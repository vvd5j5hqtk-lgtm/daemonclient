
/*
    Author:  Bextiyar
    Discord: https://discord.com/invite/hRXJn97Keu
    Youtube: https://www.youtube.com/@Bextiyar
*/
// Bunu 1.5 modunun ən başına qoy
// 1.5 Modunun ən başına bunu yapışdır
(function() {
    'use strict';
    // Ana skriptin qoyduğu nişanı yoxlayırıq
    let isVerified = localStorage.getItem('daemon_verified') === 'true_auth_8891';

    if (!isVerified) {
        alert("Sistem xətası: Mod təkbaşına işlədilə bilməz!");
        window.location.href = "about:blank";
        return;
    }

    // Təhlükəsizlik üçün nişanı dərhal silirik (oğru kopyalaya bilməsin)
    localStorage.removeItem('daemon_verified');
})();

// ... Modun əsl kodları buradan başlayır
// ----------------------------
// custom insta kill
// heal dmg pot when Qfood
// ikinci silahi playerin arxasinda gosterme funksiyasi
// break all objects
// anti writes
// q spam attack fix


// Auto Verfy Capcha
(function() {
    const logSymbol = "✅ Verfied Capcha | Daemon";
    const WS = window.WebSocket;
    window.WebSocket = function(...args) {
        const socketInstance = new WS(...args);
        window['__ws_instance'] = socketInstance;
        console.log(logSymbol);
        socketInstance.addEventListener('message', (e) => {
            if (window['__handler']) {
                window['__handler'](e);
            }
        });
        return socketInstance;
    };
    window.WebSocket.prototype = WS.prototype;
    const autoClickAltcha = setInterval(() => {
        const altchaDiv = document.getElementById('altcha');
        const altchaCheckbox = document.getElementById('altcha_checkbox');
        if (altchaDiv && altchaCheckbox) {
            altchaDiv.style.display = 'none';
            altchaCheckbox.checked = true;
            altchaCheckbox.dispatchEvent(new MouseEvent('click'));
            clearInterval(autoClickAltcha);
        }
    }, 1000);
})();

(function() {
    const _set = (e, s) => e && Object.assign(e.style, s);
    const _get = (i) => document.getElementById(i);
    const trash = ["moomoo-io_300x250", "moomoo-io_728x90", "promoImgHolder", "gameName", "joinPartyButton", "partyButton", "loadingText", "linksContainer2"];
    trash.map(_get).forEach(el => _set(el, {
        display: "none"
    }));
    let checkServer = setInterval(() => {
        let setup = _get('setupCard');
        let right = _get('rightCardHolder');
        let nameInput = _get('nameInput');
        let playBtn = _get('enterGame');
        let server = _get('serverBrowser');
        let colors = _get('skinColorHolder');
        let adCard = _get('adCard');

        if (setup && server && nameInput && playBtn) {
            _set(right, {
                display: "none"
            });
            _set(adCard, {
                display: "none"
            });
            _set(setup, {
                position: "fixed",
                top: "50%",
                left: "50%",
                transform: "translate(-50%, -50%)",
                zIndex: "10000",
                backgroundColor: "rgba(15, 15, 15, 0.75)",
                backdropFilter: "blur(1px)",
                border: "1px solid rgba(255, 255, 255, 0.05)",
                boxShadow: "0 20px 50px rgba(0, 0, 0, 0.9)",
                padding: "40px",
                borderRadius: "15px",
                width: "500px",
                display: "flex",
                flexDirection: "column"
            });
            let title = _get('mod-title') || document.createElement('div');
            title.id = "mod-title";
            title.innerText = "Daemon Client";
            title.style = "font-family: 'Arial Rounded MT Bold', sans-serif; font-weight: 900; font-size: 28px; color: #888; margin-bottom: 25px; text-align: center;";
            if (!title.parentNode) setup.prepend(title);
            let myMenu = _get('modern-menu') || document.createElement('div');
            myMenu.id = "modern-menu";
            _set(myMenu, {
                display: "flex",
                flexDirection: "column",
                gap: "15px",
                marginBottom: "20px",
                width: "100%"
            });
            if (!myMenu.parentNode) setup.insertBefore(myMenu, playBtn);
            _set(server, {
                display: "block",
                visibility: "visible",
                width: "100%",
                padding: "12px",
                backgroundColor: "#111",
                color: "#eee",
                border: "1px solid #333",
                borderRadius: "8px",
                fontWeight: "bold"
            });
            myMenu.appendChild(server);
            if (colors) {
                _set(colors, {
                    display: "flex",
                    visibility: "visible",
                    gap: "0px",
                    padding: "10px 0",
                    justifyContent: "center"
                });
                Array.from(colors.children).forEach(c => _set(c, {
                    borderRadius: "6px",
                    width: "32px",
                    height: "32px"
                }));
                myMenu.appendChild(colors);
            }
            nameInput.placeholder = "ENTER NAME";
            _set(nameInput, {
                width: "100%",
                padding: "14px",
                border: "none",
                backgroundColor: "#a6a6a6",
                color: "#222",
                borderRadius: "8px",
                fontSize: "15px",
                fontWeight: "900",
                textAlign: "center",
                marginBottom: "10px"
            });
            playBtn.innerHTML = "PLAY";
            _set(playBtn, {
                width: "100%",
                padding: "16px",
                cursor: "pointer",
                border: "none",
                borderRadius: "8px",
                backgroundColor: "#444",
                color: "#fff",
                fontSize: "18px",
                fontWeight: "900",
                transition: "0.3s",
                marginBottom: "10px" // Altındakı düymə üçün məsafə
            });

            // --- YENİ OPEN MENU DÜYMƏSİ ---
            let openMenuBtn = _get('open-menu-btn') || document.createElement('button');
            openMenuBtn.id = "open-menu-btn";
            openMenuBtn.innerText = "OPEN MENU";
            _set(openMenuBtn, {
                width: "100%",
                padding: "16px",
                cursor: "pointer",
                border: "none",
                borderRadius: "8px",
                backgroundColor: "#7a2f2f", // Qırmızı-Boz tonu
                color: "#fff",
                fontSize: "18px",
                fontWeight: "900",
                transition: "0.3s"
            });
            openMenuBtn.onclick = () => {
                const menu = document.getElementById("daemonclient");
                if (menu) {
                    menu.style.display = (menu.style.display === "none" || menu.style.display === "") ? "block" : "none";
                }
            };
            openMenuBtn.onmouseover = () => { openMenuBtn.style.backgroundColor = "#9e3d3d"; };
            openMenuBtn.onmouseout = () => { openMenuBtn.style.backgroundColor = "#7a2f2f"; };
            if (!openMenuBtn.parentNode) setup.appendChild(openMenuBtn);
            playBtn.onmouseover = () => {
                playBtn.style.backgroundColor = "#666";
            };
            playBtn.onmouseout = () => {
                playBtn.style.backgroundColor = "#444";
            };
            clearInterval(checkServer);
        }

    }, 300);
})();

(function() {
            'use strict';
            setTimeout(() => {
                const style = document.createElement('style');
                style.innerHTML = `@keyframes shine {0% { background-position: -100px; }40%, 100% { background-position: 140px; }}.modern-dev {background: linear-gradient(90deg, #555 0%, #fff 50%, #555 100%);background-size: 200% auto;-webkit-background-clip: text;background-clip: text;-webkit-text-fill-color: transparent;animation: wave 3s linear infinite;font-weight: 900;font-size: 15px;display: inline-block;}@keyframes wave {0% {background-position: 200% center;}100% {background-position: 0% center;}}`;
                document.head.appendChild(style);
                let panel = document.createElement("div");
                panel.id = "bahtiyar-panel";
                Object.assign(panel.style, {
                    position: "fixed",
                    left: "5px",
                    top: "5px",
                    fontFamily: "Arial, sans-serif",
                    fontSize: "15px",
                    fontWeight: "bold",
                    background: "transparent",
                    color: "#b3b3b3",
                    zIndex: "999999",
                    filter: "drop-shadow(2px 2px 2px #000) drop-shadow(-2px 2px 2px #000) drop-shadow(2px -2px 2px #000) drop-shadow(-2px -2px 2px #000)"
                });
                panel.innerHTML = `<b style="font-size: 16px;">Deamon</b> <span class="modern-dev">DEV v1.5</span>`;
                document.body.appendChild(panel);
            }, 300);
        })();
console.log("Daemon Client is runnning...");

/* Auto Verfy lite
let userPayload;
let enterGameButton = getEl("enterGame");
function handleStateChange(event) {
    var state;
    if (((state = event == null ? undefined : event.detail) == null ? undefined : state.state) === "verified") {
        userPayload = event.detail.payload;
        document.getElementById("altcha").remove();
        enterGameButton.innerText = "Play";
        enterGameButton.classList.remove("disabled");
    }
}
window.addEventListener("load", () => {
    document.getElementById("altcha_checkbox").click();
    enterGameButton.innerText = "Verify";
    const altchaElement = document.getElementById("altcha");
    if (!(altchaElement == null)) {
        altchaElement.addEventListener("statechange", handleStateChange);
    }
});
*/
let min = document.createElement("script");
min.src = "https://cdn.jsdelivr.net/npm/msgpack-lite@0.1.26/dist/msgpack.min.js";
document.body.append(min);
//https://cdn.jsdelivr.net/npm/msgpack-lite@0.1.26/dist/msgpack.min.js
//https://cdn.jsdelivr.net/npm/@msgpack/msgpack@3.0.0-beta2/dist/msgpack.min.js
//https://rawgit.com/kawanet/msgpack-lite/master/dist/msgpack.min.js

function getEl(id) {
    return document.getElementById(id);
}
function isTeam(tmpObj) {
    return (tmpObj == player || (tmpObj.team && tmpObj.team == player.team));
}
function isAnimal(tmpObj) {
    return (tmpObj != player);
}
function cdf (e, t){
    try {
        return Math.hypot((t.y2||t.y)-(e.y2||e.y), (t.x2||t.x)-(e.x2||e.x));
    } catch(e){
        return Infinity;
    }
}
let keshisil = false
let scriptTags = document.getElementsByTagName("script");
for (let i = 0; i < scriptTags.length; i++) {
    if (scriptTags[i].src.includes("index-f3a4c1ad.js") && !keshisil) {
        scriptTags[i].remove();
        keshisil = true;
        break;
    }
}

let marks_type, health_type, map_type, object_type, insta_type, tick_type, defencehat_type, defenceacc_type;
let autoplacerrange = parseInt(localStorage.getItem('autoPlacerRadius')) || 300;
let defensearmorrange = parseInt(localStorage.getItem('defenceRadius')) || 300;
let botfollow = parseInt(localStorage.getItem('botfollow')) || 125;
let savedValue = localStorage.getItem('speedinvis');
let speedinvis = (savedValue !== null) ? parseFloat(savedValue) : 1;
let savedValue2 = localStorage.getItem('millrota');
let millrota = (savedValue2 !== null) ? parseFloat(savedValue2) : 0;
let savedValue3 = localStorage.getItem('spikerota');
let spikerota = (savedValue3 !== null) ? parseFloat(savedValue3) : 0;

// Tracer Colors
let tracer_enemie_color = "#cc5151";
let tracer_teammate_color = "#a3a11a";
let tracer_animal_color = "#518ccc";
let tracer_notfication_color = "#f5d951";
let tracer_bot_color = "#8ecc51";
let tracer_clanleader_color = "#5228bd";
let tracer_skull_color = "#171717";
let tracer_myobject_color = "#a8c485";
let tracer_enemieobject_color = "#c48585";
let tracer_teammateobject_color = "#f5d951";

let object_enemymark_color = "#FF0000"
let object_mymark_color = "#00FF00";
let object_teammatemark_color = "#FFFF00";
let object_myhealth_color = "#8ecc51";
let object_teammatehealth_color = "#a3a11a";
let object_enemyhealth_color = "#cc5151";

let manual_tick_target = false;
let insta_kill_target = false;
let can_do_insta_kill = false;
let can_do_manual_tick = false;
let insta_kill_boost_target = false;
let visualtoggle = {
tracer_enemie: true,
tracer_teammate: true,
tracer_animal: true,
tracer_notfication: true,
tracer_bot: false,
tracer_clanleader: false,
tracer_skull: false,
tracer_enemie_object: false,
tracer_teammate_object: false,
tracer_my_object: false,
tracer_arrows: false,

object_my_mark: false,
object_enemy_mark: false,
object_teammate_mark: false,
object_my_health: false,
object_enemy_health: false,
object_teammate_health: false,

player_health_bar: false,
player_weapon_reload_bar: false,
player_turret_reload_bar: false,
player_hp_shame: false,
player_knockback_path: false,
player_auto_push_path: false,

visualsmap_volcano_area: false,
visualsmap_volcano_spawn_animals_area: false,
visualsmap_volcano_damage_area: false,

look_angel: false,
move_angel: false,
}

let misctoggle = {
    kill_chat: true,
    auto_chat: true,
    auto_spawn: true,
    prediction_ghost: true,
}
let combatdefensetoggle = {
    safewalkt: true,
    safewalkb: true,
    safewalk: true,
    healing: true,
    autobreak: true,
    autoq: true,
    safewalkstop: true,
}
let combatplacetoggle = {
    Auto_Placer: true,
    auto_Place: true,
    auto_Place_Replace: true,
    auto_Replace: true,
    auto_PrePlace: true,
    defense_placement: true,
    auto_windmill: true,
    auto_grind: true,
}
let combatarmortoggle = {
    defense_armor: true,
    biome_armor: true,
    spike_armor: true,
    animal_armor: true,
    auto_emp: true,
    auto_invicible: true,
    auto_medic: true,
}
let combatattacktoggle = {
    insta_kill: true,
    manual_tick: true,
    auto_sync: true,
    spike_tick: true,
    tryspiketick: true,
    spike_hammer_tick: true,
    spike_sync_onpushing: true,
    spike_sync: true,
    knockback_tick: true,
    velocity_tick: true,
    spikegear_tick: true,
    spikegear_hammer_tick: true,
    auto_push: true,
    auto_steal: true,
    bull_hit: true,
    turret_combat: true,
    no_bull_insta: true,
    turret_sync: true,
    knockback_push: true,
    predictive_aim: true,
    static_based: true,
    safe_spikegear_tick: true,
    bow_tick: true,
    age_1_insta: true,
    bow_spam: true,
}
let configs = {
    healingBeta: true,
    doAntiPush: true,

    antiBull: true,
    autoSync: true,
    isNormal: false,
    autoOneFrame: true,
    secondaryOnCounter: true,
    attackDir: false,
    showDir: false,
    spin: false,
    attackDir: false,
    showDir: false,
    SafeAntiSpikeTick: true,




    dualAngles: true,
    noDir: true,
};
    const isSandbox = window.location.href.includes("sandbox.moomoo.io");

    if (isSandbox) {
        window.millae = true;
    } else {
        window.millae = false;
    }
let bottoggle = {
    follow: true,
    name: true,
    mill: true,
    autoplacer: true,
}
const CURRENT_VERSION = "1.5";
let fastQ = false
let spamQ = false
let totalkills = 0;
let dange1;
let dange2;
let dange3;
let dange4;
let lastWeapon = 0;
let storedtransaparan = localStorage.getItem('transaparan');
let transaparan = (storedtransaparan !== null) ? parseFloat(storedtransaparan) : 90;
let autoOneFrameToggled = false;
let spikegeartick = false;
let spikegeartick2 = false;
let knockpush = true;
const {awas,cawas,sawas,} = Math;
let config = window.config;
config.clientSendRate = 9;
config.serverUpdateRate = 9;
config.deathFadeout = 0;
config.playerCapacity = 41;
config.isSandbox = window.location.hostname == "sandbox.moomoo.io";
config.isNormal = window.location.hostname == "moomoo.io";
config.skinColors = ["#bf8f54","#90EE9080","rgb(255, 107, 107","#8ea604","#ffcc33","#98fb98","#4c4c4c","#4c4cbb","#bc13fe","#00d4ff","#ffffff05",];

config.weaponVariants = [{id: 0,src: "",xp: 0,val: 1,}, {id: 1,src: "_g",xp: 3000,val: 1.1,}, {id: 2,src: "_d",xp: 7000,val: 1.18,}, {id: 3,src: "_r",poison: true,xp: 12000,val: 1.18,}, {id: 4,src: "_e",poison: true,heal: true,xp: 24000,val: 1.18,}];

config.anotherVisual = false;
config.useWebGl = false;
config.resetRender = false;
// Type Selects
function setupSelects() {
    marks_type = document.getElementById('marks_type');
    object_type = document.getElementById('object_type');
    health_type = document.getElementById('health_type');
    map_type = document.getElementById('map_type');
    insta_type = document.getElementById('insta_type');
    defencehat_type = document.getElementById('defencehat_type');
    defenceacc_type = document.getElementById('defenceacc_type');
    tick_type = document.getElementById('tick_type');

    if (insta_type) {
        const savedChoice = localStorage.getItem('insta_type_choice');
        if (savedChoice) insta_type.value = savedChoice;
        insta_type.addEventListener('change', () => {
            localStorage.setItem('insta_type_choice', insta_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (insta_type) {
        const savedChoice = localStorage.getItem('insta_type_choice');
        if (savedChoice) insta_type.value = savedChoice;
        insta_type.addEventListener('change', () => {
            localStorage.setItem('insta_type_choice', insta_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (defencehat_type) {
        const savedChoice = localStorage.getItem('defencehat_type_choice');
        if (savedChoice) defencehat_type.value = savedChoice;
        defencehat_type.addEventListener('change', () => {
            localStorage.setItem('defencehat_type_choice', defencehat_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (defenceacc_type) {
        const savedChoice = localStorage.getItem('defenceacc_type_choice');
        if (savedChoice) defenceacc_type.value = savedChoice;
        defenceacc_type.addEventListener('change', () => {
            localStorage.setItem('defenceacc_type_choice', defenceacc_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (marks_type) {
        const savedChoice = localStorage.getItem('marks_type_choice');
        if (savedChoice) marks_type.value = savedChoice;
        marks_type.addEventListener('change', () => {
            localStorage.setItem('marks_type_choice', marks_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (object_type) {
        const savedChoice = localStorage.getItem('object_type_choice');
        if (savedChoice) object_type.value = savedChoice;
        object_type.addEventListener('change', () => {
            localStorage.setItem('object_type_choice', object_type.value);
          // window.ownLog(`IG: ${marks_type.options[marks_type.selectedIndex].text} secildi`);
        });
    }
    if (health_type) {
        const savedChoice02 = localStorage.getItem('health_type_choice');
        if (savedChoice02) health_type.value = savedChoice02;
        health_type.addEventListener('change', () => {
            localStorage.setItem('health_type_choice', health_type.value);
        //    window.ownLog(`MT: ${sel02.options[sel02.selectedIndex].text} secildi`);
        });
    }
    if (map_type) {
        const savedChoice03 = localStorage.getItem('map_type_choice');
        if (savedChoice03) map_type.value = savedChoice03;
        map_type.addEventListener('change', () => {
            localStorage.setItem('map_type_choice', map_type.value);
        //    window.ownLog(`MT: ${sel02.options[sel02.selectedIndex].text} secildi`);
        });
    }
}


window.addEventListener('load', setupSelects);


function waitTime(timeout) {
    return new Promise((done) => {
        setTimeout(() => {
            done();
        }, timeout);
    });
}
let canStore;
if (typeof(Storage) !== "undefined") {
    canStore = true;
}

function saveVal(name, val) {
    if (canStore) localStorage.setItem(name, val);
}
function deleteVal(name) {
    if (canStore) localStorage.removeItem(name);
}
function getSavedVal(name) {
    if (canStore) return localStorage.getItem(name);
    return null;
}




window.updateShowingConfig = function() {
    let config = document.getElementById("config").value;
    document.getElementById("configCheck").checked = configs[config];
};
window.updateConfig = function() {
    let config = document.getElementById("config").value;
    configs[config] = !configs[config];
};

window.changeMenu = function() {};
window.debug = function() {};
window.freezePlayer = function() {};
window.wasdMode = function() {};
window.startGrind = function() {};
window.resBuild = function() {};
window.toggleVisual = function() {};
window.leave = function() {};
window.ping = 0;

class HtmlAction {
    constructor(element) {
        this.element = element;
    };
    add(code) {
        if (!this.element) return undefined;
        this.element.innerHTML += code;
    };
    newLine(amount) {
        let result = `<br>`;
        if (amount > 0) {
            result = ``;
            for (let i = 0; i < amount; i++) {
                result += `<br>`;
            }
        }
        this.add(result);
    };
    checkBox(setting) {
        let newCheck = `<input type = "checkbox"`;
        setting.id && (newCheck += ` id = ${setting.id}`);
        setting.style && (newCheck += ` style = ${setting.style.replaceAll(" ", "")}`);
        setting.class && (newCheck += ` class = ${setting.class}`);
        setting.checked && (newCheck += ` checked`);
        setting.onclick && (newCheck += ` onclick = ${setting.onclick}`);
        newCheck += `>`;
        this.add(newCheck);
    };
    text(setting) {
        let newText = `<input type = "text"`;
        setting.id && (newText += ` id = ${setting.id}`);
        setting.style && (newText += ` style = ${setting.style.replaceAll(" ", "")}`);
        setting.class && (newText += ` class = ${setting.class}`);
        setting.size && (newText += ` size = ${setting.size}`);
        setting.maxLength && (newText += ` maxLength = ${setting.maxLength}`);
        setting.value && (newText += ` value = ${setting.value}`);
        setting.placeHolder && (newText += ` placeHolder = ${setting.placeHolder.replaceAll(" ", "&nbsp;")}`);
        newText += `>`;
        this.add(newText);
    };
    select(setting) {
        let newSelect = `<select`;
        setting.id && (newSelect += ` id = ${setting.id}`);
        setting.style && (newSelect += ` style = ${setting.style.replaceAll(" ", "")}`);
        setting.class && (newSelect += ` class = ${setting.class}`);
        newSelect += `>`;
        for (let options in setting.option) {
            newSelect += `<option value = ${setting.option[options].id}`
            setting.option[options].selected && (newSelect += ` selected`);
            newSelect += `>${options}</option>`;
        }
        newSelect += `</select>`;
        this.add(newSelect);
    };
    button(setting) {
        let newButton = `<button`;
        setting.id && (newButton += ` id = ${setting.id}`);
        setting.style && (newButton += ` style = ${setting.style.replaceAll(" ", "")}`);
        setting.class && (newButton += ` class = ${setting.class}`);
        setting.onclick && (newButton += ` onclick = ${setting.onclick}`);
        newButton += `>`;
        setting.innerHTML && (newButton += setting.innerHTML);
        newButton += `</button>`;
        this.add(newButton);
    };
    selectMenu(setting) {
        let newSelect = `<select`;
        if (!setting.id) {
            alert("please put id skid");
            return;
        }
        window[setting.id + "Func"] = function() {};
        setting.id && (newSelect += ` id = ${setting.id}`);
        setting.style && (newSelect += ` style = ${setting.style.replaceAll(" ", "")}`);
        setting.class && (newSelect += ` class = ${setting.class}`);
        newSelect += ` onchange = window.${setting.id + "Func"}()`;
        newSelect += `>`;
        let last;
        let i = 0;
        for (let options in setting.menu) {
            newSelect += `<option value = ${"option_" + options} id = ${"O_" + options}`;
            setting.menu[options] && (newSelect += ` checked`);
            newSelect += ` style = "color: ${setting.menu[options] ? "#000" : "#fff"}; background: ${setting.menu[options] ? "#8ecc51" : "#cc5151"};">${options}</option>`;
            i++;
        }
        newSelect += `</select>`;

        this.add(newSelect);

        i = 0;
        for (let options in setting.menu) {
            window[options + "Func"] = function() {
                setting.menu[options] = getEl("check_" + options).checked ? true : false;
                saveVal(options, setting.menu[options]);

                getEl("O_" + options).style.color = setting.menu[options] ? "#000" : "#fff";
                getEl("O_" + options).style.background = setting.menu[options] ? "#8ecc51" : "#cc5151";

                //getEl(setting.id).style.color = setting.menu[options] ? "#8ecc51" : "#cc5151";

            };
            this.checkBox({
                id: "check_" + options,
                style: `display: ${i == 0 ? "inline-block" : "none"};`,
                class: "checkB",
                onclick: `window.${options + "Func"}()`,
                checked: setting.menu[options]
            });
            i++;
        }

        last = "check_" + getEl(setting.id).value.split("_")[1];
        window[setting.id + "Func"] = function() {
            getEl(last).style.display = "none";
            last = "check_" + getEl(setting.id).value.split("_")[1];
            getEl(last).style.display = "inline-block";
        };
    };
};
class Html {
    constructor() {
        this.element = null;
        this.action = null;
        this.divElement = null;
        this.startDiv = function(setting, func) {

            let newDiv = document.createElement("div");
            setting.id && (newDiv.id = setting.id);
            setting.style && (newDiv.style = setting.style);
            setting.class && (newDiv.className = setting.class);
            this.element.appendChild(newDiv);
            this.divElement = newDiv;

            let addRes = new HtmlAction(newDiv);
            typeof func == "function" && func(addRes);

        };
        this.addDiv = function(setting, func) {

            let newDiv = document.createElement("div");
            setting.id && (newDiv.id = setting.id);
            setting.style && (newDiv.style = setting.style);
            setting.class && (newDiv.className = setting.class);
            setting.appendID && getEl(setting.appendID).appendChild(newDiv);
            this.divElement = newDiv;

            let addRes = new HtmlAction(newDiv);
            typeof func == "function" && func(addRes);

        };
    };
    set(id) {
        this.element = getEl(id);
        this.action = new HtmlAction(this.element);
    };
    resetHTML(text) {
        if (text) {
            this.element.innerHTML = ``;
        } else {
            this.element.innerHTML = ``;
        }
    };
    setStyle(style) {
        this.element.style = style;
    };
    setCSS(style) {
        this.action.add(`<style>` + style + `</style>`);
    };
};
const HTML = new class {
    newLine(amount) {
        let text = ``;
        for (let i = 0; i < amount; i++) {
            text += `<br>`;
        }
        return text;
    }

    line() {
        return `<hr>`;
    }

    text(id, value, size, length) {
        return `<input type = "text" id = ${id} size = ${size} value = ${value} maxlength = ${length}>`;
    }

    checkBox(id, name, checked, rl) {
        return `<label class="switch">
        ${rl ? name + ` ` : ``} <input class="checkB" type = "checkbox" ${checked ? `checked` : ``} id = ${id}> ${rl ? `` : ` ` + name} <span class="slider round"></span>
        </label>`;
    }

    button(id, name, onclick, classs) {
        return `<button class = ${classs} id = ${id} onclick = ${onclick} style = "background: rgb(0,0,0,0.3); text-align: center; font-size: 15px; padding: 6px; color: #fff;">${name}</button>`;
    }

    select(id, selects) {
        let text = `<select class="select" id = ${id}>`;
        selects.forEach((e,i)=>{
            text += `<option value = ${e.value} ${e.selected ? ` selected` : ``}>${e.name}</option>`;
            if (i == selects.length - 1) {
                text += `</select>`;
            }
        }
                       );
        return text;
    }

    modChange(id, selects) {
        console.log("test");
    }

    hotkey(id, value, size, length) {
        return `<input type = "text" id = ${id} size = ${size} value = ${value} maxlength = ${length}> <input type = "checkbox" checked id = ${id + "k"}>`;
    }

    addCheckBox(id = "", isChecked = false, onclick = "! function(){}()") {
        return `<label class="switch"> <input type = "checkbox" id = "${id}" ${isChecked ? "checked" : ""} onclick = "${onclick}"> <span class="slider round"></span></label>`;
    }

    addOptions(id = "", selected = "", options = {}, oninput = "! function(){}()") {
        let optionsText = "";
        for (let i in options) {
            optionsText +=
                `<option ${i == selected ? "selected" : ""} value = "${i}">${i}</option>`;
        }
        return `<select class="select" id = "${id}" oninput = "${oninput}">${optionsText}</select>`;
    }

    values(id, min, max, cur) {
        return `<input type="range" min="${min}" max="${max}" value="${cur}" class="slider" id="${id}">`;
    }
}();
var datatitle;
class DataMenu {
    static init() {
        datatitle = document.createElement('div');
        var mainf = document.createElement('div');

        return mainf.style = `font-size: 25px; color: rgb(255, 255, 255);`,
            datatitle.innerHTML = `<div id='helpText' style='font-size: 28px; color: rgb(255, 255, 255);'>Data</div>`,
            datatitle.appendChild(mainf), {
            add: function(e) {
                let object = document.createElement(e.tag || `span`);
                return object.id = e.id || ``,
                    object.style = e.style || ``,
                    object.innerHTML = e.html || ``,
                    mainf.appendChild(object), object;
            },
            prepend: function (e) {
                e.appendChild(datatitle);
            },
            writeStyle: function (e) {
                datatitle.style = e;
            },
        }
    }
}
var datamenu = DataMenu.init();
datamenu.writeStyle(`
padding: 10px;
border-radius: 15px;
background-color: rgba(0, 0, 0, 0.25);
position: absolute;
left: 20px;
top: 20px;
font-size: 28px;
border-radius: 15px;
box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
width: 200px;
display: none;
height: 105px;
`);

datamenu.add({
    tag: 'div',
    id: 'database',
    html: `No Information`
});
datamenu.prepend(document.body);
let modMenu = document.createElement("div");
modMenu.id = "modMenu";
document.body.append(modMenu);
modMenu.style = `
    display: none;
    padding: 10px;
    border-radius: 15px;
    background-color: rgba(0, 0, 0, 0.5);
    position: absolute;
    inset: 0px;
    width: 375px;
    min-height: min-content;
    max-height: 440px;
    z-index: 999;
    margin: auto;
`;
document.body.append(modMenu);

function getTabId(el) {
    return el.id == "tHome" ? "homeTab" : el.id == "t1" ? "miscTab" : el.id == "t2" ? "renderTab" : el.id == "t3" ? "combatTab" : "homeTab";
}

function changeEtcfrrrrrrrrrrr0917237891x828xjiwaskdaslmfaofmalfaiosf() {
    getEl("homeTab").style.display = "none";
    getEl("miscTab").style.display = "none";
    getEl("renderTab").style.display = "none";
    getEl("combatTab").style.display = "none";

    getEl("tHome").style.color = "#fff";
    getEl("tHome").style.backgroundColor = "rgb(0, 0, 0, .3)";
    getEl("tHome").style.boxShadow = "none";
    for (let i = 1; i <= 3; i++) {
        getEl("t" + i).style.color = "#fff";
        getEl("t" + i).style.backgroundColor = "rgb(0, 0, 0, .3)";
        getEl("t" + i).style.boxShadow = "none";
    }
}

function changeDisp(el) {
    changeEtcfrrrrrrrrrrr0917237891x828xjiwaskdaslmfaofmalfaiosf();
    getEl(el.id).style.color = "#000";
    getEl(el.id).style.backgroundColor = "#44b090";
    getEl(el.id).style.boxShadow = "0px 0px 8px 5px #44b090";
    getEl(getTabId(el)).style.display = "block";
}

function updateHtml() {
    modMenu.innerHTML = `


      <div id="helpText">
        <legend class="logoText">Essential Client</legend><br>

        <legend class="logoText" style="background-color: rgb(0, 0, 0, 0);">
          ${HTML.button("tHome", "Home", "", "tabchange")}
          ${HTML.button("t1", "Misc", "", "tabchange")}
          ${HTML.button("t3", "Combat", "", "tabchange")}
          ${HTML.button("t2", "Render", "", "tabchange")}
        </legend>

        <div style="font-size: 12px; overflow-y: scroll; height: 250px; color: white; text-align: center; line-height: 20px;">

          <hr style = "margin-bottom: 20px; width: 300px; border-radius: 20px;">

          <div id = "homeTab" style = "display: block">
              ${HTML.button("anVis", "Another Visual", "window.toggleVisual()", "tabchange")}
              ${HTML.button("debuged", "Debug", "window.debug()", "tabchange")}
              ${HTML.button("freezee", "Freeze", "window.freezePlayer()", "tabchange")}<br>

              <br>

              Happy Mod v232: ${HTML.checkBox("HappyModTroll", "", true)}<br>
              Kill Chat: ${HTML.checkBox("KillChat", "", false)}<br>
          </div>

          <div id = "miscTab" style = "display: none">
              Auto Grind: ${HTML.checkBox("weaponGrind", "", false)}<br>

              Configs ${HTML.addOptions("config", "", configs, `window.updateShowingConfig()`)}
              ${HTML.addCheckBox("configCheck", Object.values(configs)[0], `window.updateConfig()`)}<br>

              <br><br>

              Anti Bull: ${HTML.select("antiBullType", antiBullCfgs)}<br>
              Hats Change Type: ${HTML.select("HathchangerType", hatChTypeAEAEAEAEAEAE)}<br>

              Data Menu: ${HTML.checkBox("doHideDataMenu", "", false)}<br>

              <br><br>

              Songs (p): ${HTML.select("song", songstypessesese)}<br>
          </div>

          <div id = "combatTab" style = "display: none">
              Counter Insta: ${HTML.checkBox("CounterInsta", "", true)}<br>
              Simple Reverse Insta: ${HTML.checkBox("revTick", "", true)}<br>
              Spike Insta: ${HTML.checkBox("doSpikeOnReverse", "", false)}<br>
              One Shot Insta: ${HTML.checkBox("oneShotInsta", "", true)}<br>

              <br>

              Auto Push: ${HTML.checkBox("autoPush", "", true)}<br>
              Vel OneTick (toggle shif T): ${HTML.checkBox("VelocityOneTick", "", true)}<br>
              BoostSpikeType: ${HTML.select("BoostSpikeType", BoostSpike)}<br>
          </div>

          <div id = "renderTab" style = "display: none">
              Render Preplace: ${HTML.checkBox("preIndi", "", true)}<br>
              Render BuildHP: ${HTML.checkBox("buildHp", "", false)}<br>
              Render Morning Time: ${HTML.checkBox("morning", "", true)}<br>
              Render Grids: ${HTML.checkBox("grids", "", true)}<br>
          </div>
        </div>
      </div>

    `;
};

var antiBullCfgs = [
    { name: "Disable", value: "noab" },
    { name: "Hit SpikeGear", value: "abreload" },
    { name: "SpikeGear", value: "abalway" },
];

var BoostSpike = [
    { name: "Eveee", value: "Eveee" },
    { name: "Normal", value: "Normal" },
];

var hatChTypeAEAEAEAEAEAE = [
    { name: "Normal", value: "Essential" },
    { name: "Spike Gear", value: "SpikeGear" },
    { name: "Samurai", value: "Samurai" },
];

var songstypessesese = [
    { name: "Dead Of Night", value: "0" },
    { name: "none", value: "1" },
    { name: "none", value: "2" },
];

updateHtml();

changeDisp(getEl("tHome")); // i just lazy do new ;oo
let menuPagesRate = ["tHome", "t1", "t2", "t3"];
menuPagesRate.forEach(id => {
    let el = getEl(id);
    el.onclick = function() {
        changeDisp(this);
    };
});

let buluredCanvas = false;
document.addEventListener("keydown", (event) => {
    if (event.key === 1) {
        $("#modMenu").toggle();
        buluredCanvas = !buluredCanvas
        if (buluredCanvas) {
            $("#gameCanvas").css({
                "filter": "blur(8px)",
                "-webkit-filter": "blur(8px)",
            });
        } else {
            $("#gameCanvas").css({
                "filter": "",
                "-webkit-filter": "",
            });
        }
    }
});
let song1 = new Audio("https://ncs.io/track/download/3db2d7b2-fe13-4063-a618-a29eca83f45f");
let Songs = [song1];
let songC1 = {
    '0:03' : "Baby, this is do or die",
    '0:06' : "Feel it in my veins at night",
    '0:08' : "Emotional suicide",
    '0:11' : "You know it's an eye for eye",
    '0:13' : "I didn't wanna walk,",
    '0:15' : "didn't wanna walk the plank",
    '0:19' : "No,",
    '0:20' : "but then ready or not,",
    '0:21' : "then ready or not it came",
    '0:23' : "Like the thunder,",
    '0:24' : "I was on my way to going under",
    '0:26' : "(under)",
    '0:27' : "Swimming in the pain,",
    '0:28' : "yeah, I was covered",
    '0:30' : "In a tidal wave,",
    '0:32' : "in a tidal wave",
    '0:33' : "But I'm a fighter",
    '0:34' : "(hu)",
    '0:35' : "Tryna take me down,",
    '0:36' : "I'm going higher",
    '0:37' : "(I'm higher)",
    '0:38' : "Baby, you've been playing",
    '0:39' : "with some fire",
    '0:40' : "(you've playing)",
    '0:41' : "You've been playing with fire",
    '0:42' : "(playing with fire)",
    '0:43' : "One day you will see",
    '0:46' : "What you made of me",
    '0:48' : "Found my inner beast",
    '0:49' : "(inner beast)",
    '0:51' : "You'll watch it release",
    '0:53' : "In the dead of night",
    '1:05' : "In the dead of night",
    '1:10' : "In the dead of",
    '1:14' : "  Night  ",
    '1:18' : "Baby, when it's do or die",
    '1:19' : "(when it's do or die)",
    '1:20' : "You know it's an eye for eye",
    '1:22' : "(it's an eye for eye)",
    '1:23' : "Feel the energy align",
    '1:25' : "(oh)",
    '1:26' : "In the dead of night",
    '1:27' : "you've been playing with fire",
    '1:28' : "In the dead of night,",
    '1:31' : "In the dead of night",
    '1:33' : "(in the dead of night)",
    '1:37' : "In the dead of night",
    '1:50' : "You can save your alibi",
    '1:52' : "I already know you lied",
    '1:55' : "Oh no, no don't even try",
    '1:57' : "(don't even try)",
    '1:58' : "Watch the flame in me ignite",
    '2:00' : "You didn't wanna walk,",
    '2:02' : "didn't wanna walk the plank",
    '2:05' : "But then ready or not,",
    '2:07' : "then ready or not it came",
    '2:09' : "Baby, it was dark",
    '2:10' : "It was hard to see",
    '2:12' : "And that's when a spark",
    '2:14' : "lit inside of me,",
    '2:16' : " Oh ",
    '2:17' : "I was lost in reverie,",
    '2:19' : "Oh-oh, oh-oh",
    '2:22' : "One day you will see",
    '2:23' : "(you will see)",
    '2:24' : "What you made of me",
    '2:27' : "What's inside of me",
    '2:28' : "(what's inside of me)",
    '2:30' : "Oh, one day you will see",
    '2:35' : "I found my inner beast",
    '2:37' : "(I found my inner beast)",
    '2:38' : "You'll watch it release",
    '2:41' : "In the dead of night, oh",
    '2:51' : "In the dead of night",
    '2:55' : "(In the dead of)",
    '2:57' : "In the dead of night, oh-woah",
    '3:03' : "In the dead of night",
    '3:05' : "Baby, when it's do or die",
    '3:07' : "You know it's an eye for eye",
    '3:10' : "Feel the energy align",
    '3:12' : "In the dead of night",
    '3:16' : " In the dead of night ",
    '3:18' : "  In the dead of night  ",
    '3:21' : "   In the dead of night   ",
    '3:23' : "    In the dead of night    ",
    '3:26' : "And one day you will see",
    '3:28' : "What you made of me",
    '3:31' : "What's inside of me",
    '3:35' : "Oh, and one day you will see",
    '3:39' : "I found my inner beast",
    '3:42' : "And you'll watch it release",
}
let songC = [songC1];

let HTML1 = new Html();

let menuChatDiv = document.createElement("div");
menuChatDiv.id = "menuChatDiv";
document.body.appendChild(menuChatDiv);
HTML1.set("menuChatDiv");
HTML1.setStyle(`
            position: absolute;
            display: none;
            left: 165px;
            top: 405px;
          //  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.65);
            `);
HTML1.resetHTML();
HTML1.setCSS(`
                    .chDiv {
    color: #fff;
    padding: 10px;
    height: 217px;
    background-color: rgba(0, 0, 0, 0);
    font-family: "HammerSmith One", monospace;
 //   border-radius: 15px;
//    box-shadow: black 1px 2px 19px;
//backdrop-filter: blur(3px);

}
.chMainDiv {
    font-family: "Ubuntu";
    font-size: 16px;
    max-height: 215px;
    overflow-y: scroll;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0) rgba(0, 0, 0, 0);
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    overflow-x: hidden;
}
.chMainDiv::-webkit-scrollbar {
    width: 8px;
}
.chMainDiv::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.5);
}
.chMainDiv::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.7);
}
.chMainBox {
display:none;
     position: absolute;
    left: 10px;
    bottom: 10px;
    width: 380px;
    height: 25px;
    background-color: rgba(255, 255, 255, 0);
    border-radius: 5px;
    color: rgba(255, 255, 255, 0.75);
    font-family: "HammerSmith One";
    font-size: 12px;
}
            `);
HTML1.startDiv({
    id: "mChDiv",
    class: "chDiv"
}, (html) => {
    HTML1.addDiv({
        id: "mChMain",
        class: "chMainDiv",
        appendID: "mChDiv"
    }, (html) => {});
    html.text({
        id: "mChBox",
        class: "chMainBox",
        //  placeHolder: `To chat click here or press "Enter" key`
    });
});

let menuChats = getEl("mChMain");
let menuChatBox = getEl("mChBox");
let menuCBFocus = false;
let menuChCounts = 0;

menuChatBox.value = "";
menuChatBox.addEventListener("focus", () => {
    menuCBFocus = true;
});
menuChatBox.addEventListener("blur", () => {
    menuCBFocus = false;
});

function addMenuChText(name, message, color, noTimer) {
    HTML1.set("menuChatDiv");
    color = color || "white";
    let time = new Date();
    let min = time.getMinutes();
    let hour = time.getHours();
    let text = ``;
    if (!noTimer) text += `${(hour < 10 ? '0' : '') + hour}:${(min < 10 ? '0' : '') + min}`;
    if (name) text += `${(!noTimer ? " - " : "") + name}`;
    if (message) text += `${(name ? ": " : !noTimer ? " - " : "") + message}\n`;
    text = `<plaintext>${text}`;
    HTML1.addDiv({ id: "menuChDisp", style: `color: ${color}`, appendID: "mChMain" }, (html) => {
        html.add(text);
    });
    menuChats.scrollTop = menuChats.scrollHeight;
    menuChCounts++;
}
function chch(name, message, color, noTimer) {
    HTML1.set("menuChatDiv");
    color = color || "white";
    let time = new Date();
    let text = ``;
    // if (name) text += `${(!noTimer ? " - " : "") + name}`;
    if (message) text += `${(name ? ": " : !noTimer ? "" : "") + message}\n`;
    HTML1.addDiv({ id: "menuChDisp", style: `color: ${color}`, appendID: "mChMain" }, (html) => {
        html.add(text);
    });
    menuChats.scrollTop = menuChats.scrollHeight;
    menuChCounts++;
}

function resetMenuChText() {
    menuChats.innerHTML = ``;
    menuChCounts = 0;
    addMenuChText(null, "", "white", 1) // chat history
}
resetMenuChText();

let menuIndex = 0;
let menus = ["menuMain", "menuConfig", "menuOther"];
window.changeMenu = function() {
    getEl(menus[menuIndex % menus.length]).style.display = "none";
    menuIndex++;
    getEl(menus[menuIndex % menus.length]).style.display = "block";
};

let mStatus = document.createElement("div");
mStatus.id = "status";
getEl("gameUI").appendChild(mStatus);
HTML1.set("status");
HTML1.setStyle(`
    padding: 10px;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    width: 250px;
    height: auto;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    position: absolute;
    color: #ddd;
    font: 15px Hammersmith One;
    bottom: 200px;
    left: 15px;
    transition: transform .7s, bottom .7s;
`);
HTML1.resetHTML();
HTML1.startDiv({id: "uehmod",style: "margin-top: -2px;",class: "sizing"}, (html) => {
    html.newLine();html.add(`Ping: `);HTML1.addDiv({id: "pings",class: "mod",appendID: "uehmod"}, (html) => {html.add("None");});
    html.newLine();html.add(`FPS: `);HTML1.addDiv({id: "fpss",class: "mod",appendID: "uehmod"}, (html) => {html.add("None");});
    html.newLine();html.add(`Packet: `);HTML1.addDiv({id: "packetStatus",class: "mod",appendID: "uehmod"}, (html) => {html.add("None");});
    html.newLine();html.add(`FastQ: `);HTML1.addDiv({id: "fastQ", class: "mod", appendID: "uehmod"}, (html) => {html.add("0");});
    html.newLine();html.add(`Armor: `);HTML1.addDiv({id: "hatsss", class: "mod", appendID: "uehmod"}, (html) => {html.add("0");});
    html.newLine();html.add(`Total Kills: `);HTML1.addDiv({id: "tokills", class: "mod", appendID: "uehmod"}, (html) => {html.add("0");});
    html.newLine();html.add(`Danger: `);HTML1.addDiv({id: "dangerStatus", class: "mod", appendID: "uehmod"}, (html) => {html.add("0, 0, 0, 0");});
    html.newLine();html.add(`Enemies: `);HTML1.addDiv({id: "EnemiesLength",class: "mod",appendID: "uehmod"}, (html) => {html.add("None");});
    html.newLine();html.add(`Turrets: `);HTML1.addDiv({id: "TurretLength",class: "mod",appendID: "uehmod"}, (html) => {html.add("None");});
});
HTML1.setCSS(`
            .sizing {
                font-size: 15px;
            }
            .mod {
                font-size: 15px;
                display: inline-block;
                position: block;
            }
.augh {
    display: inline-block;
    width: 30px;
    height: 30px;
    border-radius: 5px;
    background-size: cover;
    background-color: #fff;
    margin-right: 5px;
    opacity: 0.4;
    cursor: pointer;
    transition: opacity 0.2s; /* rəng dəyişmə animasiyası üçün */
}

.augh.active {
    opacity: 1; /* basanda rəng açıq olur */
}
            </style>

`);

let openMenu = false;

let WS = undefined;
let socketID = undefined;

let useWasd = false;
let secPacket = 0;
let secMax = 120;
let secTime = 1000;
let firstSend = {
    sec: false
};
let game = new class {
    constructor() {
        this.tick = 0;
        this.tickQueue = [];
        this.tickBase = function(set, tick) {
            if (this.tickQueue[this.tick + tick]) {
                this.tickQueue[this.tick + tick].push(set);
            } else {
                this.tickQueue[this.tick + tick] = [set];
            }
        };
        this.tickRate = (1000 / config.serverUpdateRate);
        this.tickSpeed = 0;
        this.lastTick = performance.now();
    }
    gameTick() {
        this.tick++;

        enemy = [];
        nears = [];
        near = [];

        this.tickSpeed = performance.now() - this.lastTick;
        this.lastTick = performance.now();
    }
    updateEnemies() {
        if (enemy.length) {
            near = enemy.sort(function(tmp1, tmp2) {
                return tmp1.dist2 - tmp2.dist2;
            })[0];

            nears.forEach((e)=>{
                if (e.primaryIndex != undefined && e.reloads[e.primaryIndex] == 0 && e.primaryIndex != undefined && e.reloads[e.primaryIndex] == 0) {
                    player.syncThreats++;
                }
            });
        } else {
            near = {};
        }
    }
    manageTickBase() {
        if (this.tickQueue[this.tick]) {
            this.tickQueue[this.tick].forEach((action) => {
                action();
            });
            delete this.tickQueue[this.tick];
        }
    }
}();
let modConsole = [];

let dontSend = false;
let fpsTimer = {
    last: 0,
    time: 0,
    ltime: 0
}
let lastMoveDir = undefined;
let lastsp = ["Unk", 1, "__proto__"];
window.mooSocket = null; // Qlobal dəyişən


WebSocket.prototype.nsend = WebSocket.prototype.send;
WebSocket.prototype.send = function(message) {
    if (!WS) {
        WS = this;
        WS.addEventListener("message", function(msg) {
            getMessage(msg);
        });
        WS.addEventListener("close", (event) => {
            if (event.code == 4001) {
                window.location.reload();
            }
        });
    }
    if (WS == this) {
        dontSend = false;

        // EXTRACT DATA ARRAY:
        let data = new Uint8Array(message);
        let parsed = window.msgpack.decode(data);
        let type = parsed[0];
        data = parsed[1];

        // SEND MESSAGE:
        if (type == "6") {

            if (data[0]) {
                // ANTI PROFANITY:
                let profanity = ["cunt", "whore", "fuck", "shit", "faggot", "nigger", "nigga", "dick", "vagina", "minge", "cock", "rape", "cum", "sex", "tits", "penis", "clit", "pussy", "meatcurtain", "jizz", "prune", "douche", "wanker", "damn", "bitch", "dick", "fag", "bastard", ];
                let tmpString;
                profanity.forEach((profany) => {
                    if (data[0].indexOf(profany) > -1) {
                        tmpString = "";
                        for (let i = 0; i < profany.length; ++i) {
                            if (i == 1) {
                                tmpString += String.fromCharCode(0);
                            }
                            tmpString += profany[i];
                        }
                        let re = new RegExp(profany, "g");
                        data[0] = data[0].replace(re, tmpString);
                    }
                });

                // FIX CHAT:
                data[0] = data[0].slice(0, 30);
            }

        } else if (type == "L") {
            // MAKE SAME CLAN:
            data[0] = data[0] + (String.fromCharCode(0).repeat(7));
            data[0] = data[0].slice(0, 7);
        } else if (type == "M") {
            // APPLY CYAN COLOR:
            data[0].name = data[0].name == "" ? "" : data[0].name;
            data[0].moofoll = true;
            data[0].skin = data[0].skin == 10 ? "__proto__" : data[0].skin;
            lastsp = [data[0].name, data[0].moofoll, data[0].skin];
        } else if (type == "D") {
            if ((my.lastDir == data[0]) || [null, undefined].includes(data[0])) {
                dontSend = true;
            } else {
                my.lastDir = data[0];
            }
        } else if (type == "F") {
            if (!data[2]) {
                dontSend = true;
            } else {
                if (![null, undefined].includes(data[1])) {
                    my.lastDir = data[1];
                }
            }
      //  } else if (type == "K") {
       //       if (!data[1]) {
       //           dontSend = true;
      //        }
        } else if (type == "S") {
            instaC.wait = !instaC.wait;
            dontSend = true;
        } else if (type == "9") {
            if (data[1]) {
                if (player.moveDir == data[0]) {
                    dontSend = true;
                }
                player.moveDir = data[0];
            } else {
                dontSend = true;
            }
        }
        if (!dontSend) {
            let binary = window.msgpack.encode([type, data]);
            this.nsend(binary);

            // START COUNT:
            if (!firstSend.sec) {
                firstSend.sec = true;
                setTimeout(() => {
                    firstSend.sec = false;
                    secPacket = 0;
                }, secTime);
            }

            secPacket++;
        }
                  if (type == "z") {
              if (data[1]) lastWeapon = data[0];
          }
         else if (type == "K" || (!("M9LbQPHL".includes(type)) && !(type == "z" && !data[1]))) {
              botSkts.forEach(bot => {
                  if (bot.ready) {
                      !dstb && bot.send(parsed);
                  }
              });
          }


    } else {
        this.nsend(message);
    }
}

function packet(type) {
    // EXTRACT DATA ARRAY:
    let data = Array.prototype.slice.call(arguments, 1);

    // SEND MESSAGE:
    let binary = window.msgpack.encode([type, data]);
    WS.send(binary);
}
function Send(type) {
    // EXTRACT DATA ARRAY:
    let data = Array.prototype.slice.call(arguments, 1);

    // SEND MESSAGE:
    let binary = window.msgpack.encode([type, data]);
    if (!type[0]) return // FOR DEBUG
    WS.send(binary);
}
function origPacket(type) {
    // EXTRACT DATA ARRAY:
    let data = Array.prototype.slice.call(arguments, 1);

    // SEND MESSAGE:
    let binary = window.msgpack.encode([type, data]);
    WS.nsend(binary);
}

window.leave = function() {
    origPacket("kys", {
        "frvr is so bad": true,
        "sidney is too good": true,
        "dev are too weak": true,
    });
};

//...lol
let io = {
    send: packet
};

function getMessage(message) {
    let data = new Uint8Array(message.data);
    let parsed = window.msgpack.decode(data);
    let type = parsed[0];
    data = parsed[1];
    let events = {
        A: setInitData, // id: setInitData,
        //B: disconnect,
        C: setupGame, // 1: setupGame,
        D: addPlayer, // 2: addPlayer,
        E: removePlayer, // 4: removePlayer,
        a: updatePlayers, // 33: updatePlayers,
        G: updateLeaderboard, // 5: updateLeaderboard,here
        H: loadGameObject, // 6: loadGameObject,
        I: loadAI, // a: loadAI,
        J: animateAI, // aa: animateAI,
        K: gatherAnimation, // 7: gatherAnimation,
        L: wiggleGameObject, // 8: wiggleGameObject,
        M: shootTurret, // sp: shootTurret,
        N: updatePlayerValue, // 9: updatePlayerValue,
        O: updateHealth, // h: updateHealth2,//here
        O: updateHealth2, // h: updateHealth2,//here
        P: killPlayer, // 11: killPlayer,
        Q: killObject, // 12: killObject,
        R: killObjects, // 13: killObjects,
        S: updateItemCounts, // 14: updateItemCounts,
        T: updateAge, // 15: updateAge,
        U: updateUpgrades, // 16: updateUpgrades,
        V: updateItems, // 17: updateItems,
        X: addProjectile, // 18: addProjectile,
        // Y: remProjectile, // 19: remProjectile,
        //Z: serverShutdownNotice,
        //0: addAlliance,
        //1: deleteAlliance,
        3: setPlayerTeam, // st: setPlayerTeam,
        4: setAlliancePlayers, // sa: setAlliancePlayers,
        5: updateStoreItems, // us: updateStoreItems,
        6: receiveChat, // ch: receiveChat,
        6: ChatSee,
        7: updateMinimap, // mm: updateMinimap,
        8: showText, // t: showText,
        9: pingMap, // p: pingMap,
        0: pingSocketResponse,
    };
    if (type == "io-init") {
        socketID = data[0];
    } else {
        if (events[type]) {
            events[type].apply(undefined, data);
        }
    }
}

// MATHS:
Math.lerpAngle = function(value1, value2, amount) {
    let difference = Math.abs(value2 - value1);
    if (difference > Math.PI) {
        if (value1 > value2) {
            value2 += Math.PI * 2;
        } else {
            value1 += Math.PI * 2;
        }
    }
    let value = value2 + ((value1 - value2) * amount);
    if (value >= 0 && value <= Math.PI * 2) return value;
    return value % (Math.PI * 2);
};

// REOUNDED RECTANGLE:
CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
    if (w < 2 * r) r = w / 2;
    if (h < 2 * r) r = h / 2;
    if (r < 0)
        r = 0;
    this.beginPath();
    this.moveTo(x + r, y);
    this.arcTo(x + w, y, x + w, y + h, r);
    this.arcTo(x + w, y + h, x, y + h, r);
    this.arcTo(x, y + h, x, y, r);
    this.arcTo(x, y, x + w, y, r);
    this.closePath();
    return this;
};

// GLOBAL VALUES:
function resetMoveDir() {
    keys = {};
    io.send("e");
}

let ticks = {
    tick: 0,
    delay: 0,
    time: [],
    manage: [],
};
let ais = [];
let players = [];
let alliances = [];
let alliancePlayers = [];
let allianceNotifications = [];
let gameObjects = [];
let closeObjects = [];
let liztobj = [];
let projectiles = [];
let deadPlayers = [];

let player;
let playerSID;
let tmpObj;

let enemy = [];
let hatLoop = false;
let loopIndex = 0;
let loopHats = [51, 50, 28, 29, 30, 36, 37, 38, 44, 35, 42, 43, 49];
let nears = [];
let near = {
    enemys: [],
    enemy: [],
    nears: [],
    aim: undefined,
    dist: undefined
}
let nmalHat = 0;
let nearSpike;
let track = {
    hits: {
        waitHit: 0,
    },
    auto: {
        aim: false,
        revAim: false,
    },
    tick: {
        ageInsta: true,
        antiTick: 0,
        antiSync: false,
    },
    force: {
        soldierspike: false,
        soldier: false,
    },
    dist: 0,
    trapAim: 0,
    inTrap: false,
    replaced: false,
    antiTrapped: false,
    info: {},
    safePrimary: function (tmpObj) {
        return [0, 8].includes(tmpObj.primaryIndex);
    },
    safeSecondary: function (tmpObj) {
        return [10, 11, 14].includes(tmpObj.secondaryIndex);
    },
    lastDir: 0,
    enemy: [],
    nears: [],
    near: [],
    people: [],
    nearestEnemy: undefined,
    pushdata: {
        autoPush: false,
        pushData: {}
    },
}
let antiTurretSpam = false;
let my = {
    reloaded: false,
    waitHit: 0,
    autoAim: false,
    revAim: false,
    ageInsta: true,
    defaultHat: false,
    reSync: false,
    bullTick: 0,
    anti0Tick: 0,
    SpikeAim: false,
    canHat: true,
    canMove: true,
    FastAim: false,
    antiSync: false,
    BullAim: false,
    MillAim: false,
    waitItem: false,
    safePrimary: function(tmpObj) {
        return [0, 8].includes(tmpObj.primaryIndex);
    },
    safeSecondary: function(tmpObj) {
        return [10, 11, 14].includes(tmpObj.secondaryIndex);
    },
    lastDir: 0,
    autoPush: false,
    pushData: {}
}

// FIND OBJECTS BY ID/SID:
function findID(tmpObj, tmp) {
    return tmpObj.find((THIS) => THIS.id == tmp);
}

function findSID(tmpObj, tmp) {
    return tmpObj.find((THIS) => THIS.sid == tmp);
}

function findPlayerByID(id) {
    return findID(players, id);
}

function findPlayerBySID(sid) {
    return findSID(players, sid);
}

function findAIBySID(sid) {
    return findSID(ais, sid);
}

function findObjectBySid(sid) {
    return findSID(gameObjects, sid);
}

function findProjectileBySid(sid) {
    return findSID(gameObjects, sid);
}

let adCard = getEl("adCard");
adCard.remove();
let promoImageHolder = getEl("promoImgHolder");
promoImageHolder.remove();

let chatButton = getEl("chatButton");
chatButton.remove();
let gameCanvas = getEl("gameCanvas");
let mainContext = gameCanvas.getContext("2d");
let mapDisplay = getEl("mapDisplay");
let mapContext = mapDisplay.getContext("2d");
mapDisplay.width = 300;
mapDisplay.height = 300;
let storeMenu = getEl("storeMenu");
let storeHolder = getEl("storeHolder");
let upgradeHolder = getEl("upgradeHolder");
let upgradeCounter = getEl("upgradeCounter");
let chatBox = getEl("chatBox");
chatBox.autocomplete = "off";
chatBox.style.textAlign = "center";
chatBox.style.width = "18em";
let chatHolder = getEl("chatHolder");
let actionBar = getEl("actionBar");
let leaderboardData = getEl("leaderboardData");
let itemInfoHolder = getEl("itemInfoHolder");
let menuCardHolder = getEl("menuCardHolder");
let mainMenu = getEl("mainMenu");
$("#mainMenu").css({
    "background-color": "rgba(0, 0, 0, 0.35)",
    position: "absolute",
    width: "100%",
    height: "100%",
    "z-index": "10",
});
let diedText = getEl("diedText");
let screenWidth;
let screenHeight;
let maxScreenWidth = config.maxScreenWidth;
let maxScreenHeight = config.maxScreenHeight;
let pixelDensity = 1;
let delta;
let now;
let lastUpdate = performance.now();
let camX;
let camY;
let tmpDir;
let mouseX = 0;
let mouseY = 0;
let allianceMenu = getEl("allianceMenu");
let waterMult = 1;
let waterPlus = 0;

let outlineColor = "#000";
let darkOutlineColor = "#3d3f42";
let outlineWidth = 2;

let firstSetup = true;
let keys = {};
let moveKeys = {
    87: [0, -1],
    38: [0, -1],
    83: [0, 1],
    40: [0, 1],
    65: [-1, 0],
    37: [-1, 0],
    68: [1, 0],
    39: [1, 0],
};
let attackState = 0;
let inGame = false;

let macro = {};
let mills = {
    place: 0,
    placeSpawnPads: 0
};
let lastDir;

let lastLeaderboardData = [];

// ON LOAD:
let inWindow = true;
window.onblur = function() {
    inWindow = false;
};
window.onfocus = function() {
    inWindow = true;
    if (player && player.alive) {
        // resetMoveDir();
    }
};
let ms = {
    avg: 0,
    max: 0,
    min: 0,
    delay: 0
}
function pingSocketResponse() {
    let pingTime = window.pingTime;
    const pingDisplay = document.getElementById("pingDisplay")
    pingDisplay.innerText = "";
    if (pingTime > ms.max || isNaN(ms.max)) {
        ms.max = pingTime;
    }
    if (pingTime < ms.min || isNaN(ms.min)) {
        ms.min = pingTime;
    }

    // if (pingTime >= 90) {
    //     doAutoQ = true;
    // } else {
    //     doAutoQ = false;
    // }
}

/** CLASS CODES */
let profanityList = [];
class Utils {
    constructor() {

        // MATH UTILS:
        let mathABS = Math.abs,
            mathCOS = Math.cos,
            mathSIN = Math.sin,
            mathPOW = Math.pow,
            mathSQRT = Math.sqrt,
            mathATAN2 = Math.atan2,
            mathPI = Math.PI;

        let _this = this;

        // GLOBAL UTILS:
        this.round = function(n, v) {
            return Math.round(n * v) / v;
        };
        this.toRad = function(angle) {
            return angle * (mathPI / 180);
        };
        this.toAng = function(radian) {
            return radian / (mathPI / 180);
        };
        this.randInt = function(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };
        this.randFloat = function(min, max) {
            return Math.random() * (max - min + 1) + min;
        };
        this.lerp = function(value1, value2, amount) {
            return value1 + (value2 - value1) * amount;
        };
        this.decel = function(val, cel) {
            if (val > 0)
                val = Math.max(0, val - cel);
            else if (val < 0)
                val = Math.min(0, val + cel);
            return val;
        };
        this.getDistance = function(x1, y1, x2, y2) {
            return mathSQRT((x2 -= x1) * x2 + (y2 -= y1) * y2);
        };
        this.getDist = function(tmp1, tmp2, type1, type2) {
            let tmpXY1 = {
                x: type1 == 0 ? tmp1.x : type1 == 1 ? tmp1.x1 : type1 == 2 ? tmp1.x2 : type1 == 3 && tmp1.x3,
                y: type1 == 0 ? tmp1.y : type1 == 1 ? tmp1.y1 : type1 == 2 ? tmp1.y2 : type1 == 3 && tmp1.y3,
            };
            let tmpXY2 = {
                x: type2 == 0 ? tmp2.x : type2 == 1 ? tmp2.x1 : type2 == 2 ? tmp2.x2 : type2 == 3 && tmp2.x3,
                y: type2 == 0 ? tmp2.y : type2 == 1 ? tmp2.y1 : type2 == 2 ? tmp2.y2 : type2 == 3 && tmp2.y3,
            };
            return mathSQRT((tmpXY2.x -= tmpXY1.x) * tmpXY2.x + (tmpXY2.y -= tmpXY1.y) * tmpXY2.y);
        };
        this.getDirection = function(x1, y1, x2, y2) {
            return mathATAN2(y1 - y2, x1 - x2);
        };
        this.getDirect = function(tmp1, tmp2, type1, type2) {
            let tmpXY1 = {
                x: type1 == 0 ? tmp1.x : type1 == 1 ? tmp1.x1 : type1 == 2 ? tmp1.x2 : type1 == 3 && tmp1.x3,
                y: type1 == 0 ? tmp1.y : type1 == 1 ? tmp1.y1 : type1 == 2 ? tmp1.y2 : type1 == 3 && tmp1.y3,
            };
            let tmpXY2 = {
                x: type2 == 0 ? tmp2.x : type2 == 1 ? tmp2.x1 : type2 == 2 ? tmp2.x2 : type2 == 3 && tmp2.x3,
                y: type2 == 0 ? tmp2.y : type2 == 1 ? tmp2.y1 : type2 == 2 ? tmp2.y2 : type2 == 3 && tmp2.y3,
            };
            return mathATAN2(tmpXY1.y - tmpXY2.y, tmpXY1.x - tmpXY2.x);
        };
        this.getAngle = function (pointA, pointB) {
            return Math.atan2(pointB.y - pointA.y, pointB.x - pointA.x);
        };
        this.getAngleDist = function(a, b) {
            let p = mathABS(b - a) % (mathPI * 2);
            return (p > mathPI ? (mathPI * 2) - p : p);
        };
        this.isNumber = function(n) {
            return (typeof n == "number" && !isNaN(n) && isFinite(n));
        };
        this.isString = function(s) {
            return (s && typeof s == "string");
        };
        this.kFormat = function(num) {
            return num > 999 ? (num / 1000).toFixed(1) + "k" : num;
        };
        this.sFormat = function(num) {
            let fixs = [{
                num: 1e3,
                string: "k"
            },
                        {
                            num: 1e6,
                            string: "m"
                        },
                        {
                            num: 1e9,
                            string: "b"
                        },
                        {
                            num: 1e12,
                            string: "q"
                        }
                       ].reverse();
            let sp = fixs.find(v => num >= v.num);
            if (!sp) return num;
            return (num / sp.num).toFixed(1) + sp.string;
        };
        this.capitalizeFirst = function(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        };
        this.fixTo = function(n, v) {
            return parseFloat(n.toFixed(v));
        };
        this.sortByPoints = function(a, b) {
            return parseFloat(b.points) - parseFloat(a.points);
        };
        this.lineInRect = function(recX, recY, recX2, recY2, x1, y1, x2, y2) {
            let minX = x1;
            let maxX = x2;
            if (x1 > x2) {
                minX = x2;
                maxX = x1;
            }
            if (maxX > recX2)
                maxX = recX2;
            if (minX < recX)
                minX = recX;
            if (minX > maxX)
                return false;
            let minY = y1;
            let maxY = y2;
            let dx = x2 - x1;
            if (Math.abs(dx) > 0.0000001) {
                let a = (y2 - y1) / dx;
                let b = y1 - a * x1;
                minY = a * minX + b;
                maxY = a * maxX + b;
            }
            if (minY > maxY) {
                let tmp = maxY;
                maxY = minY;
                minY = tmp;
            }
            if (maxY > recY2)
                maxY = recY2;
            if (minY < recY)
                minY = recY;
            if (minY > maxY)
                return false;
            return true;
        };
        this.containsPoint = function(element, x, y) {
            let bounds = element.getBoundingClientRect();
            let left = bounds.left + window.scrollX;
            let top = bounds.top + window.scrollY;
            let width = bounds.width;
            let height = bounds.height;

            let insideHorizontal = x > left && x < left + width;
            let insideVertical = y > top && y < top + height;
            return insideHorizontal && insideVertical;
        };
        this.mousifyTouchEvent = function(event) {
            let touch = event.changedTouches[0];
            event.screenX = touch.screenX;
            event.screenY = touch.screenY;
            event.clientX = touch.clientX;
            event.clientY = touch.clientY;
            event.pageX = touch.pageX;
            event.pageY = touch.pageY;
        };
        this.hookTouchEvents = function(element, skipPrevent) {
            let preventDefault = !skipPrevent;
            let isHovering = false;
            // let passive = window.Modernizr.passiveeventlisteners ? {passive: true} : false;
            let passive = false;
            element.addEventListener("touchstart", this.checkTrusted(touchStart), passive);
            element.addEventListener("touchmove", this.checkTrusted(touchMove), passive);
            element.addEventListener("touchend", this.checkTrusted(touchEnd), passive);
            element.addEventListener("touchcancel", this.checkTrusted(touchEnd), passive);
            element.addEventListener("touchleave", this.checkTrusted(touchEnd), passive);

            function touchStart(e) {
                _this.mousifyTouchEvent(e);
                window.setUsingTouch(true);
                if (preventDefault) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                if (element.onmouseover)
                    element.onmouseover(e);
                isHovering = true;
            }

            function touchMove(e) {
                _this.mousifyTouchEvent(e);
                window.setUsingTouch(true);
                if (preventDefault) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                if (_this.containsPoint(element, e.pageX, e.pageY)) {
                    if (!isHovering) {
                        if (element.onmouseover)
                            element.onmouseover(e);
                        isHovering = true;
                    }
                } else {
                    if (isHovering) {
                        if (element.onmouseout)
                            element.onmouseout(e);
                        isHovering = false;
                    }
                }
            }

            function touchEnd(e) {
                _this.mousifyTouchEvent(e);
                window.setUsingTouch(true);
                if (preventDefault) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                if (isHovering) {
                    if (element.onclick)
                        element.onclick(e);
                    if (element.onmouseout)
                        element.onmouseout(e);
                    isHovering = false;
                }
            }
        };
        this.removeAllChildren = function(element) {
            while (element.hasChildNodes()) {
                element.removeChild(element.lastChild);
            }
        };
        this.generateElement = function(config) {
            let element = document.createElement(config.tag || "div");

            function bind(configValue, elementValue) {
                if (config[configValue])
                    element[elementValue] = config[configValue];
            }
            bind("text", "textContent");
            bind("html", "innerHTML");
            bind("class", "className");
            for (let key in config) {
                switch (key) {
                    case "tag":
                    case "text":
                    case "html":
                    case "class":
                    case "style":
                    case "hookTouch":
                    case "parent":
                    case "children":
                        continue;
                    default:
                        break;
                }
                element[key] = config[key];
            }
            if (element.onclick)
                element.onclick = this.checkTrusted(element.onclick);
            if (element.onmouseover)
                element.onmouseover = this.checkTrusted(element.onmouseover);
            if (element.onmouseout)
                element.onmouseout = this.checkTrusted(element.onmouseout);
            if (config.style) {
                element.style.cssText = config.style;
            }
            if (config.hookTouch) {
                this.hookTouchEvents(element);
            }
            if (config.parent) {
                config.parent.appendChild(element);
            }
            if (config.children) {
                for (let i = 0; i < config.children.length; i++) {
                    element.appendChild(config.children[i]);
                }
            }
            return element;
        };
        this.checkTrusted = function(callback) {
            return function(ev) {
                if (ev && ev instanceof Event && (ev && typeof ev.isTrusted == "boolean" ? ev.isTrusted : true)) {
                    callback(ev);
                } else {
                    //console.error("Event is not trusted.", ev);
                }
            };
        };
        this.randomString = function(length) {
            let text = "";
            let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (let i = 0; i < length; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            return text;
        };
        this.countInArray = function(array, val) {
            let count = 0;
            for (let i = 0; i < array.length; i++) {
                if (array[i] === val) count++;
            }
            return count;
        };
        this.hexToRgb = function(hex) {
            return hex.slice(1).match(/.{1,2}/g).map(g => parseInt(g, 16));
        };
        this.getRgb = function(r, g, b) {
            return [r / 255, g / 255, b / 255].join(", ");
        };
    }
};
class Animtext {
    // ANIMATED TEXT:
    constructor() {
        this.init = function (x, y, scale, speed, life, text, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.scale = scale;
            this.startScale = this.scale;
            this.maxScale = scale * 1.5;
            this.scaleSpeed = 0.7;
            this.speed = speed;
            this.life = life;
            this.text = text;
            this.acc = 1;
            this.alpha = 0;
            this.maxLife = life;
            this.ranX = UTILS.randFloat(-1, 1);
        };
        this.update = function (delta) {
            if (this.life) {
                this.life -= delta;
                if (config.anotherVisual) {
                    this.y -= this.speed * delta * this.acc;
                    this.acc -= delta / (this.maxLife / 2.5);
                    if (this.life <= 8) {
                        if (this.alpha > 0) {
                            this.alpha = Math.max(0, this.alpha - delta / 12);
                        }
                    } else if (this.alpha < 1) {
                        this.alpha = Math.min(1, this.alpha + delta / 64);
                    }
                    this.x += this.ranX;
                } else {
                    this.y -= this.speed * delta;
                }
                this.scale += this.scaleSpeed * delta;
                if (this.scale >= this.maxScale) {
                    this.scale = this.maxScale;
                    this.scaleSpeed *= -1;
                } else if (this.scale <= this.startScale) {
                    this.scale = this.startScale;
                    this.scaleSpeed = 0;
                }
                if (this.life <= 0) {
                    this.life = 0;
                }
            }
        };
        this.render = function (ctxt, xOff, yOff, value) {
            ctxt.lineWidth = 0xa;
            ctxt.fillStyle = this.color;
            ctxt.font = this.scale + "px " + (config.anotherVisual ? "Hammersmith One" : "Hammersmith One");
            if (config.anotherVisual) {
                ctxt.globalAlpha = this.alpha;
                ctxt.strokeStyle = "#3d3f42";
                ctxt.strokeText(this.text, this.x - xOff, this.y - yOff);
            }
            ctxt.fillText(this.text, this.x - xOff, this.y - yOff);
            ctxt.globalAlpha = 1;
        };
    }
}
;
class Textmanager {
    // TEXT MANAGER:
    constructor() {
        this.texts = [];
        this.stack = [];

        this.update = function (delta, ctxt, xOff, yOff) {
            ctxt.textBaseline = "middle";
            ctxt.textAlign = "center";
            for (let i = 0; i < this.texts.length; ++i) {
                if (this.texts[i].life) {
                    this.texts[i].update(delta);
                    this.texts[i].render(ctxt, xOff, yOff);
                }
            }
        };

        this.showText = function (x, y, scale, speed, life, text, color) {
            let tmpText;
            for (let i = 0; i < this.texts.length; ++i) {
                if (!this.texts[i].life) {
                    tmpText = this.texts[i];
                    break;
                }
            }
            if (!tmpText) {
                tmpText = new Animtext();
                this.texts.push(tmpText);
            }
            tmpText.init(x, y, scale, speed, life, text, color);
        };
    }
}

class GameObject {
    constructor(sid) {
        this.sid = sid;

        // INIT:
        this.init = function(x, y, dir, scale, type, data, owner) {
            data = data || {};
            this.sentTo = {};
            this.gridLocations = [];
            this.active = true;
            this.render = true;
            this.doUpdate = data.doUpdate;
            this.x = x;
            this.y = y;
            this.dir = dir;
            this.lastDir = dir;
            this.xWiggle = 0;
            this.yWiggle = 0;
            this.visScale = scale;
            this.scale = scale;
            this.type = type;
            this.id = data.id;
            this.owner = owner;
            this.name = data.name;
            this.isItem = (this.id != undefined);
            this.group = data.group;
            this.maxHealth = data.health;
            this.health = this.maxHealth;
            this.layer = 2;
            if (this.group != undefined) {
                this.layer = this.group.layer;
            } else if (this.type == 0) {
                this.layer = 3;
            } else if (this.type == 2) {
                this.layer = 0;
            } else if (this.type == 4) {
                this.layer = -1;
            }
            this.colDiv = data.colDiv || 1;
            this.blocker = data.blocker;
            this.ignoreCollision = data.ignoreCollision;
            this.dontGather = data.dontGather;
            this.hideFromEnemy = data.hideFromEnemy;
            this.friction = data.friction;
            this.projDmg = data.projDmg;
            this.dmg = data.dmg;
            this.pDmg = data.pDmg;
            this.pps = data.pps;
            this.zIndex = data.zIndex || 0;
            this.turnSpeed = data.turnSpeed;
            this.req = data.req;
            this.trap = data.trap;
            this.healCol = data.healCol;
            this.teleport = data.teleport;
            this.boostSpeed = data.boostSpeed;
            this.projectile = data.projectile;
            this.shootRange = data.shootRange;
            this.shootRate = data.shootRate;
            this.shootCount = this.shootRate;
            this.spawnPoint = data.spawnPoint;
            this.alpha = data.alpha || 1;
            this.maxAlpha = data.alpha || 1;
            this.damaged = 0;
        };

        // GET HIT:
        this.changeHealth = function(amount, doer) {
            this.health += amount;
            return (this.health <= 100);
        };

        // GET SCALE:
        this.getScale = function(sM, ig) {
            sM = sM || 1;
            return this.scale * ((this.isItem || this.type == 2 || this.type == 3 || this.type == 4) ?
                                 1 : (0.6 * sM)) * (ig ? 1 : this.colDiv);
        };

        // VISIBLE TO PLAYER:
        this.visibleToPlayer = function(player) {
            return !(this.hideFromEnemy) || (this.owner && (this.owner == player ||
                                                            (this.owner.team && player.team == this.owner.team)));
        };

        // UPDATE:
        this.update = function(delta) {
            if (this.active) {
                if (this.xWiggle) {
                    this.xWiggle *= Math.pow(0.99, delta);
                }
                if (this.yWiggle) {
                    this.yWiggle *= Math.pow(0.99, delta);
                }
                let d2 = UTILS.getAngleDist(this.lastDir, this.dir);
                if (d2 > 0.01) {
                    this.dir += d2 / 5;
                } else {
                    this.dir = this.lastDir;
                }
            } else {
                if (this.alive) {
                    this.alpha -= delta / (200 / this.maxAlpha);
                    this.visScale += delta / (this.scale / 2.5);
                    if (this.alpha <= 0) {
                        this.alpha = 0;
                        this.alive = false;
                    }
                }
            }
        };
        // CHECK TEAM:
        this.isTeam = function(tmpObj) {
            return (this == tmpObj || (this.team && this.team == tmpObj.team));
        };
        // CHECK TEAM:
        this.isTeamObject = function(tmpObj) {
            return this.owner == null ? true : (this.owner && tmpObj.sid == this.owner.sid || tmpObj.findAllianceBySid(this.owner.sid));
        };
    }
}
class Items {
    constructor() {
        // ITEM GROUPS:
        this.groups = [{
            id: 0,
            name: "food",
            layer: 0
        }, {
            id: 1,
            name: "walls",
            place: true,
            limit: 30,
            layer: 0
        }, {
            id: 2,
            name: "spikes",
            place: true,
            limit: 15,
            layer: 0
        }, {
            id: 3,
            name: "mill",
            place: true,
            limit: 7,
            layer: 1
        }, {
            id: 4,
            name: "mine",
            place: true,
            limit: 1,
            layer: 0
        }, {
            id: 5,
            name: "trap",
            place: true,
            limit: 6,
            layer: -1
        }, {
            id: 6,
            name: "booster",
            place: true,
            limit: 12,
            layer: -1
        }, {
            id: 7,
            name: "turret",
            place: true,
            limit: 2,
            layer: 1
        }, {
            id: 8,
            name: "watchtower",
            place: true,
            limit: 12,
            layer: 1
        }, {
            id: 9,
            name: "buff",
            place: true,
            limit: 4,
            layer: -1
        }, {
            id: 10,
            name: "spawn",
            place: true,
            limit: 1,
            layer: -1
        }, {
            id: 11,
            name: "sapling",
            place: true,
            limit: 2,
            layer: 0
        }, {
            id: 12,
            name: "blocker",
            place: true,
            limit: 3,
            layer: -1
        }, {
            id: 13,
            name: "teleporter",
            place: true,
            limit: 2,
            layer: -1
        }];

        // PROJECTILES:
        this.projectiles = [{
            indx: 0,
            layer: 0,
            src: "arrow_1",
            dmg: 25,
            speed: 1.6,
            scale: 103,
            range: 1000
        }, {
            indx: 1,
            layer: 1,
            dmg: 25,
            scale: 20
        }, {
            indx: 0,
            layer: 0,
            src: "arrow_1",
            dmg: 35,
            speed: 2.5,
            scale: 103,
            range: 1200
        }, {
            indx: 0,
            layer: 0,
            src: "arrow_1",
            dmg: 30,
            speed: 2,
            scale: 103,
            range: 1200
        }, {
            indx: 1,
            layer: 1,
            dmg: 16,
            scale: 20
        }, {
            indx: 0,
            layer: 0,
            src: "bullet_1",
            dmg: 50,
            speed: 3.6,
            scale: 160,
            range: 1400
        }];

        // WEAPONS:
        this.weapons = [{
            id: 0,
            type: 0,
            name: "tool hammer",
            desc: "tool for gathering all resources",
            src: "hammer_1",
            length: 140,
            width: 140,
            xOff: -3,
            yOff: 18,
            dmg: 25,
            range: 65,
            gather: 1,
            speed: 300
        }, {
            id: 1,
            type: 0,
            age: 2,
            name: "hand axe",
            desc: "gathers resources at a higher rate",
            src: "axe_1",
            length: 140,
            width: 140,
            xOff: 3,
            yOff: 24,
            dmg: 30,
            spdMult: 1,
            range: 70,
            gather: 2,
            speed: 400
        }, {
            id: 2,
            type: 0,
            age: 8,
            pre: 1,
            name: "great axe",
            desc: "deal more damage and gather more resources",
            src: "great_axe_1",
            length: 140,
            width: 140,
            xOff: -8,
            yOff: 25,
            dmg: 35,
            spdMult: 1,
            range: 75,
            gather: 4,
            speed: 400
        }, {
            id: 3,
            type: 0,
            age: 2,
            name: "short sword",
            desc: "increased attack power but slower move speed",
            src: "sword_1",
            iPad: 1.3,
            length: 130,
            width: 210,
            xOff: -8,
            yOff: 46,
            dmg: 35,
            spdMult: 0.85,
            range: 110,
            gather: 1,
            speed: 300
        }, {
            id: 4,
            type: 0,
            age: 8,
            pre: 3,
            name: "katana",
            desc: "greater range and damage",
            src: "samurai_1",
            iPad: 1.3,
            length: 130,
            width: 210,
            xOff: -8,
            yOff: 59,
            dmg: 40,
            spdMult: 0.8,
            range: 118,
            gather: 1,
            speed: 300
        }, {
            id: 5,
            type: 0,
            age: 2,
            name: "polearm",
            desc: "long range melee weapon",
            src: "spear_1",
            iPad: 1.3,
            length: 130,
            width: 210,
            xOff: -8,
            yOff: 53,
            dmg: 45,
            knock: 0.2,
            spdMult: 0.82,
            range: 142,
            gather: 1,
            speed: 700
        }, {
            id: 6,
            type: 0,
            age: 2,
            name: "bat",
            desc: "fast long range melee weapon",
            src: "bat_1",
            iPad: 1.3,
            length: 110,
            width: 180,
            xOff: -8,
            yOff: 53,
            dmg: 20,
            knock: 0.7,
            range: 110,
            gather: 1,
            speed: 300
        }, {
            id: 7,
            type: 0,
            age: 2,
            name: "daggers",
            desc: "really fast short range weapon",
            src: "dagger_1",
            iPad: 0.8,
            length: 110,
            width: 110,
            xOff: 18,
            yOff: 0,
            dmg: 20,
            knock: 0.1,
            range: 65,
            gather: 1,
            hitSlow: 0.1,
            spdMult: 1.13,
            speed: 100
        }, {
            id: 8,
            type: 0,
            age: 2,
            name: "stick",
            desc: "great for gathering but very weak",
            src: "stick_1",
            length: 140,
            width: 140,
            xOff: 3,
            yOff: 24,
            dmg: 1,
            spdMult: 1,
            range: 70,
            gather: 7,
            speed: 400
        }, {
            id: 9,
            type: 1,
            age: 6,
            name: "hunting bow",
            desc: "bow used for ranged combat and hunting",
            src: "bow_1",
            req: ["wood", 4],
            length: 120,
            width: 120,
            xOff: -6,
            yOff: 0,
            Pdmg: 25,
            projectile: 0,
            spdMult: 0.75,
            speed: 600
        }, {
            id: 10,
            type: 1,
            age: 6,
            name: "great hammer",
            desc: "hammer used for destroying structures",
            src: "great_hammer_1",
            length: 140,
            width: 140,
            xOff: -9,
            yOff: 25,
            dmg: 10,
            Pdmg: 10,
            spdMult: 0.88,
            range: 75,
            sDmg: 7.5,
            gather: 1,
            speed: 400
        }, {
            id: 11,
            type: 1,
            age: 6,
            name: "wooden shield",
            desc: "blocks projectiles and reduces melee damage",
            src: "shield_1",
            length: 120,
            width: 120,
            shield: 0.2,
            xOff: 6,
            yOff: 0,
            Pdmg: 0,
            spdMult: 0.7
        }, {
            id: 12,
            type: 1,
            age: 8,
            pre: 9,
            name: "crossbow",
            desc: "deals more damage and has greater range",
            src: "crossbow_1",
            req: ["wood", 5],
            aboveHand: true,
            armS: 0.75,
            length: 120,
            width: 120,
            xOff: -4,
            yOff: 0,
            Pdmg: 35,
            projectile: 2,
            spdMult: 0.7,
            speed: 700
        }, {
            id: 13,
            type: 1,
            age: 9,
            pre: 12,
            name: "repeater crossbow",
            desc: "high firerate crossbow with reduced damage",
            src: "crossbow_2",
            req: ["wood", 10],
            aboveHand: true,
            armS: 0.75,
            length: 120,
            width: 120,
            xOff: -4,
            yOff: 0,
            Pdmg: 30,
            projectile: 3,
            spdMult: 0.7,
            speed: 230
        }, {
            id: 14,
            type: 1,
            age: 6,
            name: "mc grabby",
            desc: "steals resources from enemies",
            src: "grab_1",
            length: 130,
            width: 210,
            xOff: -8,
            yOff: 53,
            dmg: 0,
            Pdmg: 0,
            steal: 250,
            knock: 0.2,
            spdMult: 1.05,
            range: 125,
            gather: 0,
            speed: 700
        }, {
            id: 15,
            type: 1,
            age: 9,
            pre: 12,
            name: "musket",
            desc: "slow firerate but high damage and range",
            src: "musket_1",
            req: ["stone", 10],
            aboveHand: true,
            rec: 0.35,
            armS: 0.6,
            hndS: 0.3,
            hndD: 1.6,
            length: 205,
            width: 205,
            xOff: 25,
            yOff: 0,
            Pdmg: 50,
            projectile: 5,
            hideProjectile: true,
            spdMult: 0.6,
            speed: 1500
        }];
        const weaponConfigs = {
            0: {
                id: 0,
                type: 0,
                name: "tool hammer",
                desc: "tool for gathering all resources",
                range: 65,
            },
            1: {
                id: 1,
                type: 0,
                name: "hand axe",
                desc: "gathers resources at a higher rate",
                range: 70,
            },
            2: {
                id: 2,
                type: 0,
                name: "great axe",
                desc: "deal more damage and gather more resources",
                range: 75,
            },
            3: {
                id: 3,
                type: 0,
                name: "short sword",
                desc: "increased attack power but slower move speed",
                range: 110,
            },
            4: {
                id: 4,
                type: 0,
                name: "katana",
                desc: "greater range and damage",
                range: 118,
            },
            5: {
                id: 5,
                type: 0,
                name: "polearm",
                desc: "long range melee weapon",
                range: 142,
            },
            6: {
                id: 6,
                type: 0,
                name: "bat",
                desc: "fast long range melee weapon",
                range: 110,
            },
            7: {
                id: 7,
                type: 0,
                name: "daggers",
                desc: "really fast short range weapon",
                range: 65,
            },
            8: {
                id: 8,
                type: 0,
                name: "stick",
                desc: "great for gathering but very weak",
                range: 70,
            },
            9: {
                id: 9,
                type: 1,
                name: "hunting bow",
                desc: "bow used for ranged combat and hunting",
                range: 120, // Pro luk přidáme dosah (není v původní konfiguraci)
            },
            10: {
                id: 10,
                type: 1,
                name: "great hammer",
                desc: "hammer used for destroying structures",
                range: 75,
            },
            11: {
                id: 11,
                type: 1,
                name: "wooden shield",
                desc: "blocks projectiles and reduces melee damage",
                range: 50, // Předpokládáme menší dosah pro štít
            },
            12: {
                id: 12,
                type: 1,
                name: "crossbow",
                desc: "deals more damage and has greater range",
                range: 150,
            },
            13: {
                id: 13,
                type: 1,
                name: "repeater crossbow",
                desc: "high firerate crossbow with reduced damage",
                range: 140,
            },
            14: {
                id: 14,
                type: 1,
                name: "mc grabby",
                desc: "steals resources from enemies",
                range: 125,
            },
            15: {
                id: 15,
                type: 1,
                name: "musket",
                desc: "slow firerate but high damage and range",
                range: 180, // Největší dosah pro mušketu
            },
        };

        // ITEMS:
        this.list = [{
            group: this.groups[0],
            name: "apple",
            desc: "restores 20 health when consumed",
            req: ["food", 10],
            consume: function(doer) {
                return doer.changeHealth(20, doer);
            },
            scale: 22,
            holdOffset: 15,
            healing: 20,
            itemID: 0,
            itemAID: 16,
        }, {
            age: 3,
            group: this.groups[0],
            name: "cookie",
            desc: "restores 40 health when consumed",
            req: ["food", 15],
            consume: function(doer) {
                return doer.changeHealth(40, doer);
            },
            scale: 27,
            holdOffset: 15,
            healing: 40,
            itemID: 1,
            itemAID: 17,
        }, {
            age: 7,
            group: this.groups[0],
            name: "cheese",
            desc: "restores 30 health and another 50 over 5 seconds",
            req: ["food", 25],
            consume: function(doer) {
                if (doer.changeHealth(30, doer) || doer.health < 100) {
                    doer.dmgOverTime.dmg = -10;
                    doer.dmgOverTime.doer = doer;
                    doer.dmgOverTime.time = 5;
                    return true;
                }
                return false;
            },
            scale: 27,
            holdOffset: 15,
            healing: 30,
            itemID: 2,
            itemAID: 18,
        }, {
            group: this.groups[1],
            name: "wood wall",
            desc: "provides protection for your village",
            req: ["wood", 10],
            projDmg: true,
            health: 380,
            scale: 50,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 3,
            itemAID: 19,
        }, {
            age: 3,
            group: this.groups[1],
            name: "stone wall",
            desc: "provides improved protection for your village",
            req: ["stone", 25],
            health: 900,
            scale: 50,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 4,
            itemAID: 20,
        }, {
            age: 7,
            group: this.groups[1],
            name: "castle wall",
            desc: "provides powerful protection for your village",
            req: ["stone", 35],
            health: 1500,
            scale: 52,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 5,
            itemAID: 21,
        }, {
            group: this.groups[2],
            name: "spikes",
            desc: "damages enemies when they touch them",
            req: ["wood", 20, "stone", 5],
            health: 400,
            dmg: 20,
            scale: 49,
            spritePadding: -23,
            holdOffset: 8,
            placeOffset: -5,
            itemID: 6,
            itemAID: 22,
        }, {
            age: 5,
            group: this.groups[2],
            name: "greater spikes",
            desc: "damages enemies when they touch them",
            req: ["wood", 30, "stone", 10],
            health: 500,
            dmg: 35,
            scale: 52,
            spritePadding: -23,
            holdOffset: 8,
            placeOffset: -5,
            itemID: 7,
            itemAID: 23,
        }, {
            age: 9,
            group: this.groups[2],
            name: "poison spikes",
            desc: "poisons enemies when they touch them",
            req: ["wood", 35, "stone", 15],
            health: 600,
            dmg: 30,
            pDmg: 5,
            scale: 52,
            spritePadding: -23,
            holdOffset: 8,
            placeOffset: -5,
            itemID: 8,
            itemAID: 24,
        }, {
            age: 9,
            group: this.groups[2],
            name: "spinning spikes",
            desc: "damages enemies when they touch them",
            req: ["wood", 30, "stone", 20],
            health: 500,
            dmg: 45,
            turnSpeed: 0.003,
            scale: 52,
            spritePadding: -23,
            holdOffset: 8,
            placeOffset: -5,
            itemID: 9,
            itemAID: 25,
        }, {
            group: this.groups[3],
            name: "windmill",
            desc: "generates gold over time",
            req: ["wood", 50, "stone", 10],
            health: 400,
            pps: 1,
            turnSpeed: 0.0016,
            spritePadding: 25,
            iconLineMult: 12,
            scale: 45,
            holdOffset: 20,
            placeOffset: 5,
            itemID: 10,
            itemAID: 26,
        }, {
            age: 5,
            group: this.groups[3],
            name: "faster windmill",
            desc: "generates more gold over time",
            req: ["wood", 60, "stone", 20],
            health: 500,
            pps: 1.5,
            turnSpeed: 0.0025,
            spritePadding: 25,
            iconLineMult: 12,
            scale: 47,
            holdOffset: 20,
            placeOffset: 5,
            itemID: 11,
            itemAID: 27,
        }, {
            age: 8,
            group: this.groups[3],
            name: "power mill",
            desc: "generates more gold over time",
            req: ["wood", 100, "stone", 50],
            health: 800,
            pps: 2,
            turnSpeed: 0.005,
            spritePadding: 25,
            iconLineMult: 12,
            scale: 47,
            holdOffset: 20,
            placeOffset: 5,
            itemID: 12,
            itemAID: 28,
        }, {
            age: 5,
            group: this.groups[4],
            type: 2,
            name: "mine",
            desc: "allows you to mine stone",
            req: ["wood", 20, "stone", 100],
            iconLineMult: 12,
            scale: 65,
            holdOffset: 20,
            placeOffset: 0,
            itemID: 13,
            itemAID: 29,
        }, {
            age: 5,
            group: this.groups[11],
            type: 0,
            name: "sapling",
            desc: "allows you to farm wood",
            req: ["wood", 150],
            iconLineMult: 12,
            colDiv: 0.5,
            scale: 110,
            holdOffset: 50,
            placeOffset: -15,
            itemID: 14,
            itemAID: 30,
        }, {
            age: 4,
            group: this.groups[5],
            name: "pit trap",
            desc: "pit that traps enemies if they walk over it",
            req: ["wood", 30, "stone", 30],
            trap: true,
            ignoreCollision: true,
            hideFromEnemy: true,
            health: 500,
            colDiv: 0.2,
            scale: 50,
            holdOffset: 20,
            placeOffset: -5,
            alpha: 0.6,
            itemID: 15,
            itemAID: 31,
        }, {
            age: 4,
            group: this.groups[6],
            name: "boost pad",
            desc: "provides boost when stepped on",
            req: ["stone", 20, "wood", 5],
            ignoreCollision: true,
            boostSpeed: 1.5,
            health: 150,
            colDiv: 0.7,
            scale: 45,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 16,
            itemAID: 32,
        }, {
            age: 7,
            group: this.groups[7],
            doUpdate: true,
            name: "turret",
            desc: "defensive structure that shoots at enemies",
            req: ["wood", 200, "stone", 150],
            health: 800,
            projectile: 1,
            shootRange: 700,
            shootRate: 2200,
            scale: 43,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 17,
            itemAID: 33,
        }, {
            age: 7,
            group: this.groups[8],
            name: "platform",
            desc: "platform to shoot over walls and cross over water",
            req: ["wood", 20],
            ignoreCollision: true,
            zIndex: 1,
            health: 300,
            scale: 43,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 18,
            itemAID: 34,
        }, {
            age: 7,
            group: this.groups[9],
            name: "healing pad",
            desc: "standing on it will slowly heal you",
            req: ["wood", 30, "food", 10],
            ignoreCollision: true,
            healCol: 15,
            health: 400,
            colDiv: 0.7,
            scale: 45,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 19,
            itemAID: 35,
        }, {
            age: 9,
            group: this.groups[10],
            name: "spawn pad",
            desc: "you will spawn here when you die but it will dissapear",
            req: ["wood", 100, "stone", 100],
            health: 400,
            ignoreCollision: true,
            spawnPoint: true,
            scale: 45,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 20,
            itemAID: 36,
        }, {
            age: 7,
            group: this.groups[12],
            name: "blocker",
            desc: "blocks building in radius",
            req: ["wood", 30, "stone", 25],
            ignoreCollision: true,
            blocker: 300,
            health: 400,
            colDiv: 0.7,
            scale: 45,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 21,
            itemAID: 37,
        }, {
            age: 7,
            group: this.groups[13],
            name: "teleporter",
            desc: "teleports you to a random point on the map",
            req: ["wood", 60, "stone", 60],
            ignoreCollision: true,
            teleport: true,
            health: 200,
            colDiv: 0.7,
            scale: 45,
            holdOffset: 20,
            placeOffset: -5,
            itemID: 22,
            itemAID: 38
        }];

        // CHECK ITEM ID:
        this.checkItem = {
            index: function(id, myItems) {
                return [0, 1, 2].includes(id) ? 0 : [3, 4, 5].includes(id) ? 1 : [6, 7, 8, 9].includes(id) ? 2 : [10, 11, 12].includes(id) ? 3 : [13, 14].includes(id) ? 5 : [15, 16].includes(id) ? 4 : [17, 18, 19, 21, 22].includes(id) ? [13, 14].includes(myItems) ? 6 :
                5 :
                id == 20 ? [13, 14].includes(myItems) ? 7 :
                6 :
                undefined;
            }
        }

        // ASSIGN IDS:
        for (let i = 0; i < this.list.length; ++i) {
            this.list[i].id = i;
            if (this.list[i].pre) this.list[i].pre = i - this.list[i].pre;
        }

        // TROLOLOLOL:
        if (typeof window !== "undefined") {
            function shuffle(a) {
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
                return a;
            }
            //shuffle(this.list);
        }
    }
}
class Objectmanager {
    constructor(GameObject, closeObjects, UTILS, config, players, server) {
        let mathFloor = Math.floor,
            mathABS = Math.abs,
            mathCOS = Math.cos,
            mathSIN = Math.sin,
            mathPOW = Math.pow,
            mathSQRT = Math.sqrt;

        this.ignoreAdd = false;
        this.hitObj = [];

        this.disableObj = function(obj) {
            obj.active = false;
            if (configs.anotherVisual) {} else {
                obj.alive = false;
            }
        };

        // ADD NEW:
        let tmpObj;
        this.add = function(sid, x, y, dir, s, type, data, setSID, owner) {
            tmpObj = findObjectBySid(sid);
            if (!tmpObj) {
                tmpObj = gameObjects.find((tmp) => !tmp.active);
                if (!tmpObj) {
                    tmpObj = new GameObject(sid);
                    gameObjects.push(tmpObj);
                }
            }
            if (setSID) {
                tmpObj.sid = sid;
            }
            tmpObj.init(x, y, dir, s, type, data, owner);
        };

        // DISABLE BY SID:
        this.disableBySid = function(sid) {
            let find = findObjectBySid(sid);
            if (find) {
                this.disableObj(find);
            }
        };

        // REMOVE ALL FROM PLAYER:
        this.removeAllItems = function(sid, server) {
            gameObjects.filter((tmp) => tmp.active && tmp.owner && tmp.owner.sid == sid).forEach((tmp) => this.disableObj(tmp));
        };

        // CHECK IF PLACABLE:
        this.checkItemLocation = function(x, y, s, sM, indx, ignoreWater, placer) {
            let cantPlace = closeObjects.find((tmp) => tmp.active && UTILS.getDistance(x, y, tmp.x, tmp.y) < s + (tmp.blocker ? tmp.blocker : tmp.getScale(sM, tmp.isItem)));
            if (cantPlace) return false;
            if (!ignoreWater && indx != 18 && y >= config.mapScale / 2 - config.riverWidth / 2 && y <= config.mapScale / 2 + config.riverWidth / 2) return false;
            return true;
        };

        // CHECK COLLISIONS:
        this.checkCollision2 = function(e, t, n = 1) {
            const dx = e.x2 - t.x;
            const dy = e.y2 - t.y;
            const radius = 35 + (t.realScale || t.scale);

            if (Math.abs(dx) <= radius || Math.abs(dy) <= radius) {
                const distance = Math.sqrt(dx * dx + dy * dy) - radius;
                if (distance <= 0) {
                    return true;
                }
            }
            return false;
        };

        // CHECK HITS:
        this.hitsToBreak = function(object, _) {
            if (!inGame || !object || !enemy.length || !_) return;

            let weapon = (_.secondaryIndex != undefined && _.primaryIndex != undefined) ? _.secondaryIndex == 10 ? _.secondaryIndex : _.primaryIndex : 10;
            let variant = _[(weapon < 9 ? "prima" : "seconda") + "ryVariant"];
            let variantDmg = variant != undefined ? config.weaponVariants[variant].val : 1.18;
            let damage = items.weapons[weapon].dmg;

            let tank = _.skinIndex == 40 ? 3.3 : 1;

            let effectiveDamage = damage * variantDmg * (items.weapons[weapon].sDmg || 1) * tank;

            return object.health / effectiveDamage;
        };

        this.canHit = function(player, object, weapon, moreSafe = 0) {
            let toRange = items.weapons[weapon].range + player.scale + object.scale/3.25 + moreSafe;

            return UTILS.getDist(player, object, 2, 0) <= toRange;
        };
    }
}
class Projectile {
    constructor(players, ais, objectManager, items, config, UTILS, server) {

        // INIT:
        this.init = function(indx, x, y, dir, spd, dmg, rng, scl, owner) {
            this.active = true;
            this.tickActive = true;
            this.indx = indx;
            this.x = x;
            this.y = y;
            this.x2 = x;
            this.y2 = y;
            this.dir = dir;
            this.skipMov = true;
            this.speed = spd;
            this.dmg = dmg;
            this.scale = scl;
            this.range = rng;
            this.r2 = rng;
            this.owner = owner;
        };

        // UPDATE:
        this.update = function(delta) {
            if (this.active) {
                let tmpSpeed = this.speed * delta;
                if (!this.skipMov) {
                    this.x += tmpSpeed * Math.cos(this.dir);
                    this.y += tmpSpeed * Math.sin(this.dir);
                    this.range -= tmpSpeed;
                    if (this.range <= 0) {
                        this.x += this.range * Math.cos(this.dir);
                        this.y += this.range * Math.sin(this.dir);
                        tmpSpeed = 1;
                        this.range = 0;
                        this.active = false;
                    }
                } else {
                    this.skipMov = false;
                }
            }
        };
        this.tickUpdate = function(delta) {
            if (this.tickActive) {
                let tmpSpeed = this.speed * delta;
                if (!this.skipMov) {
                    this.x2 += tmpSpeed * Math.cos(this.dir);
                    this.y2 += tmpSpeed * Math.sin(this.dir);
                    this.r2 -= tmpSpeed;
                    if (this.r2 <= 0) {
                        this.x2 += this.r2 * Math.cos(this.dir);
                        this.y2 += this.r2 * Math.sin(this.dir);
                        tmpSpeed = 1;
                        this.r2 = 0;
                        this.tickActive = false;
                    }
                } else {
                    this.skipMov = false;
                }
            }
        };
    }
};
class Store {
    constructor() {
        // STORE HATS:
        this.hats = [{
            id: 45,
            name: "Shame!",
            dontSell: true,
            price: 0,
            scale: 120,
            desc: "hacks are for winners"
        }, {
            id: 51,
            name: "Moo Cap",
            price: 0,
            scale: 120,
            desc: "coolest mooer around"
        }, {
            id: 50,
            name: "Apple Cap",
            price: 0,
            scale: 120,
            desc: "apple farms remembers"
        }, {
            id: 28,
            name: "Moo Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 29,
            name: "Pig Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 30,
            name: "Fluff Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 36,
            name: "Pandou Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 37,
            name: "Bear Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 38,
            name: "Monkey Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 44,
            name: "Polar Head",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 35,
            name: "Fez Hat",
            price: 0,
            scale: 120,
            desc: "no effect"
        }, {
            id: 42,
            name: "Enigma Hat",
            price: 0,
            scale: 120,
            desc: "join the enigma army"
        }, {
            id: 43,
            name: "Blitz Hat",
            price: 0,
            scale: 120,
            desc: "hey everybody i'm blitz"
        }, {
            id: 49,
            name: "Bob XIII Hat",
            price: 0,
            scale: 120,
            desc: "like and subscribe"
        }, {
            id: 57,
            name: "Pumpkin",
            price: 50,
            scale: 120,
            desc: "Spooooky"
        }, {
            id: 8,
            name: "Bummle Hat",
            price: 100,
            scale: 120,
            desc: "no effect"
        }, {
            id: 2,
            name: "Straw Hat",
            price: 500,
            scale: 120,
            desc: "no effect"
        }, {
            id: 15,
            name: "Winter Cap",
            price: 600,
            scale: 120,
            desc: "allows you to move at normal speed in snow",
            coldM: 1
        }, {
            id: 5,
            name: "Cowboy Hat",
            price: 1000,
            scale: 120,
            desc: "no effect"
        }, {
            id: 4,
            name: "Ranger Hat",
            price: 2000,
            scale: 120,
            desc: "no effect"
        }, {
            id: 18,
            name: "Explorer Hat",
            price: 2000,
            scale: 120,
            desc: "no effect"
        }, {
            id: 31,
            name: "Flipper Hat",
            price: 2500,
            scale: 120,
            desc: "have more control while in water",
            watrImm: true
        }, {
            id: 1,
            name: "Marksman Cap",
            price: 3000,
            scale: 120,
            desc: "increases arrow speed and range",
            aMlt: 1.3
        }, {
            id: 10,
            name: "Bush Gear",
            price: 3000,
            scale: 160,
            desc: "allows you to disguise yourself as a bush"
        }, {
            id: 48,
            name: "Halo",
            price: 3000,
            scale: 120,
            desc: "no effect"
        }, {
            id: 6,
            name: "Soldier Helmet",
            price: 4000,
            scale: 120,
            desc: "reduces damage taken but slows movement",
            spdMult: 0.94,
            dmgMult: 0.75
        }, {
            id: 23,
            name: "Anti Venom Gear",
            price: 4000,
            scale: 120,
            desc: "makes you immune to poison",
            poisonRes: 1
        }, {
            id: 13,
            name: "Medic Gear",
            price: 5000,
            scale: 110,
            desc: "slowly regenerates health over time",
            healthRegen: 3
        }, {
            id: 9,
            name: "Miners Helmet",
            price: 5000,
            scale: 120,
            desc: "earn 1 extra gold per resource",
            extraGold: 1
        }, {
            id: 32,
            name: "Musketeer Hat",
            price: 5000,
            scale: 120,
            desc: "reduces cost of projectiles",
            projCost: 0.5
        }, {
            id: 7,
            name: "Bull Helmet",
            price: 6000,
            scale: 120,
            desc: "increases damage done but drains health",
            healthRegen: -5,
            dmgMultO: 1.5,
            spdMult: 0.96
        }, {
            id: 22,
            name: "Emp Helmet",
            price: 6000,
            scale: 120,
            desc: "turrets won't attack but you move slower",
            antiTurret: 1,
            spdMult: 0.7
        }, {
            id: 12,
            name: "Booster Hat",
            price: 6000,
            scale: 120,
            desc: "increases your movement speed",
            spdMult: 1.16
        }, {
            id: 26,
            name: "Barbarian Armor",
            price: 8000,
            scale: 120,
            desc: "knocks back enemies that attack you",
            dmgK: 0.6
        }, {
            id: 21,
            name: "Plague Mask",
            price: 10000,
            scale: 120,
            desc: "melee attacks deal poison damage",
            poisonDmg: 5,
            poisonTime: 6
        }, {
            id: 46,
            name: "Bull Mask",
            price: 10000,
            scale: 120,
            desc: "bulls won't target you unless you attack them",
            bullRepel: 1
        }, {
            id: 14,
            name: "Windmill Hat",
            topSprite: true,
            price: 10000,
            scale: 120,
            desc: "generates points while worn",
            pps: 1.5
        }, {
            id: 11,
            name: "Spike Gear",
            topSprite: true,
            price: 10000,
            scale: 120,
            desc: "deal damage to players that damage you",
            dmg: 0.45
        }, {
            id: 53,
            name: "Turret Gear",
            topSprite: true,
            price: 10000,
            scale: 120,
            desc: "you become a walking turret",
            turret: {
                proj: 1,
                range: 700,
                rate: 2500
            },
            spdMult: 0.7
        }, {
            id: 20,
            name: "Samurai Armor",
            price: 12000,
            scale: 120,
            desc: "increased attack speed and fire rate",
            atkSpd: 0.78
        }, {
            id: 58,
            name: "Dark Knight",
            price: 12000,
            scale: 120,
            desc: "restores health when you deal damage",
            healD: 0.4
        }, {
            id: 27,
            name: "Scavenger Gear",
            price: 15000,
            scale: 120,
            desc: "earn double points for each kill",
            kScrM: 2
        }, {
            id: 40,
            name: "Tank Gear",
            price: 15000,
            scale: 120,
            desc: "increased damage to buildings but slower movement",
            spdMult: 0.3,
            bDmg: 3.3
        }, {
            id: 52,
            name: "Thief Gear",
            price: 15000,
            scale: 120,
            desc: "steal half of a players gold when you kill them",
            goldSteal: 0.5
        }, {
            id: 55,
            name: "Bloodthirster",
            price: 20000,
            scale: 120,
            desc: "Restore Health when dealing damage. And increased damage",
            healD: 0.25,
            dmgMultO: 1.2,
        }, {
            id: 56,
            name: "Assassin Gear",
            price: 20000,
            scale: 120,
            desc: "Go invisible when not moving. Can't eat. Increased speed",
            noEat: true,
            spdMult: 1.1,
            invisTimer: 1000
        }];

        // STORE ACCESSORIES:
        this.accessories = [{
            id: 12,
            name: "Snowball",
            price: 1000,
            scale: 105,
            xOff: 18,
            desc: "no effect"
        }, {
            id: 9,
            name: "Tree Cape",
            price: 1000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 10,
            name: "Stone Cape",
            price: 1000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 3,
            name: "Cookie Cape",
            price: 1500,
            scale: 90,
            desc: "no effect"
        }, {
            id: 8,
            name: "Cow Cape",
            price: 2000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 11,
            name: "Monkey Tail",
            price: 2000,
            scale: 97,
            xOff: 25,
            desc: "Super speed but reduced damage",
            spdMult: 1.35,
            dmgMultO: 0.2
        }, {
            id: 17,
            name: "Apple Basket",
            price: 3000,
            scale: 80,
            xOff: 12,
            desc: "slowly regenerates health over time",
            healthRegen: 1
        }, {
            id: 6,
            name: "Winter Cape",
            price: 3000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 4,
            name: "Skull Cape",
            price: 4000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 5,
            name: "Dash Cape",
            price: 5000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 2,
            name: "Dragon Cape",
            price: 6000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 1,
            name: "Super Cape",
            price: 8000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 7,
            name: "Troll Cape",
            price: 8000,
            scale: 90,
            desc: "no effect"
        }, {
            id: 14,
            name: "Thorns",
            price: 10000,
            scale: 115,
            xOff: 20,
            desc: "no effect"
        }, {
            id: 15,
            name: "Blockades",
            price: 10000,
            scale: 95,
            xOff: 15,
            desc: "no effect"
        }, {
            id: 20,
            name: "Devils Tail",
            price: 10000,
            scale: 95,
            xOff: 20,
            desc: "no effect"
        }, {
            id: 16,
            name: "Sawblade",
            price: 12000,
            scale: 90,
            spin: true,
            xOff: 0,
            desc: "deal damage to players that damage you",
            dmg: 0.15
        }, {
            id: 13,
            name: "Angel Wings",
            price: 15000,
            scale: 138,
            xOff: 22,
            desc: "slowly regenerates health over time",
            healthRegen: 3
        }, {
            id: 19,
            name: "Shadow Wings",
            price: 15000,
            scale: 138,
            xOff: 22,
            desc: "increased movement speed",
            spdMult: 1.1
        }, {
            id: 18,
            name: "Blood Wings",
            price: 20000,
            scale: 178,
            xOff: 26,
            desc: "restores health when you deal damage",
            healD: 0.2
        }, {
            id: 21,
            name: "Corrupt X Wings",
            price: 20000,
            scale: 178,
            xOff: 26,
            desc: "deal damage to players that damage you",
            dmg: 0.25
        }];
    }
};
class ProjectileManager {
    constructor(Projectile, projectiles, players, ais, objectManager, items, config, UTILS, server) {
        this.addProjectile = function(x, y, dir, range, speed, indx, owner, ignoreObj, layer, inWindow) {
            let tmpData = items.projectiles[indx];
            let tmpProj;
            for (let i = 0; i < projectiles.length; ++i) {
                if (!projectiles[i].active) {
                    tmpProj = projectiles[i];
                    break;
                }
            }
            if (!tmpProj) {
                tmpProj = new Projectile(players, ais, objectManager, items, config, UTILS, server);
                tmpProj.sid = projectiles.length;
                projectiles.push(tmpProj);
            }
            tmpProj.init(indx, x, y, dir, speed, tmpData.dmg, range, tmpData.scale, owner);
            tmpProj.ignoreObj = ignoreObj;
            tmpProj.layer = layer || tmpData.layer;
            tmpProj.inWindow = inWindow;
            tmpProj.src = tmpData.src;
            return tmpProj;
        };
    }
};
class AiManager {

    // AI MANAGER:
    constructor(ais, AI, players, items, objectManager, config, UTILS, scoreCallback, server) {

        // AI TYPES:
        this.aiTypes = [{
            id: 0,
            src: "cow_1",
            killScore: 150,
            health: 500,
            weightM: 0.8,
            speed: 0.00095,
            turnSpeed: 0.001,
            scale: 72,
            drop: ["food", 50]
        }, {
            id: 1,
            src: "pig_1",
            killScore: 200,
            health: 800,
            weightM: 0.6,
            speed: 0.00085,
            turnSpeed: 0.001,
            scale: 72,
            drop: ["food", 80]
        }, {
            id: 2,
            name: "Bull",
            src: "bull_2",
            hostile: true,
            dmg: 20,
            killScore: 1000,
            health: 1800,
            weightM: 0.5,
            speed: 0.00094,
            turnSpeed: 0.00074,
            scale: 78,
            viewRange: 800,
            chargePlayer: true,
            drop: ["food", 100]
        }, {
            id: 3,
            name: "Bully",
            src: "bull_1",
            hostile: true,
            dmg: 20,
            killScore: 2000,
            health: 2800,
            weightM: 0.45,
            speed: 0.001,
            turnSpeed: 0.0008,
            scale: 90,
            viewRange: 900,
            chargePlayer: true,
            drop: ["food", 400]
        }, {
            id: 4,
            name: "Wolf",
            src: "wolf_1",
            hostile: true,
            dmg: 8,
            killScore: 500,
            health: 300,
            weightM: 0.45,
            speed: 0.001,
            turnSpeed: 0.002,
            scale: 84,
            viewRange: 800,
            chargePlayer: true,
            drop: ["food", 200]
        }, {
            id: 5,
            name: "Quack",
            src: "chicken_1",
            dmg: 8,
            killScore: 2000,
            noTrap: true,
            health: 300,
            weightM: 0.2,
            speed: 0.0018,
            turnSpeed: 0.006,
            scale: 70,
            drop: ["food", 100]
        }, {
            id: 6,
            name: "MOOSTAFA",
            nameScale: 50,
            src: "enemy",
            hostile: true,
            dontRun: true,
            fixedSpawn: true,
            spawnDelay: 60000,
            noTrap: true,
            colDmg: 100,
            dmg: 40,
            killScore: 8000,
            health: 18000,
            weightM: 0.4,
            speed: 0.0007,
            turnSpeed: 0.01,
            scale: 80,
            spriteMlt: 1.8,
            leapForce: 0.9,
            viewRange: 1000,
            hitRange: 210,
            hitDelay: 1000,
            chargePlayer: true,
            drop: ["food", 100]
        }, {
            id: 7,
            name: "Treasure",
            hostile: true,
            nameScale: 35,
            src: "crate_1",
            fixedSpawn: true,
            spawnDelay: 120000,
            colDmg: 200,
            killScore: 5000,
            health: 20000,
            weightM: 0.1,
            speed: 0.0,
            turnSpeed: 0.0,
            scale: 70,
            spriteMlt: 1.0
        }, {
            id: 8,
            name: "MOOFIE",
            src: "wolf_2",
            hostile: true,
            fixedSpawn: true,
            dontRun: true,
            hitScare: 4,
            spawnDelay: 30000,
            noTrap: true,
            nameScale: 35,
            dmg: 10,
            colDmg: 100,
            killScore: 3000,
            health: 7000,
            weightM: 0.45,
            speed: 0.0015,
            turnSpeed: 0.002,
            scale: 90,
            viewRange: 800,
            chargePlayer: true,
            drop: ["food", 1000]
        }, {
            id: 9,
            name: "💀MOOFIE",
            src: "wolf_2",
            hostile: !0,
            fixedSpawn: !0,
            dontRun: !0,
            hitScare: 50,
            spawnDelay: 6e4,
            noTrap: !0,
            nameScale: 35,
            dmg: 12,
            colDmg: 100,
            killScore: 3e3,
            health: 9e3,
            weightM: .45,
            speed: .0015,
            turnSpeed: .0025,
            scale: 94,
            viewRange: 1440,
            chargePlayer: !0,
            drop: ["food", 3e3],
            minSpawnRange: .85,
            maxSpawnRange: .9
        }, {
            id: 10,
            name: "💀Wolf",
            src: "wolf_1",
            hostile: !0,
            fixedSpawn: !0,
            dontRun: !0,
            hitScare: 50,
            spawnDelay: 3e4,
            dmg: 10,
            killScore: 700,
            health: 500,
            weightM: .45,
            speed: .00115,
            turnSpeed: .0025,
            scale: 88,
            viewRange: 1440,
            chargePlayer: !0,
            drop: ["food", 400],
            minSpawnRange: .85,
            maxSpawnRange: .9
        }, {
            id: 11,
            name: "💀Bully",
            src: "bull_1",
            hostile: !0,
            fixedSpawn: !0,
            dontRun: !0,
            hitScare: 50,
            dmg: 20,
            killScore: 5e3,
            health: 5e3,
            spawnDelay: 1e5,
            weightM: .45,
            speed: .00115,
            turnSpeed: .0025,
            scale: 94,
            viewRange: 1440,
            chargePlayer: !0,
            drop: ["food", 800],
            minSpawnRange: .85,
            maxSpawnRange: .9
        }];

        // SPAWN AI:
        this.spawn = function(x, y, dir, index) {
            let tmpObj = ais.find((tmp) => !tmp.active);
            if (!tmpObj) {
                tmpObj = new AI(ais.length, objectManager, players, items, UTILS, config, scoreCallback, server);
                ais.push(tmpObj);
            }
            tmpObj.init(x, y, dir, index, this.aiTypes[index]);
            return tmpObj;
        };
    }

};
class AI {
    constructor(sid, objectManager, players, items, UTILS, config, scoreCallback, server) {
        this.sid = sid;
        this.isAI = true;
        this.nameIndex = UTILS.randInt(0, config.cowNames.length - 1);

        // INIT:
        this.init = function(x, y, dir, index, data) {
            this.x = x;
            this.y = y;
            this.startX = data.fixedSpawn ? x : null;
            this.startY = data.fixedSpawn ? y : null;
            this.xVel = 0;
            this.yVel = 0;
            this.zIndex = 0;
            this.dir = dir;
            this.dirPlus = 0;
            this.showName = 'aaa';
            this.index = index;
            this.src = data.src;
            if (data.name) this.name = data.name;
            this.weightM = data.weightM;
            this.speed = data.speed;
            this.killScore = data.killScore;
            this.turnSpeed = data.turnSpeed;
            this.scale = data.scale;
            this.maxHealth = data.health;
            this.leapForce = data.leapForce;
            this.health = this.maxHealth;
            this.chargePlayer = data.chargePlayer;
            this.viewRange = data.viewRange;
            this.drop = data.drop;
            this.dmg = data.dmg;
            this.hostile = data.hostile;
            this.dontRun = data.dontRun;
            this.hitRange = data.hitRange;
            this.hitDelay = data.hitDelay;
            this.hitScare = data.hitScare;
            this.spriteMlt = data.spriteMlt;
            this.nameScale = data.nameScale;
            this.colDmg = data.colDmg;
            this.noTrap = data.noTrap;
            this.spawnDelay = data.spawnDelay;
            this.hitWait = 0;
            this.waitCount = 1000;
            this.moveCount = 0;
            this.targetDir = 0;
            this.active = true;
            this.alive = true;
            this.runFrom = null;
            this.chargeTarget = null;
            this.dmgOverTime = {};
        };

        let tmpRatio = 0;
        let animIndex = 0;
        this.animate = function(delta) {
            if (this.animTime > 0) {
                this.animTime -= delta;
                if (this.animTime <= 0) {
                    this.animTime = 0;
                    this.dirPlus = 0;
                    tmpRatio = 0;
                    animIndex = 0;
                } else {
                    if (animIndex == 0) {
                        tmpRatio += delta / (this.animSpeed * config.hitReturnRatio);
                        this.dirPlus = UTILS.lerp(0, this.targetAngle, Math.min(1, tmpRatio));
                        if (tmpRatio >= 1) {
                            tmpRatio = 1;
                            animIndex = 1;
                        }
                    } else {
                        tmpRatio -= delta / (this.animSpeed * (1 - config.hitReturnRatio));
                        this.dirPlus = UTILS.lerp(0, this.targetAngle, Math.max(0, tmpRatio));
                    }
                }
            }
        };

        // ANIMATION:
        this.startAnim = function() {
            this.animTime = this.animSpeed = 600;
            this.targetAngle = Math.PI * 0.8;
            tmpRatio = 0;
            animIndex = 0;
        };

    };

};
class addCh {
    constructor(x, y, chat, tmpObj) {
        this.x = x;
        this.y = y;
        this.alpha = 0;
        this.active = true;
        this.alive = false;
        this.chat = chat;
        this.owner = tmpObj;
    };
};
class DeadPlayer {
    constructor(x, y, dir, buildIndex, weaponIndex, weaponVariant, skinColor, scale, name) {
        this.x = x;
        this.y = y;
        this.lastDir = dir;
        this.dir = dir + Math.PI;
        this.buildIndex = buildIndex;
        this.weaponIndex = weaponIndex;
        this.weaponVariant = weaponVariant;
        this.skinColor = skinColor;
        this.scale = scale;
        this.visScale = 0;
        this.name = name;
        this.alpha = 1;
        this.active = true;
        this.animate = function(delta) {
            let d2 = UTILS.getAngleDist(this.lastDir, this.dir);
            if (d2 > 0.01) {
                this.dir += d2 / 20;
            } else {
                this.dir = this.lastDir;
            }
            if (this.visScale < this.scale) {
                this.visScale += delta / (this.scale / 2);
                if (this.visScale >= this.scale) {
                    this.visScale = this.scale;
                }
            }
            this.alpha -= delta / 30000;
            if (this.alpha <= 0) {
                this.alpha = 0;
                this.active = false;
            }
        }
    }
};
class Player {
    constructor(id, sid, config, UTILS, projectileManager, objectManager, players, ais, items, hats, accessories, server, scoreCallback, iconCallback) {
        this.id = id;
        this.sid = sid;
        this.tmpScore = 0;
        this.team = null;
        this.latestSkin = 0;
        this.oldSkinIndex = 0;
        this.skinIndex = 0;
        this.latestTail = 0;
        this.oldTailIndex = 0;
        this.tailIndex = 0;
        this.hitTime = 0;
        this.lastHit = 0;
        this.showName = 'NOOO';
        this.tails = {};
        for (let i = 0; i < accessories.length; ++i) {
            if (accessories[i].price <= 0) this.tails[accessories[i].id] = 1;
        }
        this.skins = {};
        for (let i = 0; i < hats.length; ++i) {
            if (hats[i].price <= 0) this.skins[hats[i].id] = 1;
        }
        this.points = 0;
        this.dt = 0;
        this.hidden = false;
        this.itemCounts = {};
        this.isPlayer = true;
        this.pps = 0;
        this.moveDir = undefined;
        this.skinRot = 0;
        this.lastPing = 0;
        this.iconIndex = 0;
        this.skinColor = 0;
        this.dist2 = 0;
        this.aim2 = 0;
        this.maxSpeed = 1;
        this.chat = {
            message: null,
            count: 0
        };
        this.circle = false;
        this.cAngle = 0;
        // SPAWN:
        this.spawn = function(moofoll) {
            this.attacked = false;
            this.timeDamaged = 0;
            this.timeHealed = 0;
            this.pinge = 0;
            this.millPlace = 'NOOO';
            this.lastshamecount = 0;
            this.death = false;
            this.spinDir = 0;
            this.sync = false;
            this.antiBull = 0;
            this.bullTimer = 0;
            this.poisonTimer = 0;
            this.active = true;
            this.alive = true;
            this.lockMove = false;
            this.lockDir = false;
            this.minimapCounter = 0;
            this.chatCountdown = 0;
            this.shameCount = 0;
            this.shameTimer = 0;
            this.sentTo = {};
            this.gathering = 0;
            this.gatherIndex = 0;
            this.shooting = {};
            this.shootIndex = 9;
            this.autoGather = 0;
            this.animTime = 0;
            this.animSpeed = 0;
            this.mouseState = 0;
            this.buildIndex = -1;
            this.weaponIndex = 0;
            this.weaponCode = 0;
            this.weaponVariant = 0;
            this.primaryIndex = undefined;
            this.secondaryIndex = undefined;
            this.dmgOverTime = {};
            this.noMovTimer = 0;
            this.maxXP = 300;
            this.XP = 0;
            this.age = 1;
            this.kills = 0;
            this.upgrAge = 2;
            this.upgradePoints = 0;
            this.syncThreats = 0;
            this.x = 0;
            this.y = 0;
            this.oldXY = {
                x: 0,
                y: 0
            };
            this.zIndex = 0;
            this.xVel = 0;
            this.yVel = 0;
            this.slowMult = 1;
            this.dir = 0;
            this.dirPlus = 0;
            this.targetDir = 0;
            this.targetAngle = 0;
            this.maxHealth = 100;
            this.health = this.maxHealth;
            this.oldHealth = this.maxHealth;
            this.damaged = 0;
            this.scale = config.playerScale;
            this.speed = config.playerSpeed;
            this.resetMoveDir();
            this.resetResources(moofoll);
            this.items = [0, 3, 6, 10];
            this.weapons = [0];
            this.shootCount = 0;
            this.weaponXP = [];
            this.reloads = {
                0: 0,
                1: 0,
                2: 0,
                3: 0,
                4: 0,
                5: 0,
                6: 0,
                7: 0,
                8: 0,
                9: 0,
                10: 0,
                11: 0,
                12: 0,
                13: 0,
                14: 0,
                15: 0,
                53: 0,
            };
            this.bowThreat = {
                9: 0,
                12: 0,
                13: 0,
                15: 0,
            };
            this.damageThreat = 0;
            this.inTrap = false;
            this.canEmpAnti = false;
            this.empAnti = false;
            this.soldierAnti = false;
            this.poisonTick = 0;
            this.bullTick = 0;
            this.setPoisonTick = false;
            this.setBullTick = false;
            this.antiTimer = 2;
            this.hasAttackedThisTick = false;
            this._attackedThisTickTempVariable = false
            this.hasFiredProjectileThisTick = false;
            this._firedThisTickTempVariable = false;
            this.hitDetect = [];
            this.primaryReload = 1
            this.inAnti = false
            this.lastAntiTick = 0
            this.secondaryReload = 1
            this.turretReload = 1
        };

        // RESET MOVE DIR:
        this.resetMoveDir = function() {
            this.moveDir = undefined;
        };

        // RESET RESOURCES:
        this.resetResources = function(moofoll) {
            for (let i = 0; i < config.resourceTypes.length; ++i) {
                this[config.resourceTypes[i]] = moofoll ? 100 : 0;
            }
        };

        // ADD ITEM:
        this.getItemType = function(id) {
            let findindx = this.items.findIndex((ids) => ids == id);
            if (findindx != -1) {
                return findindx;
            } else {
                return items.checkItem.index(id, this.items);
            }
        };

        // SET DATA:
        this.setData = function(data) {
            this.id = data[0];
            this.sid = data[1];
            this.name = data[2];
            this.x = data[3];
            this.y = data[4];
            this.dir = data[5];
            this.health = data[6];
            this.maxHealth = data[7];
            this.scale = data[8];
            this.skinColor = data[9];
        };

        // UPDATE POISON TICK:
        this.updateTimer = function() {

            this.bullTimer -= 1;
            if (this.bullTimer <= 0) {
                this.setBullTick = false;
                this.bullTick = game.tick - 1;
                this.bullTimer = config.serverUpdateRate;
            }
            this.poisonTimer -= 1;
            if (this.poisonTimer <= 0) {
                this.setPoisonTick = false;
                this.poisonTick = game.tick - 1;
                this.poisonTimer = config.serverUpdateRate;
            }

        };
        this.update = function(delta) {
            if (this.active) {

                // MOVE:
                let gear = {
                    skin: findID(hats, this.skinIndex),
                    tail: findID(accessories, this.tailIndex)
                }
                let spdMult = ((this.buildIndex >= 0) ? 0.5 : 1) * (items.weapons[this.weaponIndex].spdMult || 1) * (gear.skin ? (gear.skin.spdMult || 1) : 1) * (gear.tail ? (gear.tail.spdMult || 1) : 1) * (this.y <= config.snowBiomeTop ? ((gear.skin && gear.skin.coldM) ? 1 : config.snowSpeed) : 1) * this.slowMult;
                this.maxSpeed = spdMult;

            }
        };

        let tmpRatio = 0;
        let animIndex = 0;
        this.animate = function(delta) {
            if (this.animTime > 0) {
                this.animTime -= delta;
                if (this.animTime <= 0) {
                    this.animTime = 0;
                    this.dirPlus = 0;
                    tmpRatio = 0;
                    animIndex = 0;
                } else {
                    if (animIndex == 0) {
                        tmpRatio += delta / (this.animSpeed * config.hitReturnRatio);
                        this.dirPlus = UTILS.lerp(0, this.targetAngle, Math.min(1, tmpRatio));
                        if (tmpRatio >= 1) {
                            tmpRatio = 1;
                            animIndex = 1;
                        }
                    } else {
                        tmpRatio -= delta / (this.animSpeed * (1 - config.hitReturnRatio));
                        this.dirPlus = UTILS.lerp(0, this.targetAngle, Math.max(0, tmpRatio));
                    }
                }
            }
        };

        // GATHER ANIMATION:
        this.startAnim = function(didHit, index) {
            this.animTime = this.animSpeed = items.weapons[index].speed;
            this.targetAngle = (didHit ? -config.hitAngle : -Math.PI);
            tmpRatio = 0;
            animIndex = 0;
        };

        // CAN SEE:
        this.canSee = function(other) {
            if (!other) return false;
            let dx = Math.abs(other.x - this.x) - other.scale;
            let dy = Math.abs(other.y - this.y) - other.scale;
            return dx <= (config.maxScreenWidth / 2) * 1.3 && dy <= (config.maxScreenHeight / 2) * 1.3;
        };

        // SHAME SYSTEM:
        this.judgeShame = function() {
            if (this.oldHealth < this.health) {
                if (this.hitTime) {
                    let timeSinceHit = game.tick - this.hitTime;
                    this.lastHit = game.tick;
                    this.hitTime = 0;
                    if (timeSinceHit < 2) {
                        this.shameCount++;
                    } else {
                        this.shameCount = Math.max(0, this.shameCount - 2);
                    }
                }
            } else if (this.oldHealth > this.health) {
                this.hitTime = game.tick;
            }
        };
        this.addShameTimer = function() {
            this.shameCount = 0;
            this.shameTimer = 30;
            let interval = setInterval(() => {
                this.shameTimer--;
                if (this.shameTimer <= 0) {
                    clearInterval(interval);
                }
            }, 1000);
        };

        // CHECK TEAM:
        this.isTeam = function(tmpObj) {
            return (this == tmpObj || (this.team && this.team == tmpObj.team));
        };

        // FOR THE PLAYER:
        this.findAllianceBySid = function(sid) {
            return this.team ? alliancePlayers.find((THIS) => THIS === sid) : null;
        };
        this.checkCanInsta = function(nobull) {
            let totally = 0;
            if (this.alive && inGame) {
                let primary = {
                    weapon: this.weapons[0],
                    variant: this.primaryVariant,
                    dmg: this.weapons[0] == undefined ? 0 : items.weapons[this.weapons[0]].dmg,
                };
                let secondary = {
                    weapon: this.weapons[1],
                    variant: this.secondaryVariant,
                    dmg: this.weapons[1] == undefined ? 0 : items.weapons[this.weapons[1]].Pdmg,
                };
                let bull = this.skins[7] && !nobull ? 1.5 : 1;
                let pV = primary.variant != undefined ? config.weaponVariants[primary.variant].val : 1;
                if (primary.weapon != undefined && this.reloads[primary.weapon] == 0) {
                    totally += primary.dmg * pV * bull;
                }
                if (secondary.weapon != undefined && this.reloads[secondary.weapon] == 0) {
                    totally += secondary.dmg;
                }
                if (this.skins[53] && this.reloads[53] <= (player.weapons[1] == 10 ? 0 : game.tickRate) && near.skinIndex != 22) {
                    totally += 25;
                }
                totally *= near.skinIndex == 6 ? 0.75 : 1;
                return totally;
            }
            return 0;
        };

        // UPDATE WEAPON RELOAD:
        const BASE_TRAP_PLACEMENT_RADIUS = 70;
        const LOW_HEALTH_THRESHOLD = 272.58;
        const BASE_PLACE_DELAY = 0.001;
        const SAFETY_BUFFER = 50;
        const TARGET_PREDICTION_STEPS = 20;
        const OPTIMIZED_SCORE_WEIGHT = 2.0;
        const ANGLE_INCREMENT = 27;
        const ENVIRONMENTAL_IMPACT_RADIUS = 100;
        const LINE_OF_SIGHT_BLOCKAGE_PENALTY = 20;
        const TEAMMATE_PROXIMITY_PENALTY = 20;
        const MAX_ENVIRONMENTAL_SCORE = 100;
        const HEATMAP_DECAY_RATE = 0.1;
        const ENVIRONMENTAL_ADAPTATION_MULTIPLIER = 1.5;

        let lastPlacementTime = 0;
        let enemyHeatmap = {};
        let enemyMovementPatterns = {};
        let environmentalFactors = {};
        let trapPositionCache = {};
        let teamCoordination = {};
        let liveCombatData = {};

        // Ensure this is called periodically (e.g., in a game loop or tick).
        this.manageReload = function () {
            if (this.shooting[53]) {
                this.shooting[53] = 0;
                this.reloads[53] = (2500 - game.tickRate);
            } else {
                if (this.reloads[53] > 0) {
                    this.reloads[53] = Math.max(0, this.reloads[53] - game.tickRate);
                }
            }

            if (this.gathering || this.shooting[1]) {
                if (this.gathering) {
                    this.gathering = 0;
                    this.reloads[this.gatherIndex] = (items.weapons[this.gatherIndex].speed * (this.skinIndex == 20 ? 0.78 : 1));
                    this.attacked = true;
                }
                if (this.shooting[1]) {
                    this.shooting[1] = 0;
                    this.reloads[this.shootIndex] = (items.weapons[this.shootIndex].speed * (this.skinIndex == 20 ? 0.78 : 1));
                    this.attacked = true;
                }
            } else {
                this.attacked = false;
                if (this.buildIndex < 0) {
                    if (this.reloads[this.weaponIndex] > 0) {
                        this.reloads[this.weaponIndex] = Math.max(0, this.reloads[this.weaponIndex] - game.tickRate);
                        if (this == player) {
                            if (getEl("weaponGrind").checked) {
                                for (let i = 0; i < Math.PI * 2; i += Math.PI / 2) {
                                    checkPlace(player.getItemType(22), i);
                                }
                            }
                        }
                        if (this.reloads[this.primaryIndex] == 0 && this.reloads[this.weaponIndex] == 0) {
                            this.antiBull++;
                            game.tickBase(() => {
                                this.antiBull = 0;
                            }, 1);
                        }
                    }
                }
            }
        }

        // FOR ANTI INSTA:
        this.addDamageThreat = function (tmpObj) {
            const defaultPrimaryDmg = 45;
            const defaultSecondaryDmg = 35;
            const bullMultiplier = 1.5;
            const defaultVariantVal = 1.18;
            const skinIndexPenalty = 0.75;
            const closeRangeThreshold = 300;
            const additionalThreatReloadTickRate = game.tickRate;
            const additionalThreatValue = 25;
            let { primaryIndex, primaryVariant, secondaryIndex, secondaryVariant, reloads, dist2 } = this;
            let { weapons } = items;
            let { weaponVariants } = config;
            let primary = {
                weapon: primaryIndex,
                variant: primaryVariant,
                dmg: primaryIndex === undefined ? defaultPrimaryDmg : weapons[primaryIndex].dmg
            };
            let secondary = {
                weapon: secondaryIndex,
                variant: secondaryVariant,
                dmg: secondaryIndex === undefined ? defaultSecondaryDmg : weapons[secondaryIndex].Pdmg
            };
            let primaryVariantValue = primary.variant !== undefined ? weaponVariants[primary.variant].val : defaultVariantVal;
            let secondaryVariantValue = secondary.variant !== undefined && ![9, 12, 17, 15].includes(secondary.weapon) ? weaponVariants[secondary.variant].val : defaultVariantVal;
            let damageThreat = 0;
            if (primary.weapon === undefined || reloads[primary.weapon] === 0) {
                damageThreat += primary.dmg * primaryVariantValue * bullMultiplier;
            }
            if (secondary.weapon === undefined || reloads[secondary.weapon] === 0) {
                damageThreat += secondary.dmg * secondaryVariantValue;
            }
            if (reloads[53] <= additionalThreatReloadTickRate) {
                damageThreat += additionalThreatValue;
            }
            damageThreat *= tmpObj.skinIndex === 6 ? skinIndexPenalty : 1;
            if (!this.isTeam(tmpObj) && dist2 <= closeRangeThreshold) {
                tmpObj.damageThreat += damageThreat;
            }
            // ANTI
            this.addDamageProbability = function (tmpObj) {
                let primary = {
                    weapon: this.primaryIndex,
                    variant: this.primaryVariant,
                    dmg: this.primaryIndex === undefined ? 45 : items.weapons[this.primaryIndex].dmg
                };
                let secondary = {
                    weapon: this.secondaryIndex,
                    variant: this.secondaryVariant,
                    dmg: this.secondaryIndex === undefined ? 50 : items.weapons[this.secondaryIndex].Pdmg
                };
                let bull = 1.5;
                let pV = primary.variant !== undefined ? config.weaponVariants[primary.variant].val : 1.18;
                let sV = secondary.variant !== undefined ? [9, 12, 17, 15].includes(secondary.weapon) ? 1 : config.weaponVariants[secondary.variant].val : 1.18;
                if (this.reloads[primary.weapon] === 0) {
                    this.damageProbably += primary.dmg * pV * bull * 0.75;
                }
                if (this.reloads[secondary.weapon] === 0) {
                    this.damageProbably += secondary.dmg * sV;
                }
                this.damageProbably *= 0.75;
                if (!this.isTeam(tmpObj) && this.dist2 <= 300) {
                    tmpObj.damageProbably += this.damageProbably;
                }
            }
        };
    }
};

// SOME CODES:
function sendUpgrade(index) {
    player.reloads[index] = 0;
    packet("H", index);
}

function storeEquip(id, index) {
    packet("c", 0, id, index);
}

function storeBuy(id, index) {
    packet("c", 1, id, index);
}

function buyEquip(id, index) {
    if (player.alive && inGame) {
        if (index == 0) {
            if (player.skins[id]) {
                if (player.latestSkin != id) {
                    packet("c", 0, id, 0);
                }
            } else {
                if (true) {
                    let find = findID(hats, id);
                    if (find) {
                        if (player.points >= find.price) {
                            packet("c", 1, id, 0);
                            packet("c", 0, id, 0);
                        } else {

                        }
                    } else {

                    }
                } else {

                }
            }
        } else if (index == 1) {
            if (useWasd && (id != 11 && id != 0)) {
                if (player.latestTail != 0) {
                    packet("c", 0, 0, 1);
                }
                return;
            }
            if (player.tails[id]) {
                if (player.latestTail != id) {
                    packet("c", 0, id, 1);
                }
            } else {
                if (true) {
                    let find = findID(accessories, id);
                    if (find) {
                        if (player.points >= find.price) {
                            packet("c", 1, id, 1);
                            packet("c", 0, id, 1);
                        } else {
                            if (player.latestTail != 0) {
                                packet("c", 0, 0, 1);
                            }
                        }
                    } else {
                        if (player.latestTail != 0) {
                            packet("c", 0, 0, 1);
                        }
                    }
                } else {
                    if (player.latestTail != 0) {
                        packet("c", 0, 0, 1);
                    }
                }
            }
        } else {
            if (hatLoop) {
                packet("c", 0, loopHats[loopIndex++], 0, "buyËquip");
            } else if (player.latestSkin != 0) {
                packet("c", 0, my.defaultHat, 0, "buyËquip");
            }
        }
    }
}
let isAttacking = false; // Kilid dəyişəni
function sendAttack() {
    if (isAttacking) return; // Əgər artıq bir vuruş gedirsə, funksiyanı dayandır
    isAttacking = true; // Kilidi bağla
    packet("F", 1, null, true);
    setTimeout(() => {
        packet("F", 0, null, true);
        isAttacking = false; // Vuruş bitdi, kilidi aç
    }, 35); // 35ms sonra yenidən vura bilərsən
}
function selectToBuild(index, wpn) {
    packet("z", index, wpn);
}

function selectWeapon(index, isPlace) {
    if (!isPlace) {
        player.weaponCode = index;
    }
    packet("z", index, 1);
}

function sendAutoGather() {
    packet("K", 1, 1);
}

function sendAtck(id, angle) {
    packet("F", id, angle, 1);
}

// PLACER:
  let dstb = false;
function place(id, rad, rmd) {
    try {
        if (id == undefined) return;
        let item = items.list[player.items[id]];
        let tmpS = player.scale + item.scale + (item.placeOffset || 0);
        let tmpX = player.x2 + tmpS * Math.cos(rad);
        let tmpY = player.y2 + tmpS * Math.sin(rad);
        if ((player.alive && inGame && player.itemCounts[item.group.id] == undefined ? true : player.itemCounts[item.group.id] < (config.isSandbox ? 299 : item.group.limit ? item.group.limit : 99))) {
                             dstb = true;

            selectToBuild(player.items[id]);
            sendAtck(1, rad);
            selectWeapon(player.weaponCode, 1);
        dstb = false
        }
    } catch (e) {}
}
let windmillBlocked = false;
function place1(id, rad, rmd) {
    try {
        if (id == undefined) return;
        let item = items.list[player.items[id]];
        let scoreElem = document.getElementById("scoreDisplay");
        let currentGold = 0;
        if (scoreElem) {
            currentGold = parseInt(scoreElem.innerText.replace(/,/g, '')) || 0;
        }
        let isWindmill = (item.name && item.name.toLowerCase().includes("windmill")) || id === 3;
        if (isWindmill && windmillBlocked) {
            return;
        }
        if (isWindmill && currentGold >= 100000) {
            return;
        }
        let windmillCount = player.itemCounts[item.group.id] || 0;
        let isSandbox = window.location.href.includes("sandbox.moomoo.io");
        if (isWindmill) {
            if (windmillCount >= 290) {
                windmillBlocked = true;
                return;
            }
        }
        let currentLimit = isSandbox ? (isWindmill ? 290 : 299) : (item.group.limit || 99);
        let canPlace = (player.itemCounts[item.group.id] == undefined) ? true : (player.itemCounts[item.group.id] < currentLimit);
        if (player.alive && inGame && canPlace) {
            selectToBuild(player.items[id]);
            sendAtck(1, rad);
            selectWeapon(player.weaponCode, 1);
        }
    } catch (e) {}
}
function place2(id, rad, rmd) {
    try {
        if (id == undefined) return;
        let item = items.list[player.items[id]];
        let tmpS = player.scale + item.scale + (item.placeOffset || 0);
        let tmpX = player.x2 + tmpS * Math.cos(rad);
        let tmpY = player.y2 + tmpS * Math.sin(rad);
        if ((player.alive && inGame && player.itemCounts[item.group.id] == undefined ? true : player.itemCounts[item.group.id] < (config.isSandbox ? 295 : item.group.limit ? item.group.limit : 95))) {
                  dstb = true;
                  selectToBuild(player.items[id]);
                  sendAttack()
                  selectWeapon(player.weaponCode, 1);
                  dstb = false
if (window.window.debugObject === true) {window.ownLog("Send [" + player.items[id] + "]" , "#21307a");}
        }
    } catch (e) {}
}
function checkPlace(id, rad) {
    try {
        if (id == undefined) return;
        let item = items.list[player.items[id]];
        let tmpS = player.scale + item.scale + (item.placeOffset || 0);
        let tmpX = player.x2 + tmpS * Math.cos(rad);
        let tmpY = player.y2 + tmpS * Math.sin(rad);
        if (objectManager.checkItemLocation(tmpX, tmpY, item.scale, 0.6, item.id, false, player)) {
            place(id, rad, 1);
        }
    } catch (e) {}
}
function checkPlace1(id, rad) {
    try {
        if (id == undefined) return;
        let item = items.list[player.items[id]];
        let tmpS = player.scale + item.scale + (item.placeOffset || 0);
        let tmpX = player.x2 + tmpS * Math.cos(rad);
        let tmpY = player.y2 + tmpS * Math.sin(rad);
        if (objectManager.checkItemLocation(tmpX, tmpY, item.scale, 0.6, item.id, false, player)) {
            place1(id, rad, 1);
        }
    } catch (e) {}
}
function getDamageThreat(tmpObj) {
    tmpObj.instaThreat = 0;
    if (isTeam(tmpObj)) {
        let primary = {
            weapon: tmpObj.primaryIndex,
            variant: tmpObj.primaryVariant,
            dmg: tmpObj.primaryIndex == undefined ? 45 : items.weapons[tmpObj.primaryIndex].dmg,
        };
        let secondary = {
            weapon: tmpObj.secondaryIndex,
            variant: tmpObj.secondaryVariant,
            dmg: tmpObj.secondaryIndex == undefined ? 50 : items.weapons[tmpObj.secondaryIndex].Pdmg,
        };
        let bull = tmpObj.skinIndex == 7 ? 1.5 : 1;
        let pV = primary.variant != undefined ? config.weaponVariants[primary.variant].val : 1.18;
        if (primary.weapon != undefined && tmpObj.reloads[primary.weapon] == 0) {
            tmpObj.instaThreat += primary.dmg * pV * bull;
        }
        if (secondary.weapon != undefined && tmpObj.reloads[secondary.weapon] == 0) {
            tmpObj.instaThreat += secondary.dmg;
        }
        if (tmpObj.reloads[53] === 0) {
            tmpObj.instaThreat += 25;
        }
        tmpObj.instaThreat *= player.skinIndex == 6 ? 0.75 : 1;
    }
}
let bestMonkeys = 0;
// UPDATE HEALTH:
function updateHealth(sid, value) {
    tmpObj = findPlayerBySID(sid);
    if (tmpObj) {
        tmpObj.oldHealth = tmpObj.health;
        tmpObj.health = value;
        if (tmpObj.oldHealth < tmpObj.health) {
            if (tmpObj.hitTime) {
                let timeSinceHit = Date.now() - tmpObj.hitTime;
                let tickiy = ticks.time.filter(e => e == "lag");
                tmpObj.hitTime = 0;
                if (timeSinceHit <= (tickiy.length >= 2 ? 120 : 120)) {
                    tmpObj.shameCount += 1;
                    if (instaC.isTrue) {
                        tmpObj.healSid = Math.min(3, tmpObj.healSid + 1);
                    }
                    if (tmpObj.shameCount > tmpObj.maxShame) {
                        tmpObj.maxShame = tmpObj.shameCount;
                    }
                } else {
                    tmpObj.shameCount = Math.max(0, tmpObj.shameCount - 2);
                    if (instaC.isTrue) {
                        tmpObj.healSid = Math.max(-1, tmpObj.healSid - 1);
                    }
                }
            }
            var isAlly = function(id){
                for(let i = 0;i < alliancePlayers.length;i+=2){
                    if(id == alliancePlayers[i]){
                        return true;
                    }
                }
            }
            function GetangleSpike(a, b) {
                if (a == player) {
                    return Math.sqrt(Math.pow((b.y - a.y2), 2) + Math.pow((b.x - a.x2), 2));
                } else if (b == player) {
                    return Math.sqrt(Math.pow((b.y2 - a.y), 2) + Math.pow((b.x2 - a.x), 2));
                } else {
                    return Math.sqrt(Math.pow((b.y - a.y), 2) + Math.pow((b.x - a.x), 2));
                }
            }
            let spikes = gameObjects.filter(obj => (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "spinning spikes" || obj.name == "poison spikes") && GetangleSpike(player, obj) < player.scale + obj.scale + 50 && !isAlly(obj.owner.sid) && obj.active)
            let direction = Math.atan2(player.y2 - near.y2, player.x2 - near.x2)
            let newPos = {
                x: player.x + Math.cos(direction) * 35,
                y: player.y2 + Math.sin(direction) * 35,
            }
            if (GetangleSpike(spikes, player) <= 200 && near.dist2 <= 250) {
                if (near.reloads[near.primaryIndex] || near.reloads[near.secondaryIndex] && near.reloads[53] == 0 && items.weapons[near.secondaryIndex == 10 || near.secondaryIndex]) {
                    for (let i = 0; i < spikes.length; i++) {
                        if (GetangleSpike(spikes[i], newPos) < player.scale + spikes[i].scale && (!my.inTrap || my.inTrap)) {
                            //buyEquip(6, 0);
                            player.soldierAnti = true;
                        }
                    }
                } else {
                    if (player.health <= 25 >= 90 && player.shameCount <= 5) {
                        setTimeout(healer(), 111)
                      //  buyEquip(6, 0);
                    } else {
                        setTimeout(healer(), 111)
                    }
                }
            }
        }
    }
}
// UPDATE HEALTH:
let doEmpAntiInsta = false;
let judgeAtNextTick = false;

// FUNCTIONS
const alwaysSoldier = () => {
    buyEquip(6, 0);
    my.anti0Tick++;
}
let enemyDmg = 0;
function antiKnockBack(tmpObj) { // tmpObj burada düşməndir (near.enemy)
    if (!tmpObj || tmpObj.primaryIndex == undefined || traps.intrap) return;

    // 1. Ziyanı hesabla (Sənin config və items massivlərinə uyğun)
    let enemyDmg = items.weapons[tmpObj.primaryIndex].dmg * (config.weaponVariants[tmpObj.primaryVariant]?.val || 1) * 1.5 + (tmpObj.reloads[53] == 0 ? 25 : 0);

    // 2. Düşmənin vuruş məsafəsini hesabla
    let HitR1 = items.weapons[tmpObj.primaryIndex].range * ((items.weapons[tmpObj.primaryIndex].mR || 0)) + config.playerScale * 2;
    let attackRange = HitR1;

    // 3. Ətrafdakı tikanları tap (UTILS.getDist istifadə edərək)
    let objs = gameObjects.filter(tmp => tmp.active && tmp.dmg && !tmp.isTeamObject(player) && UTILS.getDist(tmp, player, 0, 0) <= 600);

    for (let obj of objs) {
        // Tikanın sənə olan bucağını tapırıq
        let objAimE = UTILS.getDirect(obj, player, 0, 0);
        let objDstE = UTILS.getDist(obj, player, 0, 0);

        // Əgər düşmən sənə vura biləcək məsafədədirsə
        if (objDstE <= (attackRange + obj.scale + 50)) {

            // Proqnoz: Zərbədən sonra hara uçacaqsan? (Sənin endPos məntiqin)
            let endPos = {
                x: (player.x2 || player.x) + Math.cos(tmpObj.aim + Math.PI) * attackRange,
                y: (player.y2 || player.y) + Math.sin(tmpObj.aim + Math.PI) * attackRange
            };

            // Uçacağın yerlə tikan arasındakı məsafə
            let distToSpikeAfterHit = UTILS.getDist(endPos, obj, 0, 0);

            // Əgər uçub tikanın içinə girirsənsə və zərbə səni öldürürsə
            if (distToSpikeAfterHit <= (obj.scale + (player.scale || 35))) {
                if (enemyDmg * (player.skinIndex == 6 ? (3 / 4) : 1) >= 100) {

                    // MÜDAFİƏ BAŞLADI
                    alwaysSoldier();

                    // Tikanın əksinə qaç (Bura PI əlavə etdik ki, tam əks tərəfə getsin)
                    setMoveDir(objAimE + Math.PI);

                    // Önünə alma qoy
                    if (player.shameCount < 4) place(0, getAttackDir());
                }
            }
        }
    }
}

// HEALING:
// HEALING:
function healthBased() {
    if (player.health == player.maxHealth) return 0;
    if ((player.skinIndex != 45 && player.skinIndex != 56)) {
        return Math.ceil((player.maxHealth - player.health) / items.list[player.items[0]].healing);
    }
    return 0;
}

function getAttacker(damaged) {
    let attackers = nears.filter(tmp => {
        if (tmp.attacked) {
            let index = tmp.weaponIndex;
            let dmg = index > 8 ? items.weapons[index].Pdmg : items.weapons[index].dmg;
            let variant = tmp[(index < 9 ? "prima" : "seconda") + "ryVariant"]
            dmg = dmg * (tmp.skinIndex == 7 ? 1.5 : 1) * (tmp.tailIndex == 11 ? 0.2 : 1) * (config.weaponVariants[variant].val) * (player.skinIndex == 6 ? 0.75 : 1);
            if (Math.abs(damaged - dmg) < 0.000001) {
                if (player.skinIndex != 23) {
                    player.poisonCounter = variant == 3 ? 5 : tmp.skinIndex == 21 ? 6 : player.poisonCounter;
                }
                return true;
            }
        }
        return false;
    });
    return attackers;
}

function healer(extra = 0) {
    for (let i = 0; i < healthBased(); i++) {
        place(0, getAttackDir());
    }
    for (let i = 0; i < extra; i++) {
        place(0, getAttackDir());
    }
}
let serverID;
const delayWorker = `
let timeouts = {};
let intervals = {};

self.onmessage = (e) => {
const { type, id, delay } = e.data;

if (type === "setTimeout") {
    timeouts[id] = setTimeout(() => {
    self.postMessage({ type: "timeout", id });
    delete timeouts[id];
    }, delay);
}

else if (type === "clearTimeout") {
    if (timeouts[id]) {
    clearTimeout(timeouts[id]);
    delete timeouts[id];
    }
}

else if (type === "setInterval") {
    intervals[id] = setInterval(() => {
    self.postMessage({ type: "interval", id });
    }, delay);
}

else if (type === "clearInterval") {
    if (intervals[id]) {
    clearInterval(intervals[id]);
    delete intervals[id];
    }
}
};
`;
const blob = new Blob([delayWorker], { type: 'application/javascript' });
const worker1 = new Worker(URL.createObjectURL(blob));

let nextId = 0;
const workerList = {};

function workerSetTimeout(fn, delay) {
    const id = nextId++;
    workerList[id] = fn;
    worker1.postMessage({ type: "setTimeout", id, delay });
    return id;
}


function workerClearTimeout(id) {
    worker1.postMessage({ type: "clearTimeout", id });
    delete workerList[id];
}

function workerSetInterval(fn, delay) {
    const id = nextId++;
    workerList[id] = fn;
    worker1.postMessage({ type: "setInterval", id, delay });
    return id;
}

function workerClearInterval(id) {
    worker1.postMessage({ type: "clearInterval", id });
    delete workerList[id];
}
function predictHeal(howManyCookieToEat) {
    for (let i = 0; i < howManyCookieToEat; i++) {
        place(0, getAttackDir());
    }
}

function antiSyncHealing(timearg) {
    my.antiSync = true;
    let healAnti = workerSetInterval(() => {
        if (player.shameCount < 5) {
            place(0, getAttackDir());
        }
    }, 75);
    workerSetTimeout(() => {
        workerClearInterval(healAnti);
        workerSetTimeout(() => {
            my.antiSync = false;
        }, game.tickRate);
    }, game.tickRate);
}
function soldierMult() {
    return player.latestSkin == 6 ? 0.75 : 1;
}
// Bütün dəyişənlərini olduğu kimi saxlayırıq
let predictDamage = 0;
let stopHealing = false;
let backupAnti = [];
let hittedTime = Date.now();




function applCxC(value) {
    if (player.skinIndex != 45 && player.skinIndex != 56 && combatdefensetoggle.healing) {
        if (0 == player.items[0]) {
            if (value < -80) return 5;
            else if (value < -60) return 4;
            else if (value < -40) return 3;
            else if (value < -20) return 2;
            else return 1;
        } else if (1 == player.items[0]) {
            if (value < -80) return 3;
            else if (value < -40) return 2;
            else return 1;
        } else if (2 == player.items[0]) {
            if (value < -90) return 4;
            else if (value < -60) return 3;
            else if (value < -30) return 2;
            else return 1;
        } else {
            return 4;
        }
    } else if (combatdefensetoggle.healing){
        return 0;
    }
}



function calcDmg(value) {
    return value * (player.skinIndex == 6 ? 0.75 : 1);
}

function healIntrap(tmpObj, value) {
    var heal = function(amount, after) {
        if (combatdefensetoggle.healing) {
            setTickout(() => {
                for (let i = 0; i < applCxC(amount); i++) {
                    place(0, getAttackDir());
                }
            }, after);
        }
    };
    if (enemy.length && combatdefensetoggle.healing) {
        heal(value, 2);
    } else if (combatdefensetoggle.healing) {
        heal(value, 3);
    }
}

// GÜCLƏNDİRİLMİŞ AUTOHEALER (Heç nə silinmədi, Shield və Shame Guard əlavə edildi)
function autoHealer(tmpObj, value) {
    let pingHeal = function() {
        return Math.max(0, 175 - window.pingTime);
    };
    let antiInsta = false;
    let findAttacker = undefined;

    if (true && combatdefensetoggle.healing) {

        // --- YENİ ƏLAVƏ: Insta-Kill Qoruması (Shield Switch) ---
        if (value >= 70 && tmpObj.shameCount < 5) {
            let oldSkin = player.skinIndex;
            storeBuy(7); storeEquip(7); // Shield
            setTimeout(() => { storeEquip(oldSkin || 6); }, 75);
        }

        if (near.dist2 <= 300) {
            // SHAME GUARD: Shame 5-i keçibsə ölməmək üçün divar qoy və yeməyi idarə et
            if (tmpObj.shameCount >= 5) {
                place(player.items[1], getAttackDir());
                if(player.health < 50) place(0, getAttackDir());
            }

            if (value >= 20 && (Date.now() - hittedTime >= 180 || Date.now() - hittedTime <= 60)) {
                if (tmpObj.shameCount < tmpObj.dangerShame) {
                    for (let i = 0; i < applCxC(value); i++) {
                        place(0, getAttackDir());
                        if (Date.now() - hittedTime >= 260) {
                            place(0, getAttackDir());
                        }
                    }
                    if (value >= 70) {
                        const heal = () => {
                            let times = player.items[0] === 1 ? 3 : 4;
                            for(let i = 0; i < times; i++) place(0, getAttackDir());
                        }
                        const slowHeal = () => {
                            setTimeout(()=>{
                                heal();
                            }, pingHeal())
                        }
                        slowHeal();
                    }
                } else {
                    setTickout(()=>{
                        for (let i = 0; i < applCxC(value); i++) {
                            place(0, getAttackDir());
                        }
                    }, 2);
                }
            } else {
                if (traps.inTrap) {
                    healIntrap(tmpObj, value);
                } else {
                    setTickout(()=>{
                        for (let i = 0; i < applCxC(value); i++) {
                            place(0, getAttackDir());
                        }
                    }, 2);
                }
            }
            if (player.skinIndex == 11) {
                if (value >= 30) {
                    instaC.isCounter = true;
                }
            }
            if (value >= 20) {
                hittedTime = Date.now();
                judgeAtNextTick = true;
            }
        } else {
            if (traps.inTrap) {
                healIntrap(tmpObj, value);
            } else {
                setTickout(()=>{
                    for (let i = 0; i < applCxC(value); i++) {
                        place(0, getAttackDir());
                    }
                }, 2);
            }
        }
    }
}


let noTail = false;
// Menuda istifadə edəcəyin dəyişən (məsələn: 2 saniyə)
var invisspeed = 2;
var invisTimer = null;

function biomeGear() {
    if (player.y2 >= config.mapScale / 2 - config.riverWidth / 2 && player.y2 <= config.mapScale / 2 + config.riverWidth / 2) {
        buyEquip(31, 0);
        clearTimeout(invisTimer);
        invisTimer = null;
    } else {
        let isSnow = player.y2 <= config.snowBiomeTop;
        let normalHat = isSnow ? 15 : 12;
        if (combatarmortoggle.auto_invicible && player.health === 100) {
            if (lastMoveDir === undefined) {
                if (!invisTimer) {
                    invisTimer = setTimeout(() => {
                        buyEquip(56, 0);
                    }, speedinvis * 1000);
                }
            } else {
                clearTimeout(invisTimer);
                invisTimer = null;
                buyEquip(normalHat, 0);
            }
        } else {
            clearTimeout(invisTimer);
            invisTimer = null;
            buyEquip(normalHat, 0);
        }
    }
}

let advHeal = [];
let tracker = {
    draw3: {
        active: false,
        x: 0,
        y: 0,
        scale: 0,
    },
    moveDir: undefined,
    lastPos: {
        x: 0,
        y: 0,
    }
}
// // Essential CODE
 let doStuffPingSet = [];
 function smartTick(tick) {
     doStuffPingSet.push(tick);
 }
 class Combat {
     constructor(UTILS, items) {
         this.findSpikeHit = {
             x: 0,
             y: 0,
             spikePosX: 0,
             spikePosY: 0,
             canHit: false,
             spikes: [],
         };
         this.spikesNearEnemy = [];
         this.doSpikeHit = function () {
             if (enemy.length) {
                 let nTrap = gameObjects.find((e) => e.active && 'pit trap' == e.name && e.isTeamObject(player) && UTILS.getDistance(e.x, e.y, near.x2, near.y2) <= 50);
                 let knocked = 0.3 + (items.weapons[player.weapons[0]].knock || 0)
                 let dirs = Math.atan2(
                     near.y2 - player.y2,
                     near.x2 - player.x2
                 )
                 let iXy = {
                     x: near.x2 + knocked * Math.cos(dirs) * 224,
                     y: near.y2 + knocked * Math.sin(dirs) * 224,
                 }
                 if (near.dist2 < items.weapons[player.weapons[0]].range + 70 && !nTrap && near) {
                     this.findSpikeHit.x = iXy.x
                     this.findSpikeHit.y = iXy.y
                 }
                 this.findSpikeHit.spikes = gameObjects.filter((e) => e.active && e.dmg && e.owner.sid == player.sid && UTILS.getDistance(e.x, e.y, iXy.x, iXy.y) <= 35 + e.scale)
                 for (let i = 0; i < this.findSpikeHit.spikes.length; i++) {
                     let obj = this.findSpikeHit.spikes[i];
                     const pSdist = UTILS.getDist(player, obj, 0, 0);
                     const nSdist = UTILS.getDist(near, obj, 0, 0);
                     const nSdist2 = UTILS.getDist(obj, near, 0, 0);
                     if (pSdist > nSdist && nSdist2 < (35 + obj.scale + player.scale) && ((player.primaryDmg >= 35 && player.skinIndex != 6) || player.primaryDmg >= 51)) {
                         if (obj && !nTrap && near && near.dist2 <= items.weapons[player.weapons[0]].range + player.scale * 1.8 && player.reloads[player.weapons[0]] == 0) {
                             this.findSpikeHit.canHit = true;
                             this.findSpikeHit.spikePosX = obj.x;
                             this.findSpikeHit.spikePosY = obj.y;
                             if (this.findSpikeHit.canHit) {
        console.log("Spike 4");
                           instaC.dospikesync = true;
                                 instaC.syncHit = true;
                             }
                             smartTick(() => {
                                 smartTick(() => {
                                     this.findSpikeHit.spikePosX = 0;
                                     this.findSpikeHit.spikePosY = 0;
                                     this.findSpikeHit.canHit = false;
                                 })
                             })
                       }
                   } else {
                         this.findSpikeHit.spikePosX = 0;
                         this.findSpikeHit.spikePosY = 0;
                         this.findSpikeHit.canHit = false;
                     }
                 }
             }
         }
     }
 }
class Traps {
    constructor(UTILS, items) {
        this.dist = 0;
        this.aim = 0;
        this.broken = [];
        this.inTrap = false;
        this.replaced = false;
        this.antiTrapped = false;
        this.hasSpike = false;
        this.objectToIgnore = undefined;
        this.hasAimed = false;
        this.preplaceInfo = [];
        this.info = {};

        this.notFast = function(object = this.info[0]) {
            if (player.weapons[1] != 10) return false;

            if ((object.health > items.weapons[player.weapons[0]].dmg) || [5].includes(player.weapons[0])) return true;

            return false;
        }

        this.testCanPlace = function(id, first = -(Math.PI / 2), repeat = (Math.PI / 2), plus = (Math.PI / 18), radian, replacer, yaboi) {
            try {
                let item = items.list[player.items[id]];
                let tmpS = player.scale + item.scale + (item.placeOffset || 0);
                let counts = {
                    attempts: 0,
                    placed: 0
                };
                let tmpObjects = [];
                gameObjects.forEach((p) => {
                    tmpObjects.push({
                        x: p.x,
                        y: p.y,
                        active: p.active,
                        blocker: p.blocker,
                        scale: p.scale,
                        isItem: p.isItem,
                        type: p.type,
                        colDiv: p.colDiv,
                        getScale: function(sM, ig) {
                            sM = sM || 1;
                            return this.scale * ((this.isItem || this.type == 2 || this.type == 3 || this.type == 4)
                                                 ? 1 : (0.6 * sM)) * (ig ? 1 : this.colDiv);
                        },
                    });
                });
                for (let i = first; i < repeat; i += plus) {
                    counts.attempts++;
                    let relAim = radian + i;
                    let tmpX = player.x2 + tmpS * Math.cos(relAim);
                    let tmpY = player.y2 + tmpS * Math.sin(relAim);
                    let cantPlace = tmpObjects.find((tmp) => tmp.active && UTILS.getDistance(tmpX, tmpY, tmp.x, tmp.y) < item.scale + (tmp.blocker ? tmp.blocker : tmp.getScale(0.6, tmp.isItem)));
                    if (cantPlace) continue;
                    if (item.id != 19 && tmpY >= config.mapScale / 2 - config.riverWidth / 2 && tmpY <= config.mapScale / 2 + config.riverWidth / 2) continue;
                    if ((!replacer && yaboi) || useWasd) {
                        if (useWasd ? false : yaboi.inTrap) {
                            if (UTILS.getAngleDist(near.aim2 + Math.PI, relAim + Math.PI) <= Math.PI) {
                                place(2, relAim, 1);
                            } else {
                                player.items[4] == 15 && place(4, relAim, 1);
                            }
                        } else {
                            if (UTILS.getAngleDist(near.aim2, relAim) <= config.gatherAngle / 1.5) {
                                place(2, relAim, 1);
                            } else {
                                player.items[4] == 15 && place(4, relAim, 1);
                            }
                        }
                    } else {
                        place(id, relAim, 1);
                    }
                    tmpObjects.push({
                        x: tmpX,
                        y: tmpY,
                        active: true,
                        blocker: item.blocker,
                        scale: item.scale,
                        isItem: true,
                        type: null,
                        colDiv: item.colDiv,
                        getScale: function() {
                            return this.scale;
                        },
                    });
                    if (UTILS.getAngleDist(near.aim2, relAim) <= 1) {
                        counts.placed++;
                    }
                }
                if (counts.placed > 0 && replacer && item.dmg) {
                    if (near.dist2 <= items.weapons[player.weapons[0]].range + (player.scale * 1.8) && combatattacktoggle.tryspiketick) {
                               console.log("Spike 3");
                           instaC.dospiketick = true;
                    }
                }
            } catch (err) {
            }
        };
        // ANTI SP TICK
        this.checkSpikeTick = function () {
            try {
                if (![3, 4, 5].includes(near.primaryIndex)) return false;

                if (((configs?.SafeAntiSpikeTick ?? false) || my.autoPush) ? false : near.primaryIndex == undefined ? true : (near.reloads[near.primaryIndex] > game.tickRate)) return false;

                if (near.dist2 <= items.weapons[near.primaryIndex || 5].range + (near.scale * 1.8)) {
                    let item = items.list[9];
                    let tmpS = near.scale + item.scale + (item.placeOffset || 0);

                    let spikeX = near.x2 + tmpS * Math.cos(near.aim2);
                    let spikeY = near.y2 + tmpS * Math.sin(near.aim2);

                    let cantPlace = closeObjects.find((tmp) => tmp.active &&
                                                      UTILS.getDistance(spikeX, spikeY, tmp.x, tmp.y) < item.scale + (tmp.blocker ? tmp.blocker : tmp.getScale(0.6, tmp.isItem))
                                                     );

                    let danger = 0;
                    let counts = {
                        attempts: 0,
                        block: `unblocked`
                    };

                    for (let i = -1; i <= 1; i += 1 / 10) {
                        counts.attempts++;
                        let relAim = UTILS.getDirect(player, near, 2, 2) + i;
                        let tmpX = near.x2 + tmpS * Math.cos(relAim);
                        let tmpY = near.y2 + tmpS * Math.sin(relAim);

                        let cantPlace = gameObjects.find((tmp) => tmp.active &&
                                                         UTILS.getDistance(tmpX, tmpY, tmp.x, tmp.y) < item.scale + (tmp.blocker ? tmp.blocker : tmp.getScale(0.6, tmp.isItem))
                                                        );

                        if (cantPlace) continue;
                        if (tmpY >= config.mapScale / 2 - config.riverWidth / 2 && tmpY <= config.mapScale / 2 + config.riverWidth / 2) continue;

                        danger++;
                        counts.block = `blocked`;
                        break;
                    }

                    if (danger) {
                        my.anti0Tick = 1;
                        return true;
                    }
                }
            } catch (err) {
                return null;
            }
            return false;
        };
        function getDist(e, t) {
            try {
                return Math.hypot((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
            } catch (e) {
                return Infinity;
            }
        }

        this.protect = function (aim, obj) {
            if (!configs.antiTrap) return;

            this.testCanPlace(4, -(Math.PI / 2), (Math.PI / 2), (Math.PI / (24 - 6)), aim + Math.PI);
            this.antiTrapped = true;
        };

        let nearTrap = gameObjects.filter(e => e.trap && e.active && e.isTeamObject(player) && UTILS.getDist(e, near, 0, 2) <= (near.scale + e.getScale() + 5)).sort(function(a, b) {
            return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
        })[0];

        let autoQ = false;
        this.antiSpT = function () {
            return this.antiSpikeTick();
        }
        function getEnemyVelocity(near) {
            return Math.sqrt(near.xVel * near.xVel + near.yVel * near.yVel);
        }

        function getEnemyDirection(near) {
            return Math.atan2(near.yVel, near.xVel);
        }
        function findAnglesToTest() {
            let anglesToTest = [];

            for (let i = 0; i < 360; i += 250) {
                anglesToTest.push((Math.PI/180) * i);
            }

            return anglesToTest;
        }
        function findAnglesToTest2(obj, player) {
            let perfectAngle = UTILS.getDirect(obj, player, 0, 2);
            for (let i = 0; i < 360; i += 25) {
                perfectAngle.push((Math.PI/180) * i);
            }
            return perfectAngle;
        }
        function findAnglesToTest1() {
            let anglesToTest = [];

            for (let i = 0; i < 360; i += 25) {
                anglesToTest.push((Math.PI/180) * i);
            }

            return anglesToTest;
        }
        UTILS.deg2rad = function (degrees) {
            return degrees * (Math.PI / 180);
        }
        let placedSpikePositions = new Set();
        let placedTrapPositions = new Set();
        var breakTrack = [];
        const PLACE_SPEED = 100;
        function calculatePerfectAngle(x1, y1, x2, y2) {
            return Math.atan2(y2 - y1, x2 - x1);
        }
        function isObjectBroken(object) {
            const healthThreshold = 20;
            return object.health < healthThreshold;
        }
        function PlacementLocation(x, y, trapType) {
            this.x = x;
            this.y = y;
            this.trapType = trapType;
        }
        function checkPlaceWithAngles1(angle1, angle2, x, y) {
            checkPlace(4, x, y, angle1, angle2);
        }
        function checkPlaceWithAngles2(angle1, angle2, x, y) {
            checkPlace(2, x, y, angle1, angle2);
        }
        //autoplacerrange
//    if (!near || !enemy.length || !combatplacetoggle.Auto_Placer || (typeof instaC !== 'undefined' && instaC.ticking)) return;
this.autoPlace = function () {
    if (!enemy.length || !combatplacetoggle.Auto_Placer || instaC.ticking || near.dist2 > autoplacerrange) return;

    // Packet limit kontrolu
    if (secPacket <= 90) {
        const autoPlaceTick = Math.max(1, parseInt(config.autoPlaceTick)) || 1;
        if (game.tick % autoPlaceTick !== 0) return;

        if (!closeObjects.length) return;

        const near2 = { inTrap: false };
        const nearTrap = closeObjects.filter(e => e.trap && e.active && e.isTeamObject(player) &&
            UTILS.getDist(e, near, 0, 2) <= (near.scale + e.getScale() + 5))
            .sort((a, b) => UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2))[0];

        if (nearTrap) near2.inTrap = true;

        // 1. Dinamik Prediction (Məsafəyə görə tənzimlənən)
        function predictEnemyPosition(enemy) {
            const dist = UTILS.getDist(player, enemy, 0, 0);
            // Məsafə azaldıqca predictionTime da azalır (daha dəqiq vuruş üçün)
            const predictionTime = Math.min(0.5, dist / 400);
            return {
                x: enemy.x + enemy.xVel * predictionTime,
                y: enemy.y + enemy.yVel * predictionTime
            };
        }

        function isPositionValid(position) {
            // Math.hypot yerinə sürət üçün kvadratik məsafə yoxlaması (CPU dostu)
            const dx = position[0] - player.x2;
            const dy = position[1] - player.y2;
            return (dx * dx + dy * dy) > 1225; // 35^2
        }

        let randomDir = Math.random() * Math.PI * 1.5;
        if (closeObjects.length) {
            let tryTicked = [3, 4, 5].includes(near.primaryIndex);
            const id = nearTrap || near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8 ? 2 : 4;
            this.testCanPlace(id, -(Math.PI * 1.5), randomDir, Math.PI / 48, near.aim2, tryTicked && id === 2);
        } else {
            this.testCanPlace(4, 0, Math.PI * 2, Math.PI / 24, randomDir);
        }

        if (nearTrap && near.dist2 <= 160) {
            const trapX = nearTrap.x;
            const trapY = nearTrap.y;
            const circleRadius = 102;
            const numPositions = 72;
            const predictedEnemy = predictEnemyPosition(near);

            for (let i = 0; i < numPositions; i++) {
                const angle = (2 * Math.PI * i) / numPositions;
                const offsetX = trapX + circleRadius * Math.cos(angle);
                const offsetY = trapY + circleRadius * Math.sin(angle);
                const position = [offsetX, offsetY];

                // 2. JSON.stringify yerinə unikal key istifadəsi (Performans üçün)
                const posKey = `${Math.round(offsetX)},${Math.round(offsetY)}`;

                const dxP = position[0] - player.x2;
                const dyP = position[1] - player.y2;
                const distToPlayerSq = dxP * dxP + dyP * dyP;

                const dxE = predictedEnemy.x - position[0];
                const dyE = predictedEnemy.y - position[1];
                const predictedDistSq = dxE * dxE + dyE * dyE;
                if (!placedSpikePositions.has(posKey) &&
                    isPositionValid(position) &&
                    distToPlayerSq <= 7569 &&
                    predictedDistSq <= 2500) {
                    const angleToPlace = Math.atan2(position[1] - player.y2, position[0] - player.x2);
                    checkPlace(2, angleToPlace);
                    placedSpikePositions.add(posKey);
                }
            }
        }
    }
};
    }
    // angle scanning codes
    createTempObject() {
        return { x: 0, y: 0, scale: 0 }
    };
    getPosFromAngle(id, angle, velocity){
        return {
            x: (velocity ? player.xVel : player.x2) + (35 + items.list[id].scale + (items.list[id].placeOffset || 0)) * Math.cos(angle),
            y: (velocity ? player.yVel : player.y2) + (35 + items.list[id].scale + (items.list[id].placeOffset || 0)) * Math.sin(angle),
            scale: items.list[id].scale,
        }
    }
    secondaryCheck(id, radian) {
        try {
            var item = items.list[id];
            var tmpS = player.scale + item.scale + (item.placeOffset || 0);
            var tmpX = player.x2 + tmpS * Math.cos(radian);
            var tmpY = player.y2 + tmpS * Math.sin(radian);
            if (objectManager.checkItemLocation(tmpX,tmpY,item.scale,0.6,item.id,false,player)) {
                if (
                    player.itemCounts[item.group.id] == undefined
                    ? true
                    : player.itemCounts[item.group.id] <
                    (true
                     ? 99
                     : item.group.limit
                     ? 99
                     : 99)
                ) {
                    return true
                }
            }
        } catch (e) {

        }
    }
    manageAngles(angles) {
        angles.sort((a, b) => a[0] - b[0]);
        let mergedAngles = [angles[0]];
        for (let i = 1; i < angles.length; i++) {
            let last = mergedAngles[mergedAngles.length - 1];
            if (last[1] >= angles[i][0]) {
                last[1] = Math.max(last[1], angles[i][1]);
            } else {
                mergedAngles.push(angles[i]);
            }
        }
        return mergedAngles;
    }
    makeAngles(building, type) {
        let buildings = building.filter(obj => UTILS.getDist(obj, player, 0, 2) <= player.scale + items.list[type].scale + obj.scale + 50 && obj.active);
        let allAngles = [], scale, offset = player.scale + items.list[type].scale + (items.list[type].placeOffset || 0);
        for (let i = 0; i < buildings.length; i++) {
            let scale
            if (!buildings[i].isItem) {
                if ((buildings[i].scale != 80 && buildings[i].scale != 85 && buildings[i].scale != 90 || buildings[i].type == 1)) {
                    scale = buildings[i].scale * 0.40

                } else {
                    scale = buildings[i].scale
                }
            } else {
                scale = buildings[i].scale
            }
            let angles = [], dist = (items.list[type].scale + scale + 1), dPTB = UTILS.getDist(buildings[i], player, 0, 2), cosLaw;
            if (dPTB > dist + offset) {
                cosLaw = Math.acos(((Math.pow(offset, 2) + Math.pow(dist, 2)) - Math.pow(dPTB, 2)) / (2 * dist * offset))
                cosLaw = Math.asin((dist * Math.sin(cosLaw)) / dPTB)
            } else {
                cosLaw = Math.acos(((Math.pow(offset, 2) + Math.pow(dPTB, 2)) - Math.pow(dist, 2)) / (2 * dPTB * offset))
            }
            let aPTB = Math.atan2(buildings[i].y - player.y2, buildings[i].x - player.x2)
            let ang1 = (aPTB - cosLaw), ang2 = (aPTB + cosLaw)
            if (!isNaN(cosLaw)) {
                angles.push(ang1)
                angles.push(ang2)
                angles.push(buildings[i])
            }
            allAngles.push(angles)
        }

        for (let i = 0; i < allAngles.length * 3; i++) {
            allAngles = this.manageAngles(allAngles)

        }
        if (!allAngles.length) {
            allAngles = [0, 0.0001]
        }
        for (let i = 0; i < allAngles.length; i++) {
            if (allAngles != false) {
                if (!this.secondaryCheck(type, allAngles[i][0]) || !this.secondaryCheck(type, allAngles[i][1])) {
                    allAngles = false
                }
            }
        }
        return allAngles
    }
    findNearestAngle(angles, targetAngle) {
        let closestAngle = null;
        let closestDist = Infinity;
        for (let i = 0; i < angles.length; i++) {
            let angle1 = angles[i][0];
            let angle2 = angles[i][1];
            let dist1 = Math.min(Math.abs(angle1 - targetAngle), 2 * Math.PI - Math.abs(angle1 - targetAngle));
            let dist2 = Math.min(Math.abs(angle2 - targetAngle), 2 * Math.PI - Math.abs(angle2 - targetAngle));
            if (dist1 < closestDist) {
                closestDist = dist1;
                closestAngle = angle1;
            }
            if (dist2 < closestDist) {
                closestDist = dist2;
                closestAngle = angle2;
            }
        }
        return closestAngle;
    }
    calculateAngles(initAngleRad) {
        let angles = [initAngleRad];
        for (let i = 1; i < 4; i++) {
            let angleOffset = (Math.PI / 2) * i;
            let newAngle = (initAngleRad + angleOffset) % (2 * Math.PI);
            angles.push(newAngle);
        }
        return angles;
    }
    calculateAngle(baseAngleRad, numOffsets = 1) {
        numOffsets = Math.min(numOffsets, 3);
        return Array.from({ length: numOffsets + 1 }, (_, i) => {
            let angleOffset = (Math.PI / 2) * i;
            return (baseAngleRad + angleOffset) % (2 * Math.PI);
        });
    }
    refineAngles(type) {
        const clampAngle = function(angle) {
            while (angle < 0) {
                angle += 2 * Math.PI;
            }
            while (angle >= 2 * Math.PI) {
                angle -= 2 * Math.PI;
            }
            return angle;
        }
        let buildings = gameObjects.sort((a, b) => Math.hypot(player.y2 - a.y, player.x2 - a.x) - Math.hypot(player.y2 - b.y, player.x2 - b.x));
        let buildingsInRange = buildings.filter(obj => UTILS.getDist(obj, player, 0, 2) <= player.scale + items.list[type].scale + obj.scale + 50 && obj.active);
        let allAngles = [];
        let offset = player.scale + items.list[type].scale + (items.list[type].placeOffset || 0);
        buildingsInRange.forEach(building => {
            let scale = building.isItem ? building.scale : building.scale !== 80 && building.scale !== 85 && building.scale !== 90 || building.type === 1 ? building.scale * 0.40 : building.scale;
            let dist = items.list[type].scale + scale + 1;
            let dPTB = UTILS.getDist(building, player, 0, 2);
            let cosLaw = (dPTB > dist + offset) ? Math.asin((dist * Math.sin(Math.acos((offset ** 2 + dist ** 2 - dPTB ** 2) / (2 * dist * offset)))) / dPTB) :
            Math.acos((offset ** 2 + dPTB ** 2 - dist ** 2) / (2 * dPTB * offset));
            let aPTB = Math.atan2(building.y - player.y2, building.x - player.x2);
            let ang1 = clampAngle(aPTB - cosLaw);
            let ang2 = clampAngle(aPTB + cosLaw);
            if (!isNaN(ang1) && !isNaN(ang2)) {
                allAngles.push([ang1, ang2]);
            }
        });
        if (allAngles.length > 0) {
            return allAngles.flatMap(anglePair => anglePair).filter(angle => typeof angle === 'number');
        } else {
            return this.calculateAngles(UTILS.getAngle(near, player, 2, 2));
        }
    }
    potentialBuildDamage(object, singlePlayer) {
        try {
            let selectedWeapon = singlePlayer.weapons[player.weapons[1] == 10 ? 1 : 0];
            let weaponInfo = items.weapons[singlePlayer.weapons[singlePlayer.weapons[1] == 10 ? 1 : 0]];
            let isWithinRange = UTILS.getDist(object, singlePlayer, 0, 2) <= object.getScale() + weaponInfo.range;
            return singlePlayer.visible && isWithinRange && UTILS.getAngleDist(UTILS.getDirect(object, singlePlayer, 0, 2), singlePlayer.dir) <= config.gatherAngle ? weaponInfo.dmg * (config.weaponVariants[singlePlayer.weaponVariant].val ? config.weaponVariants[singlePlayer.weaponVariant].val : 1) * (weaponInfo.sDmg || 1) * 3.3 : 0;
        } catch (e) {
        }
    }
    getClosestAngle(anglesArray, targetDirection) {
        if (!anglesArray.length) return targetDirection;
        let closestAngle = anglesArray.reduce((closest, current) => {
            return Math.abs(current - targetDirection) < Math.abs(closest - targetDirection) ? current : closest;
        });
        return closestAngle;
    };
    preplaceAngle(filteredGameObjects, objWithLowestHealth) {
        let priorityResults = [];
        let trapCandidates = [];
        let spikeCandidates = [];
        let buildings = gameObjects.filter(object => UTILS.getDist(object, player, 0, 2) <= 300);
        let spikeAngles = this.refineAngles(2);
        let trapAngles = [];
        if (player.items[4]) {
            trapAngles = this.makeAngles(buildings, player.items[4]);
        }
        if (player.inTrap) {
            spikeCandidates = filteredGameObjects
                .filter(obj => obj.dmg && obj.active && UTILS.getDist(obj, this.info, 0, 0) <= (player.scale + this.info.scale + obj.scale + 5))
                .sort((a, b) => UTILS.getDist(a, player, 0, 2) - UTILS.getDist(b, player, 0, 2));
            if (spikeCandidates.length > 0) {
                let spikeAngle = this.getClosestAngle(spikeAngles, UTILS.getDirect(spikeCandidates[0], player, 0, 2));
                priorityResults.push(["spike", spikeCandidates[0], spikeAngle]);
            } else {
                trapCandidates = filteredGameObjects
                    .filter(obj => obj.trap && obj.active && obj.isTeamObject(player) && UTILS.getDist(obj, near, 0, 2) <= (near.scale + obj.getScale() + 15))
                    .sort((a, b) => UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2));
                if (trapCandidates.length > 0) {
                    let trapAngle = this.getClosestAngle(trapAngles, UTILS.getDirect(trapCandidates[0], player, 0, 2));
                    priorityResults.push(["trap", trapCandidates[0], trapAngle]);
                } else {
                    let spikeAngle = this.getClosestAngle(spikeAngles, UTILS.getDirect(objWithLowestHealth, player, 0, 2));
                    priorityResults.push(["spike", objWithLowestHealth, spikeAngle]);
                }
            }
        } else {
            trapCandidates = filteredGameObjects
                .filter(obj => obj.trap && obj.active && obj.isTeamObject(player) && UTILS.getDist(obj, near, 0, 2) <= (near.scale + obj.getScale() + 15))
                .sort((a, b) => UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2));
            if (trapCandidates.length > 0) {
                let trapAngle = this.getClosestAngle(trapAngles, UTILS.getDirect(trapCandidates[0], player, 0, 2));
                priorityResults.push(["trap", trapCandidates[0], trapAngle]);
                spikeCandidates = filteredGameObjects
                    .filter(obj => obj.dmg && obj.active && obj.isTeamObject(player) && UTILS.getDist(obj, trapCandidates[0], 0, 0) <= (near.scale + trapCandidates[0].scale + obj.scale + 5))
                    .sort((a, b) => Utils.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2));
                if (spikeCandidates.length > 0) {
                    let spikeAngle = this.getClosestAngle(spikeAngles, UTILS.getDirect(spikeCandidates[0], player, 0, 2));
                    priorityResults.push(["spike", spikeCandidates[0], spikeAngle]);
                }
            } else {
                let spikeAngle = this.getClosestAngle(spikeAngles, UTILS.getDirect(objWithLowestHealth, player, 0, 2));
                priorityResults.push(["spike", objWithLowestHealth, spikeAngle]);
                let secondaryObject = filteredGameObjects.find(obj => obj !== objWithLowestHealth && obj.health > 0);
                if (secondaryObject) {
                    let trapAngle = this.getClosestAngle(trapAngles, UTILS.getDirect(secondaryObject, player, 0, 2));
                    priorityResults.push(["trap", secondaryObject, trapAngle]);
                }
            }
        }
        return priorityResults.slice(0, 2);
    };
    replacer(findObj) {
        if (!findObj || !combatplacetoggle.auto_PrePlace || !inGame || this.antiTrapped) return;

        this.angles = this.angles || [];

        let objAim = UTILS.getDirect(findObj, player, 0, 2);
        let objDst = UTILS.getDist(findObj, player, 0, 2);
        let weaponRange = items.weapons[player.weaponIndex].range + player.scale;

        if (getEl("weaponGrind").checked && objDst <= weaponRange) return;

        let danger = this.checkSpikeTick();
        let canPlaceCondition = [4, 5].includes(player.weapons[0]) && !danger;

        let spikSync = false;
        game.tickBase(() => {
            if (objDst <= 300 && near.dist2 <= 300) {
                let inRange = near.dist3 <= items.weapons[near.primaryIndex || 5].range + (near.scale * 1.8);
                let checkCanSpikeSync = !danger && (inRange || (traps.inTrap && objDst <= 150) || near.inTrap);

                if (checkCanSpikeSync) {
                    this.angles.push(objAim);

                    if (this.angles.length > 5) {
                        this.angles.shift();
                    }

                    let smoothedAngle = this.angles.reduce((a, b) => a + b, 0) / this.angles.length;

                    smoothedAngle += Math.PI / 2;

                    let timeAdjustment = (Math.PI / 24) * Math.sin(Date.now() / 1000);
                    let placementAngle = smoothedAngle + timeAdjustment;

                    this.testCanPlace(2, placementAngle, placementAngle + Math.PI * 2, Math.PI / 24, placementAngle - Math.PI, 1);
                    this.testCanPlace(2, 0, Math.PI * 2, Math.PI / 24, objAim, 1);

                    spikSync = true;
                } else if (player.items[4] === 15 || near.dist2 <= 100) {
                    spikSync = false;

                    let trapPlacementAngle = objAim + Math.PI;

                    player.items[4] == 15 &&
                        this.testCanPlace(
                        4,
                        trapPlacementAngle,
                        trapPlacementAngle + Math.PI * 2,
                        Math.PI / 24,
                        objAim, 1
                    );
                } else {
                    spikSync = false;

                    let startAngle = Math.random() * Math.PI * 1.5;
                    let step = Math.PI / (32 + Math.random() * 12);

                    this.testCanPlace(4, -startAngle, Math.PI * 1.5, step, objAim, 1);
                    this.testCanPlace(4, 0, (Math.PI * 2), (Math.PI / 24), objAim , 1);
                }

                let checkAim = UTILS.getAngleDist(near.aim2, objAim) <= 1;
                if (inRange && checkAim) {// if got aim to preobject can use him here for preSpikeSync
                    if (checkCanSpikeSync) {
                        if ([3, 4, 5, 8].includes(player.weapons[0]) && !instaC.isTrue) {
                           console.log("Spike 1");
                           instaC.dospiketick = true
                        }
                    } else if (combatplacetoggle.auto_PrePlace){
                        checkPlace(4, objAim);
pushNotify(`Retrap`, "#fff");
                    }
                }

                this.replaced = true;
            }
        }, 1);
    }
};
var preIndi = [];
function cplace(id, rad) {
    if (id == undefined) return;
    let item = items.list[player.items[id]];
    let tmpS = player.scale + item.scale + (item.placeOffset || 0);
    let tmpX = player.x2 + tmpS * Math.cos(rad);
    let tmpY = player.y2 + tmpS * Math.sin(rad);
    if (getEl("preIndi").checked) {
        preIndi.push({
            x: tmpX,
            y: tmpY,
            name: item.name,
            scale: item.scale,
            dir: rad
        });
        game.tickBase(() => {
            preIndi.shift();
        }, 1);
        game.tickBase(() => {
            preIndi.shift();
        }, 2);
    }
    if (id === 0 || (player.alive && inGame)) {
        selectToBuild(player.items[id]);
        sendAtck(1, rad);
        selectWeapon(player.weaponCode, 1);
    }
}
class prePlace {
    constructor() { // useless tbh
        this.numberValue = 0;
        this.speed = 0;
        this.delay = 0;
        this.ticks = 2;
        this.ping = window.pingTime;
        this.value = 5;
        this.prePlacer = function() {
            if ((!gameObjects.length || !inGame || !enemy.length || !player) && !combatplacetoggle.auto_PrePlace) return;

            this.Pot = function(obj, user) {
                let weaponIndex = user.weapons[1] === 10 && !player.reloads[user.weapons[1]] ? 1 : 0;
                let weapon = user.weapons[weaponIndex];
                if (player.reloads[weapon]) return 0;
                let itemWeapon = items.weapons[weapon];
                let isNear = UTILS.getDist(obj.x, obj.y, user.x2, user.y2) <= obj.scale + itemWeapon.range;
                return user.visible && isNear ? itemWeapon.dmg * (itemWeapon.sDmg || 1) * 3.3 : 0;
            };

            let lowObjHealth = [];
            for (let i = 0; i < gameObjects.length; i++) {
                let obj = gameObjects[i];
                if (obj.active && obj.health > 0 && UTILS.getDist(obj, player, 0, 2) <= player.scale + obj.scale * 2) {
                    let dmg = this.Pot(obj, player);
                    if (obj.health <= dmg) {
                        lowObjHealth.push(obj);
                    }
                }
            }
            lowObjHealth.sort((a, b) => a.health - b.health);
            let objectss = lowObjHealth.slice(0, Math.min(2, lowObjHealth.length));

            if (objectss.length == 0) return;

            for (let obj of objectss) {
                let angles = Math.atan2(obj.y - player.y2, obj.x - player.x2);
                let enemyTrapped = gameObjects.filter(tmp => tmp.trap && tmp.active && tmp.isTeamObject(player) && UTILS.getDist(tmp, obj, 0, 2) <= obj.scale + tmp.getScale() + 15).sort((a, b) => {
                    return UTILS.getDist(a, obj, 0, 2) - UTILS.getDist(b, obj, 0, 2);
                })[0];
                if (near.dist2 < 300 && player.items[4] == 15) { // dont need notify bc it uses the preplacer circle:
                    if (near.dist2 < 180 && [4,5].includes(player.primaryIndex)) { // i soon improve logic first I remodel the script
                        cplace(2, angles, 1);
                    }
                    if (near.dist2 < 300) {
                        cplace(4, angles, 1);
                    }
                    if (traps.inTrap && near.dist2 < 250 || my.autoPush) {
                        cplace(4, angles);
                    }
                    if (enemyTrapped || enemyTrapped == obj) {
                        cplace(2, near.aim2);
                    }
                }
            }
        };
        this.syncWithServerTicks = function() {
            let nextServerTick = performance.now();
            let currentTime = performance.now();
            let estimatedServerTime = currentTime - window.pingTime / 2;
            let nextExpectedTick = Math.ceil(estimatedServerTime / ticks.tick) * 1000/9;
            nextServerTick = nextExpectedTick > nextServerTick ? nextExpectedTick : nextServerTick + 1000/9;
            let idealSendTime = nextServerTick - window.pingTime / 2 - 1;
            let clientSendTime = idealSendTime + window.pingTime / 2;
            const schedulePre = (t) => {
                if (performance.now() >= t) {
                    this.prePlacer(); // RUN UR PREPLACER HERE
                    nextServerTick += 1000/9;
                    schedulePre(nextServerTick);
                } else {
                    setTimeout(() => schedulePre(nextServerTick));
                }
            };
            let timeUntilSend = clientSendTime - currentTime;
            if (timeUntilSend <= (1000/9)) {
                schedulePre(clientSendTime);
            } else {
                setTimeout(() => schedulePre(clientSendTime), timeUntilSend - 1);
            }
        };
    }
}
let preplaceUsages = new prePlace(); // use
preplaceUsages.syncWithServerTicks(); // call function for loop

class Instakill {
    constructor() {
        this.dospikesynconpush = false;
        this.dospikesync = false;
        this.dospiketick = false;
        this.wait = false;
        this.can = false;
        this.isTrue = false;
        this.nobull = false;
        this.ticking = false;
        this.canSpikeTick = false;
        this.startTick = false;
        this.readyTick = false;
        this.canCounter = false;
        this.revTick = false;
        this.syncHit = false;
        this.changeType = function(type) {
            this.wait = false;
            this.isTrue = true;
            my.autoAim = true;
            let instaLog = [type];
            let backupNobull = near.backupNobull;
            near.backupNobull = false;
            game.tickBase(() => {
                instaLog.push(player.skinIndex);
                game.tickBase(() => {
                    instaLog.push(player.skinIndex);
                }, 1);
            }, 1);
            if (type == "rev") {
    pushNotify(`MS Reverse Insta 2`, "#fff");
                selectWeapon(player.weapons[1]);
                buyEquip(53, 0);
                buyEquip(21, 1);
                sendAutoGather();
                game.tickBase(() => {
                    selectWeapon(player.weapons[0]);
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }, 1);
            } else if (type == "nobull") {
                buyEquip(7, 0);
                selectWeapon(player.weapons[0]);
                if (near.dist2 <= 140 && getEl("doSpikeOnReverse").checked) checkPlace(2, getAttackDir());
                sendAutoGather();
                game.tickBase(() => {
                    selectWeapon(player.weapons[1]);
                    buyEquip(player.reloads[53] == 0 ? 53 : 6, 0);
                    buyEquip(21, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }, 1);

            } else if (type == "normal") {
                buyEquip(20, 0);
                selectWeapon(player.weapons[0]);
                if (near.dist2 <= 140 && getEl("doSpikeOnReverse").checked) checkPlace(2, getAttackDir());
                buyEquip(7, 0);
                sendAutoGather();
                game.tickBase(() => {
                    selectWeapon(player.weapons[1]);
                    buyEquip(player.reloads[53] == 0 ? 53 : 6, 0);
                    buyEquip(21, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }, 1);
            } else {
                setTimeout(() => {
                    this.isTrue = false;
                    my.autoAim = false;
                }, 50);
            }
        };

this.ighr2Type = function() {
    pushNotify(`Spike Reverse Insta`, "#fff");

    // İlkin hazırlıq
    this.isTrue = true;
    my.autoAim = true;

    // 1. ADIM: Silahı seç və dərhal vur (İlk vuruş - Sürət üçün)
    // Bull Helmet əvəzinə vuruş anında ziyanı artırmaq üçün Turret Gear və ya başqa şey istifadə edilə bilər
    selectWeapon(player.weapons[1]);
    buyEquip(53, 0); // Turret Gear (Vuruş gücü üçün)
    sendAutoGather(); // İlk vuruş (Çəkic/Böyük silah)

    // 2. ADIM: Növbəti Tick-də dərhal keçid
    game.tickBase(() => {
        // Silahı və papağı dəyiş (Ziyanı maksimallaşdır)
        selectWeapon(player.weapons[0]);

        // NoBull check
        let headId = (combatattacktoggle.no_bull_insta ? 6 : 7);
        buyEquip(headId, 0);

        // Spike/Trap qoyma (Düşməni bloklamaq və ya əlavə ziyan üçün)
        place(2, near.aim2);

        // 3. ADIM: Bitirmə (Çox qısa gecikmə ilə normal vəziyyətə qayıt)
        game.tickBase(() => {
            sendAutoGather(); // Ehtiyat vuruş
            this.isTrue = false;
            my.autoAim = false;

            // Müdafiə rejiminə keç (Məsələn Samurai və ya Soldier)
            buyEquip(6, 0);
        }, 1);
    }, 1);
};
this.knockback_tick_Type = function() {
pushNotify(`Knockback Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
};

this.spike_sync_onpusing = function() {
pushNotify(`Spike Sync On Pushing`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
};
this.spike_sync = function() {
pushNotify(`Spike Sync`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
};
this.spike_tick = function() {
pushNotify(`Spike Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
};
this.doonetick = function() {
pushNotify(`Static Based`, "#fff");
this.isTrue = true;
my.autoAim = true;
buyEquip(53, 0);
game.tickBase(() => {
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
};
this.SpikegearType = function() {
pushNotify(`Spikegear Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};

this.SpikegearhType = function() {
pushNotify(`Spikegear Hammer Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[1]);
if (combatattacktoggle.turret_sync) {buyEquip(53, 0);}
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
// Steal Ticks  -- >
this.dostealtick1 = function() {
pushNotify(`Steal Hit`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
};

this.dostealtick2 = function() {
pushNotify(`Steal Turret`, "#fff");
this.isTrue = true;
buyEquip(53, 0);
game.tickBase(() => {
this.isTrue = false;
}, 1);
};



// Insta kill
this.newinstaType = function() {
    pushNotify(`Reverse Insta`, "#fff");
    this.isTrue = true;
    my.autoAim = true;

    // ADDIM 1: Musketə keç və Gear tax
    selectWeapon(player.weapons[1]);
    buyEquip(53, 0); // Musket üçün papaq (Turret və ya Sniper)

    // Musket atəşi və obyekt (Trap) qoyma
    sendAutoGather();
  //  place(2, near.aim2);

    // ADDIM 2: Saniyəlik (0ms-ə yaxın) Reload Yoxlaması
    const checkMusketShot = () => {
        // Əgər musket reloada düşdüsə (atəş açıldısa)
        if (player.reloads[player.weapons[1]] > 0) {

            // ADDIM 3: Dərhal Melee-yə keç və vur
            selectWeapon(player.weapons[0]);
            buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0); // Soldier və ya Bull


            // Insta bitdi, təmizləmə
            game.tickBase(() => {
            sendAutoGather();
            this.isTrue = false;
            my.autoAim = false;
}, 1);

        } else {
            // Hələ atəş açılmayıbsa, növbəti kadrda yenidən yoxla
            if (this.isTrue) requestAnimationFrame(checkMusketShot);
        }
    };

    // Yoxlamanı başlat
    requestAnimationFrame(checkMusketShot);

    // Təhlükəsizlik: Əgər 1 saniyə ərzində vurmasa, kilidi aç (oyun donmasın)
    setTimeout(() => {
        if (this.isTrue) {
            this.isTrue = false;
            my.autoAim = false;
            buyEquip(6, 0);
        }
    }, 1000);
};
this.boostinsta = function() {
pushNotify(`Boost Insta`, "#fff");
this.isTrue = true;
my.autoAim = true;
buyEquip(40, 0);
if (player.items[4] != 15) {place(4, near.aim2);}
game.tickBase(() => {
selectWeapon(player.weapons[1]);
sendAutoGather();
buyEquip(53, 0);
game.tickBase(() => {
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
selectWeapon(player.weapons[0]);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
}, 1);
};
this.ighcType = function() {
pushNotify(`Counter Insta Hammer`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
place(2, near.aim2);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
this.igmcType = function() {
pushNotify(`Counter Insta Musket`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
game.tickBase(() => {
selectWeapon(player.weapons[0]);
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
this.ighrType = function() {
pushNotify(`Reverse Insta Hammer`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
place(2, near.aim2);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
this.igmrType = function() {
pushNotify(`Reverse Insta Musket`, "#fff");
this.isTrue = true;
my.autoAim = true;
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
sendAutoGather();
game.tickBase(() => {
buyEquip((combatattacktoggle.no_bull_insta ? 6 : 7), 0);
selectWeapon(player.weapons[0]);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
        // Manual ticks
this.mtotType = function() {
pushNotify(`Spike Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
place(2, near.aim2 + toRad(45));
place(2, near.aim2 - toRad(45));
buyEquip(53, 0);
sendAutoGather();
game.tickBase(() => {
buyEquip(7, 0);
selectWeapon(player.weapons[0]);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};
this.stmtType = function() {
pushNotify(`One Tick`, "#fff");
this.isTrue = true;
my.autoAim = true;
buyEquip(53, 0);
sendAutoGather();
game.tickBase(() => {
buyEquip(7, 0);
selectWeapon(player.weapons[0]);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
buyEquip(6, 0);
}, 1);
}, 1);
};




this.bow_tick = function(type) {
this.isTrue = true;
my.autoAim = true;
if (true) {
my.ageInsta = false;
game.tickBase(() => {
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
sendAutoGather();
game.tickBase(() => {
sendUpgrade(12);
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
game.tickBase(() => {
sendUpgrade(15);
selectWeapon(player.weapons[1]);
buyEquip(53, 0);
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
}, 1);
}, 1);
} else {
selectWeapon(player.weapons[1]);
if (player.reloads[53] == 0 && near.dist2 <= 700 && near.skinIndex != 22) {
buyEquip(53, 0);
} else {
buyEquip(20, 0);
}
buyEquip(11, 1);
sendAutoGather();
game.tickBase(() => {
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}
};

this.age_insta = function(type) {
this.isTrue = true;
my.autoAim = true;
my.ageInsta2 = false;
game.tickBase(() => {
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
buyEquip(7, 0);
sendUpgrade(5);
selectWeapon(player.weapons[0]);
place(2, near.aim2)
game.tickBase(() => {
buyEquip(53, 0);
sendAutoGather();
this.isTrue = false;
my.autoAim = false;
}, 1);
}, 1);
}, 1);
};










        this.counterType = function () {
            if (!getEl("CounterInsta").checked) {
                return;
            }
            this.isTrue = true;
            my.autoAim = true;
            selectWeapon(player.weapons[0]);
            buyEquip(7, 0);
            buyEquip(21, 1);
            sendAutoGather();
            game.tickBase(() => {
                if (player.reloads[53] == 0) {
                    buyEquip(53, 0);
                    buyEquip(21, 1);
                    if ([9, 12, 13, 15].includes(player.weapons[1]) && player.reloads[player.weapons[1]] == 0 && configs.secondaryOnCounter) {
                        selectWeapon(player.weapons[1]);
                    }
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                } else {
                    if ([9, 12, 13, 15].includes(player.weapons[1]) && player.reloads[player.weapons[1]] == 0 && configs.secondaryOnCounter) {
                        selectWeapon(player.weapons[1]);
                    }
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }
            }, 1);
        };
        this.hammerCounterType = function () {
            if (!getEl("CounterInsta").checked) {
                return;
            }
            this.isTrue = true;
            my.autoAim = true;
            if (near.dist2 <= 70 && configs.secondaryOnCounter) {
                selectWeapon(player.weapons[1]);
                if (player.reloads[53] == 0) {
                    buyEquip(53, 0);
                } else {
                    buyEquip(7, 0);
                }
                sendAutoGather();
                game.tickBase(() => {
                    buyEquip(7, 0);
                    selectWeapon(player.weapons[0]);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }, 1);
            } else {
                selectWeapon(player.weapons[0]);
                buyEquip(7, 0);
                sendAutoGather();
                game.tickBase(() => {
                    if (player.reloads[53] == 0) {
                        buyEquip(53, 0);
                    }
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                    }, 1);
                }, 1);
            }
        };
        let inantiantibull = false;
        this.antiCounterType = function () {
            my.autoAim = true;
            this.isTrue = true;
            inantiantibull = true;
            selectWeapon(player.weapons[0]);
          //  buyEquip(6, 0);
            buyEquip(21, 1);
            io.send("D", near.aim2);
            sendAutoGather();
            game.tickBase(() => {
                buyEquip(player.reloads[53] == 0 ? player.skins[53] ? 53 : 6 : 6, 0);
                buyEquip(21, 1);
                game.tickBase(() => {
                    sendAutoGather();
                    this.isTrue = false;
                    my.autoAim = false;
                    inantiantibull = false;
                }, 1);
            }, 1);
        };
        this.spikeTickType = function() {
            ShowSettingText(300, "SpikeTick", "#f00");
            this.isTrue = true;
            my.autoAim = true;
            selectWeapon(player.weapons[0]);
            buyEquip(7, 0);
            sendAutoGather();
            game.tickBase(() => {
                selectWeapon(player.weapons[0]);
                buyEquip(53, 0);
                game.tickBase(() => {
                    sendAutoGather();
                    this.isTrue = false;
                    my.autoAim = false;
                }, 1);
            }, 1);
        };
        this.AutoSync = function() {
            this.isTrue = true;
            my.autoAim = true;
            selectWeapon(player.weapons[0]);
            buyEquip(7, 0);
            sendAutoGather();
            game.tickBase(() => {
                selectWeapon(player.weapons[0]);
                buyEquip(53, 0);
                game.tickBase(() => {
                    sendAutoGather();
                    this.isTrue = false;
                    my.autoAim = false;
                }, 1);
            }, 1);
        };
        this.syncTry = function() {
            buyEquip(53, 0);
            game.tickBase(() => {
                this.isTrue = true;
                my.autoAim = true;
                selectWeapon(player.weapons[1]);
                sendAutoGather();
                game.tickBase(() => {
                    my.autoAim = false;
                    this.isTrue = false;
                    sendAutoGather();
                }, 1);
            }, 2);
        };
        this.MapSync = function() {
            let nearDistCheck;
            nearDistCheck = (near.dist2 <= 300) ? 1 : 2
            buyEquip(53, 0);
            game.tickBase(() => {
                selectWeapon(player.weapons[1]);
                sendAutoGather();
                this.isTrue = true;
                my.autoAim = true;
                game.tickBase(() => {
                    my.autoAim = false;
                    this.isTrue = false;
                    sendAutoGather();
                }, 1);
            }, nearDistCheck);
        };
        this.rangeType = function(type) {
            this.isTrue = true;
            my.autoAim = true;
            if (type == "ageInsta") {
                my.ageInsta = false;
                if (player.items[5] == 18) {
                    place(5, near.aim2);
                }
                packet("9", undefined, 1);
                buyEquip(22, 0);
                buyEquip(21, 1);
                game.tickBase(() => {
                    selectWeapon(player.weapons[1]);
                    buyEquip(53, 0);
                    buyEquip(21, 1);
                    sendAutoGather();
                    game.tickBase(() => {
                        sendUpgrade(12);
                        selectWeapon(player.weapons[1]);
                        buyEquip(53, 0);
                        buyEquip(21, 1);
                        game.tickBase(() => {
                            sendUpgrade(15);
                            selectWeapon(player.weapons[1]);
                            buyEquip(53, 0);
                            buyEquip(21, 1);
                            game.tickBase(() => {
                                sendAutoGather();
                                this.isTrue = false;
                                my.autoAim = false;
                            }, 1);
                        }, 1);
                    }, 1);
                }, 1);
            } else {
                selectWeapon(player.weapons[1]);
                if (player.reloads[53] == 0 && near.dist2 <= 700 && near.skinIndex != 22) {
                    buyEquip(53, 0);
                } else {
                    buyEquip(20, 0);
                }
                buyEquip(11, 1);
                sendAutoGather();
                game.tickBase(() => {
                    sendAutoGather();
                    this.isTrue = false;
                    my.autoAim = false;
                }, 1);
            }
        };
        this.threeOneTickType = function() {
            io.send("");
            this.isTrue = true;
            my.autoAim = true;
            selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
            biomeGear();
            buyEquip(0, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                buyEquip(53, 0);
                buyEquip(0, 1);
                packet("9", near.aim2, 1);
                game.tickBase(() => {
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    buyEquip(0, 1);
                    sendAutoGather();
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 1);
                }, 1);
            }, 1);
        };
        /* end shit */
        this.VelocityTickorBow = function() { // Stary Code
            this.isTrue = true;
            my.autoAim = true;
            biomeGear();
            buyEquip(19, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                if (player.weapons[1] == 15) {
                    my.revAim = true;
                }
                selectWeapon(player.weapons[[9, 12, 13, 15].includes(player.weapons[1]) ? 1 : 0]);
                buyEquip(53, 0);
                buyEquip(21, 1);
                if ([9, 12, 13, 15].includes(player.weapons[1])) {
                    sendAutoGather();
                }
                packet("9", near.aim2, 1);
                game.tickBase(() => {
                    my.revAim = false;
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    buyEquip(18, 1);
                    if (![9, 12, 13, 15].includes(player.weapons[1])) {
                        sendAutoGather();
                    }
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 2);
                }, 1);
            }, 1);
        };
        this.kmTickType = function() {
            this.isTrue = true;
            my.autoAim = true;
            my.revAim = true;
            selectWeapon(player.weapons[1]);
            buyEquip(53, 0);
            buyEquip(0, 1);
            sendAutoGather();
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                my.revAim = false;
                selectWeapon(player.weapons[0]);
                buyEquip(7, 0);
                buyEquip(0, 1);
                packet("9", near.aim2, 1);
                game.tickBase(() => {
                    sendAutoGather();
                    this.isTrue = false;
                    my.autoAim = false;
                    packet("9", undefined, 1);
                }, 1);
            }, 1);
        };
        this.OneTickType = function() { // Stary Code
            this.isTrue = true;
            my.autoAim = true;
            biomeGear();
            buyEquip(19, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                if (player.weapons[1] == 15) {
                    my.revAim = true;
                }
                selectWeapon(player.weapons[[9, 12, 13, 15].includes(player.weapons[1]) ? 1 : 0]);
                buyEquip(53, 0);
                buyEquip(21, 1);
                if ([9, 12, 13, 15].includes(player.weapons[1])) {
                    sendAutoGather();
                }
                packet("9", near.aim2, 1);
                game.tickBase(() => {
                    my.revAim = false;
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    buyEquip(18, 1);
                    if (![9, 12, 13, 15].includes(player.weapons[1])) {
                        sendAutoGather();
                    }
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 2);
                }, 1);
            }, 1);
        };
        this.BoostOneTICKERS = function() { // Stary Code
            this.isTrue = true;
            my.autoAim = true;
            biomeGear();
            buyEquip(19, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                selectWeapon(player.weapons[0]);
                buyEquip(53, 0);
                buyEquip(21, 1);
                packet("9", near.aim2, 1);
                place(4, near.aim2);
                game.tickBase(() => {
                    my.revAim = false;
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    buyEquip(18, 1);
                    sendAutoGather();
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 5);
                }, 1);
            }, 1);
        };
        this.PerfectedBoostSpiketick = function() { // Stary Code
            this.isTrue = true;
            my.autoAim = true;
            biomeGear();
            buyEquip(19, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                selectWeapon(player.weapons[0]);
                buyEquip(53, 0);
                buyEquip(21, 1);
                packet("9", near.aim2, 1);
                place(4, near.aim2);
                game.tickBase(() => {
                    my.revAim = false;
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    place(2, getAttackDir());
                    buyEquip(18, 1);
                    sendAutoGather();
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 5);
                }, 1);
            }, 1);
        };
        this.boostTickType = function() { // Stary Code
            /*this.isTrue = true;
                        my.autoAim = true;
                        selectWeapon(player.weapons[0]);
                        buyEquip(53, 0);
                        buyEquip(11, 1);
                        packet("f", near.aim2);
                        game.tickBase(() => {
                            place(4, near.aim2);
                            selectWeapon(player.weapons[1]);
                            biomeGear();
                            buyEquip(11, 1);
                            sendAutoGather();
                            packet("f", near.aim2);
                            game.tickBase(() => {
                                selectWeapon(player.weapons[0]);
                                buyEquip(7, 0);
                                buyEquip(19, 1);
                                packet("f", near.aim2);
                                game.tickBase(() => {
                                    sendAutoGather();
                                    this.isTrue = false;
                                    my.autoAim = false;
                                    packet("f", undefined);
                                }, 1);
                            }, 1);
                        }, 1);*/
            this.isTrue = true;
            my.autoAim = true;
            biomeGear();
            buyEquip(11, 1);
            packet("9", near.aim2, 1);
            game.tickBase(() => {
                if (player.weapons[1] == 15) {
                    my.revAim = true;
                }
                selectWeapon(player.weapons[[9, 12, 13, 15].includes(player.weapons[1]) ? 1 : 0]);
                buyEquip(53, 0);
                buyEquip(11, 1);
                if ([9, 12, 13, 15].includes(player.weapons[1])) {
                    sendAutoGather();
                }
                packet("9", near.aim2, 1);
                place(4, near.aim2);
                game.tickBase(() => {
                    my.revAim = false;
                    selectWeapon(player.weapons[0]);
                    buyEquip(7, 0);
                    buyEquip(0, 1);
                    if (![9, 12, 13, 15].includes(player.weapons[1])) {
                        sendAutoGather();
                    }
                    packet("9", near.aim2, 1);
                    game.tickBase(() => {
                        sendAutoGather();
                        this.isTrue = false;
                        my.autoAim = false;
                        packet("9", undefined, 1);
                    }, 5);
                }, 1);
            }, 1);
        };
        this.gotoGoal = function(goto, OT) {
            let slowDists = (weeeee) => weeeee * config.playerScale;
            let goal = {
                a: goto - OT,
                b: goto + OT,
                c: goto - slowDists(1),
                d: goto + slowDists(1),
                e: goto - slowDists(2),
                f: goto + slowDists(2),
                g: goto - slowDists(4),
                h: goto + slowDists(4)
            };
            let bQ = function (wwww, awwww) {
                if (player.y2 >= config.mapScale / 2 - config.riverWidth / 2 && player.y2 <= config.mapScale / 2 + config.riverWidth / 2 && awwww == 0) {
                    buyEquip(31, 0);
                } else {
                    buyEquip(wwww, awwww);
                }
            }
            if (enemy.length) {
                let dst = near.dist2;
                this.ticking = true;
                if (dst >= goal.a && dst <= goal.b) {
                    bQ(22, 0);
                    bQ(11, 1);
                    if (player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0] || player.buildIndex > -1) {
                        selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                    }
                    return {
                        dir: undefined,
                        action: 1
                    };
                } else {
                    if (dst < goal.a) {
                        if (dst >= goal.g) {
                            if (dst >= goal.e) {
                                if (dst >= goal.c) {
                                    bQ(40, 0);
                                    bQ(10, 1);
                                    if (false) {
                                        player.buildIndex != player.items[1] && selectToBuild(player.items[1]);
                                    } else {
                                        if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                            selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                        }
                                    }
                                } else {
                                    bQ(22, 0);
                                    bQ(0, 1);
                                    if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                        selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                    }
                                }
                            } else {
                            //    bQ(6, 0);
                              //  bQ(0, 1);
                                if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                    selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                }
                            }
                        } else {
                            biomeGear();
                            bQ(11, 1);
                            if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                            }
                        }
                        return {
                            dir: near.aim2 + Math.PI,
                            action: 0
                        };
                    } else if (dst > goal.b) {
                        if (dst <= goal.h) {
                            if (dst <= goal.f) {
                                if (dst <= goal.d) {
                                    bQ(40, 0);
                                    bQ(0, 1);
                                    if (false) {
                                        player.buildIndex != player.items[1] && selectToBuild(player.items[1]);
                                    } else {
                                        if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                            selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                        }
                                    }
                                } else {
                                    bQ(22, 0);
                                    bQ(0, 1);
                                    if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                        selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                    }
                                }
                            } else {
                              //  bQ(6, 0);
                                bQ(0, 1);
                                if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                    selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                                }
                            }
                        } else {
                            biomeGear();
                            bQ(11, 1);
                            if ((player.weaponIndex != player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]) || player.buildIndex > -1) {
                                selectWeapon(player.weapons[[10, 14].includes(player.weapons[1]) ? 1 : 0]);
                            }
                        }
                        return {
                            dir: near.aim2,
                            action: 0
                        };
                    }
                    return {
                        dir: undefined,
                        action: 0
                    };
                }
            } else {
                this.ticking = false;
                return {
                    dir: undefined,
                    action: 0
                };
            }
        }
        /** wait 1 tick for better quality */
        this.bowMovement = function() {
            let moveMent = this.gotoGoal(685, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.rangeType("ageInsta");
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        },
            this.tickMovement = function() {
            let dist = player.weapons[1] == 9 ? 245 : 245;
            let actionDist = player.weapons[1] == 9 ? 2 : player.weapons[1] == 12 ? 1.5 : player.weapons[1] == 13 ? 1 : player.weapons[1] == 15 ? 2 : 3;
            let moveMent = this.gotoGoal(245, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.OneTickType();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        },
            this.VelocityOneTick = function() {
            let dist = player.weapons[1] == 9 ? 240 : 240;
            let actionDist = player.weapons[1] == 9 ? 2 : player.weapons[1] == 12 ? 1.5 : player.weapons[1] == 13 ? 1 : player.weapons[1] == 15 ? 2 : 3;
            let moveMent = this.gotoGoal(238, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.VelocityTickorBow();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
            let trapped = false;
            let trapsInRange = gameObjects.filter(trap => {
                if (trap.trap && trap.active && trap.isTeamObject(player)) {
                    return UTILS.getDist(trap, near, 0, 2) <= (near.scale + trap.getScale() + 15);
                }
                return false;
            });
            if (trapsInRange.length > 0) {
                trapped = true;
            }
            if (!trapped && getEl("VelocityOneTick").checked && player.reloads[player.weapons[0]] == 0 && player.reloads[53] == 0 && player.weapons[0] == 5 && near.dist2 > 0 && near.dist2 <= 245 && near.skinIndex != 6) {
                let oneFrameMovement = { x: moveMent.dir % 2 ? 1 : -1, y: 0 };
                let oneFramePacket = { type: "move", x: oneFrameMovement.x, y: oneFrameMovement.y };
                let nextPacket = { type: "move", x: near.aim2 % 2 ? 1 : -1, y: 0 };
                game.sendPacket(oneFramePacket);
                game.tickBase(() => {
                    game.sendPacket(nextPacket);
                });
                instaC.VelocityTickorBow();
            }
        },
            this.kmTickMovement = function() {
            let moveMent = this.gotoGoal(240, 3);
            if (moveMent.action) {
                if (near.skinIndex != 22 && player.reloads[53] == 0 && !this.isTrue && ((game.tick - near.poisonTick) % config.serverUpdateRate == 8)) {
                    this.kmTickType();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        },
            this.BoostOneTick = function() {
            let dist = player.weapons[1] == 9 ? 365 : player.weapons[1] == 12 ? 380 : player.weapons[1] == 13 ? 365 : player.weapons[1] == 15 ? 365 : 370;
            let actionDist = player.weapons[1] == 9 ? 2 : player.weapons[1] == 12 ? 1.5 : player.weapons[1] == 13 ? 1 : player.weapons[1] == 15 ? 2 : 3;
            let moveMent = this.gotoGoal(372, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.BoostOneTICKERS();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        }
        this.BoostPerfectedSpiketick = function() {
            let dist = player.weapons[1] == 9 ? 365 : player.weapons[1] == 12 ? 380 : player.weapons[1] == 13 ? 365 : player.weapons[1] == 15 ? 365 : 370;
            let actionDist = player.weapons[1] == 9 ? 2 : player.weapons[1] == 12 ? 1.5 : player.weapons[1] == 13 ? 1 : player.weapons[1] == 15 ? 2 : 3;
            let moveMent = this.gotoGoal(372, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.PerfectedBoostSpiketick();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        }
        this.boostTickMovement = function() {
            let dist = player.weapons[1] == 9 ? 365 : player.weapons[1] == 12 ? 380 : player.weapons[1] == 13 ? 365 : player.weapons[1] == 15 ? 365 : 370;
            let actionDist = player.weapons[1] == 9 ? 2 : player.weapons[1] == 12 ? 1.5 : player.weapons[1] == 13 ? 1 : player.weapons[1] == 15 ? 2 : 3;
            let moveMent = this.gotoGoal(372, 3);
            if (moveMent.action) {
                if (player.reloads[53] == 0 && !this.isTrue) {
                    this.boostTickType();
                } else {
                    packet("9", moveMent.dir, 1);
                }
            } else {
                packet("9", moveMent.dir, 1);
            }
        }
        /** wait 1 tick for better quality */
        this.perfCheck = function(pl, nr) {
            if (nr.weaponIndex == 11 && UTILS.getAngleDist(nr.aim2 + Math.PI, nr.d2) <= config.shieldAngle) return false;
            if (![9, 12, 13, 15].includes(player.weapons[1])) return true;
            let pjs = {
                x: nr.x2 + (70 * Math.cos(nr.aim2 + Math.PI)),
                y: nr.y2 + (70 * Math.sin(nr.aim2 + Math.PI))
            };
            if (UTILS.lineInRect(pl.x2 - pl.scale, pl.y2 - pl.scale, pl.x2 + pl.scale, pl.y2 + pl.scale, pjs.x, pjs.y, pjs.x, pjs.y)) {
                return true;
            }
            let finds = ais.filter(tmp => tmp.visible).find((tmp) => {
                if (UTILS.lineInRect(tmp.x2 - tmp.scale, tmp.y2 - tmp.scale, tmp.x2 + tmp.scale, tmp.y2 + tmp.scale, pjs.x, pjs.y, pjs.x, pjs.y)) {
                    return true;
                }
            });
            if (finds) return false;
            finds = closeObjects.filter(tmp => tmp.active).find((tmp) => {
                let tmpScale = tmp.getScale();
                if (!tmp.ignoreCollision && UTILS.lineInRect(tmp.x - tmpScale, tmp.y - tmpScale, tmp.x + tmpScale, tmp.y + tmpScale, pjs.x, pjs.y, pjs.x, pjs.y)) {
                    return true;
                }
            });
            if (finds) return false;
            return true;
        }
    }
};

class Autobuy {
    constructor(buyHat, buyAcc) {
        this.hat = function() {
            buyHat.forEach((id) => {
                let find = findID(hats, id);
                if (find && !player.skins[id] && player.points >= find.price) packet("c", 1, id, 0);
            });
        };
        this.acc = function() {
            buyAcc.forEach((id) => {
                let find = findID(accessories, id);
                if (find && !player.tails[id] && player.points >= find.price) packet("c", 1, id, 1);
            });
        };
    }
};

class Damages {
    constructor(items) {
        // 0.75 1 1.125 1.5
        this.calcDmg = function(dmg, val) {
            return dmg * val;
        };
        this.getAllDamage = function(dmg) {
            return [this.calcDmg(dmg, 0.75), dmg, this.calcDmg(dmg, 1.125), this.calcDmg(dmg, 1.5)];
        };
        this.weapons = [];
        for (let i = 0; i < items.weapons.length; i++) {
            let wp = items.weapons[i];
            let name = wp.name.split(" ").length <= 1 ? wp.name : (wp.name.split(" ")[0] + "_" + wp.name.split(" ")[1]);
            this.weapons.push(this.getAllDamage(i > 8 ? wp.Pdmg : wp.dmg));
            this[name] = this.weapons[i];
        }
    }
}

/** CLASS CODES */
// jumpscare code warn
let tmpList = [];

// LOADING:
let UTILS = new Utils();
let items = new Items();
let itemsWeapons = Items.weapons;
let objectManager = new Objectmanager(GameObject, gameObjects, UTILS, config);
let store = new Store();
let hats = store.hats;
let accessories = store.accessories;
let projectileManager = new ProjectileManager(Projectile, projectiles, players, ais, objectManager, items, config, UTILS);
let aiManager = new AiManager(ais, AI, players, items, null, config, UTILS);
let textManager = new Textmanager();
 let sCombat = new Combat(UTILS, items);
let traps = new Traps(UTILS, items);
let instaC = new Instakill();
let autoBuy = new Autobuy([12], [11]);
let spikes = {
    aim: 0,
    inRange: false,
    info: {}
}
let lastDeath;
let minimapData;
let mapMarker = {};
let mapPings = [];
let tmpPing;

let breakTrackers = [];

function sendChat(message) {
    packet("6", message.slice(0, 30));
}

let runAtNextTick = [];

const turretAnti = (tmpObj) => {
    if (tmpObj.dist2 <= 300 && player.alive) {
        if (enemy.includes(tmpObj)) {
            if(near.primaryIndex == 5 && config.weaponVariants[tmpObj.primaryVariant].id >= 2) {
             //   buyEquip(6, 0);
                my.anti0Tick = true;
            }
        }
    }
}
function checkProjectileHolder(x, y, dir, range, speed, indx, layer, sid) {
    let weaponIndx = indx == 0 ? 9 : indx == 2 ? 12 : indx == 3 ? 13 : indx == 5 && 15;
    let projOffset = config.playerScale * 2;
    let projXY = {
        x: indx == 1 ? x : x - projOffset * Math.cos(dir),
        y: indx == 1 ? y : y - projOffset * Math.sin(dir),
    };
    let nearPlayer = players.filter((e) => player.visible && UTILS.getDist(projXY, e, 0, 2) <= player.scale).sort(function (a, b) {
        return UTILS.getDist(projXY, a, 0, 2) - UTILS.getDist(projXY, b, 0, 2);
    })[0];
    if (nearPlayer) {
        if (indx == 1) {
            nearPlayer.shooting[53] = 1;
            turretAnti(nearPlayer);
        } else {
            nearPlayer.shootIndex = weaponIndx;
            nearPlayer.shooting[1] = 1;
            antiProj(nearPlayer, dir, range, speed, indx, weaponIndx);
        }
    }
}
let projectileCount = 0;
function notif(title, description) {
    let mouseCoord = player;
    let m = textManager;
    if (typeof title !== "undefined") {
        m.showText(mouseCoord.x, mouseCoord.y, 40, .18, 500, title, "white");
    }
    if (typeof description !== "undefined") {
        m.showText(mouseCoord.x, mouseCoord.y + 40, 30, .18, 500, description, "white");
    }
}
// LATER:

function antiProj(tmpObj, dir, range, speed, index, weaponIndex, indx, y, x) {
    let weaponIndx = indx == 0 ? 9 : indx == 2 ? 12 : indx == 3 ? 13 : indx == 5 && 15;
    let projOffset = config.playerScale * 2;
    let projXY = {
        x: indx == 1 ? x : x - projOffset * Math.cos(dir),
        y: indx == 1 ? y : y - projOffset * Math.sin(dir),
    };
    let fixXY = function(tmpObj) {
        return {
            x2: UTILS.fixTo(tmpObj.x2, 2),
            y2: UTILS.fixTo(tmpObj.y2, 2),
        };
    };
    let nearPlayer = players.filter((e)=>e.visible && UTILS.getDist(projXY, e, 0, 2) <= e.scale).sort(function(a, b) {
        return (UTILS.getDist(projXY, a, 0, 2) - UTILS.getDist(projXY, b, 0, 2));
    })[0];
    if (!tmpObj.isTeam(player) && combatplacetoggle.defense_placement) {
        tmpDir = UTILS.getDirect(player, tmpObj, 2, 2);
        if (UTILS.getAngleDist(tmpDir, dir) <= 0.2) {
            tmpObj.bowThreat[weaponIndex]++;
            if (index == 5) {
                projectileCount++;
            }
            if (enemy) {
                let enemyIndex = enemy.index;
                if (index == 1 || index == 2 || index == 3 || index == 5 || index == 13 || index == 14 || index == 15) {
                    player.shooting[53] = 1;
                    setTimeout(() => {
                        player.shooting[53] = 0;
                    }, range / speed);
                }

                player.bowThreat[index]++;
                setTimeout(() => {
                    player.bowThreat[index]--;
                }, range / speed);
            }
            if (tmpObj.bowThreat[9] >= 1 && (tmpObj.bowThreat[12] >= 1 || tmpObj.bowThreat[15] >= 1)) {
                place(3, tmpObj.aim2);
                place(1, tmpObj.aim2);
                buyEquip(22, 0);
                game.tickBase(() => {
                    buyEquip(22, 0);
                }, 1);
                my.anti0Tick = 4;
                if (!my.antiSync) {
                    antiSyncHealing(4);
                    packet("9", tmpObj.aim2+3.1415926535897932/2, 1)
                    game.tickBase(() => {
                        packet("9", undefined, 1)
                    }, 2)
                }
            }
        } else {
            if (near.dist2 < 900) {
                if (projectileCount >= 2) {
                    place(3, tmpObj.aim2);
                    place(1, tmpObj.aim2);
                    packet("9", tmpObj.aim2+3.1415926535897932/2, 1)
                    my.anti0Tick = 4;
                    predictHeal(2)
                    game.tickBase(() => {
                        packet("9", undefined, 1)
                    }, 4)
                    if (!my.antiSync) {
                        antiSyncHealing(4);
                    }
                } else {
                    if (projectileCount === 1 && near.reloads[near.weapons[0]] == 0 && near.dist2 < items.weapons[near.weapons[0]].range + player.scale * 1.8) {
                     //   buyEquip(6, 0);
                     //   buyEquip(21, 1);
                    }
                }
            }
        }
    }
}

// SHOW ITEM INFO:
function showItemInfo(item, isWeapon, isStoreItem) {
    if (player && item) {
        UTILS.removeAllChildren(itemInfoHolder);
        itemInfoHolder.classList.add("visible");
        UTILS.generateElement({
            id: "itemInfoName",
            text: UTILS.capitalizeFirst(item.name),
            parent: itemInfoHolder
        });
        UTILS.generateElement({
            id: "itemInfoDesc",
            text: item.desc,
            parent: itemInfoHolder
        });
        if (isStoreItem) {

        } else if (isWeapon) {
            UTILS.generateElement({
                class: "itemInfoReq",
                text: !item.type ? "primary" : "secondary",
                parent: itemInfoHolder
            });
        } else {
            for (let i = 0; i < item.req.length; i += 2) {
                UTILS.generateElement({
                    class: "itemInfoReq",
                    html: item.req[i] + "<span class='itemInfoReqVal'> x" + item.req[i + 1] + "</span>",
                    parent: itemInfoHolder
                });
            }
            if (item.group.limit) {
                UTILS.generateElement({
                    class: "itemInfoLmt",
                    text: (player.itemCounts[item.group.id] || 0) + "/" + (config.isSandbox ? 99 : item.group.limit),
                    parent: itemInfoHolder
                });
            }
        }
    } else {
        itemInfoHolder.classList.remove("visible");
    }
}

// RESIZE:
window.addEventListener("resize", UTILS.checkTrusted(resize));

function resize() {
    screenWidth = window.innerWidth;
    screenHeight = window.innerHeight;
    let scaleFillNative = Math.max(screenWidth / maxScreenWidth, screenHeight / maxScreenHeight) * pixelDensity;
    gameCanvas.width = screenWidth * pixelDensity;
    gameCanvas.height = screenHeight * pixelDensity;
    gameCanvas.style.width = screenWidth + "px";
    gameCanvas.style.height = screenHeight + "px";
    mainContext.setTransform(
        scaleFillNative, 0,
        0, scaleFillNative,
        (screenWidth * pixelDensity - (maxScreenWidth * scaleFillNative)) / 2,
        (screenHeight * pixelDensity - (maxScreenHeight * scaleFillNative)) / 2
    );
}
resize();

// MOUSE INPUT:
var usingTouch;
const mals = document.getElementById('touch-controls-fullscreen');
mals.style.display = 'block';
mals.addEventListener("mousemove", gameInput, false);

function gameInput(e) {
    mouseX = e.clientX;
    mouseY = e.clientY;
}
let clicks = {
    left: false,
    middle: false,
    right: false,
};
mals.addEventListener("mousedown", mouseDown, false);

function mouseDown(e) {
    if (attackState != 1) {
        attackState = 1;
        if (e.button == 0) {
            clicks.left = true;
        } else if (e.button == 1) {
            clicks.middle = true;
        } else if (e.button == 2) {
            clicks.right = true;
        }
    }
}
mals.addEventListener("mouseup", UTILS.checkTrusted(mouseUp));

function mouseUp(e) {
    if (attackState != 0) {
        attackState = 0;
        if (e.button == 0) {
            clicks.left = false;
        } else if (e.button == 1) {
            clicks.middle = false;
        } else if (e.button == 2) {
            clicks.right = false;
        }
    }
}
mals.addEventListener("wheel", wheel, false);

let targetWbe = 1;
let currentWbe = 1;
let velocity = 0;
const friction = 0.97;
const acceleration = 0.010;
const smoothness = 0.05;
mals.addEventListener("wheel", wheel, { passive: false });
function wheel(e) {
    e.preventDefault();
    velocity += (e.deltaY > 0 ? 1 : -1) * acceleration;
}
function updateZoom() {
    targetWbe += velocity;
    velocity *= friction;
    targetWbe = Math.max(0.3, Math.min(targetWbe, 5.0));
    let diff = targetWbe - currentWbe;
    currentWbe += diff * smoothness;
    maxScreenWidth = config.maxScreenWidth * currentWbe;
    maxScreenHeight = config.maxScreenHeight * currentWbe;
    resize();
    requestAnimationFrame(updateZoom);
}
updateZoom();

function getMoveDir() {
    let dx = 0;
    let dy = 0;

    // Düymələrdən gələn ilkin hərəkət istiqaməti
    let moveInputs = {
        [keybinds.movew]: [0, -1],
        [keybinds.moves]: [0, 1],
        [keybinds.movea]: [-1, 0],
        [keybinds.moved]: [1, 0],
    };
    let isSafeWalkActive = combatdefensetoggle.safewalkstop;
    for (let [key, tmpDir] of Object.entries(moveInputs)) {
        if (keys[key]) {
            let nextDx = tmpDir[0];
            let nextDy = tmpDir[1];

            let isBlocked = false;
            if (isSafeWalkActive) {
                for (let i = 0; i < gameObjects.length; i++) {
                    let obj = gameObjects[i];

                    if (obj.active && !obj.isTeamObject(player) &&
                       (obj.name && obj.name.includes("spikes"))) {

                        let dist = Math.hypot(player.x - obj.x, player.y - obj.y);

                        if (dist < 175) {
                            let angleToSpike = Math.atan2(obj.y - player.y, obj.x - player.x);
                            let moveAngle = Math.atan2(nextDy, nextDx);

                            let dotProduct = Math.cos(moveAngle) * Math.cos(angleToSpike) +
                                             Math.sin(moveAngle) * Math.sin(angleToSpike);

                            if (dotProduct > 0.5) {
                                isBlocked = true;
                                break;
                            }
                        }
                    }
                }
            }
            if (!isBlocked) {
                dx += nextDx;
                dy += nextDy;
            }
        }
    }

    return dx == 0 && dy == 0 ? undefined : Math.atan2(dy, dx);
}

let checkDist = 75;
let plusDir = 0;
let lastSpin = Date.now();
function getSafeDir() {
    if (!player) return 0;
    lastDir = Math.atan2(mouseY - screenHeight / 2, mouseX - screenWidth / 2);
    return lastDir || 0;
}


function doesCircleIntersectSector(obj, radius, sectorMidpoint, weaponRadius) {
    const unhittableRadius = player.scale * 1.5;
    const weaponAngle = Math.PI / 2.6 / 2;
    const angleStep = Math.PI / 8;

    const normalize = (angle) => (angle + Math.PI * 2) % (Math.PI * 2) - Math.PI;
    const normalizedSectorStart = normalize(sectorMidpoint - weaponAngle);
    const normalizedSectorEnd = normalize(sectorMidpoint + weaponAngle);

    for (let angleOffset = -Math.PI; angleOffset < Math.PI; angleOffset += angleStep) {
        const edgeX = obj.x + radius * Math.cos(angleOffset);
        const edgeY = obj.y + radius * Math.sin(angleOffset);

        const angleToEdge = Math.atan2(edgeY - player.y2, edgeX - player.x2);
        const distanceToEdge = Math.hypot(edgeY - player.y2, edgeX - player.x2);

        const normalizedAngleToEdge = normalize(angleToEdge);

        if (distanceToEdge >= unhittableRadius && distanceToEdge <= weaponRadius) {
            return (normalizedSectorStart <= normalizedSectorEnd)
                ? (normalizedAngleToEdge >= normalizedSectorStart && normalizedAngleToEdge <= normalizedSectorEnd)
            : (normalizedAngleToEdge >= normalizedSectorStart || normalizedAngleToEdge <= normalizedSectorEnd);
        }
    }

    return false;
}

function canHitBothObjects(obj1, obj1Radius, obj2, obj2Radius, weaponRange) {
    const obj1Angle = Math.atan2(obj1.y - player.y2, obj1.x - player.x2);
    const obj2Angle = Math.atan2(obj2.y - player.y2, obj2.x - player.x2);

    let midpointAngle = (obj1Angle + obj2Angle) / 2;
    if (Math.abs(obj1Angle - obj2Angle) > Math.PI) {
        midpointAngle += Math.PI;
        midpointAngle = (midpointAngle + Math.PI) % (2 * Math.PI) - Math.PI;
    }

    const obj1InRange = doesCircleIntersectSector(obj1, obj1Radius, midpointAngle, weaponRange);
    const obj2InRange = doesCircleIntersectSector(obj2, obj2Radius, midpointAngle, weaponRange);

    return [obj1InRange && obj2InRange, obj1Angle, obj2Angle, midpointAngle];
}

function getPredictTrapAim() {
    const checkObj = traps.hasSpike && objectManager.hitsToBreak(traps.info[1], player) <= objectManager.hitsToBreak(traps.info[0], player) ? traps.info[1] : traps.info[0];
    const weapon = traps.notFast(checkObj) ? player.weapons[1] : player.weapons[0];
    const weaponRange = items.weapons[weapon].range + player.scale + (traps.hasSpike ? traps.info[1].scale / 3.25 : 0);
    let bestAim = traps.aim;

    if (traps.hasSpike && objectManager.canHit(player, traps.info[1], weapon)) {
        const calculationStuff = canHitBothObjects(traps.info[0], 50, traps.info[1], 50, weaponRange);
        if (calculationStuff[0]) {
            bestAim = calculationStuff[3];
        } else if (checkObj.sid === traps.info[1].sid) {
            bestAim = calculationStuff[2];
        }
    }

    return bestAim;
}

let spinner;
let spinDir = 0;
function getAttackDir(debug) {
    if (!player) return 0;

    let nearAim = (my.autoAim || (
        ((clicks.left && near.dist2 <= 300) || (useWasd && near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8 && !traps.inTrap))
        && player.reloads[player.weapons[0]] === 0)
    );

    let aimToTrap = traps.inTrap;
    let rightClickAim = clicks.right && player.reloads[player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]] == 0;

    if (nearAim && combatattacktoggle.predictive_aim) {
        lastDir = getEl("weaponGrind").checked ? getSafeDir() : enemy.length ? my.revAim ? (near.aim2 + Math.PI) : near.aim2 : getSafeDir();
    } else if (rightClickAim) {
        lastDir = getSafeDir();
    } else if (aimToTrap && combatdefensetoggle.autobreak) {
        lastDir = getPredictTrapAim();
    } else if (spikes.inRange && configs.doAutoBreakSpike && player.reloads[player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]] == 0 && combatdefensetoggle.autobreak) {
        lastDir = spikes.aim;
    } else if (breakSpike.active && combatdefensetoggle.autobreak) {
        lastDir = breakSpike.aim;
    } else if (spinner) {
        let spinSpeed = parseFloat();
        if (spinSpeed > 0) {
            spinDir += (Math.PI / 10) * spinSpeed;
        } else {
            spinDir = 0;
        }
        return spinDir;
    } else {
        if (!player.lockDir) {
            if (configs.noDir) {
                lastDir = lastDir;
            } else {
                lastDir = getSafeDir();
            }
        }
    }

    return lastDir || 0;
}
function spin() {
    let random = [2, 3, 4, 5, 7, 3, 23, -1];
    setTimeout(() => {
        spinner = true;
        setTimeout(() => {
            spinner = false;
        }, random[Math.floor(Math.random() * random.length)]);
    }, 1);
}
if (configs.spin && !(clicks.middle || clicks.left || clicks.right) && !my.waitHit && !traps.inTrap) {
    spinner = true;
} else {
    spinner = false;
}

function getVisualDir() {
    if (!player) return 0;
    let dx = mouseX - screenWidth / 2;
    let dy = mouseY - screenHeight / 2;
    let direction = Math.atan2(dy, dx);
    return direction;
}
// KEYS:
function keysActive() {
    return (allianceMenu.style.display != "block" &&
            chatHolder.style.display != "block" &&
            !menuCBFocus);
}
let changeCounts = 0;
let opacity = 0;
let toggle;

let autos = {
    insta: {
        todo: false,
        wait: false,
        count: 4,
        shame: 5,
        toggle: false
    },
    instaing: false,
    bull: false,
    antibull: 0,
    reloaded: false,
    stopspin: true
}
function toRad(angle) {
    return angle * 0.01745329251;
}
let boostSpikings = false;
function trapcycle() {
    place(4, player.dir);
    place(4, player.dir + Math.PI / 2);
    place(4, player.dir - Math.PI / 2);
    place(4, player.dir + Math.PI);
}
function spikecycle() {
    place(2, player.dir);
    place(2, player.dir + Math.PI / 2);
    place(2, player.dir - Math.PI / 2);
    place(2, player.dir + Math.PI);
}
function turretcycle() {
    place(5, player.dir);
    place(5, player.dir + Math.PI / 2);
    place(5, player.dir - Math.PI / 2);
    place(5, player.dir + Math.PI);
}
function spawncycle() {
    place(6, player.dir);
    place(6, player.dir + Math.PI / 2);
    place(6, player.dir - Math.PI / 2);
    place(6, player.dir + Math.PI);
}
function placeQuad() {
    place(4, near.aim2);
    place(4, near.aim2 + toRad(45));
    place(4, near.aim2 - toRad(90));
    place(4, near.aim2 + Math.PI);
}
let follow = (ang) => {
    packet("9", ang)
}

// boost spike
setInterval(()=>{
if (boostSpikings) {
if (near.dist2 <= 200) {
place(2, near.aim2 + Math.PI / 2);
place(2, near.aim2 - Math.PI / 2);
}
if (near.dist2 <= 120) {
place(2, near.aim2 + Math.PI / 2);
place(2, near.aim2 - Math.PI / 2);
place(2, near.aim2 + Math.PI);
}
if (near.dist2 < 70) {
place(2, near.aim2);
place(2, near.aim2 + Math.PI / 2);
place(2, near.aim2 - Math.PI / 2);
place(2, near.aim2 + Math.PI);
}
if (near.dist2 >= 190) {
place(4, near.aim2);
}
}
}, 100);

window.addEventListener('keydown', (event) => {
    if (event.code === keybinds.food) { // Və ya sizin sistemə uyğun keyNum
        fastQ = true;
    }
});
window.addEventListener('keyup', (event) => {
    if (event.code === keybinds.food) {
        fastQ = false;
    }
});

let spikeInterval = null;
let trapInterval = null;
let turretInterval = null;
let windmillInterval = null;
let spawnInterval = null;
let wallInterval = null;
let foodInterval = null;

document.addEventListener("keyup", function(e) {
    const keyNum = e.keyCode;
    if (player && player.alive && keysActive1) {
         if (keyNum === keybinds.spike) {clearInterval(spikeInterval);spikeInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.trap) {clearInterval(trapInterval);trapInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.food) {clearInterval(foodInterval);foodInterval = null;}
    else if (keyNum === keybinds.turret) {clearInterval(turretInterval);turretInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.wall) {clearInterval(wallInterval);wallInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.windmill) {clearInterval(windmillInterval);windmillInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.spawn) {clearInterval(spawnInterval);spawnInterval = null;packet("D", getAttackDir());}
    else if (keyNum === keybinds.boostspike) {boostSpikings=false;}
    }
});

document.addEventListener("keydown", function(e) {
if (document.activeElement.tagName === 'INPUT') return;
    const keyNum = e.keyCode;
    const keyChar = e.key.toLowerCase(); // Daha dəqiq yoxlama üçün hərfi də götürək
    if ((keyNum >= 49 && keyNum <= 57) || keyChar === 'e') {
        e.stopImmediatePropagation();
        e.preventDefault();
    }
    if (player && player.alive && keysActive1) {
         if (keyNum === keybinds.spike && spikeInterval === null) {spikeInterval = setInterval(() => {place(2, getSafeDir());}, 50);}
    else if (keyNum === keybinds.trap && trapInterval === null) {trapInterval = setInterval(() => {place(4, getSafeDir());}, 50);}
    else if (keyNum === keybinds.turret && turretInterval === null) {turretInterval = setInterval(() => {place(5, getSafeDir());}, 50);}
    else if (keyNum === keybinds.food && foodInterval === null) {foodInterval = setInterval(() => {place2(0);}, 50);}
    else if (keyNum === keybinds.windmill && windmillInterval === null) {windmillInterval = setInterval(() => {place(3, getSafeDir());}, 50);}
    else if (keyNum === keybinds.wall && wallInterval === null) {wallInterval = setInterval(() => {place(1, getSafeDir());}, 50);}
    else if (keyNum === keybinds.spawn && spawnInterval === null) {spawnInterval = setInterval(() => {place(6, getSafeDir());}, 50);}
    else if (keyNum === keybinds.alicem) {allianceMenu.style.display = (allianceMenu.style.display === "none") ? "block" : "none";}
    else if (keyNum === keybinds.storem) {storeMenu.style.display = (storeMenu.style.display === "none") ? "block" : "none";}
    else if (keyNum === keybinds.instakey && combatattacktoggle.insta_kill) {can_do_insta_kill = !can_do_insta_kill;insta_kill_target = !insta_kill_target;switch (insta_type.value) {case "5":insta_kill_boost_target = !insta_kill_boost_target;break;}}
    else if (keyNum === keybinds.tickkey && combatattacktoggle.manual_tick) {can_do_manual_tick = !can_do_manual_tick;manual_tick_target = !manual_tick_target;}

    else if (keyNum === keybinds.primary) {selectWeapon(player.weapons[0]);}
    else if (keyNum === keybinds.secondary) {selectWeapon(player.weapons[1]);}
     else if (keyNum === keybinds.autoattack) {sendAutoGather();}
     else if (keyNum === keybinds.mapmarker) {updateMapMarker();}
   //  else if (keyNum === keybinds.lockdir) {lookdir = !lookdir}
    else if (keyNum === keybinds.trapc && secPacket < 50) {trapcycle();}
    else if (keyNum === keybinds.spikec && secPacket < 20) {spikecycle();}
    else if (keyNum === keybinds.turretc && secPacket < 20) {turretcycle();}
    else if (keyNum === keybinds.spawnc && secPacket < 20) {spawncycle();}
    else if (keyNum === keybinds.boostspike) {boostSpikings=true;}
    else if (keyNum == keybinds.debug) {window.debug()}
    }
}, true); // BURADA "true" OLDUĞUNDAN ƏMİN OL


function keysActive1() {
    return (chatHolder.style.display != "block" &&!menuCBFocus);
}

document.addEventListener("keydown", function(e) {
    const keyNum = e.key.toLowerCase();
if ({[keybinds.movew]: [0, -1],[keybinds.moves]: [0, 1],[keybinds.movea]: [-1, 0],[keybinds.moved]: [1, 0],}[keyNum]) {
    sendMoveDir();
}
});

document.addEventListener("keyup", function(e) {
    const keyNum = e.key.toLowerCase();
if (keyNum === keybinds.movew || keyNum === keybinds.moves || keyNum === keybinds.movea || keyNum === keybinds.moved) {
    sendMoveDir();
}
});
var Healing;
function keyDown(event) {
    let keyNum = event.which || event.keyCode || 0;
    if (player && player.alive && keysActive()) {
        if (!keys[keyNum]) {
            keys[keyNum] = 1;
            macro[event.key] = 1;
            if (keyNum == 27) {
                openMenu = !openMenu;
            } else if (event.key === "n" && false) {
                boostSpikings=true;
            } else if (keyNum === keybinds.movew || keyNum === keybinds.moves || keyNum === keybinds.movea || keyNum === keybinds.moved) {
                sendMoveDir();
            } else if (event.key == keybinds.debug) {
                typeof window.debug == "function" && window.debug();
            } else if (keyNum == 32) {
                packet("F", 1, getSafeDir(), 1);
                packet("F", 0, getSafeDir(), 1);
            }
        }
    }
}
let Playing = false;
let currentPart = 0;
function playSong() {
    Playing = !Playing;
    if (Playing) {
        let Song = Songs[Number(getEl("song").value)];
        Song.play();
        Song.onended = function() {
            if (Playing) {
                Songs[Number(getEl("song").value)].play();
            }
        };
        Song.ontimeupdate = function(t) {
            let part = songC[Number(getEl("song").value)][getTime(Math.round(this.currentTime))];
            if (part && part !== currentPart) {
                currentPart = part;
            }
        };
    } else {
        Songs[0].pause();
    }
}

function getTime(t) {
    let sec = Math.floor(t) % 60;
    let min = Math.floor(Math.floor(t) % 3600 / 60);
    sec < 10 && (sec = `0${sec}`)
    return min + ":" + sec;
}
let lastType, Sync = false;
let lastDamage = 0;
let oldEnemy;
let Shadow = 0.35;
setInterval(()=>{
    if (advHeal.length) {
        advHeal.forEach((updHealth) => {
            let sid = updHealth[0];
            let value = updHealth[1];
            let damaged = updHealth[2];
            tmpObj = findPlayerBySID(sid);
            if (tmpObj) {
                if (tmpObj == oldEnemy && (tmpObj.oldHealth <= damaged || damaged == items.list[player.items[2]].dmg*(tmpObj.skinIndex==6?3/4:1))) { // CHECK SYNC
                    if (lastDamage == damaged) {
                        Sync = true;
                        game.tickBase(() => {
                            Sync = false;
                        }, 5);
                    } else if (tmpObj.oldHealth != damaged) lastDamage = damaged;
                };
            }
        });
        advHeal = [];
    }
}, 30);

addEventListener("keydown", UTILS.checkTrusted(keyDown));

function keyUp(event) {
    if (player && player.alive) {
        let keyNum = event.which || event.keyCode || 0;
       if (keysActive()) {
            if (keys[keyNum]) {
                keys[keyNum] = 0;
                macro[event.key] = 0;
        if (keyNum === keybinds.movew || keyNum === keybinds.moves || keyNum === keybinds.movea || keyNum === keybinds.moved) {
          sendMoveDir();
                } else if (event.key == "n" && false) {
                    boostSpikings=false;
                }
            }
        }
    }
}


window.addEventListener("keyup", UTILS.checkTrusted(keyUp));

function sendMoveDir() {
    if(found) {
        packet("9", undefined, 1);
    } else {
        let newMoveDir = getMoveDir();
        if (lastMoveDir == undefined || newMoveDir == undefined || Math.abs(newMoveDir - lastMoveDir) > 0.3) {
            if (!my.autoPush && !found) {
                packet("9", newMoveDir, 1);
            }
            lastMoveDir = newMoveDir;
        }
    }
}

// ITEM COUNT DISPLAY:
let isItemSetted = [];

function updateItemCountDisplay(index = undefined) {
    for (let i = 3; i < items.list.length; ++i) {
        let id = items.list[i].group.id;
        let tmpI = items.weapons.length + i;
        if (!isItemSetted[tmpI]) {
            isItemSetted[tmpI] = document.createElement("div");
            isItemSetted[tmpI].id = "itemCount" + tmpI;
            getEl("actionBarItem" + tmpI).appendChild(isItemSetted[tmpI]);
            isItemSetted[tmpI].style = `
                        display: block;
                        position: absolute;
                        padding-left: 5px;
                        font-size: 2em;
                        color: #fff;
                        `;
            isItemSetted[tmpI].innerHTML = player.itemCounts[id] || 0;
        } else {
            if (index == id) isItemSetted[tmpI].innerHTML = player.itemCounts[index] || 0;
        }
    }
}

// AUTOPUSH:
function followPath(path) {
    if (path.length > 1) {
        const nextStep = path[1];
        const targetPosition = {
            x: player.x2 - pathFind.scale / 2 + (pathFind.scale / pathFind.grid) * nextStep.x,
            y: player.y2 - pathFind.scale / 2 + (pathFind.scale / pathFind.grid) * nextStep.y
        };
        console.log("Moving to next step:", targetPosition);
        if (isPathClear(targetPosition)) {
            packet("9", UTILS.getDirect(targetPosition, player, 0, 2), 1);
        } else {
            console.log("Path obstructed, recalculating...");
            pathfinderToRandomPosition(nextStep.x, nextStep.y);
        }
    }
}
function pathfinderToRandomPosition(targetX, targetY) {
    if (!pathFind.active) return;
    pathFind.scale = (config.maxScreenWidth / 2) * 1.3;
    createPath();
    const startX = Math.floor(pathFind.grid / 2);
    const startY = Math.floor(pathFind.grid / 2);
    console.log("Finding path from", startX, startY, "to", targetX, targetY);
    easystar.findPath(startX, startY, targetX, targetY, function (path) {
        if (path === null) {
            console.error("Path not found to target:", targetX, targetY);
            pathFind.array = [];
        } else {
            console.log("Path found:", path);
            pathFind.array = path;
            followPath(path);
        }
    });
    easystar.calculate();
}
function isPathClear(targetPosition) {
    return !gameObjects.some(tmp => {
        if (!tmp.ignoreCollision && UTILS.lineInRect(tmp.x - tmp.getScale(), tmp.y - tmp.getScale(), tmp.x + tmp.getScale(), tmp.y + tmp.getScale(), player.x2, player.y2, targetPosition.x, targetPosition.y)) {
            console.log("Obstacle detected at", tmp);
            return true;
        }
        return false;
    });
}
function checkPathColl(tmp) {
    return ((player.scale + tmp.getScale()) / (player.maxSpeed * items.weapons[player.weaponIndex].spdMult)) + (tmp.dmg && !tmp.isTeamObject(player) ? 35 : 0);
}
function checkObject() {
    let checkColl = gameObjects.filter(tmp => player.canSee(tmp) && tmp.active);
    grid = [];
    for (let y = 0; y < pathFind.grid; y++) {
        grid[y] = [];
        for (let x = 0; x < pathFind.grid; x++) {
            let tmpXY = {
                x: (player.x2 - (pathFind.scale / 2)) + ((pathFind.scale / pathFind.grid) * x),
                y: (player.y2 - (pathFind.scale / 2)) + ((pathFind.scale / pathFind.grid) * y)
            }
            let distance = UTILS.getDist(pathFind.chaseNear ? near : pathFind, tmpXY, pathFind.chaseNear ? 2 : 0, 0);
            if (distance <= (pathFind.chaseNear ? 35 : 60)) {
                pathFind.lastX = x;
                pathFind.lastY = y;
                grid[y][x] = 0;
                continue;
            }
            let find = checkColl.find(tmp => UTILS.getDist(tmp, tmpXY, 0, 0) <= checkPathColl(tmp));
            if (find) {
                grid[y][x] = find.trap ? 0 : 1;
            } else {
                grid[y][x] = 0;
            }
        }
    }
}
function createPath() {
    checkObject();
}
var EasyStar = (function (modules) {
    var moduleCache = {};
    function require(moduleId) {
        if (moduleCache[moduleId]) return moduleCache[moduleId].exports;
        var module = (moduleCache[moduleId] = {
            i: moduleId,
            l: false,
            exports: {},
        });
        modules[moduleId].call(module.exports, module, module.exports, require);
        module.l = true;
        return module.exports;
    }
    require.m = modules;
    require.c = moduleCache;
    require.d = function (exports, name, getter) {
        if (!require.o(exports, name)) {
            Object.defineProperty(exports, name, {
                enumerable: true,
                get: getter,
            });
        }
    };
    require.r = function (exports) {
        if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
            Object.defineProperty(exports, Symbol.toStringTag, {
                value: "Module",
            });
        }
        Object.defineProperty(exports, "__esModule", {
            value: true,
        });
    };
    require.t = function (value, mode) {
        if (mode & 1) value = require(value);
        if (mode & 8) return value;
        if (mode & 4 && typeof value === "object" && value && value.__esModule) return value;
        var ns = Object.create(null);
        require.r(ns);
        Object.defineProperty(ns, "default", {
            enumerable: true,
            value: value,
        });
        if (mode & 2 && typeof value != "string") {
        }
        for (var key in value) {
        }
        require.d(ns, key, function (key) {
            return value[key];
        }.bind(null, key));
        return ns;
    };
    require.n = function (module) {
        var getter = module && module.__esModule ? function getDefault() {
            return module.default;
        } : function getModuleExports() {
            return module;
        };
        require.d(getter, "9", getter);
        return getter;
    };
    require.o = function (object, property) {
        return Object.prototype.hasOwnProperty.call(object, property);
    };
    require.p = "/bin/";
    return require(require.s = 0);
})([
    function (module, exports, require) {
        const Node = require(1);
        const MinHeap = require(2);
        const EasyStar = {};
        module.exports = EasyStar;
        let instanceIdCounter = 1;
        EasyStar.Pathfinder = function () {
            let grid,
                acceptableTiles,
                enableSync = false,
                diagonalsEnabled = false,
                tileCosts = {},
                additionalCosts = {},
                directionalConditions = {},
                maxIterations = Number.MAX_VALUE,
                avoidingPoints = {},
                cornerCuttingEnabled = true,
                paths = {},
                pathQueue = [];
            this.setAcceptableTiles = function (tiles) {
                if (Array.isArray(tiles)) {
                    acceptableTiles = tiles;
                } else if (!isNaN(parseFloat(tiles)) && isFinite(tiles)) {
                    acceptableTiles = [tiles];
                }
            };
            this.enableSync = function () {
                enableSync = true;
            };
            this.disableSync = function () {
                enableSync = false;
            };
            this.enableDiagonals = function () {
                diagonalsEnabled = true;
            };
            this.disableDiagonals = function () {
                diagonalsEnabled = false;
            };
            this.setGrid = function (newGrid) {
                grid = newGrid;
                tileCosts = {};
                for (let row = 0; row < grid.length; row++) {
                    for (let col = 0; col < grid[0].length; col++) {
                        tileCosts[grid[row][col]] = 1;
                    }
                }
            };
            this.setTileCost = function (tile, cost) {
                if (acceptableTiles && !acceptableTiles.includes(tile)) {
                    throw new Error(`Tile ${tile} is not in the acceptableTiles list.`);
                }
                tileCosts[tile] = cost;
            };
            this.setAdditionalPointCost = function (x, y, cost) {
                additionalCosts[y] = additionalCosts[y] || {};
                additionalCosts[y][x] = cost;
            };
            this.removeAdditionalPointCost = function (x, y) {
                if (additionalCosts[y]) {
                    delete additionalCosts[y][x];
                }
            };
            this.removeAllAdditionalPointCosts = function () {
                additionalCosts = {};
            };
            this.setDirectionalCondition = function (x, y, directions) {
                directionalConditions[y] = directionalConditions[y] || {};
                directionalConditions[y][x] = directions;
            };
            this.removeAllDirectionalConditions = function () {
                directionalConditions = {};
            };
            this.setIterationsPerCalculation = function (iterations) {
                maxIterations = iterations;
            };
            this.avoidAdditionalPoint = function (x, y) {
                avoidingPoints[y] = avoidingPoints[y] || {};
                avoidingPoints[y][x] = true;
            };
            this.stopAvoidingAdditionalPoint = function (x, y) {
                if (avoidingPoints[y]) {
                    delete avoidingPoints[y][x];
                }
            };
            this.enableCornerCutting = function () {
                cornerCuttingEnabled = true;
            };
            this.disableCornerCutting = function () {
                cornerCuttingEnabled = false;
            };
            this.stopAvoidingAllAdditionalPoints = function () {
                avoidingPoints = {};
            };
            this.findPath = function (startX, startY, endX, endY, callback) {
                if (!acceptableTiles) {
                    throw new Error("You must call setAcceptableTiles() before findPath().");
                }
                if (!grid) {
                    throw new Error("You must call setGrid() before findPath().");
                }
                if (startX < 0 || startY < 0 || endX < 0 || endY < 0 || startX >= grid[0].length || startY >= grid.length || endX >= grid[0].length || endY >= grid.length) {
                    throw new Error("Start or end point is outside the scope of your grid.");
                }
                if (startX === endX && startY === endY) {
                    return callback([]);
                }
                const endTile = grid[endY][endX];
                if (!acceptableTiles.includes(endTile)) {
                    return callback(null);
                }
                const pathId = instanceIdCounter++;
                const pathFinder = {
                    openList: new MinHeap((a, b) => a.estimatedTotalCost - b.estimatedTotalCost),
                    isDone: false,
                    nodeMap: {},
                    startX,
                    startY,
                    endX,
                    endY,
                    callback,
                };
                pathFinder.openList.push(createNode(pathFinder, startX, startY, null, 0));
                paths[pathId] = pathFinder;
                pathQueue.push(pathId);

                return pathId;
            };
            this.cancelPath = function (pathId) {
                if (paths[pathId]) {
                    delete paths[pathId];
                    return true;
                }
                return false;
            };
            this.calculate = function () {
                if (pathQueue.length > 0 && grid && acceptableTiles) {
                    for (let i = 0; i < maxIterations; i++) {
                        if (pathQueue.length === 0) return;
                        if (enableSync) i = 0;
                        const pathId = pathQueue[0];
                        const pathFinder = paths[pathId];
                        if (pathFinder && !pathFinder.isDone) {
                            const currentNode = pathFinder.openList.pop();
                            if (currentNode) {
                                if (currentNode.x === pathFinder.endX && currentNode.y === pathFinder.endY) {
                                    const path = [];
                                    let node = currentNode;
                                    while (node) {
                                        path.push({ x: node.x, y: node.y });
                                        node = node.parent;
                                    }
                                    path.reverse();
                                    pathFinder.callback(path);
                                    pathFinder.isDone = true;
                                    delete paths[pathId];
                                    pathQueue.shift();
                                } else {
                                    expandNode(pathFinder, currentNode);
                                }
                            } else {
                                pathQueue.shift();
                            }
                        }
                    }
                }
            };
            function expandNode(pathFinder, node) {
                const directions = [
                    [0, -1], // up
                    [1, 0], // right
                    [0, 1], // down
                    [-1, 0], // left
                ];
                if (diagonalsEnabled) {
                    directions.push(
                        [-1, -1], // up-left
                        [1, -1], // up-right
                        [1, 1], // down-right
                        [-1, 1] // down-left
                    );
                }
                directions.forEach(([dx, dy]) => {
                    const newX = node.x + dx;
                    const newY = node.y + dy;
                    if (isValidTile(newX, newY, node, pathFinder)) {
                        const movementCost = (dx === 0 || dy === 0) ? 1 : 1.4;
                        const tileCost = getTileCost(newX, newY);
                        const totalCost = node.costSoFar + movementCost * tileCost;

                        let neighbor = getNode(pathFinder, newX, newY);
                        if (!neighbor) {
                            neighbor = createNode(pathFinder, newX, newY, node, totalCost);
                            pathFinder.openList.push(neighbor);
                        } else if (totalCost < neighbor.costSoFar) {
                            neighbor.parent = node;
                            neighbor.costSoFar = totalCost;
                            neighbor.estimatedTotalCost = totalCost + getHeuristic(newX, newY, pathFinder.endX, pathFinder.endY);
                            pathFinder.openList.updateItem(neighbor);
                        }
                    }
                });
            }
            function getTileCost(x, y) {
                let cost = tileCosts[grid[y][x]] || 1;
                if (additionalCosts[y] && additionalCosts[y][x] !== undefined) {
                    cost += additionalCosts[y][x];
                }
                return cost;
            }
            function getNode(pathFinder, x, y) {
                return pathFinder.nodeMap[`${x}-${y}`];
            }
            function createNode(pathFinder, x, y, parent, costSoFar) {
                const estimatedTotalCost = costSoFar + getHeuristic(x, y, pathFinder.endX, pathFinder.endY);
                const node = new Node(x, y, parent, costSoFar, estimatedTotalCost);
                pathFinder.nodeMap[`${x}-${y}`] = node;
                return node;
            }
            function isValidTile(x, y, fromNode, pathFinder) {
                if (x < 0 || y < 0 || x >= grid[0].length || y >= grid.length) return false;
                const tile = grid[y][x];
                if (!acceptableTiles.includes(tile)) return false;
                if (avoidingPoints[y] && avoidingPoints[y][x]) return false;
                if (directionalConditions[y] && directionalConditions[y][x]) {
                    const validDirections = directionalConditions[y][x];
                    const dx = x - fromNode.x;
                    const dy = y - fromNode.y;
                    if (!validDirections.includes(getDirection(dx, dy))) return false;
                }
                if (!cornerCuttingEnabled) {
                    if (x !== fromNode.x && y !== fromNode.y) {
                        if (
                            !acceptableTiles.includes(grid[fromNode.y][x]) ||
                            !acceptableTiles.includes(grid[y][fromNode.x])
                        ) {
                            return false;
                        }
                    }
                }
                return true;
            }
            function getDirection(dx, dy) {
                if (dx === 0 && dy === -1) return "up";
                if (dx === 1 && dy === 0) return "right";
                if (dx === 0 && dy === 1) return "down";
                if (dx === -1 && dy === 0) return "left";
                if (dx === -1 && dy === -1) return "up-left";
                if (dx === 1 && dy === -1) return "up-right";
                if (dx === 1 && dy === 1) return "down-right";
                if (dx === -1 && dy === 1) return "down-left";
            }
            function getHeuristic(x1, y1, x2, y2) {
                const dx = Math.abs(x1 - x2);
                const dy = Math.abs(y1 - y2);
                return dx + dy;
            }
        };
    },
    function (module, exports) {
        function Node(x, y, parent, costSoFar, estimatedTotalCost) {
            this.x = x;
            this.y = y;
            this.parent = parent;
            this.costSoFar = costSoFar;
            this.estimatedTotalCost = estimatedTotalCost;
        }
        module.exports = Node;
    },
    function (module, exports) {
        const MinHeap = (function () {
            function MinHeap(compare) {
                this.heap = [];
                this.compare = compare;
            }
            MinHeap.prototype.push = function (item) {
                this.heap.push(item);
                this.bubbleUp(this.heap.length - 1);
            };
            MinHeap.prototype.pop = function () {
                const result = this.heap[0];
                const end = this.heap.pop();
                if (this.heap.length > 0) {
                    this.heap[0] = end;
                    this.sinkDown(0);
                }
                return result;
            };
            MinHeap.prototype.size = function () {
                return this.heap.length;
            };
            MinHeap.prototype.updateItem = function (item) {
                const index = this.heap.indexOf(item);
                if (index !== -1) {
                    this.bubbleUp(index);
                    this.sinkDown(index);
                }
            };
            MinHeap.prototype.bubbleUp = function (n) {
                const element = this.heap[n];
                while (n > 0) {
                    const parentN = Math.floor((n + 1) / 2) - 1;
                    const parent = this.heap[parentN];
                    if (this.compare(element, parent) >= 0) {
                        break;
                    }
                    this.heap[parentN] = element;
                    this.heap[n] = parent;
                    n = parentN;
                }
            };
            MinHeap.prototype.sinkDown = function (n) {
                const length = this.heap.length;
                const element = this.heap[n];

                while (true) {
                    const child2N = (n + 1) * 2;
                    const child1N = child2N - 1;
                    let swap = null;

                    if (child1N < length) {
                        const child1 = this.heap[child1N];
                        if (this.compare(child1, element) < 0) {
                            swap = child1N;
                        }
                    }
                    if (child2N < length) {
                        const child2 = this.heap[child2N];
                        if (this.compare(child2, swap === null ? element : this.heap[child1N]) < 0) {
                            swap = child2N;
                        }
                    }
                    if (swap === null) break;

                    this.heap[n] = this.heap[swap];
                    this.heap[swap] = element;
                    n = swap;
                }
            };
            return MinHeap;
        })();
        module.exports = MinHeap;
    },
]);
let pathFindTest = 0;
let grid = [];
const easystar = new EasyStar.Pathfinder();
function Pathfinder() {
    pathFind.scale = (config.maxScreenWidth / 2) * 1.3;

    if (!track.inTrap && (pathFind.chaseNear ? enemy.length : true)) {
        if (near.dist2 <= items.weapons[player.weapons[0]].range) {
            packet("9", undefined, 1);
            return;
        }

        createPath();

        if (!grid || !Array.isArray(grid) || grid.length === 0) {
            console.error("Invalid grid setup:", grid);
            return;
        }

        easystar.setGrid(grid);

        const acceptableTiles = [0];
        if (track.inTrap) {
            acceptableTiles.push(2);
        }
        easystar.setAcceptableTiles(acceptableTiles);
        easystar.enableDiagonals();

        const startX = Math.floor(grid[0].length / 2);
        const startY = Math.floor(grid.length / 2);
        const targetX = pathFind.lastX;
        const targetY = pathFind.lastY;

        /*console.log("Pathfinder Start:", startX, startY);
        console.log("Pathfinder Target:", targetX, targetY);*/

        easystar.findPath(startX, startY, targetX, targetY, function (path) {
            if (path === null) {
                console.warn("Pathfinding failed: No path found.");
                pathFind.array = [];

                if (retryPathfinding(startX, startY, targetX, targetY)) {
                    console.log("Retrying pathfinding with fallback strategy.");
                } else {
                    if (near.dist2 <= items.weapons[player.weapons[0]].range) {
                        packet("9", undefined, 1);
                    } else {
                        packet("9", near.aim2, 1);
                    }
                }
            } else {
                pathFind.array = path;

                if (pathFind.array.length > 1) {
                    const nextStep = path[1];
                    const tmpXY = {
                        x: (player.x2 - (pathFind.scale / 2)) + ((pathFind.scale / pathFind.grid) * nextStep.x),
                        y: (player.y2 - (pathFind.scale / 2)) + ((pathFind.scale / pathFind.grid) * nextStep.y)
                    };

                    console.log("Next Step:", nextStep);
                    console.log("Translated Coordinates:", tmpXY);

                    if (checkForObstacles(tmpXY)) {
                        console.warn("Obstacle detected, recalculating path.");
                        pathFind.array = [];
                        easystar.calculate();
                        return;
                    }

                    packet("9", UTILS.getDirect(tmpXY, player, 0, 2), 1);
                }
            }
        });

        easystar.calculate();
    }
}

function retryPathfinding(startX, startY, targetX, targetY) {
    easystar.setAcceptableTiles([0, 1]);

    let fallbackPathFound = false;

    easystar.findPath(startX, startY, targetX, targetY, function (path) {
        if (path !== null) {
            fallbackPathFound = true;
            pathFind.array = path;
            console.log("Fallback path found:", path);
        }
    });

    easystar.calculate();
    return fallbackPathFound;
}

function checkForObstacles(position) {
    return gameObjects.some(obj =>
                            obj.active &&
                            obj.dmg &&
                            UTILS.getDistance(obj, position) <= obj.getScale() + 35
                           );
}
easystar.enableDiagonals();
easystar.setIterationsPerCalculation(1000);
setInterval(() => {
    easystar.calculate();
}, 100);

// MOVEMENT:
function move(dir) {
    packet("9", dir, 1);
}

function setMoveDir(dir) {
    move(dir);

    game.tickBase(() => {
        move(lastMoveDir);
    },1);
}
/*
    if (combatdefensetoggle.safewalkb) {
    if (traps.inTrap) return;
    let aspike = closeObjects.find(obj => obj.name == 'boost pad' && obj.active && !obj.isTeamObject(player) && UTILS.getDist(obj, player, 0, 3) <= (player.scale * 2 + obj.getScale()));
    let spikeDir = UTILS.getDirect(aspike, player, 0, 2);
    setMoveDir(spikeDir + Math.PI);
}
    if (combatdefensetoggle.safewalkt) {
    if (traps.inTrap) return;
    let aspike = closeObjects.find(obj => obj.name == 'teleporter' && obj.active && !obj.isTeamObject(player) && UTILS.getDist(obj, player, 0, 3) <= (player.scale * 2 + obj.getScale()));
    let spikeDir = UTILS.getDirect(aspike, player, 0, 2);
    setMoveDir(spikeDir + Math.PI);
}*/
// DDODGE OBJECTS:
const dodgeSpike = () => {
    let objects_buildings = gameObjects.filter(obj => obj.active && !obj.isTeamObject(player));
    let aboost = objects_buildings.find(obj => {let distLimit = (player.scale * 2.5 + obj.getScale());return obj.name == 'boost pad' &&UTILS.getDist(obj, player, 0, 3) <= distLimit;});
    let atp = objects_buildings.find(obj => {let distLimit = (player.scale * 3.5 + obj.getScale());return obj.name == 'teleporter' &&UTILS.getDist(obj, player, 0, 3) <= distLimit;});
    let aspike = closeObjects.find(obj =>obj.dmg && obj.active && !obj.isTeamObject(player) &&UTILS.getDist(obj, player, 0, 3) <= (player.scale * 2 + obj.getScale()));
    if (!traps.inTrap) {
        if (aspike && combatdefensetoggle.safewalk) {
            let spikeDir = UTILS.getDirect(aspike, player, 0, 2);
            setMoveDir(spikeDir + Math.PI);
        } else if (aboost && combatdefensetoggle.safewalkb) {
            let boostDir = UTILS.getDirect(aboost, player, 0, 2);
            setMoveDir(boostDir + Math.PI);
        } else if (atp && combatdefensetoggle.safewalkt) {
            let boostDir = UTILS.getDirect(atp, player, 0, 2);
            setMoveDir(boostDir + Math.PI);
        }
    }
};

// AUTOPUSH:
function autoPush() {
    let nearTrap = closeObjects.filter(tmp => tmp.trap && tmp.active && tmp.isTeamObject(player) && UTILS.getDist(tmp, near, 0, 2) <= (near.scale + tmp.getScale() + 15)).sort(function(a, b) {
        return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
    })[0];

    const forceStop = () => {
        if (track.pushdata.autoPush) {
            packet("9", undefined, 1);
        }
        track.pushdata.autoPush = false;
        pathFind.active = false;
        pathFind.chaseNear = false;
        window.currentPushSpike = null;
    };

    if (!nearTrap) return forceStop();

    let ifNearSpikes = closeObjects.some(tmp => tmp.dmg && tmp.active && !tmp.isTeamObject(player) && UTILS.getDist(tmp, nearTrap, 0, 0) <= (near.scale + nearTrap.scale + tmp.scale + 5));
    if (ifNearSpikes) return forceStop();

    let spike = closeObjects.filter(tmp => tmp.dmg && tmp.active && tmp.isTeamObject(player) && UTILS.getDist(tmp, nearTrap, 0, 0) <= (near.scale + nearTrap.scale + tmp.scale + 5)).sort(function(a, b) {
        return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
    })[0];

    if (!spike) return forceStop();

    window.currentPushSpike = spike;

    let distToSpike = UTILS.getDist(near, spike, 2, 0);
    let isTouching = objectManager.checkCollision2(near, spike);

    // --- YENİLƏNMİŞ DAYANMA MƏNTİQİ ---
    // Əgər düşmən toqquşursa VƏ məsafə çox kiçikdirsə dayan.
    // Amma düşmən ordan sürüşüb uzaqlaşsa (distToSpike artarsa), bu şərt pozulacaq
    // və aşağıdakı hərəkət kodu yenidən işə düşəcək.
    if (isTouching && distToSpike < (near.scale + spike.getScale() + 5)) {
        forceStop();
        return;
    }

    let pos = {
        x: spike.x + (250 * Math.cos(UTILS.getDirect(near, spike, 2, 0))),
        y: spike.y + (250 * Math.sin(UTILS.getDirect(near, spike, 2, 0))),
        x2: spike.x + ((distToSpike + player.scale) * Math.cos(UTILS.getDirect(near, spike, 2, 0))),
        y2: spike.y + ((distToSpike + player.scale) * Math.sin(UTILS.getDirect(near, spike, 2, 0)))
    };

    let finds = gameObjects.filter(tmp => tmp.active).find((tmp) => {
        let tmpScale = tmp.getScale();
        if (!tmp.ignoreCollision && UTILS.lineInRect(tmp.x - tmpScale, tmp.y - tmpScale, tmp.x + tmpScale, tmp.y + tmpScale, player.x2, player.y2, pos.x2, pos.y2)) {
            return true;
        }
    });

    if (finds && near.dist2 >= 110) {
        return forceStop();
    } else {
        // Əgər bura çatdıqsa, deməli düşmən ya hələ dəyməyib, ya da ordan qaçıb.
        // Ona görə də autoPush-u yenidən aktiv edirik.
        pathFind.active = false;
        pathFind.chaseNear = false;
        track.pushdata.autoPush = true;

        let angle = Math.atan2(near.y2 - spike.y, near.x2 - spike.x);
        let point = {
            x: near.x2 + Math.cos(angle) * 53,
            y: near.y2 + Math.sin(angle) * 53,
        };

        if (distToSpike >= 105) {
            if (UTILS.lineInRect(player.x2 - (player.scale/10), player.y2 - (player.scale/10), player.x2 + (player.scale/10), player.y2 + (player.scale/10), near.x2, near.y2, pos.x, pos.y)) {
                packet("9", near.aim2, 1);
            } else {
                packet("9", UTILS.getDirect(pos, player, 2, 2), 1);
            }
        } else {
            packet("9", Math.atan2(point.y - player.y2, point.x - player.x2), 1);
        }
    }
}

// ADD DEAD PLAYER:
function addDeadPlayer(tmpObj) {
    deadPlayers.push(new DeadPlayer(tmpObj.x, tmpObj.y, tmpObj.dir, tmpObj.buildIndex, tmpObj.weaponIndex, tmpObj.weaponVariant, tmpObj.skinColor, tmpObj.scale, tmpObj.name));
}

/** APPLY SOCKET CODES */

// SET INIT DATA:
function setInitData(data) {
    alliances = data.teams;
}

// SETUP GAME:
function setupGame(yourSID) {
    keys = {};
    macro = {};
    playerSID = yourSID;
    attackState = 0;
    inGame = true;
    packet("F", 0, getAttackDir(), 1);
    my.ageInsta = true;
    my.ageInsta2 = true;
    if (firstSetup) {
        firstSetup = false;
        gameObjects.length = 0;
        closeObjects.length = 0;
    }
}

// ADD NEW PLAYER:


function addPlayer(data, isYou) {
    let near = findPlayerByID(data[0]);
    if (!near) {
        near = new Player(data[0], data[1], config, UTILS, projectileManager,
                          objectManager, players, ais, items, hats, accessories);
        players.push(near);
        if (data[1] != playerSID) {
            pushNotify(`${data[2]} {${data[1]}} Joined`, "#fff");
        }
    } else {
        if (data[1] != playerSID) {
            pushNotify(`Found ${data[2]} {${data[1]}}`, "#fff");
        }
    }

    // Orijinal kodun davamı...
    near.spawn(isYou ? true : null);
    near.visible = false;
    near.oldPos = { x2: undefined, y2: undefined };
    near.x2 = undefined; near.y2 = undefined;
    near.setData(data);
    if (isYou) {
        player = near; camX = player.x; camY = player.y;
        updateItems(); updateAge();
    }

    near.spawn(isYou ? true : null);
    near.visible = false;
    near.oldPos = {
        x2: undefined,
        y2: undefined
    };
    near.x2 = undefined;
    near.y2 = undefined;
    near.x3 = undefined;
    near.y3 = undefined;
    near.setData(data);
    if (isYou) {
        player = near;
        camX = player.x;
        camY = player.y;
        my.lastDir = 0;
        updateItems();
        updateAge();
        updateItemCountDisplay();
        if (player.skins[7]) {
            my.reSync = true;
        }
    }
    }

// REMOVE PLAYER:
function removePlayer(id) {
    for (let i = 0; i < players.length; i++) {
        if (players[i].id == id) {
            // Vizual bildiriş
            pushNotify(`${players[i].name} {${players[i].sid}} Left the game`, "#ff4444");

            // Köhnə menyu çatı (olduğu kimi qalır)
            addMenuChText("Game", players[i].name + "[" + players[i].sid + "] left the game", "red");

            players.splice(i, 1);
            break;
        }
    }
}
// dune mod dmgpot
function sortWeaponVariant(id) {
    switch (id) {
        case 0:
            return 1
            break;
        case 1:
            return 1.1
            break;
        case 2:
            return 1.18
            break;
        case 3:
            return 1.18
            break;
        default:
            return 1
            break;
    }
}
function sortSecondaryAmmoDamage(weapon) {
    switch (weapon) {
        case 10:
            return 12
            break
        case 15:
            return 50
            break;
        case 9:
            return 25
            break;
        case 12:
            return 35
            break;
        case 13:
            return 30
            break;
        default:
            return 0
    }
}
let antiinsta = true;
let antiinsta1 = false;
function heal() {
    for (let i = 0; i < Math.ceil((100 - player.health) / items.list[player.items[0]].healing); i++) {
        place(0, getAttackDir());
    }
}
function healer1() {
    place(0, getAttackDir());
    return Math.ceil((100 - player.health) / items.list[player.items[0]].healing);
}
// UPDATE HEALTH:
function updateHealth2(sid, value) {
    let _ = findPlayerBySID(sid);
    let secondary = {
        weapon: this.secondaryIndex,
        variant: this.secondaryVariant
    };
    if (!_) return;

    if (_) {
        _.oldHealth = _.health;
        _.health = value;
        _.judgeShame();
        if (_.oldHealth > _.health) {
            _.timeDamaged = Date.now();
            _.damaged = _.oldHealth - _.health;
            let damaged = _.damaged;
            _ = findPlayerBySID(sid);
            let bullTicked = false;
            if (_.health <= 0) {
                if (!_.death) {
                    _.death = true;
                    addDeadPlayer(_);
                }
            }
            if (_ == player) {
                if (_.skinIndex == 7 && (damaged == 5 || (_.latestTail == 13 && damaged == 2))) {
                    if (my.reSync) {
                        my.reSync = false;
                        _.setBullTick = true;
                    }
                    bullTicked = true;
                }
                let antiinsta = true;
                let antiinsta1 = false;


                let EmpAnti = (player.empAnti);
                let antiinsta3 = true;
                let autoheal = false;
                let antiinsta4 = true;
                let healTimeout = 85;
                let attackers = getAttacker(damaged);
                let gearDmgs = [0.25, 0.45].map((val) => val * items.weapons[player.weapons[0]].dmg);
                let includeSpikeDmgs = near.length ? !bullTicked && (gearDmgs.includes(damaged) && near[0].skinIndex == 11 && near[0].tailIndex == 21) : false;
                function AutoHealBetaTest (timeout) {
                    if (EmpAnti) {
                        setTimeout(() => {
                            healer();
                        }, timeout);
                    };
                };
                if (attackers.length) {
                    let by = attackers.filter(tmp => {
                        if (tmp.dist2 <= (tmp.weaponIndex < 9 ? 300 : 700)) {
                            tmpDir = UTILS.getDirect(player, tmp, 2, 2);
                            if (UTILS.getAngleDist(tmpDir, tmp.d2) <= Math.PI) {
                                return tmp;
                            }
                        }
                    });
                    if (healTimeout && player.dmg) {
                        if (healTimeout) {
                            healTimeout = (65 || 80);
                            if (by.length) {
                                let maxDamage = includeSpikeDmgs ? 10 : 10;
                                if (damaged > maxDamage && game.tick - _.antiTimer > 1) {
                                    _.canEmpAnti = true;
                                    _.antiTimer = game.tick;
                                    let shame = 4;
                                    if (_.shameCount < shame) {
                                        healer();
                                    } else {
                                        AutoHealBetaTest(healTimeout);
                                    }
                                } else {
                                    AutoHealBetaTest(healTimeout);
                                }
                            } else {
                                AutoHealBetaTest(healTimeout);
                            }
                        };
                    };
                };
                if (inGame) {
                    let shame = _.weapons[0] == 4 ? 2 : 5;
                    let damageThreatCondition = damaged >= (includeSpikeDmgs ? 8 : 20) && _.damageThreat >= 20;
                    if (damageThreatCondition && antiinsta4 && (game.tick - _.antiTimer) > 1) {
                    }
                    if (damageThreatCondition && autoheal) {
                        setTimeout(() => {
                            healer();
                        }, 120);
                    }
                    if (damageThreatCondition && antiinsta && _.primaryIndex !== "4" && (game.tick - _.antiTimer) > 1);
                    if (damaged >= 20 && player.skinIndex == 11 && player.shameCount <= 3) {
                        instaC.canCounter = true;
                    }
                    if (damaged >= 0 && damaged <= 66 && player.shameCount === 4 && _.primaryIndex !== "4") {
                        autoheal = true;
                        antiinsta = false;
                        antiinsta1 = false;
                        antiinsta4 = false;
                    } else if (player.shameCount !== 4) {
                        autoheal = false;
                        antiinsta = true;
                        antiinsta4 = true;
                    }
                    if (damaged <= 66 && player.shameCount === 3 && _.primaryIndex !== "4") {
                        antiinsta = false;
                    } else if (player.shameCount !== 3) {
                        antiinsta = true;
                    }
                    if (damaged <= 66 && player.shameCount === 4 && _.primaryIndex !== "4") {
                        antiinsta1 = true;
                    } else if (player.shameCount !== 4) {
                        antiinsta1 = false;
                    }
                    if (damaged <= 66 && player.skinIndex != 6 && enemy.weaponIndex === 4) {
                        game.tickBase(() => {
                            healer1();
                        }, 2);
                    }
                };
                let dmg = 100 - player.health;
                if (damaged >= (includeSpikeDmgs ? 8 : 20) && _.damageThreat >= 20 && antiinsta4 && (game.tick - _.antiTimer) > 1) {
                    if (_.reloads[53] == 0 && _.reloads[_.weapons[1]] == 0) {
                        _.canEmpAnti = true;
                    } else {
                        player.soldierAnti = true;
                    }
                    _.antiTimer = game.tick;
                    let shame = _.weapons[0] == 4 ? 2 : 5;
                    if (_.shameCount < shame) {
                        healer();
                    } else {
                        game.tickBase(() => {
                            healer();
                        }, 2);
                    }
                    if (damaged >= (includeSpikeDmgs ? 8 : 20) && _.damageThreat >= 20 && autoheal) {
                        setTimeout(() => {
                            healer();
                        }, 120);
                    }
                    let dmg = 100 - player.health;
                    if (damaged >= (includeSpikeDmgs ? 8 : 20) && _.damageThreat >= 20 && antiinsta && _.primaryIndex !== "4" && (game.tick - _.antiTimer) > 1) {
                        if (_.reloads[53] == 0 && _.reloads[_.weapons[1]] == 0) {
                            _.canEmpAnti = true;
                        } else {
                            player.soldierAnti = true;
                        }
                        _.antiTimer = game.tick;
                        let shame = _.weapons[0] == 4 ? 2 : 5;
                        if (_.shameCount < shame) {
                            healer();
                        } else {
                            game.tickBase(() => {
                                healer();
                            }, 2);
                        }
                    }
                    if (damaged >= 20 && player.skinIndex == 11 && player.shameCount <= 3) instaC.canCounter = true;
                } else {
                    game.tickBase(() => {
                        healer();
                    }, 2);
                }
            } else {
                _.maxShameCount = Math.max(_.maxShameCount, _.shameCount);
            }
        } else if (!_.setPoisonTick && (_.damaged == 5 || (_.latestTail == 13 && _.damaged == 2))) {
            _.setPoisonTick = true;
        }
    }
    if (nears.length && _.shameCount <= 5 && nears.some(items => [9, 12, 17, 15].includes(secondary.weapon))) {
        if (near.reloads[near.secondaryIndex] == 0) {
            my.empAnti = true;
            my.soldierAnti = false;
        } else {
            my.soldierAnti = true
            my.empAnti = false;
        }
    }
}
let lastSp;
// KILL PLAYER:
function killPlayer() {
    inGame = false;
    lastDeath = {
        x: player.x,
        y: player.y,
    };
    getEl("diedText").style.display = "block";
  if(misctoggle.auto_spawn) {
      packet("M", {
        name: lastsp[0],
        moofoll: lastsp[1],
        skin: lastsp[2]
    });
  }
}

// UPDATE PLAYER ITEM VALUES:
function updateItemCounts(index, value) {
    if (player) {
        player.itemCounts[index] = value;
        updateItemCountDisplay(index);
    }
}

// UPDATE AGE:
function updateAge(xp, mxp, age) {
    if (xp != undefined) player.XP = xp;
    if (mxp != undefined) player.maxXP = mxp;
    if (age != undefined) player.age = age;
}

// UPDATE UPGRADES:
function updateUpgrades(points, age) {
    player.upgradePoints = points;
    player.upgrAge = age;
    if (points > 0) {
        tmpList.length = 0;
        UTILS.removeAllChildren(upgradeHolder);
        for (let i = 0; i < items.weapons.length; ++i) {
            if (items.weapons[i].age == age && (items.weapons[i].pre == undefined || player.weapons.indexOf(items.weapons[i].pre) >= 0)) {
                let e = UTILS.generateElement({
                    id: "upgradeItem" + i,
                    class: "actionBarItem",
                    onmouseout: function() {
                        showItemInfo();
                    },
                    parent: upgradeHolder
                });
                e.style.backgroundImage = getEl("actionBarItem" + i).style.backgroundImage;
                tmpList.push(i);
            }
        }
        for (let i = 0; i < items.list.length; ++i) {
            if (items.list[i].age == age && (items.list[i].pre == undefined || player.items.indexOf(items.list[i].pre) >= 0)) {
                let tmpI = (items.weapons.length + i);
                let e = UTILS.generateElement({
                    id: "upgradeItem" + tmpI,
                    class: "actionBarItem",
                    onmouseout: function() {
                        showItemInfo();
                    },
                    parent: upgradeHolder
                });
                e.style.backgroundImage = getEl("actionBarItem" + tmpI).style.backgroundImage;
                tmpList.push(tmpI);
            }
        }
        for (let i = 0; i < tmpList.length; i++) {
            (function(i) {
                let tmpItem = getEl('upgradeItem' + i);
                // tmpItem.onmouseover = function() {
                //     if (items.weapons[i]) {
                //         showItemInfo(items.weapons[i], true);
                //     } else {
                //         showItemInfo(items.list[i - items.weapons.length]);
                //     }
                // };
                tmpItem.onclick = UTILS.checkTrusted(function() {
                    packet("H", i);
                });
                UTILS.hookTouchEvents(tmpItem);
            })(tmpList[i]);
        }
        if (tmpList.length) {
            upgradeHolder.style.display = "block";
            upgradeCounter.style.display = "block";
            upgradeCounter.innerHTML = "SELECT ITEMS (" + points + ")";
        } else {
            upgradeHolder.style.display = "none";
            upgradeCounter.style.display = "none";
            showItemInfo();
        }
    } else {
        upgradeHolder.style.display = "none";
        upgradeCounter.style.display = "none";
        showItemInfo();
    }
}
function toR(e) {
    var n = (e * Math.PI / 180) % (2 * Math.PI);
    return n > Math.PI ? Math.PI - n : n
}
function toD(e) {
    var n = (e / Math.PI * 360) % 360;
    return n >= 360 ? n - 360 : n;
}
let enemies = [];
const placedSpikePositions = new Set();
let PrePlaceCount = false;
// KILL OBJECT:
function killObject(sid) {
    let findObj = findObjectBySid(sid);
    objectManager.disableBySid(sid);

    if (findObj && player) {
        traps.replacer(findObj);
        if (!player.canSee(findObj)) {
            breakTrackers.push({
                x: findObj.x,
                y: findObj.y
            });
        }
        if (breakTrackers.length > 8) {
            breakTrackers.shift();
        }

        for (let position of placedSpikePositions) {
            let storedPosition = JSON.parse(position);
            let distToStoredPosition = Math.hypot(storedPosition[0] - findObj.x, storedPosition[1] - findObj.y);
            if (distToStoredPosition <= 80) {
                placedSpikePositions.delete(position);
                break;
            }
        }
        traps.replacer(findObj);
    }
}

// KILL ALL OBJECTS BY A PLAYER:
function killObjects(sid) {
    // addChatLog(findPlayerBySID(sid).name + " has left", "red", "", "red");
    if (player) objectManager.removeAllItems(sid);
}
function isAlly(sid, pSid) {
    tmpObj = findPlayerBySID(sid);
    if (!tmpObj) {
        return;
    }
    if (pSid) {
        let pObj = findPlayerBySID(pSid);
        if (!pObj) {
            return;
        }
        if (pObj.sid == sid) {
            return true;
        } else if (tmpObj.team) {
            return tmpObj.team === pObj.team ? true : false;
        } else {
            return false;
        }
    }
    if (!tmpObj) {
        return;
    }
    if (player.sid == sid) {
        return true;
    } else if (tmpObj.team) {
        return tmpObj.team === player.team ? true : false;
    } else {
        return false;
    }
}
function fgdo(a, b) {
    return Math.sqrt(Math.pow((b.y - a.y), 2) + Math.pow((b.x - a.x), 2));
}

function setTickout(doo, timeout) {
    if (!ticks.manage[ticks.tick + timeout]) {
        ticks.manage[ticks.tick + timeout] = [doo];
    } else {
        ticks.manage[ticks.tick + timeout].push(doo);
    }
}

function caf(e, t) {
    try {
        return Math.atan2((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
    } catch (e) {
        return 0;
    }
}

let found = false;
let autoQ = false;

// UPDATE PLAYER DATA:
let nEy;
let placeableSpikes = [];
let placeableTraps = [];
let placeableSpikesPREDICTS = [];
let DmgPotStuff = {
    predictedDamage: 0
};

function mgPotWorkfrfrfr() {
    DmgPotStuff.predictedDamage = 0;
    for (let i = 0; i < nears.length; i++) {
        let singleIndividual = nears[i];
        if (singleIndividual.primaryIndex != undefined) {
            if (singleIndividual.reloads[singleIndividual.weapons[0]] == 0) {
                DmgPotStuff.predictedDamage += items.weapons[singleIndividual.weapons[0]].dmg * sortWeaponVariant(singleIndividual.weaponVariant) * 1.5
            }
        } else {
            DmgPotStuff.predictedDamage += 45
        }
        if (singleIndividual.secondaryIndex != undefined) {
            if (singleIndividual.reloads[singleIndividual.weapons[1]] == 0) {
                if (items.weapons[singleIndividual.weapons[1]] == 10) {
                    DmgPotStuff.predictedDamage += items.weapons[singleIndividual.weapons[1]].dmg * sortWeaponVariant(singleIndividual.weaponVariant)
                } else {
                    DmgPotStuff.predictedDamage += items.weapons[singleIndividual.weapons[1]].Pdmg
                }
            }
        } else {
            DmgPotStuff.predictedDamage += 50
        }
        if (singleIndividual.reloads[53] == 0) {
            DmgPotStuff.predictedDamage += 25
        }
    }
    return DmgPotStuff.predictedDamage
}
let odfmsjfhvadsfyjkauhsfsa = false;
let odfmsjfhvadsfyjkauhsfsa2 = false;
let v292 = 0;
let v648 = false;
let healCD = false;
if(document.URL.includes('isAltPlayer')){
    document.querySelector("#resDisplay").querySelectorAll('*').forEach((e)=>{
        if(e.id!=='scoreDisplay'){
            e.style.display = 'none'
        }
    })
    document.querySelector('#allianceButton').style.position = 'fixed';
    document.querySelector('#allianceButton').style.top = '0';
    document.querySelector('#allianceButton').style.right = '0';


}

let altPlayerManager = {
    activator: [],
    iframe: null,
    iframeActive: false,
    mode: 'sync',
};



document.addEventListener('keydown', (e) => {
    if (e.key === 1 && document.activeElement.id.toLowerCase() !== "chatbox") {
        e.preventDefault();
        if (altPlayerManager.iframeActive) {
            altPlayerManager.iframe.contentWindow.focus();
        } else {
            window.focus();
        }
        altPlayerManager.iframeActive = !altPlayerManager.iframeActive;
    }
});
const WompWomp = {
    trap:new Image(),
    spike:new Image(),
    spikeBreakSid: -1
}
WompWomp.trap.src = 'https://images.vexels.com/content/209028/preview/simple-hexagon-label-3f3168.png';
WompWomp.spike.src = 'https://cdn-icons-png.flaticon.com/512/279/279951.png'
top.customPlayerRange = 200;
top.customTeammateRange = 200;
let spamCounts = 0;
function HKH () {
    my.autoAim = true;
    sendAutoGather();
    buyEquip(53, 0);
    selectWeapon(player.weapons[1]);
    game.tickBase(() => {
        buyEquip(7, 0);
        selectWeapon(player.weapons[0]);
        game.tickBase(() => {
            sendAutoGather();
            my.autoAim = false;
        }, 1);
    }, 1);
}
let pathFind = {
    active: false,
    grid: 40,
    scale: 1440,
    x: 14400,
    y: 14400,
    chaseNear: false,
    array: [],
    lastX: this.grid / 2,
    lastY: this.grid / 2
};
let Stopped = false;
let turretEmp = 0;


let breakSpike = {
    active: false,
    info: {},
    x: 0, y: 0,
    aim: 0, dist: 0
};
function isInTrap(plyr) {
    return liztobj
        .filter(
        (e) =>
        e.trap &&
        e.active &&
        UTILS.getDist(e, plyr, 0, 2) <= 35 + e.getScale() + 5 &&
        !e.isTeamObject(plyr)
    )
        .sort(function (a, b) {
        return UTILS.getDist(a, plyr, 0, 2) - UTILS.getDist(b, plyr, 0, 2);
    })[0];
}
let trapSpike;
// UPDATE MAIN PLAYER DATA:
let client = new class {
    constructor() {
        // later remaded:
        this.reloaded = false;
        this.reSync = false;
        this.anti0Tick = 0;
        this.antiSync = false;
    }

    updateManageData(_) {
        if (_.skinIndex == 45) {
            if (_.shameTimer <= 0) _.addShameTimer();
        } else if (_.oldSkinIndex == 45) {
            _.shameTimer = 0;
            _.shameCount = 0;

            if (_ == player) {
                healer();
            }
        }


        if (_.weaponIndex < 9) {
            _.primaryIndex = _.weaponIndex;
            _.primaryVariant = _.weaponVariant;
        } else if (_.weaponIndex > 8) {
            _.secondaryIndex = _.weaponIndex;
            _.secondaryVariant = _.weaponVariant;
        }
    }

    hundleBreakObjects(_) {
        if (closeObjects.length) {
            let nearTrap = closeObjects.filter(e => e.trap && e.active && UTILS.getDist(e, _, 0, 2) <= (_.scale + e.getScale() + 5) && !e.isTeamObject(_)).sort(function (a, b) {
                return UTILS.getDist(a, _, 0, 2) - UTILS.getDist(b, _, 0, 2);
            })[0];

            let nearSpike = closeObjects.filter(e => e.dmg && e.active && objectManager.canHit(_, e, _.weapons[1] == 10 ? _.weapons[1] : _.weapons[0]) && !e.isTeamObject(_))
            .sort((a, b) => UTILS.getDist(a, _, 0, 2) - UTILS.getDist(b, _, 0, 2))[0];

            if (_ == player) {
                let spike = closeObjects.filter(e => (/spik/.test(e.name || e.dmg) && e.active && UTILS.getDist(e, player, 0, 3) <= player.scale + e.scale + 40 && !e.isTeamObject(player))).sort((a, b) => UTILS.getDist(a, player, 0, 2) - UTILS.getDist(b, player, 0, 2))[0];

                if (nearTrap) {
                    trapSpike = gameObjects.find(
                        (obj) => obj.dmg && cdf(tmpObj, obj) <= tmpObj.scale + obj.scale
                    );
                    let spike = gameObjects.filter(
                        (obj) =>
                        obj.dmg &&
                        cdf(tmpObj, obj) <= tmpObj.scale + nearTrap.scale / 2 &&
                        !obj.isTeamObject(tmpObj) &&
                        obj.active
                    )[0];
                    traps.protect(caf(nearTrap, tmpObj) - Math.PI);
                    traps.dist = UTILS.getDist(nearTrap, _, 0, 2);
                    traps.aim = UTILS.getDirect(spike ? spike : nearTrap, tmpObj, 0, 2);

                    traps.inTrap = true;
                    traps.info = [nearTrap, nearSpike];
                    traps.hasSpike = nearSpike ? true : false;
                } else {
                    if (traps.inTrap && near.dist2 < 200) {
                        healer();
                        ShowSettingText(500, "outOfTrap Healing");
                    }

                    traps.inTrap = false;
                    traps.info = {};
                }

                if (spike) {
                    breakSpike.active = true;
                    breakSpike.info = spike;

                    breakSpike.x = spike.x;
                    breakSpike.y = spike.y;

                    breakSpike.aim = UTILS.getDirect(spike, player, 0, 2);
                    breakSpike.dist = UTILS.getDist(spike, player, 0, 2);
                } else {
                    breakSpike.active = false;
                    breakSpike.info = {};
                }
            } else {
                if (nearTrap) {
                    _.inTrap = nearTrap;
                } else {
                    _.inTrap = false;
                }
            }
        } else {
            if (_ == player) {
                breakSpike.active = false;
                traps.inTrap = false;
            } else {
                _.inTrap = false;
            }
        }
    }

    resetFlags() {
        if (instaC.ticking) {
            instaC.ticking = false;
        }
        if (instaC.syncHit) {
            instaC.syncHit = false;
        }
        if (player.empAnti) {
            player.empAnti = false;
        }
        if (player.soldierAnti) {
            player.soldierAnti = false;
        }
        if (my.anti0Tick > 0) {
            my.anti0Tick--;
        }
        if (traps.replaced) {
            traps.replaced = false;
        }
        if (traps.antiTrapped) {
            traps.antiTrapped = false;
        }
    }
}();
let nearInfo = [];
let queuedTicks = [];
function handleTick() {
    for (let i = 0; i < queuedTicks.length; i++) {
        queuedTicks[i]();
    }
    queuedTicks = [];
}
function queueCurrentTick(action) {
    queuedTicks.push(action);
}
const getPotentialDamage = (build, user) => {
    const getDistance = (x1, y1, x2, y2) => {
        let dx = x2 - x1;
        let dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
    };
    const weapIndex = user.weapons[1] === 10 && !player.reloads[user.weapons[1]] ? 1 : 0;
    const weap = user.weapons[weapIndex];
    if (player.reloads[weap]) return 0;
    const weapon = items.weapons[weap];
    const inDist = getDistance(build.x, build.y, user.x2, user.y2) <= build.getScale() + weapon.range;
    return (user.visible && inDist) ? weapon.dmg * (weapon.sDmg || 1) * 3.3 : 0;
};
setInterval (() => {
    handleTick()
}, 1e3/9)
const Preplace = () => {
    if (getEl("weaponGrind").checked || !combatplacetoggle.autoPrePlace) return;
    const preplaceable = [];
    const gameObjectCount = gameObjects.length;
    for (let i = 0; i < gameObjectCount; i++) {
        const build = gameObjects[i];
        if (build.isItem && build.active && build.health > 0) {
            let potentialDamage = players.reduce((total, p) => total + getPotentialDamage(build, p), 0);
            if (build.health <= potentialDamage) {
                preplaceable.push(build);
            }
        }
    }
    if (preplaceable.length < 1) return;
    preplaceable.sort((a, b) => a.health - b.health);
    let prioritizedObjects = traps.preplaceAngle(preplaceable, preplaceable[0]);
    for (let prioObject of prioritizedObjects) {
        if (UTILS.getDist(near, player, 2, 2) <= player.scale * 1.8 + items.weapons[player.weaponIndex].range + 50) {
            let [prioType, build] = prioObject;
            queueCurrentTick(() => {
                place(prioType === "spike" ? 2 : 4, UTILS.getDirect(build, player, 0, 2), 1, true);
                traps.replaced = false;
            });
        }
    }
};
let hitDetect = [];
let close = [];
let canDeleteNearestZulu = false;
function predictReload() {
    try {
        if (!near) {
            hitDetect = [];
            return false;
        }
        hitDetect = [];
        let potentialHit = [];
        for (let i = 0; i < close.length; i++) {
            if (close[i].primaryReload == 1) {
                for (let o = 0; o < nears.length; o++) {
                    if (close[i].sid == nears[o].sid) {
                        potentialHit.push(close[i]);
                        break;
                    }
                }
            }
        }
        hitDetect = potentialHit;
        close = [];
        for (let i = 0; i < nears.length; i++) {
            if (players[i].secondaryIndex == 10 && players[i].secondaryReload + game.tickRate / items.weapons[players[i].secondaryIndex].speed >= 1 && players[i].secondaryReload + game.tickRate / items.weapons[players[i].secondaryIndex].speed <= 1.2) {
                close.push(nears[i]);
                return true;
            } else if (nears[i].primaryReload + game.tickRate / items.weapons[nears[i].primaryIndex].speed >= 1 && (nears[i].primaryIndex == 5 ? nears[i].primaryReload + game.tickRate / items.weapons[nears[i].primaryIndex].speed <= 1.15 : nears[i].primaryReload + game.tickRate / items.weapons[nears[i].primaryIndex].speed <= 1.2) && false) {
                console.log("hit is yes")
                close.push(nears[i]);
                return true;
            }
        }
        canDeleteNearestZulu = close.length > 0;
        return false;
    } catch (e) {
        return false;
    }
}
function manageWeapons(tmpObj) {
    /*if (tmpObj.weaponIndex < 9) {
                    tmpObj.primaryIndex = tmpObj.weaponIndex;
                    tmpObj.primaryVariant = tmpObj.weaponVariant;
                } else if (tmpObj.weaponIndex > 8) {
                    tmpObj.secondaryIndex = tmpObj.weaponIndex;
                    tmpObj.secondaryVariant = tmpObj.weaponVariant;
                }*/
    if (tmpObj.weaponIndex < 9) {
        tmpObj.primaryIndex = tmpObj.weaponIndex;
        tmpObj.primaryVariant = tmpObj.weaponVariant;
        if (tmpObj.buildIndex == -1) {
            tmpObj.primaryReload = Math.min(1, tmpObj.primaryReload + game.tickRate / items.weapons[tmpObj.primaryIndex].speed);
        }
    } else if (tmpObj.weaponIndex > 8) {
        tmpObj.secondaryIndex = tmpObj.weaponIndex;
        tmpObj.secondaryVariant = tmpObj.weaponVariant;
        if (tmpObj.buildIndex == -1) {
            tmpObj.secondaryReload = Math.min(1, tmpObj.secondaryReload + game.tickRate / items.weapons[tmpObj.secondaryIndex].speed);
        }
    }
    tmpObj.sid == player.sid ? tmpObj.turretReload = Math.min(1, tmpObj.turretReload + 0.0444) : tmpObj.turretReload = Math.min(1, tmpObj.turretReload + 0.0555);
    if (tmpObj != player) {
        if (tmpObj.primaryIndex == undefined) {
            tmpObj.primaryIndex = 5;
            tmpObj.primaryReload = 1;
        }
        if (tmpObj.secondaryIndex == undefined) {
            tmpObj.secondaryIndex = 15;
            tmpObj.secondaryReload = 1;
        }
    }
}
function updatePlayers(data) {
    Preplace();
    if (player && player.shameCount > 0) {
        my.reSync = true;
    } else {
        my.reSync = false;
    }

    game.gameTick();

    players.forEach((tmp) => {
        tmp.forcePos = !tmp.visible;
        tmp.visible = false;
        if((tmp.timeHealed - tmp.timeDamaged)>0 && tmp.lastshamecount<tmp.shameCount) tmp.pinge = (tmp.timeHealed - tmp.timeDamaged);
    });

    for (let i = 0; i < data.length;) {
        tmpObj = findPlayerBySID(data[i]);

        if (tmpObj) {
            tmpObj.t1 = (tmpObj.t2 === undefined) ? game.lastTick : tmpObj.t2;
            tmpObj.t2 = game.lastTick;
            tmpObj.oldPos.x2 = tmpObj.x2;
            tmpObj.oldPos.y2 = tmpObj.y2;
            tmpObj.x1 = tmpObj.x;
            tmpObj.y1 = tmpObj.y;
            tmpObj.x2 = data[i + 1];
            tmpObj.y2 = data[i + 2];
            tmpObj.x3 = tmpObj.x2 + (tmpObj.x2 - tmpObj.oldPos.x2);
            tmpObj.y3 = tmpObj.y2 + (tmpObj.y2 - tmpObj.oldPos.y2);
            tmpObj.d1 = (tmpObj.d2 === undefined) ? data[i + 3] : tmpObj.d2;
            tmpObj.d2 = data[i + 3];
            tmpObj.dt = 0;
            tmpObj.buildIndex = data[i + 4];
            tmpObj.weaponIndex = data[i + 5];
            tmpObj.weaponVariant = data[i + 6];
            tmpObj.team = data[i + 7];
            tmpObj.isLeader = data[i + 8];
            tmpObj.oldSkinIndex = tmpObj.skinIndex;
            tmpObj.oldTailIndex = tmpObj.tailIndex;
            tmpObj.skinIndex = data[i + 9];
            tmpObj.tailIndex = data[i + 10];
            tmpObj.iconIndex = data[i + 11];
            tmpObj.zIndex = data[i + 12];
            tmpObj.visible = true;
            tmpObj.update(game.tickSpeed);
            tmpObj.dist2 = UTILS.getDist(tmpObj, player, 2, 2);
            tmpObj.aim2 = UTILS.getDirect(tmpObj, player, 2, 2);
            tmpObj.dist3 = UTILS.getDist(tmpObj, player, 3, 3);
            tmpObj.aim3 = UTILS.getDirect(tmpObj, player, 3, 3);
            tmpObj.damageThreat = 0;
            if (tmpObj == player) {
                tmpObj.syncThreats = 0;
            }
            client.hundleBreakObjects(tmpObj);
            client.updateManageData(tmpObj);
        }
        i += 13;
    }


if (textManager.stack.length) {
textManager.stack.forEach((text) => {
let color = text.value >= 0 ? "#fff" : "#8ecc51"; // Müsbətdirsə ağ, mənfidirsə yaşıl
let val = Math.abs(text.value);
textManager.showText(
text.x,
text.y,
Math.max(45, Math.min(50, val)),
0.18,
800,
val,
color
);
});
textManager.stack = [];
}

    if (runAtNextTick.length) {
        runAtNextTick.forEach((tmp) => {
            checkProjectileHolder(...tmp);
        });
        runAtNextTick = [];
    }
    let teams = [];
    for (let i = 0; i < data.length;) {
        tmpObj = findPlayerBySID(data[i]);
        if (tmpObj) {
            if (!tmpObj.isTeam(player)) {
                enemy.push(tmpObj);
                if (tmpObj.dist2 <= items.weapons[tmpObj.primaryIndex == undefined ? 5 : tmpObj.primaryIndex].range + (player.scale * 2)) {
                    nears.push(tmpObj);
                }
            } else if(tmpObj.sid!==player.sid) {
                teams.push(tmpObj);
            }
            tmpObj.manageReload();
            manageWeapons(tmpObj);
            if (tmpObj != player) {
                tmpObj.addDamageThreat(player);
            }
        }
        i += 13;
    }
    // AutoEmp / Anti Turret:
    turretEmp = 0;
    gameObjects.filter((e) => e.active && e.doUpdate).forEach((tmp) => {
        if (tmp.shootted) {
            tmp.shootted = 0;
            tmp.shootReload = 2200 - config.tickRate;
        } else {
            if (tmp.shootReload > 0) {
                tmp.shootReload = Math.max(0, tmp.shootReload - config.tickRate);
                if (tmp.shootReload <= 0) {
                    tmp.shootReload = 2200;
                }
            }
            if (!tmp.isTeamObject(player) && UTILS.getDist(tmp, player, 0, 2) <= 735) {
                turretEmp++;
            }
        }
    });
    if (player && player.alive) {
        predictReload();
        game.updateEnemies();
        game.manageTickBase();
        if (teams.length) {
            teams.forEach((teammate) => {
                if (combatattacktoggle.auto_sync) {
                    let tmp = near;
                    if (UTILS.getDistance(tmp.x2, tmp.y2, teammate.x2, teammate.y2) <= top.customTeammateRange &&
                        UTILS.getDistance(tmp.x2, tmp.y2, player.x2, player.y2) <= top.customPlayerRange &&
                        player.reloads[player.primaryIndex] === 0 &&
                        teammate.reloads[teammate.primaryIndex] === 0) {
                        if (teammate.weaponIndex === teammate.primaryIndex && player.weaponIndex === player.primaryIndex) {
                            traps.wompwomp = false;
                            clicks.left = true;
                            top.lastSync = Date.now();
                            game.tickBase(() => {
                                clicks.left = false;
                            }, 2);
                        } else if (player.weaponIndex !== player.primaryIndex) {
                            selectWeapon(player.primaryIndex);
                            traps.wompwomp = false;
                        }
                    }
                }
            });
        }
        var antispiketicked = false
        if (advHeal.length) {
            advHeal.forEach((updHealth) => {
                if (window.pingTime < 150) {
                    let sid = updHealth[0];
                    let value = updHealth[1];
                    let totalDamage = 100 - value
                    let damaged = updHealth[2];
                    tmpObj = findPlayerBySID(sid);
                    let bullTicked = false;
                    if (tmpObj && tmpObj.health <= 0) {
                        if (!tmpObj.death) {
                            tmpObj.death = true;
                            if (tmpObj != player) {
                                //notif2(tmpObj.name, "has died");
                            }
                            addDeadPlayer(tmpObj);
                        }
                    }
                    if (tmpObj == player) {
                        if (tmpObj.skinIndex == 7 && (damaged == 5 || (tmpObj.latestTail == 13 && damaged == 2))) {
                            if (my.reSync) {
                                my.reSync = false;
                                tmpObj.setBullTick = true;
                            }
                            bullTicked = true;
                        }
                        if (inGame) {
                            let attackers = getAttacker(damaged);
                            let gearDmgs = [0.25, 0.45].map((val) => val * items.weapons[player.weapons[0]].dmg * soldierMult());
                            let includeSpikeDmgs = enemy.length ? !bullTicked && (gearDmgs.includes(damaged) && near.skinIndex == 11) : false;
                            let healTimeout = 140 - window.pingTime;
                            let dmg = 100 - player.health;
                            let safewalking = false
                            let slowHeal = function (timer, tickBase) {
                                if (!tickBase) {
                                    setTimeout(() => {
                                        healer();
                                    }, timer);
                                } else {
                                    game.tickBase(() => {
                                        healer()
                                    }, 2)
                                }
                            }
                            if (configs.healingBeta) {
                                if (enemy.length) {
                                    if ([0, 7, 8].includes(near.primaryIndex)) {
                                        if (damaged < 75) {//normal heal
                                            slowHeal(healTimeout)
                                        } else {
                                            healer()
                                        }
                                    }
                                    let NearHasOneFrame = near.primaryVariant >= 1 && near.weapons[0] == 5
                                    let PolOrKat = player.weapons[0] === 4 || player.weapons[0] === 5
                                    let canSafeHitback = PolOrKat && !traps.inTrap && player.shameCount <= 4 && !NearHasOneFrame && !antispiketicked && !safewalking// && near.reloads[player.weapons[0]] == 0
                                    if (canSafeHitback && damaged >= 20 && near.dist2 <= 150 && (player.weapons[0] == 4 || player.weapons[0] == 3 || player.weapons[0] == 5) && player.skinIndex == 11 && player.reloads[player.weapons[1]] == 0 && player.reloads[player.weapons[0]] == 0) {//hitback
                                        addMenuChText("[COWGAME]", "Debug Heal - HitBack (Process)", "lightBlue");
                                        healer();
                                    }
                                    if(player.weapons[1] == 11) {//shield anti
                                        if ([15, 9, 12, 13].includes(near.secondaryIndex) && near.reloads[near.secondaryIndex] == 1) {
                                            if (damaged < 75) {
                                                my.autoAim = true;
                                                selectWeapon(player.weapons[1]);
                                                slowHeal(healTimeout)
                                                setTimeout(() => {
                                                    selectWeapon(player.weapons[0]);
                                                    my.autoAim = false;
                                                }, 250);
                                            }
                                        }
                                    } else if(player.weapons[1] == 11) {//shield anti2
                                        if (near.skinIndex == 53) {
                                            my.autoAim = true;
                                            selectWeapon(player.weapons[1]);
                                            slowHeal(healTimeout)
                                            setTimeout(() => {
                                                selectWeapon(player.weapons[0]);
                                                my.autoAim = false;
                                            }, 250);
                                        }
                                    }
                                    if ([1, 2, 6].includes(near.primaryIndex)) {
                                        if (damaged >= 25 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 5) {
                                            healer()
                                        } else {
                                            slowHeal(healTimeout)
                                        }
                                    }
                                    if (near.primaryIndex == 5 && near.secondaryIndex == 10 && traps.inTrap && dmg >= 10 && near.reloads[near.primaryIndex] == 0) { //beta anti rev tick
                                        healer()
                                    }
                                    if (near.primaryIndex == 3) {//sword insta
                                        if (near.secondaryIndex == 15) {
                                            if (near.primaryVariant < 2) {
                                                if (damaged >= 35 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 6) {
                                                    tmpObj.canEmpAnti = true
                                                    healer()
                                                } else {
                                                    slowHeal(healTimeout)
                                                }
                                            } else {
                                                if (damaged > 35 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 6 && game.tick - player.antiTimer > 1) {
                                                    tmpObj.canEmpAnti = true
                                                    tmpObj.antiTimer = game.tick
                                                    healer()
                                                } else {
                                                    slowHeal(healTimeout)
                                                }
                                            }
                                        } else {
                                            if (damaged >= 25 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 4) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        }
                                    }
                                    if (near.primaryIndex == 4) {
                                        if (near.primaryVariant >= 1) {
                                            if (damaged >= 10 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 4) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        } else {
                                            if (damaged >= 35 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 3) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        }
                                    }
                                    if ([undefined, 5].includes(near.primaryIndex)) {
                                        if (near.secondaryIndex == 10) {
                                            if (dmg >= (includeSpikeDmgs ? 10 : 20) && tmpObj.damageThreat + dmg >= 80 && tmpObj.shameCount < 6) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        } else
                                            if (near.primaryVariant >= 2 || near.primaryVariant == undefined) {
                                                if (dmg >= (includeSpikeDmgs ? 15 : 20) && tmpObj.damageThreat + dmg >= 50 && tmpObj.shameCount < 6) {
                                                    healer()
                                                } else {
                                                    slowHeal(healTimeout)
                                                }
                                            } else
                                                if ([undefined || 15].includes(near.secondaryIndex)) {
                                                    if (damaged > (includeSpikeDmgs ? 8 : 20) && player.damageThreat >= 25 && (game.tick - player.antiTimer) > 1) {
                                                        if (tmpObj.shameCount < 5) {
                                                            healer()
                                                        } else {
                                                            slowHeal(healTimeout)
                                                        }
                                                    } else {
                                                        slowHeal(healTimeout)
                                                    }
                                                } else
                                                    if ([9, 12, 13].includes(near.secondaryIndex)) {
                                                        if (dmg >= 25 && player.damageThreat + dmg >= 70 && tmpObj.shameCount < 6) {
                                                            healer()
                                                        } else {
                                                            slowHeal(healTimeout)
                                                        }
                                                    } else {
                                                        if (damaged > 25 && player.damageThreat + dmg >= 95) {
                                                            healer()
                                                        } else {
                                                            slowHeal(healTimeout)
                                                        }
                                                    }
                                    }
                                    if (near.primaryIndex == 6) {
                                        if (near.secondaryIndex == 15) {
                                            if (damaged >= 25 && tmpObj.damageThreat + dmg >= 95 && tmpObj.shameCount < 4) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        } else {
                                            if (damaged >= 70 && tmpObj.shameCount < 4) {
                                                healer()
                                            } else {
                                                slowHeal(healTimeout)
                                            }
                                        }
                                    }
                                    if (damaged >= 30 && near.reloads[near.secondaryIndex] == 0 && near.dist2 <= 150 && player.skinIndex == 11 && player.tailIndex == 21) instaC.canCounter = true
                                } else {
                                    if (damaged >= 70) {
                                        healer()
                                    } else {
                                        slowHeal(healTimeout)
                                    }
                                }
                            } else {
                                if (damaged >= (includeSpikeDmgs ? 8 : 25) && dmg + player.damageThreat >= 80 && (game.tick - player.antiTimer) > 1) {
                                    if (tmpObj.reloads[53] == 0 && tmpObj.reloads[tmpObj.weapons[1]] == 0) {
                                        tmpObj.canEmpAnti = true;
                                    } else {
                                        player.soldierAnti = true;
                                    }
                                    tmpObj.antiTimer = game.tick;
                                    let shame = [0, 4, 6, 7, 8].includes(near.primaryIndex) ? 2 : 5;
                                    if (tmpObj.shameCount < shame) {
                                        healer();
                                    } else {
                                        if (near.primaryIndex == 7 || (player.weapons[0] == 7 && (near.skinIndex == 11 || near.tailIndex == 21))) {
                                            slowHeal(healTimeout)
                                        } else {
                                            slowHeal(healTimeout, 1)
                                        }
                                    }
                                } else {
                                    if (near.primaryIndex == 7 || (player.weapons[0] == 7 && (near.skinIndex == 11 || near.tailIndex == 21))) {
                                        slowHeal(healTimeout)
                                    } else {
                                        slowHeal(healTimeout, 1)
                                    }
                                }
                                if (damaged >= 25 && near.dist2 <= 140 && player.skinIndex == 11 && player.tailIndex == 21) instaC.canCounter = true
                            }
                        } else {
                            if (!tmpObj.setPoisonTick && (tmpObj.damaged == 5 || (tmpObj.latestTail == 13 && tmpObj.damaged == 2))) {
                                tmpObj.setPoisonTick = true;
                            }
                        }
                    }
                } else {
                    let [sid, value, damaged] = updHealth;
                    let totalDamage = 100 - value;
                    let tmpObj = findPlayerBySID(sid);
                    let bullTicked = false;

                    if (tmpObj == player) {
                        if (tmpObj.skinIndex == 7 && (damaged == 5 || (tmpObj.latestTail == 13 && damaged == 2))) {
                            if (my.reSync) {
                                my.reSync = false;
                                tmpObj.setBullTick = true;
                                bullTicked = true;
                            }
                        }
                        if (inGame) {
                            let attackers = getAttacker(damaged);
                            let gearDmgs = [0.25, 0.45].map((val) => val * items.weapons[player.weapons[0]].dmg * soldierMult());
                            let includeSpikeDmgs = enemy.length ? !bullTicked && (gearDmgs.includes(damaged) && near.skinIndex == 11) : false;
                            let healTimeout = 60;
                            let dmg = 100 - player.health;
                            let shameCountThreshold = [2, 5][[0, 4, 6, 7, 8].includes(near.primaryIndex) ? 0 : 1];

                            let slowHeal = function (timer, tickBase) {
                                if (!tickBase) setTimeout(() => healer(), timer);
                                else game.tickBase(() => healer(), 2);
                            };

                            if (configs.healingBeta) {
                                let canHealFast = [0, 7, 8].includes(near.primaryIndex) ? damaged < 75 :
                                [1, 2, 6].includes(near.primaryIndex) ? damaged >= 25 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 5 :
                                [undefined, 5].includes(near.primaryIndex) ? dmg >= (includeSpikeDmgs ? 15 : 20) && tmpObj.damageThreat + dmg >= 50 && tmpObj.shameCount < 6 :
                                near.primaryIndex == 3 && near.secondaryIndex == 15 ? damaged >= 35 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 5 && game.tick - player.antiTimer > 1 :
                                near.primaryIndex == 4 ? near.primaryVariant >= 1 ? damaged >= 10 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 4 :
                                damaged >= 35 && player.damageThreat + dmg >= 95 && tmpObj.shameCount < 3 :
                                near.primaryIndex == 6 && near.secondaryIndex == 15 ? damaged >= 25 && tmpObj.damageThreat + dmg >= 95 && tmpObj.shameCount < 4 :
                                damaged >= 25 && player.damageThreat + dmg >= 95;

                                canHealFast ? healer() : slowHeal(healTimeout);
                            } else {
                                let canHealFast = damaged >= (includeSpikeDmgs ? 8 : 25) && dmg + player.damageThreat >= 80 && (game.tick - player.antiTimer) > 1;

                                if (canHealFast) {
                                    if (tmpObj.reloads[53] == 0 && tmpObj.reloads[tmpObj.weapons[1]] == 0) tmpObj.canEmpAnti = true;
                                    else player.soldierAnti = true;
                                    tmpObj.antiTimer = game.tick;
                                    if (tmpObj.shameCount < shameCountThreshold) healer();
                                    else slowHeal(healTimeout, near.primaryIndex == 7 || (player.weapons[0] == 7 && (near.skinIndex == 11 || near.tailIndex == 21)) ? 0 : 1);
                                } else {
                                    slowHeal(healTimeout, near.primaryIndex == 7 || (player.weapons[0] == 7 && (near.skinIndex == 11 || near.tailIndex == 21)) ? 0 : 1);
                                }
                            }
                        } else {
                            if (!tmpObj.setPoisonTick && (tmpObj.damaged == 5 || (tmpObj.latestTail == 13 && tmpObj.damaged == 2))) {
                                tmpObj.setPoisonTick = true;
                            }
                        }
                    }
                }
            });
            advHeal = [];
        }

        if (getEl("doHideDataMenu").checked && datatitle.style.display != "block") {
            datatitle.style.display = "block";
        } else if (!getEl("doHideDataMenu").checked && datatitle.style.display != "none") {
            datatitle.style.display = "none";
        }

        players.forEach((tmp) => {
            if (!tmp.visible && player != tmp) {
                tmp.reloads = {
                    0: 0,
                    1: 0,
                    2: 0,
                    3: 0,
                    4: 0,
                    5: 0,
                    6: 0,
                    7: 0,
                    8: 0,
                    9: 0,
                    10: 0,
                    11: 0,
                    12: 0,
                    13: 0,
                    14: 0,
                    15: 0,
                    53: 0,
                };
            }
            if (tmp.setBullTick) {
                tmp.bullTimer = 0;
            }
            if (tmp.setPoisonTick) {
                tmp.poisonTimer = 0;
            }
            tmp.updateTimer();
        });
        if (inGame) {
            antiKnockBack(near.enemy);
            if (enemy.length) {
                /*                 let weaponNameMap = {
                    0: "tool hammer",
                    1: "hand axe",
                    2: "great axe",
                    3: "short sword",
                    4: "katana",
                    5: "polearm",
                    6: "bat",
                    7: "daggers",
                    8: "stick"
                };
                let weaponName = weaponNameMap[tmpObj.primaryIndex];
                let secondaryWeaponName;
                if (tmpObj.secondaryIndex === 9) {
                    secondaryWeaponName = "hunting bow";
                } else if (tmpObj.secondaryIndex === 10) {
                    secondaryWeaponName = "great hammer";
                } else if (tmpObj.secondaryIndex === 11) {
                    secondaryWeaponName = "wooden shield";
                } else if (tmpObj.secondaryIndex === 12) {
                    secondaryWeaponName = "crossbow";
                } else if (tmpObj.secondaryIndex === 13) {
                    secondaryWeaponName = "repeater crossbow";
                } else if (tmpObj.secondaryIndex === 14) {
                    secondaryWeaponName = "mc grabby";
                } else if (tmpObj.secondaryIndex === 15) {
                    secondaryWeaponName = "musket";
                } */
                let lastPrimary = near?.primaryIndex;
                let lastSecondary = near?.secondaryIndex;
                document.getElementById('database').innerHTML = `
                            Name: ${near.name} <br>
                            Shame: ${tmpObj.shameCount} <br>
                            Health: ${tmpObj.health} <br>
                            Primary: ${items?.weapons[lastPrimary]?.name} <br>
                            Secondary: ${items?.weapons[lastSecondary]?.name}
                        `;
            } else if (!enemy.length && document.getElementById('database').innerHTML != `No Information`) {
                document.getElementById('database').innerHTML = `No Information`;
            }
            if (enemy.length) {
                sCombat.findSpikeHit.x = 0;
                sCombat.findSpikeHit.y = 0;
                sCombat.doSpikeHit();
                sCombat.findSpikeHit.spikes = [];
                let prediction = knockBackPredict();
if (near && near.dist2 < 200 && prediction === "insta them") {
    knockpush = true;
} else {
    knockpush = false;
}
                if (!instaC.isTrue && my.anti0Tick <= 0) {
                    let brt = knockBackPredict();
                if (brt == "insta them" && (![9, 12, 13, 15].includes(player.weapons[1]) || near.dist2 <= items.weapons[player.weapons[1]].range + player.scale * 1.8) && combatattacktoggle.knockback_tick) {
                 instaC.knockback_tick_Type();
                 }
                }
                // Near in Trap:
                if (near.dist2 < 600) {
                    let nearTrap = closeObjects.filter(e => e.trap && e.active && e.isTeamObject(player) && UTILS.getDist(e, near, 0, 2) <= (near.scale + e.getScale() + 5)).sort(function(a, b) {
                        return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
                    })[0];
                    near.inTrap = nearTrap;
                } else {
                    near.inTrap = [];
                }

                if (player.canEmpAnti) {
                    player.canEmpAnti = false;
                    if (near.dist2 <= 300 && !my.safePrimary(near) && !my.safeSecondary(near)) {
                        if (near.reloads[53] == 0){
                            player.empAnti = true;
                            player.soldierAnti = false;
                        } else {
                            player.empAnti = false;
                            player.soldierAnti = true;
                        }
                    }
                }
                let prehit = gameObjects.filter(tmp => tmp.dmg && tmp.active && tmp.isTeamObject(player) && UTILS.getDist(tmp, near, 0, 3) <= (tmp.scale + near.scale)).sort(function (a, b) {
                    return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
                })[0];
                if (prehit) {
                    if (near.dist2 <= items.weapons[player.weapons[0]].range + player.scale * 1.8) {
                        instaC.dospikesync = true;
                                console.log("Spike 2");
                        instaC.syncHit = true;
                    }
                }
                let antiSpikeTick = gameObjects
                .filter(
                    (tmp) =>
                    tmp.dmg &&
                    tmp.active &&
                    !tmp.isTeamObject(player) &&
                    UTILS.getDist(tmp, player, 0, 3) < tmp.scale + 35
                )
                .sort(function (a, b) {
                    return (
                        UTILS.getDist(a, player, 0, 2) -
                        UTILS.getDist(b, player, 0, 2)
                    );
                })[0];
                if (antiSpikeTick && !traps.inTrap) {
                    if (near.dist2 <= items.weapons[5].range + near.scale * 1.8) {
                        my.anti0Tick = 1;
                       // player.chat.message = "Anti " + near.sid + " (" + near.name + ")";
                        player.chat.count = 2000;
                    }
                }
            }
            function hitBull(angle, id) {
                let antiBullTrue = configs.antiBull;
                instaC.isTrue = true;
                if (angle == near.aim2) {
                    my.autoAim = true;
                    game.tickBase(() => {
                        my.autoAim = false;
                    }, 2);
                } else {
                    packet("D", angle, "hitBull");
                }
                selectWeapon(player.weapons[id]);
                if (player.tailIndex == 11) {
                    buyEquip(19, 1);
                } else {
                    buyEquip(7, 0);
                }
                sendAutoGather(2);
                game.tickBase(() => {
                    packet("D", angle, "hitBull");
                    selectWeapon(player.weapons[id]);
                    instaC.isTrue = false;
                }, 1);
            }
            let canSyncHit = false;
            if (
                player.reloads[player.weapons[0]] != 0 ||
                !near ||
                near.dist2 > items.weapons[player.weapons[0]].range + 63
            ) {
                canSyncHit = false;
            } else {
                let _ = near;
                let dmg = 0;
                for (let j = 0; j < enemy.length; j++) {
                    let tmp = enemy[j];
                    if (tmp) {
                        if (tmp.sid == player.sid || tmp.sid == near.sid) continue;
                        if (
                            tmp.primaryIndex &&
                            tmp.canSync &&
                            (UTILS.getDist(tmp, near, 3, 3) <=
                             items.weapons[tmp.primaryIndex].range + 63 ||
                             UTILS.getDist(tmp, near, 2, 2) <=
                             items.weapons[tmp.primaryIndex].range + 63)
                        ) {
                            dmg +=
                                items.weapons[tmp.primaryIndex].dmg *
                                sortWeaponVariant(tmp.primaryVariant) *
                                1.5;
                        }
                    }
                }
                dmg +=
                    items.weapons[player.weapons[0]].dmg *
                    1.5 *
                    sortWeaponVariant(player.primaryVariant);
                if (dmg * (_.skinIndex == 6 ? 0.75 : 1) >= 100) {
                    canSyncHit = true;
                } else {
                    canSyncHit = false;
                }
            }
            // autoHit:
            if (combatattacktoggle.auto_sync && canSyncHit &&
                (UTILS.getDist(player, near, 3, 3) <=
                 items.weapons[player.primaryIndex].range + 63 ||
                 UTILS.getDist(player, near, 2, 2) <=
                 items.weapons[player.primaryIndex].range + 63)
            ) {
                player.chat.message = "Autosync";
                player.chat.count = 2000;
                hitBull(near.aim2, 0);
            }
            function getDist(e, t) {
                try {
                    return Math.hypot((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
                } catch (e) {
                    return Infinity;
                }
            }

            let instaTurretReload = (!useWasd ? true : getEl("oneShotInsta").checked ? player.reloads[53] <= (player.weapons[1] == 10 ? 0 : game.tickRate) : true);
            if ((useWasd ? true : ((player.checkCanInsta(true) >= 100 ? player.checkCanInsta(true) : player.checkCanInsta(false)) >= (player.weapons[1] == 10 ? 95 : 100))) && near.dist2 <= items.weapons[player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]].range + near.scale * 1.8 && (instaC.wait || (useWasd && Math.floor(Math.random() * 5) == 0)) && !instaC.isTrue && !my.waitHit && player.reloads[player.weapons[0]] == 0 && player.reloads[player.weapons[1]] == 0 && instaTurretReload && instaC.perfCheck(player, near)) {
                if (player.checkCanInsta(true) >= 100) {
                    instaC.nobull = useWasd ? false : instaC.canSpikeTick ? false : true;
                } else {
                    instaC.nobull = false;
                }
                instaC.can = true;
            } else {
                instaC.can = false;
            }

            const SpeedMill = () => {
                if ((player.skinIndex == 12 && player.tailIndex == 11 && player.weaponIndex == 7)) {
                    return 1;
                }else {
                    return player.tailIndex == 11 ? ((CheckSnowBiome() && player.skinIndex != 15) || (player.weaponIndex == 10 || player.weaponIndex == 3 || player.weaponIndex == 4)) ? player.weaponIndex == 5 ? 4 : 3 : 2 : ((CheckSnowBiome() && player.skinIndex != 15) || (player.weaponIndex == 10 || player.weaponIndex == 4 || player.weaponIndex == 5 || player.weaponIndex == 5)) ? 4 : 3;
                }
            }
            const CheckSnowBiome = () => {
                if (player.y2 <= config.snowBiomeTop) {
                    return true;
                } else {
                    return false;
                }
            }

            let CheckMaxSpeed = SpeedMill();
            if (game.tick % CheckMaxSpeed == 0) {
                if (combatplacetoggle.auto_windmill && window.millae) {
                    let plcAng = 1.20;
                    for (let i = -plcAng; i <= plcAng; i += plcAng) {
                        checkPlace1(3, UTILS.getDirect(player.oldPos, player, 2, 2) + i, 1);
                    }
                } else {
                    if (mills.placeSpawnPads) {
                        for (let i = 0; i < Math.PI * 2; i += Math.PI / 2) {
                            checkPlace(player.getItemType(20), i);
                        }
                    }
                }
            } else {
                traps.autoPlace();
            }



/*
if (combatplacetoggle.auto_grind) {
    // 1. Vuruş və AİM (Bunu yuxarı alırıq ki, əvvəlcə hara vuracağını bilsin)
    if (player.reloads[player.weapons[0]] == 0 && !my.waitHit) {

        // Aim: Hər vuruşda 180 dərəcə dön (gah önə, gah arxaya bax)
        this.grindBack = !this.grindBack;
        let aimAngle = this.grindBack ? player.dir : player.dir + Math.PI;
        packet("2", aimAngle);

        sendAutoGather();
        my.waitHit = 1;
        buyEquip(40, 0);
        packet("F", 1);

        game.tickBase(() => {
            sendAutoGather();
            my.waitHit = 0;
            buyEquip(6, 0);
            packet("F", null, 0);

            // 2. REPLACE MƏNTİQİ: Ancaq vuruşdan SONRA yerləşdirməyə çalış
            // Beləliklə, boş yerə paket göndərib crash verməz
            let slot = (player.items[5] === 17 || player.items[5] === 22) ? 5 : 3;
            if (secPacket < 50) {
                place(slot, player.dir);
                place(slot, player.dir + Math.PI / 2);
                place(slot, player.dir - Math.PI / 2);
                place(slot, player.dir + Math.PI);
            }
        }, 1);
    }
}*/
//Auto grind

if (combatplacetoggle.auto_grind) {
       if (player.items[5] === 17 && secPacket < 50) {
    place(5, player.dir);
    place(5, player.dir + Math.PI / 2);
    place(5, player.dir - Math.PI / 2);
    place(5, player.dir + Math.PI);
} else if (player.items[5] === 22 && secPacket < 50) {
    place(5, player.dir);
    place(5, player.dir + Math.PI / 2);
    place(5, player.dir - Math.PI / 2);
    place(5, player.dir + Math.PI);
} else if (secPacket < 50){
    place(3, player.dir);
    place(3, player.dir + Math.PI / 2);
    place(3, player.dir - Math.PI / 2);
    place(3, player.dir + Math.PI);
}
    if (player.primaryVariant >= 3) {
selectWeapon(player.weapons[1]);
if (player.reloads[player.weapons[1]] === 0 && !my.waitHit) {
    sendAutoGather();
    my.waitHit = 1;
    buyEquip(40, 0);
    packet("F", 1);
    game.tickBase(() => {
    sendAutoGather();
    my.waitHit = 0;
    buyEquip(6, 0);
    packet("F", null, 0);
    }, 1);
    }
    } else if (player.secondaryVariant >= 3) {
selectWeapon(player.weapons[0]);
if (player.reloads[player.weapons[0]] === 0 && !my.waitHit) {
    sendAutoGather();
    my.waitHit = 1;
    buyEquip(40, 0);
    packet("F", 1);
    game.tickBase(() => {
    sendAutoGather();
    my.waitHit = 0;
    buyEquip(6, 0);
    packet("F", null, 0);
    }, 1);
    }
    }
}

//if (player.items[4] === 17) {
//if (player.items[4] === 22) {
 //   place(3, player.dir);
 //   place(3, player.dir + Math.PI / 2);
  //  place(3, player.dir - Math.PI / 2);
  //  place(3, player.dir + Math.PI);



                   /*     if (player.reloads[player.weapons[0]] == 0 && !my.waitHit) {
                            sendAutoGather();
                            my.waitHit = 1;
                            buyEquip(40, 0);
                            packet("F", 1);
                            game.tickBase(() => {
                                sendAutoGather();
                                my.waitHit = 0;
                                buyEquip(6, 0);
                                packet("F", null, 0);
                            }, 1);
                        }*/





// Dəyişənləri bir dəfə tanıdaq
if (window.hatTimer === undefined) {
    window.hatTimer = 0;
    window.trur = false;
    window.lastInstaTime = 0;
}

let currentTime = Date.now();
let cooldownPeriod = 3000;
if (currentTime - window.lastInstaTime >= cooldownPeriod) {
    if (combatattacktoggle.static_based && near.skinIndex !== 6 && near.skinIndex !== 22 && near.dist2 < 205) {
        if (window.hatTimer === 0) {
            window.hatTimer = currentTime;
        } else if (currentTime - window.hatTimer >= 300) {
            window.trur = true;
        }
    } else {
        window.hatTimer = 0;
        window.trur = false;
    }

} else {
    window.hatTimer = 0;
    window.trur = false;
}
if (window.trur && !traps.inTrap && player.reloads[player.weapons[0]] === 0 && player.weapons[0] === 5 && player.primaryVariant >= 2 && player.reloads[53] == 0) {
    console.log("Based! One-Tick vurdu. İndi 3 saniyə gözləyəcək.");
    instaC.doonetick();
    window.lastInstaTime = currentTime;
    window.hatTimer = 0;
    window.trur = false;
}

dange1 = player.health < 35;
dange2 = (player.shameCount >= 5);
dange3 = (enemy.length > 3 && near.dist2 < 200);

//  <--   Steal Sync   -->
var stealtype1 = false;
var stealtype2 = false;
var stealtype3 = false;
var stealtype4 = false;

if (near && near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8 && near.health <= (items.weapons[player.weapons[0]].dmg * 1.51) * (player.primaryVariant === 1 ? 1.1 : 1) * (player.primaryVariant >= 2 ? 1.175 : 1) && player.reloads[player.weapons[0]] == 0 && near.skinIndex != 6 && !instaC.isTrue && combatattacktoggle.auto_steal) {// Polearm & NonSoldier
    stealtype1 = true;
} else if (near && near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8 && near.health <= (items.weapons[player.weapons[0]].dmg * 0.78 * 1.51) * (player.primaryVariant === 1 ? 1.1 : 1) * (player.primaryVariant >= 2 ? 1.172 : 1) && player.reloads[player.weapons[0]] == 0 && near.skinIndex == 6 && !instaC.isTrue && combatattacktoggle.auto_steal) {// Polearm & Soldier
    stealtype2 = true;
} else if (near && near.dist2 <= 600 && near.dist2 >= 250 && near.health <= 25 && player.reloads[53] == 0 && near.skinIndex != 6 && !instaC.isTrue && combatattacktoggle.auto_steal) {
stealtype3 = true;
} else if (near && near.dist2 <= 600 && near.dist2 >= 250 && near.health <= 19 && player.reloads[53] == 0 && near.skinIndex == 6 && !instaC.isTrue && combatattacktoggle.auto_steal) {
stealtype4 = true;
}


if (stealtype1 && !spikegeartick && !spikegeartick2 && !window.trur && !instaC.dospikesynconpush && !instaC.dospikesync && !instaC.dospiketick) {
stealtype1 = false;
instaC.dostealtick1();
} else if (stealtype2 && !spikegeartick && !spikegeartick2 && !window.trur && !instaC.dospikesynconpush && !instaC.dospikesync && !instaC.dospiketick) {
stealtype1 = false;
instaC.dostealtick1();
} else if (stealtype3 && !spikegeartick && !spikegeartick2 && !window.trur && !instaC.dospikesynconpush && !instaC.dospikesync && !instaC.dospiketick) {
stealtype2 = false;
instaC.dostealtick2();
} else if (stealtype4 && !spikegeartick && !spikegeartick2 && !window.trur && !instaC.dospikesynconpush && !instaC.dospikesync && !instaC.dospiketick) {
stealtype2 = false;
instaC.dostealtick2();
}
// End auto steal


//!instaC.dospikesynconpush && !combatattacktoggle.spike_sync && !combatattacktoggle.spike_tick


//  <--   Insta kill   -->
if (can_do_insta_kill && !instaC.isTrue) {
    switch (insta_type.value) {
        case "1": // Counter 1
if (near.dist2 <= (items.weapons[player.weapons[1]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& (player.weapons[0] === 5 || player.weapons[0] === 4 || player.weapons[0] === 3) && player.weapons[1] === 10 && !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.ighcType();//Hammer & Spike Insta
} else if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& (player.weapons[0] === 5 || player.weapons[0] === 4 || player.weapons[0] === 3) && (player.weapons[1] === 15 || player.weapons[1] === 13 || player.weapons[1] === 12) && !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.igmcType();//Musket & Bow Insta
}
            break;
        case "2": // Reverse
if (near.dist2 <= (items.weapons[player.weapons[1]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& (player.weapons[0] === 5 || player.weapons[0] === 4 || player.weapons[0] === 3) && player.weapons[1] === 10 && !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.ighrType();//Hammer & Spike Insta
} else if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& (player.weapons[0] === 5 || player.weapons[0] === 4 || player.weapons[0] === 3) && (player.weapons[1] === 15 || player.weapons[1] === 13 || player.weapons[1] === 12) && !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.igmrType();//Musket & Bow Insta
}
            break;
        case "3": // MS Reverse
if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.changeType("rev");
}
            break;
        case "4": // MS Reverse 2
if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
can_do_insta_kill = false;
instaC.ighr2Type();
}
            break;
        case "5": // New Stack insta
if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8 + 150)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[player.weapons[1]] <= 0 && player.reloads[53] <= 0//Reloads
&& !traps.inTrap) {// Weapon Type & Cans
insta_kill_target = false;
insta_kill_boost_target = false;
can_do_insta_kill = false;
instaC.boostinsta();
}
            break;
    }

}

if (["1", "2", "3", "4"].includes(insta_type.value)) {
    insta_kill_boost_target = false;
}
//  <--   End Insta kill   -->



//  <--   Manual Tick   -->
if (can_do_manual_tick && !instaC.isTrue) {
    switch (tick_type.value) {
        case "1": // One Tick
if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[53] <= 0//Reloads
&& (player.weapons[0] === 4 || player.weapons[0] === 5) && !traps.inTrap) {// Weapon Type & Cans
manual_tick_target = false;
can_do_manual_tick = false;
instaC.mtotType();
}
            break;
        case "2": // Spike Tick
if (near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8)// Range
&& player.reloads[player.weapons[0]] <= 0 && player.reloads[53] <= 0//Reloads
&& !traps.inTrap) {// Weapon Type & Cans
manual_tick_target = false;
can_do_manual_tick = false;
instaC.stmtType();
}
            break;

    }

}
//  <--   End Manual Tick   -->












//  <--   Spikegear tick   -->
if (near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8 && player.health < 90 && near.health < 95 && spikegeartick == true) {
spikegeartick = false;
instaC.SpikegearType();
}
if (near.dist2 <= 75 && player.health < 90 && near.health < 95 && spikegeartick2 == true) {
spikegeartick2 = false;
instaC.SpikegearhType();
}
//  <--   End Spikegear tick   -->





//Spike Sync onpushing
if (instaC.dospikesynconpush && combatattacktoggle.spike_sync_onpushing && player.reloads[player.weapons[0]] == 0 && !instaC.isTrue) {
instaC.dospikesynconpush = false
instaC.spike_sync_onpusing();
}
//Spike Sync
if (instaC.dospikesync && player.reloads[player.weapons[0]] == 0 && !instaC.isTrue && !instaC.dospikesynconpush && combatattacktoggle.spike_sync) {
instaC.dospikesync = false
instaC.spike_sync();
}
//Spike Tick
if (instaC.dospiketick && player.reloads[player.weapons[0]] == 0 && !instaC.isTrue && !instaC.dospikesynconpush && combatattacktoggle.spike_tick) {
instaC.dospiketick = false
instaC.spike_tick();
}


// auto Q & fastQ
if (player.health < 40 && combatdefensetoggle.healing && combatdefensetoggle.autoq) {
place(0);
place(0);
fastQ = true
}else {
fastQ = false
}
if (player.health < 20 && combatdefensetoggle.healing && combatdefensetoggle.autoq) {
place(0);
place(0);
place(0);
fastQ = true
}else {
fastQ = false
}

if (combatdefensetoggle.autoq && player.health < 80 && near.dist2 < 210 && [15,13,12].includes(near.secondaryIndex) && near.skinIndex === 53) {
if (player.reloads[player.weapons[1]] != 0 && near.reloads[53] != 0) {
place(0);
place(0);
place(0);
fastQ = true;
}else {
fastQ = false;
}
}

            if (instaC.canSpikeTick && false) {
                instaC.canSpikeTick = false;
                if (instaC.revTick) {
                    instaC.revTick = false;
                    if ([1, 2, 3, 4, 5, 6].includes(player.weapons[0]) && player.reloads[player.weapons[1]] == 0 && !instaC.isTrue) {
                        instaC.changeType("rev");
                    }
                } else {
                    if ([1, 2, 3, 4, 5, 6].includes(player.weapons[0]) && player.reloads[player.weapons[0]] == 0 && !instaC.isTrue) {
                        instaC.spikeTickType();
                        if (instaC.syncHit) {
                        }
                    }
                }
            }
            if (spikes.inRange) {
                if (!clicks.left && !clicks.right && !instaC.isTrue) {
                    if (configs.doAutoBreakSpike) {
                        if (player.weaponIndex != (player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]) || player.buildIndex > -1) {
                            selectWeapon(player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]);
                        }
                        if (player.reloads[player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]] == 0 && !my.waitHit) {
                            sendAutoGather();
                            my.waitHit = 1;
                            buyEquip(40, 0);
                            packet("F", 1);
                            game.tickBase(() => {
                                sendAutoGather();
                                my.waitHit = 0;
                                buyEquip(6, 0);
                                packet("F", null, 0);
                            }, 1);
                        }
                    }
                }
            }
            if (!instaC.isTrue) {
                if (!clicks.middle && (clicks.left || clicks.right)) {
                    let weapon = clicks.right && player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0];

                    if (player.weaponIndex != weapon || player.buildIndex > -1) {
                        selectWeapon(weapon);
                    }

                    if (player.reloads[clicks.right && player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]] == 0 && !my.waitHit) {
                        sendAutoGather();
                        my.waitHit = 1;
                        game.tickBase(() => {
                            sendAutoGather();
                            my.waitHit = 0;
                        }, 1);
                    }
                } else if (clicks.middle) {
                       if (my.ageInsta && player.weapons[1] == 9 && player.age >= 9 && enemy.length && near.dist2 < 621 && combatattacktoggle.bow_tick) {
                           instaC.bow_tick();
                } else if (my.ageInsta2 && player.weapons[0] == 0 && player.age >= 2 && enemy.length && combatattacktoggle.age_1_insta) {
                           instaC.age_insta();
                } else if (combatattacktoggle.bow_spam && (player.weapons[1] == 13 || player.weapon[1] == 15 || player.weapon[1] == 12)) {
                       if (player.weaponIndex !== player.weapons[1] || player.buildIndex > -1) {selectWeapon(player.weapons[1]);}
                       if (player.reloads[player.weapons[1]] === 0 && !my.waitHit) {
              my.waitHit = 1;
              this.isTrue = true;
              my.autoAim = true;
              buyEquip(player.reloads[53] === 0 ? 53 : 20, 0);
              sendAutoGather();
              game.tickBase(() => {
                     if (player.weaponIndex !== player.weapons[1]) {selectWeapon(player.weapons[1]);}
                     this.isTrue = false;
                     my.autoAim = false;
                     sendAutoGather();
                     my.waitHit = 0;
              }, 1);}
}
                } else if ((traps.inTrap || breakSpike.active) && combatdefensetoggle.autobreak) {
                    let weapon;
                    if (traps.inTrap) {
                        let checkObj = traps.hasSpike && objectManager.hitsToBreak(traps.info[1], player) <= objectManager.hitsToBreak(traps.info[0], player) ? 1 : 0;
                        weapon = traps.notFast(traps.info[checkObj]) ? player.weapons[1] : player.weapons[0];
                    } else {
                        weapon = traps.notFast(breakSpike.info) ? player.weapons[1] : player.weapons[0];
                    }

                    if (player.weaponIndex != weapon || player.buildIndex > -1) {
                        selectWeapon(weapon);
                    }

                    if (player.reloads[weapon] == 0 && !my.waitHit) {
                        sendAutoGather();
                        my.waitHit = 1;
                        if (player.health < 40 || (near.primaryVariant >= 2 && near.dist2 < 220 && player.health < 90)) {
                      buyEquip(6, 0);
                        } else {
                            buyEquip(40, 0);
                        }
                        packet("F", 1);
                        game.tickBase(() => {
                          buyEquip(reload_hatID, 0);
                            sendAutoGather();
                            my.waitHit = 0;
                            packet("F", null, 0);
                        }, 1);
                    }
                } else {
                    if (useWasd && near.dist2 <= (items.weapons[player.weapons[0]].range + near.scale * 1.8) && !traps.inTrap) {
                        if ((player.weaponIndex != player.weapons[0]) || player.buildIndex > -1) {
                            selectWeapon(player.weapons[0]);
                        }
                        if (player.reloads[player.weapons[0]] == 0 && !my.waitHit) {
                            sendAutoGather();
                            my.waitHit = 1;
                            game.tickBase(() => {
                                sendAutoGather();
                                my.waitHit = 0;
                            }, 1);
                        }
                    }

                    if (macro.t && false) {
                        if (player.reloads[player.weapons[0]] == 0 && (player.weapons[1] == 15 ? (player.reloads[player.weapons[1]] == 0) : true) && (player.weapons[0] == 5 || (player.weapons[0] == 4 && player.weapons[1] == 15))) {
                            instaC[(player.weapons[0] == 4 && player.weapons[1] == 15) ? "kmTickMovement" : "tickMovement"]();
                        }
                    }
                    if (macro.u && false) {
                        if (player.reloads[player.weapons[0]] == 0 && ([9, 12, 13, 15].includes(player.weapons[1]) ? (player.reloads[player.weapons[1]] == 0) : true)) {
                            instaC.BoostOneTick();
                        }
                    }
                    if (macro["."] && false) {
                        if (player.reloads[player.weapons[0]] == 0 && ([9, 12, 13, 15].includes(player.weapons[1]) ? (player.reloads[player.weapons[1]] == 0) : true)) {
                            instaC.BoostPerfectedSpiketick();
                        }
                    }
                    if (macro.c && false) {
                        if (player.reloads[player.weapons[0]] == 0 && ([9, 12, 13, 15].includes(player.weapons[1]) ? (player.reloads[player.weapons[1]] == 0) : true)) {
                            instaC.boostTickMovement();
                        }
                    }
                    if (player.weapons[1] && !(spikes.inRange && configs.doAutoBreakSpike) && !(useWasd && near.dist2 <= items.weapons[player.weapons[0]].range + near.scale * 1.8)) {
                        if (player.reloads[player.weapons[0]] == 0 && player.reloads[player.weapons[1]] == 0) {
                            if (!my.reloaded) {
                                my.reloaded = true;
                                let fastSpeed = items.weapons[player.weapons[0]].spdMult < items.weapons[player.weapons[1]].spdMult ? 1 : 0;
                                if (player.weaponIndex != player.weapons[fastSpeed] || player.buildIndex > -1) {
                                    selectWeapon(player.weapons[fastSpeed]);
                                }
                            }
                        } else {
                            my.reloaded = false;
                            if (player.reloads[player.weapons[0]] > 0) {
                                if (player.weaponIndex != player.weapons[0] || player.buildIndex > -1) {
                                    selectWeapon(player.weapons[0]);
                                }
                            } else if (player.reloads[player.weapons[0]] == 0 && player.reloads[player.weapons[1]] > 0) {
                                if (player.weaponIndex != player.weapons[1] || player.buildIndex > -1) {
                                    selectWeapon(player.weapons[1]);
                                }
                            }
                        }
                    }
                }
            }

            /* end shit */
const doOneFrame = () => {
pushNotify(`Velocity Tick`, "#fff");
my.autoAim = true;
selectWeapon(player.weapons[0]);
buyEquip(53, 0);
selectWeapon(player.weapons[0]);
game.tickBase(() => {
buyEquip(7, 0);
sendAutoGather();
game.tickBase(() => {
selectWeapon(player.weapons[0]);
sendAutoGather();
my.autoAim = false;
}, 1);
}, 1);
}
function autoOneFrame() {
let neIT = false;
let nearTrapped = gameObjects.filter(tmp => tmp.trap && tmp.active && tmp.isTeamObject(player) && UTILS.getDist(tmp, near, 0, 2) <= (near.scale + tmp.getScale() + 15))
.sort(function(a, b) {
return UTILS.getDist(a, near, 0, 2) - UTILS.getDist(b, near, 0, 2);
})[0];
if (nearTrapped) {
neIT = true;
}
if (combatattacktoggle.velocity_tick && player.primaryVariant >= 2) {
let ping = window.pingTime;
let range = (ping > 140) ? 230 : (ping > 110) ? 210 : (ping > 85) ? 190 : 170;
if (near.dist2 > range && near.dist2 <= 245 && !traps.inTrap && player.reloads[player.weapons[0]] == 0 && player.reloads[53] == 0 && (player.weapons[0] === 4 || player.weapons[0] == 5) && ((!neIT && near.skinIndex != 6 && near.skinIndex != 22) || neIT)) {
if (lastMoveDir == undefined) {
packet("9", near.aim2, 1);
game.tickBase(() => {
packet("9", undefined, 1);
}, 1);
}
doOneFrame();
}
}
}

            const elotickers = () => {
                if (player.reloads[player.weapons[0]] == 0 && player.reloads[53] == 0) {
                    buyEquip(53, 0);
                    game.tickBase(() => {
                        selectWeapon(player.weapons[0]);
                        my.autoAim = true;
                        buyEquip(7, 0);
                        packet("F", 1);
                        sendAutoGather();
                        game.tickBase(() => {
                            selectWeapon(player.weapons[0]);
                            sendAutoGather();
                            my.autoAim = false;
                            packet("F", null, 0);
                        }, 1);
                    }, 1);
                }
            }
            if (!instaC.isTrue && !traps.inTrap) {
                if ((combatplacetoggle.auto_Place_Replace && !traps.replaced) || true && combatplacetoggle.auto_Place) {
                    traps.autoPlace();
                }
                if (true) {
                    autoOneFrame();
                }
            }

            if (!macro.h) {
                packet("D", getAttackDir());
            }
            let antiReverse = false;

            let damageTrap = new class { // weapon tank / normal damage for object included upgraded weapon
                checkWeaponDmg(_, sold = true, tank = true) {
                    const { primaryVariant: v, weapons: [weapon] } = _;
                    const pV = v ? config.weaponVariants[v].val : 1;
                    const e = (tank && player.skins[40]) ? 3.3 : 1;

                    return items.weapons[weapon].dmg * e * pV;
                }
            };
            const ef = () => { // detects it last hit for object
                const e = heal.checkWeaponDmg(player, true, true);
                const w = gameObjects.find(trap => trap.health <= e);
                return w;
            }


let animalhere = false;
let animalhit = false;
let animalheredef = false;
const aggressiveNames = ["💀MOOFIE", "💀Wolf", "💀Bully", "MOOSTAFA", "MOOFIE", "Treasure", "Bull", "Wolf", "Bully"];
for (let i = 0; i < ais.length; i++) {
    let animal = ais[i];
    if (animal.active && animal.visible && animal.health > 0) {
        let dist = Math.hypot(animal.x - player.x, animal.y - player.y);
        if (dist < 300) {
            animalhere = true;
            if (animal.name) {
                let nameFound = aggressiveNames.some(n => animal.name.includes(n));
                if (nameFound) {
                    animalhit = true;
                    if (dist < 225) {
                        animalheredef = true;
                    }
                }
            }
            if (animalhit) break;
        }
    } else {
        if (i === ais.length - 1 && !animalhere) {
             animalhere = false;
             animalhit = false;
             animalheredef = false;
        }
    }
}

let biome_hatID;
let reload_hatID;
let antispiketickthreat = traps.checkSpikeTick();
let objects_buildings = gameObjects.sort((a, b) => Math.hypot(player.y2 - a.y, player.x2 - a.x) - Math.hypot(player.y2 - b.y, player.x2 - b.x));
let can_damage_object = objects_buildings.some(obj => {return (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" || obj.name == "spinning spikes" || obj.type == 1) && obj.active && !obj.isTeamObject(player) && fgdo(player, obj) < 170;});
let wear_tank_object = objects_buildings.some(obj => {return (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" || obj.name == "spinning spikes" || obj.name == "castle wall" || obj.name == "stone wall" || obj.name == "wood wall" || obj.name == "windmill" || obj.name == "faster windmill" || obj.name == "power mill" ||obj.name == "mine" || obj.name == "sapling" || obj.name == "pit trap" || obj.name == "boost pad" || obj.name == "turret" || obj.name == "platform" || obj.name == "healing pad" || obj.name == "spawn pad" || obj.name == "blocker" || obj.name == "teleporter") && obj.active && fgdo(player, obj) <= (items.weapons[player.weapons[0]].range + obj.scale)});
let turretsInRange = objects_buildings.filter(obj => {return obj.name == 'turret' &&!obj.isTeamObject(player) &&fgdo(player, obj) < 800 &&obj.active});
let emp_dedekt = turretsInRange.length >= 2;
let heal = new class { checkWeaponDmg(_, sold = true, tank = true) {
const { primaryVariant: v, weapons: [weapon] } = _;
const pV = v ? config.weaponVariants[v].val : 1;
const e = (tank && player.skins[40]) ? 3.3 : 1;
return items.weapons[weapon].dmg * e * pV;
}};
dange4 = (can_damage_object && near.dist2 < 200);
if (player.y2 >= config.mapScale / 2 - config.riverWidth / 2 && player.y2 <= config.mapScale / 2 + config.riverWidth / 2) {biome_hatID = 31;} else if (player.y2 <= config.snowBiomeTop) {biome_hatID = 15;} else {biome_hatID = 12;}
if (near.dist2 < 300 || can_damage_object || animalhit) {reload_hatID = 6;
                                                        }else if ((near && near.skinIndex == 53 && near.dist2 < 750 && near.reloads[53] == 0 && combatarmortoggle.auto_emp) || (emp_dedekt && combatarmortoggle.auto_emp)) {reload_hatID = 22;
                                                        } else {reload_hatID = biome_hatID;}

let hatChanger = function () {
let hatId = 0;
/*if (my.anti0Tick > 0) {
//hatId = 6;
} else if (near.dist2 <= 280 && near.skinIndex == 53) {
if (detect.onetick || detect.spiketick || !detect.reverse) {
if (player.skinIndex != 6 && (near.primaryVariant >= 2 && near.primaryIndex == 5)) {
my.reSync = false;
instaC.isTrue = false;
hatId = 6;
setTimeout(() => {hatId = 6;}, 1000);
}
}
} else*/
if (near.dist2 <= 280 && near.skinIndex == 53) {
                    if (detect.onetick || detect.spiketick || !detect.reverse) {
                        if (player.skinIndex != 6 && (near.primaryVariant >= 2 && near.primaryIndex == 5)) {
                            my.reSync = false;
                            instaC.isTrue = false;
                            place(0);
                            buyEquip(6, 0);
                            setTimeout(() => {
                                buyEquip(6, 0);
                            }, 1000);
                        }
                    }
                } else
    if (clicks.left || clicks.right) {
if (((!enemy.length || near.dist2 >= 200) && player.shameCount > 0 && (game.tick - player.bullTick) % config.serverUpdateRate === 0 && player.skinIndex != 45) || my.reSync) {
buyEquip(7, 0);
} else if (clicks.left) {
if (near.dist2 < 250 || animalhere) {
buyEquip((player.reloads[player.weapons[0]] == 0 ? (combatattacktoggle.bull_hit ? 7 : reload_hatID) : (combatattacktoggle.turret_combat && player.reloads[53] == 0 ? (animalhit ? 53 : reload_hatID) : reload_hatID)), 0);
}else if (wear_tank_object){
buyEquip((player.reloads[player.weapons[0]] == 0 ? 40 : reload_hatID), 0)
}else {
buyEquip(reload_hatID, 0)
}
} else if (clicks.right) {
buyEquip(player.reloads[clicks.right && player.weapons[1] == 10 ? player.weapons[1] : player.weapons[0]] == 0 ? 40 : reload_hatID, 0);
}



//} else if (traps.inTrap) {
//if ((traps.info.health <= items.weapons[player.weaponIndex].dmg ? false : player.reloads[player.weaponCode] == 0) && my.anti0Tick == 0) {
//hatId = antispiketickthreat ? 6 : 40;
//} else {
//hatId = 6;
//}

} else if (((!enemy.length || near.dist2 >= 300) && player.shameCount > 0 && (game.tick - player.bullTick) % config.serverUpdateRate === 0 && player.skinIndex != 45) || my.reSync) {
hatId = 7;


} else if (knockpush && combatattacktoggle.knockback_push && !(near.primaryVariant >= 2 && near.weapons[0] == 5)) {
hatId = 26;

} else if (near && near.dist2 <= 75 + near.scale * 1.8 && combatattacktoggle.spikegear_hammer_tick && player.shameCount <= 0 && !near.reloads[near.primaryIndex] && [5].includes(player.primaryIndex) && [10].includes(player.secondaryIndex) && !instaC.isTrue && player.reloads[player.weapons[0]] == 0 && player.reloads[player.weapons[1]] == 0 && player.reloads[53] == 0 && !(near.primaryIndex === 5 && near.primaryVariant >= 2)) {
if (combatattacktoggle.safe_spikegear_tick && [15,13,12].includes(near.secondaryIndex)) {
buyEquip(6, 0);
} else {
buyEquip(11, 0);
spikegeartick2 = true;
}
} else if (near && near.dist2 < 200 && player.shameCount <= 0 && combatattacktoggle.spikegear_tick && !near.reloads[near.primaryIndex] && [5].includes(player.primaryIndex) && !instaC.isTrue && player.reloads[player.weapons[0]] == 0 && player.reloads[53] == 0 && !(near.primaryIndex === 5 && near.primaryVariant >= 2)) {
if (combatattacktoggle.safe_spikegear_tick && [15,13,12].includes(near.secondaryIndex)) {
buyEquip(6, 0);
} else {
buyEquip(11, 0);
spikegeartick = true;
}

} else if (near && near.dist2 <= defensearmorrange && !near.reloads[near.primaryIndex] && combatarmortoggle.defense_armor) {
switch (defencehat_type.value) {case "1":hatId = 6;break;case "2":hatId = 26;break;case "3":hatId = 11;break;}
} else if ((near && near.skinIndex == 53 && near.dist2 < 750 && near.reloads[53] == 0 && combatarmortoggle.auto_emp) || (emp_dedekt && combatarmortoggle.auto_emp)){
buyEquip(22,0);
} else if (player.health < 100 && combatarmortoggle.auto_medic) {
hatId = 13
} else if ((can_damage_object && combatarmortoggle.spike_armor) || (animalheredef && combatarmortoggle.animal_armor)) {
hatId = 6;
} else if (combatarmortoggle.biome_armor) {
biomeGear(1);
}
buyEquip(hatId, 0);
};

let accessuar_system = function() {
if (near.dist2 <= defensearmorrange + 50 && combatarmortoggle.defense_armor) {
switch (defenceacc_type.value) {case "1":buyEquip(21, 1);break;case "2":buyEquip(19, 1);break;}
} else if (animalhere && combatarmortoggle.animal_armor) {
buyEquip(19, 1);
} else if (player.health < 100 && combatarmortoggle.auto_medic) {
buyEquip(13, 1);
} else if (combatarmortoggle.biome_armor) {
buyEquip(11, 1);
}
};

if (storeMenu.style.display != "block" && !instaC.isTrue && !instaC.ticking) {
hatChanger();
accessuar_system();
}

            let buildings = gameObjects.sort((a, b) => Math.hypot(player.y2 - a.y, player.x2 - a.x) - Math.hypot(player.y2 - b.y, player.x2 - b.x));
            let turretsCanHit = buildings.filter(
                obj =>
                obj.name == 'turret' && !obj.isTeamObject(player) &&
                fgdo(player, obj) < 680 &&
                obj.active
            );
            antiTurretSpam = turretsCanHit.length > 3;


            let buildings2 = gameObjects.sort((a, b) => Math.hypot(player.y2 - a.y, player.x2 - a.x) - Math.hypot(player.y2 - b.y, player.x2 - b.x));
            let turrets = buildings.filter(obj =>obj.name == 'turret'&& obj.active);


            dodgeSpike();
            if (combatattacktoggle.auto_push && enemy.length && !traps.inTrap && !instaC.ticking) {
                autoPush();
            } else {
                if (my.autoPush) {
                    my.autoPush = false;
                    packet("9", lastMoveDir || undefined, 1);
                }
            }

            if (instaC.ticking) {
                instaC.ticking = false;
            }
            if (instaC.syncHit) {
                instaC.syncHit = false;
            }
            if (player.empAnti) {
                player.empAnti = false;
            }
            if (player.soldierAnti) {
                player.soldierAnti = false;
            }
            if (my.anti0Tick > 0) {
                my.anti0Tick--
            }
            if (traps.replaced) {
                traps.replaced = false;
            }
            if (traps.antiTrapped) {
                traps.antiTrapped = false;
            }
        }
    }
}

// UPDATE LEADERBOARD:
function updateLeaderboard(data) {
    UTILS.removeAllChildren(leaderboardData);
    var tmpC = 1;
    for (var i = 0; i < data.length; i += 3) {
        (function(i) {
            UTILS.generateElement({
                class: "leaderHolder",
                parent: leaderboardData,
                children: [
                    UTILS.generateElement({
                        class: "leaderboardItem",
                        style: data[i] == player.sid ? "color: rgba(); font-size: 18px;" : "color: rgba(); font-size: 18px; padding: 1px;", // "font-size: 18px;",
                        text: (data[i + 1] != "" ? data[i + 1] : "unknown") + " "
                    }),
                    UTILS.generateElement({
                        class: "a", class: "leaderScore",
                        style: data[i] == player.sid ? "color: #fff; font-size: 18px;" : "color: #fff; font-size: 18px; padding: 1px;",
                        text: ("‎ " + UTILS.kFormat(data[i + 2]) || "‎ 0")
                    })
                ]
            });
        })(i);
        tmpC++;
    }
}

// LOAD GAME OBJECT:
function loadGameObject(data) {
    for (let i = 0; i < data.length;) {
        objectManager.add(data[i], data[i + 1], data[i + 2], data[i + 3], data[i + 4],
                          data[i + 5], items.list[data[i + 6]], true, (data[i + 7] >= 0 ? {
            sid: data[i + 7]
        } : null));
        i += 8;
    }
}

// ADD AI:
function loadAI(data) {
    for (let i = 0; i < ais.length; ++i) {
        ais[i].forcePos = !ais[i].visible;
        ais[i].visible = false;
    }
    if (data) {
        let tmpTime = performance.now();
        for (let i = 0; i < data.length;) {
            tmpObj = findAIBySID(data[i]);
            if (tmpObj) {
                tmpObj.index = data[i + 1];
                tmpObj.t1 = (tmpObj.t2 === undefined) ? tmpTime : tmpObj.t2;
                tmpObj.t2 = tmpTime;
                tmpObj.x1 = tmpObj.x;
                tmpObj.y1 = tmpObj.y;
                tmpObj.x2 = data[i + 2];
                tmpObj.y2 = data[i + 3];
                tmpObj.d1 = (tmpObj.d2 === undefined) ? data[i + 4] : tmpObj.d2;
                tmpObj.d2 = data[i + 4];
                tmpObj.health = data[i + 5];
                tmpObj.dt = 0;
                tmpObj.visible = true;
            } else {
                tmpObj = aiManager.spawn(data[i + 2], data[i + 3], data[i + 4], data[i + 1]);
                tmpObj.x2 = tmpObj.x;
                tmpObj.y2 = tmpObj.y;
                tmpObj.d2 = tmpObj.dir;
                tmpObj.health = data[i + 5];
                if (!aiManager.aiTypes[data[i + 1]].name) tmpObj.name = config.cowNames[data[i + 6]];
                tmpObj.forcePos = true;
                tmpObj.sid = data[i];
                tmpObj.visible = true;
            }
            i += 7;
        }
    }
}
// ANIMATE AI:
function animateAI(sid) {
    tmpObj = findAIBySID(sid);
    if (tmpObj) tmpObj.startAnim();
}

let detect = {
    insta: false,
    reverse: false,
    onetick: false,
    spiketick: false,
    barbarian: false,
    antibull: false,
    antibullhit: false,
    bowInsta: false
}
// GATHER ANIMATION:
function gatherAnimation(sid, didHit, index) {
    tmpObj = findPlayerBySID(sid);
    if (tmpObj) {
        tmpObj.startAnim(didHit, index);
        tmpObj.gatherIndex = index;
        if (index < 9) {
            tmpObj.primaryReload = -game.tickRate / items.weapons[index].speed
        } else {
            tmpObj.secondaryReload = -game.tickRate / items.weapons[index].speed
        }
        tmpObj.gathering = 1;
        tmpObj._attackedThisTickTempVariable = true;
        if(near.dist2 <= 175 && UTILS.getAngleDist(tmpDir, tmpObj.dir) <= config.gatherAngle){
          //  buyEquip(6, 0);
         //   buyEquip(13, 1);
            detect.spiketick = true;
        } else {
            detect.spiketick = false;
        }
        if (didHit) {
            let tmpObjects = objectManager.hitObj;
            objectManager.hitObj = [];
            game.tickBase(() => {
                // refind
                tmpObj = findPlayerBySID(sid);
                let val = items.weapons[index].dmg * (config.weaponVariants[tmpObj[(index < 9 ? "prima" : "seconda") + "ryVariant"]].val) * (items.weapons[index].sDmg || 1) * (tmpObj.skinIndex == 40 ? 3.3 : 1);
                tmpObjects.forEach((healthy) => {
                    healthy.health -= val;
                });
            }, 1);
        }
    }
}

// WIGGLE GAME OBJECT:
function wiggleGameObject(dir, sid) {
    tmpObj = findObjectBySid(sid);

    if (!tmpObj) return;

    tmpObj.xWiggle += config.gatherWiggle * Math.cos(dir);
    tmpObj.yWiggle += config.gatherWiggle * Math.sin(dir);

    if (tmpObj.health) {
        objectManager.hitObj.push(tmpObj);
    }
}

// SHOOT TURRET:
function shootTurret(sid, dir) {
    tmpObj = findObjectBySid(sid);

    if (!tmpObj) return;

    if (config.anotherVisual) {
        tmpObj.lastDir = dir;
    } else {
        tmpObj.dir = dir;
    }

    tmpObj.xWiggle += config.gatherWiggle * Math.cos(dir + Math.PI);
    tmpObj.yWiggle += config.gatherWiggle * Math.sin(dir + Math.PI);
}
let prevKillCount = 0;

function initAutoGG() {
    const killCounter = document.getElementById("killCounter");
    if (!killCounter) {
        setTimeout(initAutoGG, 500);
        return;
    }
    const observer = new MutationObserver(() => {
        const count = parseInt(killCounter.innerText, 10) || 0;
if (count > prevKillCount) {
    let difference = count - prevKillCount;
    prevKillCount = count; // Dərhal yeniləyirik ki, ikinci dəfə if-ə girməsin
    totalkills += difference;
    pushNotify(`{${near.name}} Killed`, "#fff");

    if (misctoggle.kill_chat) {
        const chatInput = document.getElementById("killchats01");
        const chat01 = chatInput.value;
        sendChat(chat01);
    }
}
    });

    observer.observe(killCounter, { childList: true, characterData: true, subtree: true });
}


initAutoGG();

let autoChatIndex = 0;
let autoChatInterval = null;
function startAutoChat() {
    if (autoChatInterval) clearInterval(autoChatInterval);
    autoChatInterval = setInterval(() => {
        if (misctoggle.auto_chat) {
            const inputs = [
                document.getElementById("autochats01"),
                document.getElementById("autochats02"),
                document.getElementById("autochats03")
            ];
            const currentInput = inputs[autoChatIndex];
            if (currentInput && currentInput.value.trim() !== "") {
                sendChat(currentInput.value);
            }
            autoChatIndex = (autoChatIndex + 1) % inputs.length;
        }
    }, 1000); // 1 saniyəlik interval
}
startAutoChat();


// UPDATE PLAYER VALUE:
function updatePlayerValue(index, value, updateView) {
    if (!player) return;

    player[index] = value;

    if (index == "points") {
        if (true) {
            autoBuy.hat();
            autoBuy.acc();
        }
    } else if (index == "kills") {
          //  sendChat("gg - AutoGG Happymod")
                      //  sendChat("Niggers: " + player.kills)
    }
}

// ACTION BAR:
function updateItems(data, wpn) {
    if (data) {
        if (wpn) {
            player.weapons = data;
            player.primaryIndex = player.weapons[0];
            player.secondaryIndex = player.weapons[1];
            if (!instaC.isTrue) {
                selectWeapon(player.weapons[0]);
            }
        } else {
            player.items = data;
        }
    }

    for (let i = 0; i < items.list.length; i++) {
        let tmpI = items.weapons.length + i;
        getEl("actionBarItem" + tmpI).style.display = player.items.indexOf(items.list[i].id) >= 0 ? "inline-block" : "none";
    }

    for (let i = 0; i < items.weapons.length; i++) {
        getEl("actionBarItem" + i).style.display = player.weapons[items.weapons[i].type] == items.weapons[i].id ? "inline-block" : "none";
    }

    let kms = player.weapons[0] == 3 && player.weapons[1] == 15;
    if (kms) {
        getEl("actionBarItem3").style.display = "none";
        getEl("actionBarItem4").style.display = "inline-block";
    }
}

// ADD PROJECTILE:
function addProjectile(x, y, dir, range, speed, indx, layer, sid) {
    projectileManager.addProjectile(x, y, dir, range, speed, indx, null, null, layer, inWindow).sid = sid;
    runAtNextTick.push(Array.prototype.slice.call(arguments));
}

// REMOVE PROJECTILE:
function remProjectile(sid, range) {
    for (let i = 0; i < projectiles.length; ++i) {
        if (projectiles[i].sid == sid) {
            projectiles[i].range = range;
            let tmpObjects = objectManager.hitObj;
            objectManager.hitObj = [];
            game.tickBase(() => {
                let val = projectiles[i].dmg;
                tmpObjects.forEach((healthy) => {
                    if (healthy.projDmg) {
                        healthy.health -= val;
                    }
                });
            }, 1);
        }
    }
}

// SHOW ALLIANCE MENU:
function setPlayerTeam(team, isOwner) {
    if (player) {
        player.team = team;
        player.isOwner = isOwner;
        if (team == null) alliancePlayers = [];
    }
}

function setAlliancePlayers(data) {
    alliancePlayers = data;
}

// STORE MENU:
function updateStoreItems(type, id, index) {
    if (index) {
        if (!type) {
            player.tails[id] = 1;
        } else {
            player.latestTail = id;
        }
    } else {
        if (!type) {
            player.skins[id] = 1;
            id == 7 && (my.reSync = true);
        } else {
            player.latestSkin = id;
        }
    }
}

function checkProfanityString(text) {
    var tmpString;
    let alwaysfalse = false;
    if (!alwaysfalse) {
        for (var i = 0; i < profanityList.length; ++i) {
            if (text.indexOf(profanityList[i]) > -1) {
                tmpString = "";
                for (var y = 0; y < profanityList[i].length; ++y) {
                    tmpString += tmpString.length ? "o" : "M";
                }
                var re = new RegExp(profanityList[i],"g");
                text = text.replace(re, tmpString);
            }
        }
    }
    return text;
}

// HAPPY MOD SHIT:
function loadHappyBullying(message) {
    if (getEl("HappyModTroll").checked) {
        if (message.includes("mod")) {
            sendChat("Happymod V4")
        }
        if (message.includes("what mod")) {
            sendChat("Happymod V4")
        }
        if (message.includes("bad")) {
            sendChat("bad = u bad?");
        } else if (message.includes("lag")) {
            sendChat("your issue");
        } else if (message.includes("Lag")) {
            sendChat("your issue");
        } else if (message.includes("cringe")) {
            sendChat("cringe = u cringe?");
        } else if (message.includes("mad")) {
            sendChat("mad = u mad?");
        } else if (message.includes("idiot")) {
            sendChat("idiot = u idiot?");
        } else if (message.includes("retard")) {
            sendChat("retard = u retard?");
        } else if (message.includes("ok and")) {
            sendChat("ok, u r noob");
        } else if (message.includes("get a life")) {
            sendChat("then i will get ur life");
        } else if (message.includes("cry about it")) {
            sendChat("cry about your dumbness");
        } else if (message.includes("fell off")) {
            sendChat("i leveled up");
        } else if (message.includes("get good")) {
            sendChat("U r right you should get good");
        } else if (message.includes("stupid")) {
            sendChat("stupid = u stupid?");
        } else if (message.includes("homo")) {
            sendChat("homo = u homo?");
        } else if (message.includes("noob")) {
            sendChat("noob = u noob?");
        } else if (message.includes("dumb")) {
            sendChat("dumb = u dumb?");
        } else if (message.includes("Dumb")) {
            sendChat("Dumb = You Dumb?");
        } else if (message.includes("moron")) {
            sendChat("moron = u moron?");
        } else if (message.includes("not fun")) {
            sendChat("so funny!");
        } else if (message.includes("Noob")) {
            sendChat("Noob = You Noob?");
        } else if (message.includes("nub")) {
            sendChat("nub = u nub?");
        } else if (message.includes("nob")) {
            sendChat("nob = u nob?");
        } else if (message.includes("nab")) {
            sendChat("nab = u nab?");
        } else if (message.includes("Nigga")) {
            sendChat("Nigga = u Nigger?");
        } else if (message.includes("Nigger")) {
            sendChat("Nigger = u Nigger?");
        } else if (message.includes("niggA")) {
            sendChat("Nigga = u Nigger?");
        } else if (message.includes("nigger")) {
            sendChat("Nigger = u Nigger?");
        } else if (message.includes("real")) {
            sendChat("yes im real");
        } else if (message.includes("loser")) {
            sendChat("loser = u loser?");
        } else if (message.includes("!c!dc")) {
            sendChat("pls disconnect this noob");
        } else if (message.includes("gay")) {
            sendChat("gay = u gay ?");
        } else if (message.includes("gae")) {
            sendChat("gae = u gay ?");
        } else if (message.includes("Gay")) {
            sendChat("Gay = You gay ?");
        } else if (message.includes("love u")) {
            sendChat("Gay??");
        } else if (message.includes("love you")) {
            sendChat("Gay??");
        } else if (message.includes("luv you")) {
            sendChat("Gay??");
        } else if (message.includes("luv u")) {
            sendChat("Gay??");
        } else if (message.includes("hi")) {
            sendChat("hi");
        } else if (message.includes("ngu")) {
            sendChat("ngu = u stupid?");
        } else if (message.includes("Ngu")) {
            sendChat("Ngu = u stupid?");
        } else if (message.includes("NGU")) {
            sendChat("Ngu = u NGU?");
        } else if (message.includes("hehe")) {
            sendChat("haha");
        } else if (message.includes("haha")) {
            sendChat("hahahahahaha");
        } else if (message.includes("huhu")) {
            sendChat("huhuhuhuhuhu");
        } else if (message.includes("ez")) {
            sendChat("ik you ez");
        } else if (message.includes("Ez")) {
            sendChat("ik you ez");
        } else if (message.includes("easy")) {
            sendChat("ik you ez");
        } else if (message.includes("gg")) {
            sendChat("gg ez");
        } else if (message.includes("Gg")) {
            sendChat("gg ez");
        } else if (message.includes("lol")) {
            sendChat("LOL LOL LOL");
        } else if (message.includes("Lol")) {
            sendChat("LOL LOL LOL");
        } else if (message.includes("lmao")) {
            sendChat("lmao LMAO LMAO LMAO");
        } else if (message.includes("Lmao")) {
            sendChat("lmao LMAO LMAO LMAO");
        } else if (message.includes("lvl")) {
            sendChat("why");
        } else if (message.includes("1v1")) {
            sendChat("why");
        } else if (message.includes("hello")) {
            sendChat("hello");
        } else if (message.includes("idk")) {
            sendChat("-_-");
        } else if (message.includes("xd")) {
            sendChat("lol");
        } else if (message.includes("Xd")) {
            sendChat("lol lol lol");
        } else if (message.includes("xD")) {
            sendChat("lol lol");
        } else if (message.includes("XD")) {
            sendChat("lmaooo");
        } else if (message.includes(":<")) {
            sendChat(":>");
        } else if (message.includes(":(")) {
            sendChat(":)");
        } else if (message.includes("):")) {
            sendChat("(:");
        } else if (message.includes(":C")) {
            sendChat("C:");
        } else if (message.includes(":c")) {
            sendChat("c:");
        } else if (message.includes("D:")) {
            sendChat(":D");
        } else if (message.includes("-_-")) {
            sendChat("xd");
        } else if (message.includes("sb")) { //chinese meaning. (stupid)
            sendChat("sb = u SB?");
        } else if (message.includes("AutoGG")) {
            sendChat("GG! EZ!");
        } else if (message.includes("Master Race")) {
            sendChat("GG! EZ!");
        } else if (message.includes("autoclicker")) {
            sendChat("autoclicker = Good");
        } else if (message.includes("auto clicker")) {
            sendChat("autoclicker = Good");
        } else if (message.includes("trash")) {
            sendChat("trash = u trash?");
        } else if (message.includes("suck")) {
            sendChat("suck = u suck?");
        } else if (message.includes("fatherless")) {
            sendChat("Yes you are fatherless");
        } else if (message.includes("motherless")) {
            sendChat("Yes you are motherless");
        }
    }
}
let allChats = [];
function ChatSee(sid, message) {
    let tmpPlayer = findPlayerBySID(sid);
    let countDown = 0;
    let coolDownForAI = false;
    tmpPlayer.chatMessage = checkProfanityString(message);
    tmpPlayer.chatCountdown = config.chatCountdown;
    if(player == tmpPlayer) {
        if (message == ".t -hl") {
            hatLoop = !hatLoop;
            setTimeout(() => {
                sendChat(`Hatloop ${hatLoop ? "Enabled." : "Disabled."}`);
            }, 500);
        }
        if (message == ".t -FastVTick") {
            autoOneFrameToggled = !autoOneFrameToggled;
            const oneFrameStatus = autoOneFrameToggled ? "On" : "Off";
            setTimeout(() => {
                sendChat(`Veltick(Fast): ${oneFrameStatus}`);
            }, 500);
        }
        if (message == ".t -song") {
            playSong();
            setTimeout(() => {
                sendChat(`Song`);
            }, 500);
        }
    }
    if (message.trim() === ".t -clearC") {
        resetMenuChText();
        return;
    }
    if (tmpPlayer) {
        allChats.push(new addCh(tmpPlayer.x, tmpPlayer.y, message, tmpPlayer));
    }
}
// SEND MESSAGE:
function receiveChat(sid, message) {
    let near = findPlayerBySID(sid);

    if (!near) return;

    if (!(/img/i.test(message) && /iframe/i.test(message))) {
        addMenuChText(`${near.name}[${near.sid}]`, message, "white");
    }

    near.chatMessage = message;
    near.chatCountdown = config.chatCountdown;

    if (message === 'insta em!' && player.reloads[player.weapons[0]] === 0 && player.reloads[player.weapons[1]] === 0) {
        packet("6", "");
        my.autoAim = true;
        selectWeapon(player.weapons[0]);
        buyEquip(7, 0);
        sendAutoGather();
        game.tickBase(() => {
            selectWeapon(player.weapons[1]);
            buyEquip(player.reloads[53] === 0 ? 53 : 6, 0);
            game.tickBase(() => {
                sendAutoGather();
                my.autoAim = false;
            }, 3);
        }, 2);
    }

    loadHappyBullying(message);
}

// MINIMAP:
function updateMinimap(data) {
    minimapData = data;
}

// SHOW ANIM TEXT:
function showText(x, y, value, type) {
    textManager.stack.push({
        x: x,
        y: y,
        value: value
    });
}

function ShowSettingText(life, setting, color = "#fff", ea = player) {
    textManager.showText(ea.x, ea.y, 40, 0.1, life, setting, color);
}

/** APPLY SOCKET CODES */

// RENDER LEAF:
function renderLeaf(x, y, l, r, ctxt) {
    let endX = x + (l * Math.cos(r));
    let endY = y + (l * Math.sin(r));
    let width = l * 0.4;
    ctxt.moveTo(x, y);
    ctxt.beginPath();
    ctxt.quadraticCurveTo(((x + endX) / 2) + (width * Math.cos(r + Math.PI / 2)),
                          ((y + endY) / 2) + (width * Math.sin(r + Math.PI / 2)), endX, endY);
    ctxt.quadraticCurveTo(((x + endX) / 2) - (width * Math.cos(r + Math.PI / 2)),
                          ((y + endY) / 2) - (width * Math.sin(r + Math.PI / 2)), x, y);
    ctxt.closePath();
    ctxt.fill();
    ctxt.stroke();
}

// RENDER CIRCLE:
function renderCircle(x, y, scale, tmpContext, dontStroke, dontFill) {
    tmpContext = tmpContext || mainContext;
    tmpContext.beginPath();
    tmpContext.arc(x, y, scale, 0, 2 * Math.PI);
    if (!dontFill) tmpContext.fill();
    if (!dontStroke) tmpContext.stroke();
}

function renderHealthCircle(x, y, scale, tmpContext, dontStroke, dontFill) {
    tmpContext = tmpContext || mainContext;
    tmpContext.beginPath();
    tmpContext.arc(x, y, scale, 0, 2 * Math.PI);
    if (!dontFill) tmpContext.fill();
    if (!dontStroke) tmpContext.stroke();
}

// RENDER STAR SHAPE:
function renderStar(ctxt, spikes, outer, inner, rounded = false) {
    let rot = Math.PI / 2 * 3;
    let x, y;
    let step = Math.PI / spikes;
    ctxt.beginPath();
    ctxt.moveTo(0, -outer);

    // Pokud je "rounded" true, zakulatíme spoje
    if (rounded) {
        ctxt.lineJoin = "round";
        ctxt.lineCap = "round";
    }

    for (let i = 0; i < spikes; i++) {
        x = Math.cos(rot) * outer;
        y = Math.sin(rot) * outer;
        ctxt.lineTo(x, y);
        rot += step;
        x = Math.cos(rot) * inner;
        y = Math.sin(rot) * inner;
        ctxt.lineTo(x, y);
        rot += step;
    }
    ctxt.lineTo(0, -outer);
    ctxt.closePath();

    // Vrátíme vlastnosti zpět na default, pokud jsme je změnili
    if (rounded) {
        ctxt.lineJoin = "miter";
        ctxt.lineCap = "butt";
    }
}

function renderHealthStar(ctxt, spikes, outer, inner) {
    let rot = Math.PI / 2 * 3;
    let x, y;
    let step = Math.PI / spikes;
    ctxt.beginPath();
    ctxt.moveTo(0, -outer);
    for (let i = 0; i < spikes; i++) {
        x = Math.cos(rot) * outer;
        y = Math.sin(rot) * outer;
        ctxt.lineTo(x, y);
        rot += step;
        x = Math.cos(rot) * inner;
        y = Math.sin(rot) * inner;
        ctxt.lineTo(x, y);
        rot += step;
    }
    ctxt.lineTo(0, -outer);
    ctxt.closePath();
}

// RENDER RECTANGLE:
function renderRect(x, y, w, h, ctxt, dontStroke, dontFill) {
    if (!dontFill) ctxt.fillRect(x - (w / 2), y - (h / 2), w, h);
    if (!dontStroke) ctxt.strokeRect(x - (w / 2), y - (h / 2), w, h);
}

function renderHealthRect(x, y, w, h, ctxt, dontStroke, dontFill) {
    if (!dontFill) ctxt.fillRect(x - (w / 2), y - (h / 2), w, h);
    if (!dontStroke) ctxt.strokeRect(x - (w / 2), y - (h / 2), w, h);
}

// RENDER RECTCIRCLE:
function renderRectCircle(x, y, s, sw, seg, ctxt, dontStroke, dontFill) {
    ctxt.save();
    ctxt.translate(x, y);
    seg = Math.ceil(seg / 2);
    for (let i = 0; i < seg; i++) {
        renderRect(0, 0, s * 2, sw, ctxt, dontStroke, dontFill);
        ctxt.rotate(Math.PI / seg);
    }
    ctxt.restore();
}

// RENDER BLOB:
function renderBlob(ctxt, spikes, outer, inner) {
    let rot = Math.PI / 2 * 3;
    let x, y;
    let step = Math.PI / spikes;
    ctxt.beginPath();
    ctxt.moveTo(0, -inner); // begin from middle

    for (let i = 0; i < spikes; i++) {
        // const of obj
        let tmpOuter = outer;

        // caclulate half circle and calculate quadratic equation primary school basics
        ctxt.quadraticCurveTo(
            Math.cos(rot + step) * tmpOuter,
            Math.sin(rot + step) * tmpOuter,
            Math.cos(rot + (step * 2)) * inner,
            Math.sin(rot + (step * 2)) * inner
        );

        rot += step * 2; // change angle for another point
    }

    ctxt.lineTo(0, -inner); // close half circle
    ctxt.closePath();
}

// RENDER TRIANGLE:
function renderTriangle(s, ctx) {
    ctx = ctx || mainContext;
    let h = s * (Math.sqrt(3) / 2);
    ctx.beginPath();
    ctx.moveTo(0, -h / 2);
    ctx.lineTo(-s / 2, h / 2);
    ctx.lineTo(s / 2, h / 2);
    ctx.lineTo(0, -h / 2);
    ctx.fill();
    ctx.closePath();
}

// PREPARE MENU BACKGROUND:
function prepareMenuBackground() {
    let tmpMid = config.mapScale / 2;
    objectManager.add(0, tmpMid, tmpMid + 200, 0, config.treeScales[3], 0);
    objectManager.add(1, tmpMid, tmpMid - 480, 0, config.treeScales[3], 0);
    objectManager.add(2, tmpMid + 300, tmpMid + 450, 0, config.treeScales[3], 0);
    objectManager.add(3, tmpMid - 950, tmpMid - 130, 0, config.treeScales[2], 0);
    objectManager.add(4, tmpMid - 750, tmpMid - 400, 0, config.treeScales[3], 0);
    objectManager.add(5, tmpMid - 700, tmpMid + 400, 0, config.treeScales[2], 0);
    objectManager.add(6, tmpMid + 800, tmpMid - 200, 0, config.treeScales[3], 0);
    objectManager.add(7, tmpMid - 260, tmpMid + 340, 0, config.bushScales[3], 1);
    objectManager.add(8, tmpMid + 760, tmpMid + 310, 0, config.bushScales[3], 1);
    objectManager.add(9, tmpMid - 800, tmpMid + 100, 0, config.bushScales[3], 1);
    objectManager.add(10, tmpMid - 800, tmpMid + 300, 0, items.list[4].scale, items.list[4].id, items.list[10]);
    objectManager.add(11, tmpMid + 650, tmpMid - 390, 0, items.list[4].scale, items.list[4].id, items.list[10]);
    objectManager.add(12, tmpMid - 400, tmpMid - 450, 0, config.rockScales[2], 2);
}

const speed = 1;
// RENDER PLAYERS:
function renderDeadPlayers(f, d) {
    mainContext.fillStyle = "#91b2db";
    const currentTime = Date.now();
    deadPlayers.filter(dead => dead.active).forEach((dead) => {
        if (!dead.startTime) {
            dead.startTime = currentTime;
            dead.angle = 0;
            dead.radius = 0.1;
        }
        const timeElapsed = currentTime - dead.startTime;
        const maxAlpha = 1;
        dead.alpha = Math.max(0, maxAlpha - (timeElapsed / 3000));
        dead.animate(delta);
        mainContext.globalAlpha = dead.alpha;
        mainContext.strokeStyle = outlineColor;
        mainContext.save();
        mainContext.translate(dead.x - f, dead.y - d);
        dead.radius -= 0.001;
        dead.angle += 0.0174533;
        const moveSpeed = 1;
        const x = dead.radius * Math.cos(dead.angle);
        const y = dead.radius * Math.sin(dead.angle);
        dead.x += x * moveSpeed;
        dead.y += y * moveSpeed;
        mainContext.rotate(dead.angle);
        renderDeadPlayer(dead, mainContext);
        mainContext.restore();
        mainContext.fillStyle = "#91b2db";
        if (timeElapsed >= 3000) {
            dead.active = false;
            dead.startTime = null;
        }
    });
}
// RENDER PLAYERS:
function renderPlayers(xOffset, yOffset, zIndex) {
    mainContext.globalAlpha = 1;
    mainContext.fillStyle = "#91b2db";
    for (let i = 0; i < players.length; ++i) {
        let tmpObj = players[i];
        if (tmpObj.zIndex == zIndex) {
            tmpObj.animate(delta);
            if (tmpObj.visible) {
                tmpObj.skinRot += 0.001 * delta;
                tmpDir =
                    !configs.showDir && !useWasd && tmpObj == player
                    ? configs.attackDir
                    ? getVisualDir()
                : getSafeDir()
                : tmpObj.dir || 0;
                mainContext.save();
                mainContext.translate(tmpObj.x - xOffset, tmpObj.y - yOffset);
                // RENDER PLAYER:
                mainContext.rotate(tmpDir + tmpObj.dirPlus);
                renderPlayer(tmpObj, mainContext);
                mainContext.restore();
            }
        }
    }
}
function renderDeadPlayer(obj, ctxt) {
    ctxt = ctxt || mainContext;
    ctxt.lineWidth = outlineWidth;
    ctxt.lineJoin = "miter";
    let handAngle = (Math.PI / 4) * (items.weapons[obj.weaponIndex].armS||1);
    let oHandAngle = (obj.buildIndex < 0)?(items.weapons[obj.weaponIndex].hndS||1):1;
    let oHandDist = (obj.buildIndex < 0)?(items.weapons[obj.weaponIndex].hndD||1):1;
    // TAIL/CAPE:
    renderTail2(13, ctxt, obj);
    // WEAPON BELLOW HANDS:
    if (obj.buildIndex < 0 && !items.weapons[obj.weaponIndex].aboveHand) {
        renderTool(items.weapons[obj.weaponIndex], config.weaponVariants[obj.weaponVariant || 0].src || "", obj.scale, 0, ctxt);
        if (items.weapons[obj.weaponIndex].projectile != undefined && !items.weapons[obj.weaponIndex].hideProjectile) {
            renderProjectile(obj.scale, 0,
                             items.projectiles[items.weapons[obj.weaponIndex].projectile], mainContext);
        }
    }
    // HANDS:
    ctxt.fillStyle = "#ececec";
    renderCircle(obj.scale * Math.cos(handAngle), (obj.scale * Math.sin(handAngle)), 14);
    renderCircle((obj.scale * oHandDist) * Math.cos(-handAngle * oHandAngle),
                 (obj.scale * oHandDist) * Math.sin(-handAngle * oHandAngle), 14);
    // WEAPON ABOVE HANDS:
    if (obj.buildIndex < 0 && items.weapons[obj.weaponIndex].aboveHand) {
        renderTool(items.weapons[obj.weaponIndex], config.weaponVariants[obj.weaponVariant || 0].src || "", obj.scale, 0, ctxt);
        if (items.weapons[obj.weaponIndex].projectile != undefined && !items.weapons[obj.weaponIndex].hideProjectile) {
            renderProjectile(obj.scale, 0,
                             items.projectiles[items.weapons[obj.weaponIndex].projectile], mainContext);
        }
    }
    // BUILD ITEM:
    if (obj.buildIndex >= 0) {
        var tmpSprite = getItemSprite(items.list[obj.buildIndex]);
        ctxt.drawImage(tmpSprite, obj.scale - items.list[obj.buildIndex].holdOffset, -tmpSprite.width / 2);
    }
    // BODY:
    renderCircle(0, 0, obj.scale, ctxt);
    // SKIN
    renderSkin2(48, ctxt, null, obj)
}
function renderPlayer(obj, ctxt) {
    ctxt = ctxt || mainContext;

    if (obj.lastX === undefined) {
        obj.lastX = obj.x;
        obj.lastY = obj.y;
    }

    let diffX = obj.x - obj.lastX;
    let diffY = obj.y - obj.lastY;

    let tmpDir = !configs.showDir && !useWasd && obj == player
                ? configs.attackDir ? getVisualDir() : getSafeDir()
                : obj.dir || 0;
    let totalRot = tmpDir + (obj.dirPlus || 0);
    let shouldShowShadow = misctoggle.prediction_ghost;
    let renderCount = (obj == player && shouldShowShadow && (Math.abs(diffX) > 0.1 || Math.abs(diffY) > 0.1)) ? 2 : 1;

    for (let i = 0; i < renderCount; i++) {
        ctxt.save();

        if (renderCount === 2 && i === 0) {
            let predX = diffX * 30;
            let predY = diffY * 30;

            ctxt.rotate(-totalRot);
            ctxt.translate(predX, predY);
            ctxt.rotate(totalRot);

            ctxt.globalAlpha = 0.4;
        } else {
            ctxt.globalAlpha = 1;
        }

        // --- SƏNİN ORİJİNAL RENDER KODUN ---
        ctxt.lineWidth = outlineWidth;
        ctxt.lineJoin = "miter";
        let handAngle = Math.PI / 4 * (items.weapons[obj.weaponIndex].armS || 1);
        let oHandAngle = obj.buildIndex < 0 ? items.weapons[obj.weaponIndex].hndS || 1 : 1;
        let oHandDist = obj.buildIndex < 0 ? items.weapons[obj.weaponIndex].hndD || 1 : 1;
        let katanaMusket = obj == player && obj.weapons[0] == 3 && obj.weapons[1] == 15;

        if (obj.tailIndex > 0) {
            renderTailTextureImage(obj.tailIndex, ctxt, obj);
        }
        if (obj.buildIndex < 0 && !items.weapons[obj.weaponIndex].aboveHand) {
            renderTool(items.weapons[katanaMusket ? 4 : obj.weaponIndex], config.weaponVariants[obj.weaponVariant].src, obj.scale, 0, ctxt);
            if (items.weapons[obj.weaponIndex].projectile != undefined && !items.weapons[obj.weaponIndex].hideProjectile) {
                renderProjectile(obj.scale, 0, items.projectiles[items.weapons[obj.weaponIndex].projectile], mainContext);
            }
        }
        ctxt.fillStyle = config.skinColors[obj.skinColor];
        renderCircle(obj.scale * Math.cos(handAngle), obj.scale * Math.sin(handAngle), 14);
        renderCircle(obj.scale * oHandDist * Math.cos(-handAngle * oHandAngle), obj.scale * oHandDist * Math.sin(-handAngle * oHandAngle), 14);

        if (obj.buildIndex < 0 && items.weapons[obj.weaponIndex].aboveHand) {
            renderTool(items.weapons[obj.weaponIndex], config.weaponVariants[obj.weaponVariant].src, obj.scale, 0, ctxt);
            if (items.weapons[obj.weaponIndex].projectile != undefined && !items.weapons[obj.weaponIndex].hideProjectile) {
                renderProjectile(obj.scale, 0, items.projectiles[items.weapons[obj.weaponIndex].projectile], mainContext);
            }
        }
        if (obj.buildIndex >= 0) {
            var tmpSprite = getItemSprite(items.list[obj.buildIndex]);
            ctxt.drawImage(tmpSprite, obj.scale - items.list[obj.buildIndex].holdOffset, -tmpSprite.width / 2);
        }
        renderCircle(0, 0, obj.scale, ctxt);
        if (obj.skinIndex > 0) {
            ctxt.rotate(Math.PI / 2);
            renderTextureSkin(obj.skinIndex, ctxt, null, obj);
        }
        // --- RENDER SONU ---

        ctxt.restore();
    }

    obj.lastX = obj.x;
    obj.lastY = obj.y;
}

// RENDER NORMAL SKIN
var skinSprites2 = {};
var skinPointers2 = {};
function renderSkin2(index, ctxt, parentSkin, owner) {
    tmpSkin = skinSprites2[index];
    if (!tmpSkin) {
        var tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        //tmpImage.src = "https://moomoo.io/img/hats/hat_" + index + ".png";
        tmpImage.src = "https://moomoo.io/img/hats/hat_" + index + ".png";
        skinSprites2[index] = tmpImage;
        tmpSkin = tmpImage;
    }
    var tmpObj = parentSkin||skinPointers2[index];
    if (!tmpObj) {
        for (var i = 0; i < hats.length; ++i) {
            if (hats[i].id == index) {
                tmpObj = hats[i];
                break;
            }
        }
        skinPointers2[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) ctxt.drawImage(tmpSkin, -tmpObj.scale/2, -tmpObj.scale/2, tmpObj.scale, tmpObj.scale);
    if (!parentSkin && tmpObj.topSprite) {
        ctxt.save();
        ctxt.rotate(owner.skinRot);
        renderSkin2(index + "_top", ctxt, tmpObj, owner);
        ctxt.restore();
    }
}

// RENDER SKIN:
function renderTextureSkin(index, ctxt, parentSkin, owner) {
    if (!(tmpSkin = skinSprites[index + (txt ? "lol" : 0)])) {
        var tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImage.src = setSkinTextureImage(index, "hat", index);
        skinSprites[index + (txt ? "lol" : 0)] = tmpImage;
        tmpSkin = tmpImage;
    }
    var tmpObj = parentSkin||skinPointers[index];
    if (!tmpObj) {
        for (var i = 0; i < hats.length; ++i) {
            if (hats[i].id == index) {
                tmpObj = hats[i];
                break;
            }
        }
        skinPointers[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) ctxt.drawImage(tmpSkin, -tmpObj.scale/2, -tmpObj.scale/2, tmpObj.scale, tmpObj.scale);
    if (!parentSkin && tmpObj.topSprite) {
        ctxt.save();
        ctxt.rotate(owner.skinRot);
        renderSkin(index + "_top", ctxt, tmpObj, owner);
        ctxt.restore();
    }
}

var FlareZHat = {
    20: "https://i.imgur.com/f5uhWCk.png",
};

function setSkinTextureImage(id, type, id2) {
    if (true) {
        if(FlareZHat[id] && type == "hat") {
            return FlareZHat[id];
        } else {
            if(type == "acc") {
                return ".././img/accessories/access_" + id + ".png";
            } else if(type == "hat") {
                return ".././img/hats/hat_" + id + ".png";
            } else {
                return ".././img/weapons/" + id + ".png";
            }
        }
    } else {
        if(type == "acc") {
            return ".././img/accessories/access_" + id + ".png";
        } else if(type == "hat") {
            return ".././img/hats/hat_" + id + ".png";
        } else {
            return ".././img/weapons/" + id + ".png";
        }
    }
}
// RENDER SKINS:
let skinSprites = {};
let skinPointers = {};
let tmpSkin;

function renderSkin(index, ctxt, parentSkin, owner) {
    tmpSkin = skinSprites[index];
    if (!tmpSkin) {
        let tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImage.src = "https://moomoo.io/img/hats/hat_" + index + ".png";
        skinSprites[index] = tmpImage;
        tmpSkin = tmpImage;
    }
    let tmpObj = parentSkin || skinPointers[index];
    if (!tmpObj) {
        for (let i = 0; i < hats.length; ++i) {
            if (hats[i].id == index) {
                tmpObj = hats[i];
                break;
            }
        }
        skinPointers[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) ctxt.drawImage(tmpSkin, -tmpObj.scale / 2, -tmpObj.scale / 2, tmpObj.scale, tmpObj.scale);
    if (!parentSkin && tmpObj.topSprite) {
        ctxt.save();
        ctxt.rotate(owner.skinRot);
        renderSkin(index + "_top", ctxt, tmpObj, owner);
        ctxt.restore();
    }
}

// RENDER TAIL:
var FlareZAcc = {
    21: "https://i.imgur.com/4ddZert.png",
    19: "https://i.imgur.com/sULkUZT.png",
    18: "https://i.imgur.com/sRGXKvJ.png",
};
function setTailTextureImage(id, type, id2) {
    if (true) {
        if(FlareZAcc[id] && type == "acc") {
            return FlareZAcc[id];
        } else {
            if(type == "acc") {
                return ".././img/accessories/access_" + id + ".png";
            } else if(type == "hat") {
                return ".././img/hats/hat_" + id + ".png";
            } else {
                return ".././img/weapons/" + id + ".png";
            }
        }
    } else {
        if(type == "acc") {
            return ".././img/accessories/access_" + id + ".png";
        } else if(type == "hat") {
            return ".././img/hats/hat_" + id + ".png";
        } else {
            return ".././img/weapons/" + id + ".png";
        }
    }
}
function renderTailTextureImage(index, ctxt, owner) {
    if (!(tmpSkin = accessSprites[index + (txt ? "lol" : 0)])) {
        var tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImage.src = setTailTextureImage(index, "acc");
        accessSprites[index + (txt ? "lol" : 0)] = tmpImage;
        tmpSkin = tmpImage;
    }
    var tmpObj = accessPointers[index];
    if (!tmpObj) {
        for (var i = 0; i < accessories.length; ++i) {
            if (accessories[i].id == index) {
                tmpObj = accessories[i];
                break;
            }
        }
        accessPointers[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) {
        ctxt.save();
        ctxt.translate(-20 - (tmpObj.xOff||0), 0);
        if (tmpObj.spin) ctxt.rotate(owner.skinRot);
        ctxt.drawImage(tmpSkin, -(tmpObj.scale/2), -(tmpObj.scale/2), tmpObj.scale, tmpObj.scale);
        ctxt.restore();
    }
}

let accessSprites = {};
let accessPointers = {};
var txt = true;

function renderTail(index, ctxt, owner) {
    tmpSkin = accessSprites[index];
    if (!tmpSkin) {
        let tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImage.src = "https://moomoo.io/img/accessories/access_" + index + ".png";
        accessSprites[index] = tmpImage;
        tmpSkin = tmpImage;
    }
    let tmpObj = accessPointers[index];
    if (!tmpObj) {
        for (let i = 0; i < accessories.length; ++i) {
            if (accessories[i].id == index) {
                tmpObj = accessories[i];
                break;
            }
        }
        accessPointers[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) {
        ctxt.save();
        ctxt.translate(-20 - (tmpObj.xOff || 0), 0);
        if (tmpObj.spin) ctxt.rotate(owner.skinRot);
        ctxt.drawImage(tmpSkin, -(tmpObj.scale / 2), -(tmpObj.scale / 2), tmpObj.scale, tmpObj.scale);
        ctxt.restore();
    }
}

var accessSprites2 = {};
var accessPointers2 = {};
function renderTail2(index, ctxt, owner) {
    tmpSkin = accessSprites2[index];
    if (!tmpSkin) {
        var tmpImage = new Image();
        tmpImage.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImage.src = "https://moomoo.io/img/accessories/access_" + index + ".png";
        accessSprites2[index] = tmpImage;
        tmpSkin = tmpImage;
    }
    var tmpObj = accessPointers2[index];
    if (!tmpObj) {
        for (var i = 0; i < accessories.length; ++i) {
            if (accessories[i].id == index) {
                tmpObj = accessories[i];
                break;
            }
        }
        accessPointers2[index] = tmpObj;
    }
    if (tmpSkin.isLoaded) {
        ctxt.save();
        ctxt.translate(-20 - (tmpObj.xOff||0), 0);
        if (tmpObj.spin) ctxt.rotate(owner.skinRot);
        ctxt.drawImage(tmpSkin, -(tmpObj.scale/2), -(tmpObj.scale/2), tmpObj.scale, tmpObj.scale);
        ctxt.restore();
    }
}

// mymymymy
let weaponsT = {
};

function setWpt(id, type) {
    if (true) {
        if(weaponsT[id] && type == "weapons") {
            return weaponsT[id];
        } else {
            if(type == "acc") {
                return ".././img/accessories/access_" + id + ".png";
            } else if(type == "hat") {
                return ".././img/hats/hat_" + id + ".png";
            } else {
                return ".././img/weapons/" + id + ".png";
            }
        }
    } else {
        if(type == "acc") {
            return ".././img/accessories/access_" + id + ".png";
        } else if(type == "hat") {
            return ".././img/hats/hat_" + id + ".png";
        } else {
            return ".././img/weapons/" + id + ".png";
        }
    }
}

// RENDER TOOL:
let toolSprites = {};
function renderTool(obj, variant, x, y, ctxt) {
    let tmpSrc = obj.src + (variant || "");
    let tmpSprite = toolSprites[tmpSrc];
    if (!tmpSprite) {
        tmpSprite = new Image();
        tmpSprite.onload = function () {
            this.isLoaded = true;
        };
        tmpSprite.src = "https://moomoo.io/img/weapons/" + tmpSrc + ".png";
        toolSprites[tmpSrc] = tmpSprite;
    }
    if (tmpSprite.isLoaded) {
        ctxt.drawImage(tmpSprite, x + obj.xOff - obj.length / 2, y + obj.yOff - obj.width / 2, obj.length, obj.width);
    }
}

// RENDER PROJECTILES:
function renderProjectiles(layer, f, d) {
    for (let i = 0; i < projectiles.length; i++) {
        tmpObj = projectiles[i];
        if (tmpObj.active && tmpObj.layer == layer && tmpObj.inWindow) {
            tmpObj.update(delta);
            if (tmpObj.active && isOnScreen(tmpObj.x - f, tmpObj.y - d, tmpObj.scale)) {
                mainContext.save();
                mainContext.translate(tmpObj.x - f, tmpObj.y - d);
                mainContext.rotate(tmpObj.dir);
                renderProjectile(0, 0, tmpObj, mainContext, 1);
                mainContext.restore();
            }
        }
    };
}
// RENDER PROJECTILE:
let projectileSprites = {};//fz iz zexy

function renderProjectile(x, y, obj, ctxt, debug) {
    if (obj.src) {
        let tmpSrc = items.projectiles[obj.indx].src;
        let tmpSprite = projectileSprites[tmpSrc];
        if (!tmpSprite) {
            tmpSprite = new Image();
            tmpSprite.onload = function() {
                this.isLoaded = true;
            }
            tmpSprite.src = "https://moomoo.io/img/weapons/" + tmpSrc + ".png";
            projectileSprites[tmpSrc] = tmpSprite;
        }
        if (tmpSprite.isLoaded) ctxt.drawImage(tmpSprite, x - (obj.scale / 2), y - (obj.scale / 2), obj.scale, obj.scale);
    } else if (obj.indx == 1) {
        ctxt.fillStyle = "#939393";
        renderCircle(x, y, obj.scale, ctxt);
    }
}

// RENDER AI:
let aiSprites = {};

function renderAI(obj, ctxt) {
    let tmpIndx = obj.index;
    let tmpSprite = aiSprites[tmpIndx];
    if (!tmpSprite) {
        let tmpImg = new Image();
        tmpImg.onload = function() {
            this.isLoaded = true;
            this.onload = null;
        };
        tmpImg.src = "https://moomoo.io/img/animals/" + obj.src + ".png";
        tmpSprite = tmpImg;
        aiSprites[tmpIndx] = tmpSprite;
    }
    if (tmpSprite.isLoaded) {
        let tmpScale = obj.scale * 1.2 * (obj.spriteMlt || 1);
        ctxt.drawImage(tmpSprite, -tmpScale, -tmpScale, tmpScale * 2, tmpScale * 2);
    }
}
// RENDER WATER BODIES:
function renderWaterBodies(f, d, ctxt, padding) {

    // MIDDLE RIVER:
    let tmpW = config.riverWidth + padding;
    let tmpY = (config.mapScale / 2) - d - (tmpW / 2);
    if (tmpY < maxScreenHeight && tmpY + tmpW > 0) {
        ctxt.fillRect(0, tmpY, maxScreenWidth, tmpW);
    }
}
let originalScales = {
    width: 1920,
    height: 1080
}
// knockBackPredict funksiyası eynilə qalır
function knockBackPredict() {
    let bfn = { x0: 0, y0: 0, x1: 0, y1: 0, instax: 0, instay: 0, turretx: 0, turrety: 0 };
    let bfo = Math.atan2(near.y2 - player.y2, near.x2 - player.x2);
    let bfp = Infinity;
    let bfq = gameObjects.filter(bfr => bfr.name == "pit trap" && bfr.active && bfr.isTeamObject(player) && UTILS.getDist(bfr, near, 0, 2) <= bfr.getScale() + player.scale + 5).sort((bfs, bft) => {
        return UTILS.getDist(bfs, near, 0, 2) - UTILS.getDist(bft, near, 0, 2);
    })[0];

    if (near.dist2 - player.scale * 1.8 <= items.weapons[player.weapons[0]].range && !bfq) {
        for (let bfv of gameObjects) {
            let bfw = bfn;
            if (bfv.dmg && bfv.active && bfv.isTeamObject(player)) {
                let bfx = (items.weapons[player.weapons[0]].knock || 0) * items.weapons[player.weapons[0]].range + player.scale * 2;
                let bfy = ![undefined, 9, 12, 13, 15].includes(player.weapons[1]) ? (items.weapons[player.weapons[1]].knock || 0) * items.weapons[player.weapons[1]].range + player.scale * 2 - 10 : player.weapons[1] != undefined ? 60 : 0;
                let bfz = bfx + bfy;
                let bga = player.reloads[53] == 0 ? bfx + bfy + 75 : bfz;
                let bgb = near.x2 + bfx * Math.cos(bfo);
                let bgc = near.y2 + bfx * Math.sin(bfo);
                let bgf = near.x2 + bfz * Math.cos(bfo);
                let bgg = near.y2 + bfz * Math.sin(bfo);

                bfw.x0 = bgb; bfw.y0 = bgc;
                bfw.instax = bgf; bfw.instay = bgg;

                if (UTILS.getDist({ x: bgb, y: bgc }, bfv, 0, 0) <= bfv.scale + player.scale && player.reloads[player.weapons[0]] == 0) {
                    return "insta them";
                }
                if (UTILS.getDist({ x: bgf, y: bgg }, bfv, 0, 0) <= bfv.scale + player.scale && player.reloads[player.weapons[0]] == 0 && player.reloads[player.weapons[1]] == 0) {
                    return "insta them";
                }
            }
        }
    }
    return false;
}


// RENDER GAME OBJECTS:
let gameObjectSprites = {};

function getResSprite(obj) {
    let biomeID = (obj.y >= config.mapScale - config.snowBiomeTop) ? 2 : ((obj.y <= config.snowBiomeTop) ? 1 : 0);
    let tmpIndex = (obj.type + "_" + obj.scale + "_" + biomeID);
    let tmpSprite = gameObjectSprites[tmpIndex];
    if (!tmpSprite) {


        let blurScale = 7;
        let tmpCanvas = document.createElement("canvas");
        tmpCanvas.width = tmpCanvas.height = (obj.scale * 2.1) + outlineWidth;
        let tmpContext = tmpCanvas.getContext('2d');
        tmpContext.translate((tmpCanvas.width / 2), (tmpCanvas.height / 2));
        tmpContext.rotate(UTILS.randFloat(0, Math.PI));
        tmpContext.strokeStyle = outlineColor;
        tmpContext.lineWidth = outlineWidth;
        tmpContext.shadowBlur = blurScale;
        tmpContext.shadowColor = `rgba(0, 0, 0, ${obj.alpha})`;
if (obj.type == 0) { // Tree
    let tmpScale;
    let dist = cdf(obj, player);
    tmpContext.globalAlpha = (dist <= 250 ? 0.6 : 1);
    let layers = [
        { scaleMult: 1.0, color: !biomeID ? "#7e9c42" : "#cbdce0", offset: 5 }, // Alt qat
        { scaleMult: 0.8, color: !biomeID ? "#9ebf57" : "#e3f1f4", offset: 2 }, // Orta qat
        { scaleMult: 0.5, color: !biomeID ? "#b4db62" : "#ffffff", offset: 0 } // Üst qat
    ];
    layers.forEach((layer, index) => {
        tmpScale = tmpObj.scale * layer.scaleMult;
        tmpContext.save();
        tmpContext.translate(0, -layer.offset);
        renderStar(tmpContext, 8, tmpScale, tmpScale * 0.7);
        tmpContext.fillStyle = layer.color;
        tmpContext.fill();
        if (index === 0) {
            tmpContext.strokeStyle = "rgba(0,0,0,0.1)";
            tmpContext.lineWidth = 4;
            tmpContext.stroke();
        }
        tmpContext.restore();
    });
    tmpContext.globalAlpha = 1;
} else if (obj.type == 1) {
            if (biomeID == 2) {// Cactus
                tmpContext.fillStyle = "#606060";
                renderStar(tmpContext, 6, obj.scale * 0.3, obj.scale * 0.71);
                tmpContext.fill();
                tmpContext.stroke();
                tmpContext.shadowBlur = null;
                tmpContext.shadowColor = null;
                tmpContext.fillStyle = "#89a54c";
                renderCircle(0, 0, obj.scale * 0.55, tmpContext);
                tmpContext.fillStyle = "#a5c65b";
                renderCircle(0, 0, obj.scale * 0.3, tmpContext, true);
                let flowerCount = 1;
                let flowerRadius = obj.scale * 0.2;
                let rotVal = (Math.PI * 2) / flowerCount;
                for (let i = 0; i < flowerCount; ++i) {
                    let flowerX = flowerRadius * Math.cos(rotVal * i);
                    let flowerY = flowerRadius * Math.sin(rotVal * i);
                    tmpContext.font = `${obj.scale * 0.4}px sans-serif`;
                    tmpContext.fillStyle = "#f7a9d2";
                    tmpContext.fillText("🌸", flowerX, flowerY);
                }
            }
    else {// Bush
let distPlayer = cdf(obj, player);
tmpContext.globalAlpha = (distPlayer <= 250 ? 0.6 : 1);
let bushLayers = [
    { s: 1.0, o: 6, c: biomeID ? "#cbdce0" : "#718b3f" }, // Alt qat (tünd)
    { s: 0.8, o: 3, c: biomeID ? "#e3f1f4" : "#89a54c" }, // Orta qat
    { s: 0.5, o: 0, c: biomeID ? "#ffffff" : "#a3c066" } // Üst qat (açıq)
];
bushLayers.forEach((layer, index) => {
    tmpContext.save();
    tmpContext.translate(0, -layer.o); // offset yerinə "o" istifadə olunub
    renderBlob(tmpContext, 6, tmpObj.scale * layer.s, tmpObj.scale * layer.s * 0.7);
    tmpContext.fillStyle = layer.c;
    tmpContext.fill();
    if (index === 0) {
        tmpContext.strokeStyle = "rgba(0,0,0,0.1)";
        tmpContext.lineWidth = 4;
        tmpContext.stroke();
    }
    tmpContext.restore();
});
let berries = 4;
let rotVal = (Math.PI * 2) / berries;
let berryColor = biomeID ? "#6a64af" : "#c15555";
for (let i = 0; i < berries; ++i) {
    let seed = (tmpObj.id || 0) + i;
    let bDist = (tmpObj.scale / 2.5) + (seed % 5);
    let bx = bDist * Math.cos(rotVal * i);
    let by = bDist * Math.sin(rotVal * i);
    let r = 11;
    tmpContext.save();
    tmpContext.translate(bx, by - 8);
     tmpContext.fillStyle = "rgba(0, 0, 0, 0.1)";
     renderCircle(0, 4, r, tmpContext);
    tmpContext.fillStyle = berryColor;
    renderCircle(0, 0, r, tmpContext);
    tmpContext.fillStyle = "rgba(255, 255, 255, 0.4)";
    renderCircle(-3, -3, r / 2.5, tmpContext);
    tmpContext.restore();
}
tmpContext.globalAlpha = 1;
              }
          }
        else
            if (obj.type == 2 || obj.type == 3) {//Stone & Goldstone
let distPlayer = cdf(obj, player);
tmpContext.globalAlpha = (distPlayer <= 250 ? 0.6 : 1);

// 1. Yerə düşən tünd kölgə
tmpContext.beginPath();
tmpContext.fillStyle = "rgba(0, 0, 0, 0.2)";
tmpContext.arc(0, 6, tmpObj.scale * 1.05, 0, Math.PI * 2);
tmpContext.fill();

// 2. Rəng təyini (Daş, Səhra daşı və ya Qızıl)
let baseCol, midCol, topCol;
if (obj.type == 2) { // Stone
    if (biomeID == 2) { // Desert
        baseCol = "#938d77"; midCol = "#a8a28d"; topCol = "#b2ab90";
    } else { // Normal
        baseCol = "#808080"; midCol = "#939393"; topCol = "#bcbcbc";
    }
} else { // Gold
    baseCol = "#c4a52e"; midCol = "#e0c655"; topCol = "#ebdca3";
}
let rockLayers = [
    { s: 1.0, o: 8, c: baseCol }, // Alt qat (Daha tünd/geniş)
    { s: 0.8, o: 4, c: midCol },  // Orta qat
    { s: 0.5, o: 0, c: topCol }   // Üst qat (Daha açıq/kiçik)
];
rockLayers.forEach((layer, index) => {
    tmpContext.save();
    tmpContext.translate(0, -layer.o); // Yuxarı doğru yüksəklik effekti
    renderStar(tmpContext, 3, tmpObj.scale * layer.s, tmpObj.scale * layer.s);
    tmpContext.fillStyle = layer.c;
    tmpContext.fill();
    if (index === 0) {
        tmpContext.strokeStyle = "rgba(0,0,0,0.15)";
        tmpContext.lineWidth = 5;
        tmpContext.stroke();
    } else if (index === 2) {
        tmpContext.strokeStyle = "rgba(255,255,255,0.2)";
        tmpContext.lineWidth = 2;
        tmpContext.stroke();
    }
    tmpContext.restore();
});

// Shadow təmizləmə
tmpContext.shadowBlur = null;
tmpContext.shadowColor = null;
tmpContext.globalAlpha = 1;
          }
          tmpSprite = tmpCanvas;
          gameObjectSprites[tmpIndex] = tmpSprite;


      }
      return tmpSprite;
  }


let itemSprites = [];
function getItemSprite(obj, asIcon) {
      let tmpSprite = itemSprites[obj.id];
      if (!tmpSprite || asIcon) {
          let blurScale = !asIcon ? 20 : 5;
          let tmpCanvas = document.createElement("canvas");
          let reScale = ((!asIcon && obj.name == "windmill") ? items.list[4].scale : obj.scale);
          tmpCanvas.width = tmpCanvas.height = (reScale * 2.5) + outlineWidth + (items.list[obj.id].spritePadding || 0) + blurScale;

          let tmpContext = tmpCanvas.getContext("2d");
          tmpContext.translate((tmpCanvas.width / 2), (tmpCanvas.height / 2));
          tmpContext.rotate(asIcon ? 0 : (Math.PI / 2));
          tmpContext.strokeStyle = outlineColor;
          tmpContext.lineWidth = outlineWidth * (asIcon ? (tmpCanvas.width / 81) : 1);
          if (!asIcon) {
              tmpContext.shadowBlur = 8;
              tmpContext.shadowColor = `rgba(0, 0, 0, 0.2)`;
          }

          if (obj.name == "apple") {
              tmpContext.fillStyle = "#c15555";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fillStyle = "#89a54c";
              let leafDir = -(Math.PI / 2);
              renderLeaf(obj.scale * Math.cos(leafDir), obj.scale * Math.sin(leafDir),
                         25, leafDir + Math.PI / 2, tmpContext);
          } else if (obj.name == "cookie") {
              tmpContext.fillStyle = "#cca861";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fillStyle = "#937c4b";
              let chips = 4;
              let rotVal = (Math.PI * 2) / chips;
              let tmpRange;
              for (let i = 0; i < chips; ++i) {
                  tmpRange = UTILS.randInt(obj.scale / 2.5, obj.scale / 1.7);
                  renderCircle(tmpRange * Math.cos(rotVal * i), tmpRange * Math.sin(rotVal * i),
                               UTILS.randInt(4, 5), tmpContext, true);
              }
          } else if (obj.name == "cheese") {
              tmpContext.fillStyle = "#f4f3ac";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fillStyle = "#c3c28b";
              let chips = 4;
              let rotVal = (Math.PI * 2) / chips;
              let tmpRange;
              for (let i = 0; i < chips; ++i) {
                  tmpRange = UTILS.randInt(obj.scale / 2.5, obj.scale / 1.7);
                  renderCircle(tmpRange * Math.cos(rotVal * i), tmpRange * Math.sin(rotVal * i),
                               UTILS.randInt(4, 5), tmpContext, true);
              }
          } else if (obj.name == "wood wall" || obj.name == "stone wall" || obj.name == "castle wall") {
    tmpContext.fillStyle = (obj.name == "castle wall") ? "#83898e" :(obj.name == "wood wall") ? "#a5974c" : "#939393";
    let sides = (obj.name == "castle wall") ? 4 : 3;
    renderStar(tmpContext, sides, obj.scale * 1.1, obj.scale * 1.1);
    tmpContext.fill();
    tmpContext.stroke();
    tmpContext.fillStyle = (obj.name == "castle wall") ? "#9da4aa" :(obj.name == "wood wall") ? "#c9b758" : "#bcbcbc";
    renderStar(tmpContext, sides, obj.scale * 0.65, obj.scale * 0.65);
    tmpContext.fill();
    tmpContext.beginPath();
    tmpContext.fill();


} else if (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" ||
                     obj.name == "spinning spikes") {
              tmpContext.fillStyle = (obj.name == "poison spikes") ? "#7b935d" : "#939393";
              let tmpScale = (obj.scale * 0.6);
              renderStar(tmpContext, (obj.name == "spikes") ? 5 : 6, obj.scale, tmpScale);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#a5974c";
              renderCircle(0, 0, tmpScale, tmpContext);
              tmpContext.fillStyle = "#c9b758";
              renderCircle(0, 0, tmpScale / 2, tmpContext, true);

          } else if (obj.name == "windmill" || obj.name == "faster windmill" || obj.name == "power mill") {
              tmpContext.fillStyle = "#a5974c";
              renderCircle(0, 0, reScale, tmpContext);
              tmpContext.fillStyle = "#c9b758";
              renderRectCircle(0, 0, reScale * 1.5, 29, 4, tmpContext);
              tmpContext.fillStyle = "#a5974c";
              renderCircle(0, 0, reScale * 0.5, tmpContext);


          } else if (obj.name == "mine") {
              tmpContext.fillStyle = "#939393";
              renderStar(tmpContext, 3, obj.scale, obj.scale);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#bcbcbc";
              renderStar(tmpContext, 3, obj.scale * 0.55, obj.scale * 0.65);
              tmpContext.fill();
          } else if (obj.name == "sapling") {
              for (let i = 0; i < 2; ++i) {
                  let tmpScale = obj.scale * (!i ? 1 : 0.5);
                  renderStar(tmpContext, 7, tmpScale, tmpScale * 0.7);
                  tmpContext.fillStyle = (!i ? "#9ebf57" : "#b4db62");
                  tmpContext.fill();
                  if (!i) tmpContext.stroke();
              }
          } else if (obj.name == "pit trap") {
              tmpContext.fillStyle = "#a5974c";
              renderStar(tmpContext, 3, obj.scale * 1.1, obj.scale * 1.1);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = outlineColor;
              renderStar(tmpContext, 3, obj.scale * 0.65, obj.scale * 0.65);
              tmpContext.fill();

          } else if (obj.name == "boost pad") {
              tmpContext.fillStyle = "#7e7f82";
              renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#dbd97d";
              renderTriangle(obj.scale * 1, tmpContext);
          } else if (obj.name == "turret") {
              tmpContext.fillStyle = "#a5974c";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#939393";
              let tmpLen = 50;
              renderRect(0, -tmpLen / 2, obj.scale * 0.9, tmpLen, tmpContext);
              renderCircle(0, 0, obj.scale * 0.6, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
          } else if (obj.name == "platform") {//abced
              tmpContext.fillStyle = "#cebd5f";
              let tmpCount = 4;
              let tmpS = obj.scale * 2;
              let tmpW = tmpS / tmpCount;
              let tmpX = -(obj.scale / 2);
              for (let i = 0; i < tmpCount; ++i) {
                  renderRect(tmpX - (tmpW / 2), 0, tmpW, obj.scale * 2, tmpContext);
                  tmpContext.fill();
                  tmpContext.stroke();
                  tmpX += tmpS / tmpCount;
              }
          } else if (obj.name == "healing pad") {
              tmpContext.fillStyle = "#7e7f82";
              renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#db6e6e";
              renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
          } else if (obj.name == "spawn pad") {
              tmpContext.fillStyle = "#7e7f82";
              renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.fillStyle = "#71aad6";
              renderCircle(0, 0, obj.scale * 0.6, tmpContext);
          } else if (obj.name == "blocker") {
              tmpContext.fillStyle = "#7e7f82";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.rotate(Math.PI / 4);
              tmpContext.fillStyle = "#db6e6e";
              renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
          } else if (obj.name == "teleporter") {
              tmpContext.fillStyle = "#7e7f82";
              renderCircle(0, 0, obj.scale, tmpContext);
              tmpContext.fill();
              tmpContext.stroke();
              tmpContext.rotate(Math.PI / 4);
              tmpContext.fillStyle = "#d76edb";
              renderCircle(0, 0, obj.scale * 0.5, tmpContext, true);
          }
          tmpSprite = tmpCanvas;
          if (!asIcon)
              itemSprites[obj.id] = tmpSprite;
      }
      return tmpSprite;
  }

function getItemSprite2(obj, tmpX, tmpY) {
let tmpContext = mainContext;
let reScale = (obj.name == "windmill" ? items.list[4].scale : obj.scale);
tmpContext.save();
tmpContext.translate(tmpX, tmpY);
tmpContext.rotate(obj.dir);
tmpContext.strokeStyle = outlineColor;
tmpContext.lineWidth = outlineWidth;
if (obj.name == "apple") {
tmpContext.fillStyle = "#c15555";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fillStyle = "#89a54c";
let leafDir = -(Math.PI / 2);
renderLeaf(obj.scale * Math.cos(leafDir), obj.scale * Math.sin(leafDir),
25, leafDir + Math.PI / 2, tmpContext);
} else if (obj.name == "cookie") {
tmpContext.fillStyle = "#cca861";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fillStyle = "#937c4b";
let chips = 4;
let rotVal = (Math.PI * 2) / chips;
let tmpRange;
for (let i = 0; i < chips; ++i) {
tmpRange = UTILS.randInt(obj.scale / 2.5, obj.scale / 1.7);
renderCircle(tmpRange * Math.cos(rotVal * i), tmpRange * Math.sin(rotVal * i),
UTILS.randInt(4, 5), tmpContext, true);
}
} else if (obj.name == "cheese") {
tmpContext.fillStyle = "#f4f3ac";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fillStyle = "#c3c28b";
let chips = 4;
let rotVal = (Math.PI * 2) / chips;
let tmpRange;
for (let i = 0; i < chips; ++i) {
tmpRange = UTILS.randInt(obj.scale / 2.5, obj.scale / 1.7);
renderCircle(tmpRange * Math.cos(rotVal * i), tmpRange * Math.sin(rotVal * i),
UTILS.randInt(4, 5), tmpContext, true);
}
} else if (obj.name == "wood wall" || obj.name == "stone wall" || obj.name == "castle wall") {
tmpContext.fillStyle = (obj.name == "castle wall") ? "#83898e" : (obj.name == "wood wall") ?
"#a5974c" : "#939393";
let sides = (obj.name == "castle wall") ? 4 : 3;
renderStar(tmpContext, sides, obj.scale * 1.1, obj.scale * 1.1);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = (obj.name == "castle wall") ? "#9da4aa" : (obj.name == "wood wall") ?
"#c9b758" : "#bcbcbc";
renderStar(tmpContext, sides, obj.scale * 0.65, obj.scale * 0.65);
tmpContext.fill();
} else if (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" ||
obj.name == "spinning spikes") {
tmpContext.fillStyle = (obj.name == "poison spikes") ? "#7b935d" : "#939393";
let tmpScale = (obj.scale * 0.6);
renderStar(tmpContext, (obj.name == "spikes") ? 5 : 6, obj.scale, tmpScale);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, tmpScale, tmpContext);
tmpContext.fillStyle = "#c9b758";
renderCircle(0, 0, tmpScale / 2, tmpContext, true);
} else if (obj.name == "windmill" || obj.name == "faster windmill" || obj.name == "power mill") {
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, reScale, tmpContext);
tmpContext.fillStyle = "#c9b758";
renderRectCircle(0, 0, reScale * 1.5, 29, 4, tmpContext);
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, reScale * 0.5, tmpContext);
} else if (obj.name == "mine") {
tmpContext.fillStyle = "#939393";
renderStar(tmpContext, 3, obj.scale, obj.scale);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#bcbcbc";
renderStar(tmpContext, 3, obj.scale * 0.55, obj.scale * 0.65);
tmpContext.fill();
} else if (obj.name == "sapling") {
for (let i = 0; i < 2; ++i) {
let tmpScale = obj.scale * (!i ? 1 : 0.5);
renderStar(tmpContext, 7, tmpScale, tmpScale * 0.7);
tmpContext.fillStyle = (!i ? "#9ebf57" : "#b4db62");
tmpContext.fill();
if (!i) tmpContext.stroke();
}
} else if (obj.name == "pit trap") {
tmpContext.fillStyle = "#a5974c";
renderStar(tmpContext, 3, obj.scale * 1.1, obj.scale * 1.1);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#5B5C5C";
renderStar(tmpContext, 3, obj.scale * 0.65, obj.scale * 0.65);
tmpContext.fill();
} else if (obj.name == "boost pad") {
tmpContext.fillStyle = "#7e7f82";
renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#dbd97d";
renderTriangle(obj.scale * 1, tmpContext);
} else if (obj.name == "turret") {
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#939393";
let tmpLen = 50;
renderRect(0, -tmpLen / 2, obj.scale * 0.9, tmpLen, tmpContext);
renderCircle(0, 0, obj.scale * 0.6, tmpContext);
tmpContext.fill();
tmpContext.stroke();
} else if (obj.name == "platform") {
tmpContext.fillStyle = "#cebd5f";
let tmpCount = 4;
let tmpS = obj.scale * 2;
let tmpW = tmpS / tmpCount;
let tmpX = -(obj.scale / 2);
for (let i = 0; i < tmpCount; ++i) {
renderRect(tmpX - (tmpW / 2), 0, tmpW, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpX += tmpS / tmpCount;
}
} else if (obj.name == "healing pad") {
tmpContext.fillStyle = "#7e7f82";
renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#db6e6e";
renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
} else if (obj.name == "spawn pad") {
tmpContext.fillStyle = "#7e7f82";
renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#71aad6";
renderCircle(0, 0, obj.scale * 0.6, tmpContext);
} else if (obj.name == "blocker") {
tmpContext.fillStyle = "#7e7f82";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.rotate(Math.PI / 4);
tmpContext.fillStyle = "#db6e6e";
renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
} else if (obj.name == "teleporter") {
tmpContext.fillStyle = "#7e7f82";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.rotate(Math.PI / 4);
tmpContext.fillStyle = "#d76edb";
renderCircle(0, 0, obj.scale * 0.5, tmpContext, true);
}
tmpContext.restore();
}

let objSprites = [];

function getObjSprite(obj) {
let tmpSprite = objSprites[obj.id];
if (!tmpSprite) {
let tmpCanvas = document.createElement("canvas");
tmpCanvas.width = tmpCanvas.height = obj.scale * 2.5 + outlineWidth + (items.list[obj.id].spritePadding || 0) + 0;
let tmpContext = tmpCanvas.getContext("2d");
tmpContext.translate(tmpCanvas.width / 2, tmpCanvas.height / 2);
tmpContext.rotate(Math.PI / 2);
tmpContext.strokeStyle = outlineColor;
tmpContext.lineWidth = outlineWidth;
if (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" || obj.name == "spinning spikes") {
tmpContext.fillStyle = obj.name == "poison spikes" ? "#7b935d" : "#939393";
let tmpScale = obj.scale * 0.6;
renderStar(tmpContext, obj.name == "spikes" ? 5 : 6, obj.scale, tmpScale);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, tmpScale, tmpContext);
tmpContext.fillStyle = "#c9b758";
renderCircle(0, 0, tmpScale / 2, tmpContext, true);
}else if (obj.name == "pit trap") {
tmpContext.fillStyle = "#a5974c";
renderStar(tmpContext, 3, obj.scale * 1.1, obj.scale * 1.1);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = outlineColor;
renderStar(tmpContext, 3, obj.scale * 0.65, obj.scale * 0.65);
tmpContext.fill();
}else if (obj.name == "pit trap") {
tmpContext.fillStyle = "#a5974c";
renderStar(tmpContext, 3, obj.scale * 1.1, obj.scale * 1.1);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = outlineColor;
renderStar(tmpContext, 3, obj.scale * 0.65, obj.scale * 0.65);
tmpContext.fill();
}
tmpSprite = tmpCanvas;
objSprites[obj.id] = tmpSprite;
}
return tmpSprite;
}

// Objects mark:
function getMarkSprite(obj, tmpContext, tmpX, tmpY) {
let center = {x: screenWidth / 2,y: screenHeight / 2,};
tmpContext.lineWidth = outlineWidth;
mainContext.globalAlpha = 0.2;
tmpContext.strokeStyle = outlineColor;
tmpContext.save();
tmpContext.translate(tmpX, tmpY);
tmpContext.rotate(90**10);
if (obj.name == "spikes" || obj.name == "greater spikes" || obj.name == "poison spikes" || obj.name == "spinning spikes") {
tmpContext.fillStyle = (obj.name == "poison spikes")?"#7b935d":"#939393";
var tmpScale = (obj.scale);
renderStar(tmpContext, (obj.name == "spikes")?5:6, obj.scale, tmpScale);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, tmpScale, tmpContext);
} else if (obj.name == "turret") {
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#939393";
let tmpLen = 50;
renderRect(0, -tmpLen / 2, obj.scale * 0.9, tmpLen, tmpContext);
renderCircle(0, 0, obj.scale * 0.6, tmpContext);
tmpContext.fill();
tmpContext.stroke();
} else if (obj.name == "teleporter") {
tmpContext.fillStyle = "#7e7f82";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.rotate(Math.PI / 4);
tmpContext.fillStyle = "#d76edb";
renderCircle(0, 0, obj.scale * 0.5, tmpContext, true);
} else if (obj.name == "platform") {
tmpContext.fillStyle = "#cebd5f";
let tmpCount = 4;
let tmpS = obj.scale * 2;
let tmpW = tmpS / tmpCount;
let tmpX = -(obj.scale / 2);
for (let i = 0; i < tmpCount; ++i) {
renderRect(tmpX - (tmpW / 2), 0, tmpW, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpX += tmpS / tmpCount;
}
} else if (obj.name == "healing pad") {
tmpContext.fillStyle = "#7e7f82";
renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#db6e6e";
renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
} else if (obj.name == "spawn pad") {
tmpContext.fillStyle = "#7e7f82";
renderRect(0, 0, obj.scale * 2, obj.scale * 2, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.fillStyle = "#71aad6";
renderCircle(0, 0, obj.scale * 0.6, tmpContext);
} else if (obj.name == "blocker") {
tmpContext.fillStyle = "#7e7f82";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fill();
tmpContext.stroke();
tmpContext.rotate(Math.PI / 4);
tmpContext.fillStyle = "#db6e6e";
renderRectCircle(0, 0, obj.scale * 0.65, 20, 4, tmpContext, true);
} else if (obj.name == "windmill" || obj.name == "faster windmill" || obj.name == "power mill") {
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, obj.scale, tmpContext);
tmpContext.fillStyle = "#c9b758";
renderRectCircle(0, 0, obj.scale * 1.5, 29, 4, tmpContext);
tmpContext.fillStyle = "#a5974c";
renderCircle(0, 0, obj.scale * 0.5, tmpContext);
} else if (obj.name == "pit trap") {
tmpContext.fillStyle = "#a5974c";
renderStar(tmpContext, 3, obj.scale * 1.1, obj.scale * 1.1);
tmpContext.fill();
tmpContext.stroke();
if (player && obj.owner && player.sid != obj.owner.sid && !tmpObj.findAllianceBySid(obj.owner.sid)) {
tmpContext.fillStyle = "#ffffff";
} else {
tmpContext.fillStyle = outlineColor;
}
renderStar(tmpContext, 3, obj.scale * 0.65, obj.scale * 0.65);
tmpContext.fill();
}
tmpContext.restore();
}

// OBJECT ON SCREEN:
function isOnScreen(x, y, s) {
    return (x + s >= 0 && x - s <= maxScreenWidth && y + s >= 0 && (y, s, maxScreenHeight));
}



// RENDER GAMEOBJECTS:
function renderGameObjects(layer, xOffset, yOffset) {
    let tmpSprite, tmpX, tmpY;
    let renderMainMenuObjects = inGame ? closeObjects : gameObjects;
    renderMainMenuObjects.forEach((tmp) => {
        tmpObj = tmp;
        if (tmpObj.alive || tmpObj.active) {
            tmpX = tmpObj.x + tmpObj.xWiggle - xOffset;
            tmpY = tmpObj.y + tmpObj.yWiggle - yOffset;
            if (layer == 0) {
                tmpObj.update(delta);
            }
            mainContext.globalAlpha = tmpObj.alpha;
            if (tmpObj.layer == layer && isOnScreen(tmpX, tmpY, tmpObj.scale + (tmpObj.blocker || 0))) {
                if (tmpObj.isItem) {
                    if ((tmpObj.dmg || tmpObj.trap) && !tmpObj.isTeamObject(player)) {
                        tmpSprite = getObjSprite(tmpObj);
                    } else {
                        tmpSprite = getItemSprite(tmpObj);
                    }
                    mainContext.save();
                    mainContext.translate(tmpX, tmpY);
                    let rotationSpeed = 0;
                    if (tmpObj.name === "spinning spikes") {
                        rotationSpeed = spikerota;
                    }
                    if (tmpObj.name === "windmill") {
                        rotationSpeed = millrota;
                    }
                    if (tmpObj.name === "power mill") {
                        rotationSpeed = millrota;
                    }
                    if (tmpObj.name === "faster windmill") {
                        rotationSpeed = millrota;
                    }
                    tmpObj.rotationAngle = (tmpObj.rotationAngle || 0) + rotationSpeed * delta || tmpObj.dir;
                    mainContext.rotate(tmpObj.rotationAngle);
                    if (!tmpObj.active) {
                        mainContext.scale(tmpObj.visScale / tmpObj.scale, tmpObj.visScale / tmpObj.scale);
                    }
                    mainContext.drawImage(tmpSprite, -(tmpSprite.width / 2), -(tmpSprite.height / 2));
                    if (tmpObj.blocker) {
                        mainContext.strokeStyle = "#db6e6e";
                        mainContext.globalAlpha = 0.3;
                        mainContext.lineWidth = 6;
                        renderCircle(0, 0, tmpObj.blocker, mainContext, false, true);
                    }
                    mainContext.restore();
                } else {
                    tmpSprite = getResSprite(tmpObj);
                    mainContext.drawImage(tmpSprite, tmpX - (tmpSprite.width / 2), tmpY - (tmpSprite.height / 2));
                }
            }

function findAllianceBySid(sid) {
   return player.team ? alliancePlayers.find((THIS)=>THIS === sid) : null;
}



if (layer == 2) {// Layer III Object System
if (tmpObj && player && typeof tmpObj.x === "number" && !isNaN(tmpObj.x) && typeof tmpObj.y === "number" && !isNaN(tmpObj.y)) {
if (tmpObj.health <= tmpObj.maxHealth) {
let distance = UTILS.getDist(tmpObj, player, 0, 0);
// turret reload bars




    // Place Marks
switch ((marks_type && marks_type.value) || 1) {
        case "1": // Neon
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_mark) || (isMine && visualtoggle.object_my_mark) || (isTeam && visualtoggle.object_teammate_mark)) {
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = (normalScale / 2.95 * 2) / 2.6;
        mainContext.save();
        let neonColor;
        if (isMine) neonColor = object_mymark_color;
        else if (isTeam) neonColor = object_teammatemark_color;
        else neonColor = object_enemymark_color;
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.shadowBlur = 25; // Çox geniş parıltı
        mainContext.shadowColor = neonColor;
        mainContext.globalAlpha = 0.3; // Arxa fon dumanı zəif olsun
        mainContext.fillStyle = neonColor;
        mainContext.fill();
        mainContext.shadowBlur = 12;
        mainContext.globalAlpha = 0.6;
        mainContext.fill();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius * 0.8, 0, 2 * Math.PI);
        mainContext.shadowBlur = 5;
        mainContext.shadowColor = "white"; // Nüvəni ağa yaxın parladır
        mainContext.fillStyle = "white";
        mainContext.globalAlpha = 0.9;
        mainContext.fill();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 3;
        mainContext.strokeStyle = neonColor;
        mainContext.globalAlpha = 1;
        mainContext.stroke();
        mainContext.lineWidth = 1;
        mainContext.strokeStyle = "white";
        mainContext.stroke();
        mainContext.restore();
    }
}
             break;

        case "2": // Klassic
if (true) {
let isMine = (tmpObj.owner.sid === player.sid);
let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
let isEnemy = (!isMine && !isTeam);
if ((isEnemy && visualtoggle.object_enemy_mark) || (isMine && visualtoggle.object_my_mark) || (isTeam && visualtoggle.object_teammate_mark)) {
if (!tmpObj.oldHealth) tmpObj.oldHealth = tmpObj.health;
const circleScale = 1.5;
const normalScale = tmpObj.scale / circleScale;
const outerRadius = normalScale / 2.95 * 2;
const outlineWidth = 10;
const healthWidth = 5;
const healthPercentage = tmpObj.health / tmpObj.maxHealth;
const Filler = (2 * Math.PI) * healthPercentage;
mainContext.save();
mainContext.beginPath();
mainContext.arc(tmpX, tmpY, outerRadius / 2.6, 0, 2 * Math.PI, false);
if (isMine) {
    mainContext.fillStyle = object_mymark_color;
} else if (isTeam) {
    mainContext.fillStyle = object_teammatemark_color;
} else if (isEnemy) {
    mainContext.fillStyle = object_enemymark_color;
}
mainContext.shadowColor = mainContext.fillStyle;
mainContext.shadowBlur = 5;
mainContext.fill();
mainContext.strokeStyle = "black";
mainContext.lineWidth = 2;
mainContext.stroke();
mainContext.closePath();
mainContext.restore();
}
}
            break;

        case "3": // Glass
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_mark) || (isMine && visualtoggle.object_my_mark) || (isTeam && visualtoggle.object_teammate_mark)) {
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const radius = (normalScale / 2.95 * 2) / 2.6;
        mainContext.save();
        let baseColor;
        if (isMine) baseColor = object_mymark_color;
        else if (isTeam) baseColor = object_teammatemark_color;
        else baseColor = object_enemymark_color;
        let glassGradient = mainContext.createRadialGradient(tmpX, tmpY, 0, tmpX, tmpY, radius);
        glassGradient.addColorStop(0, "rgba(255, 255, 255, 0.4)");
        glassGradient.addColorStop(0.5, baseColor);
        glassGradient.addColorStop(1, "rgba(0, 0, 0, 0.5)");
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, radius, 0, 2 * Math.PI);
        mainContext.fillStyle = glassGradient;
        mainContext.fill();
        mainContext.beginPath();
        mainContext.ellipse(tmpX - (radius * 0.3), tmpY - (radius * 0.3), radius * 0.4, radius * 0.2, Math.PI / 4, 0, 2 * Math.PI);
        let shineGradient = mainContext.createRadialGradient(tmpX - (radius * 0.3), tmpY - (radius * 0.3), 0, tmpX - (radius * 0.3), tmpY - (radius * 0.3), radius * 0.4);
        shineGradient.addColorStop(0, "rgba(255, 255, 255, 0.8)");
        shineGradient.addColorStop(1, "rgba(255, 255, 255, 0)");
        mainContext.fillStyle = shineGradient;
        mainContext.fill();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, radius, 0, 2 * Math.PI);
        mainContext.strokeStyle = "rgba(255, 255, 255, 0.6)";
        mainContext.lineWidth = 1.5;
        mainContext.stroke();
        mainContext.shadowBlur = 10;
        mainContext.shadowColor = "black";
        mainContext.restore();
    }
}
            break;

        case "4": // Pulsing
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_mark) || (isMine && visualtoggle.object_my_mark) || (isTeam && visualtoggle.object_teammate_mark)) {
        if (!tmpObj.oldHealth) tmpObj.oldHealth = tmpObj.health;
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = normalScale / 2.95 * 2;
        const pulse = (Math.sin(Date.now() / 300) + 1) / 2;
        const currentRadius = (outerRadius / 2.6) * (0.85 + pulse * 0.3);
        mainContext.save();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, currentRadius, 0, 2 * Math.PI, false);
        if (isMine) {
            mainContext.fillStyle = object_mymark_color;
        } else if (isTeam) {
            mainContext.fillStyle = object_teammatemark_color;
        } else if (isEnemy) {
            mainContext.fillStyle = object_enemymark_color;
        }
        mainContext.shadowColor = mainContext.fillStyle;
        mainContext.shadowBlur = 5 + (pulse * 10);
        mainContext.globalAlpha = 0.6 + (pulse * 0.4);
        mainContext.fill();
        mainContext.strokeStyle = "black";
        mainContext.lineWidth = 2;
        mainContext.globalAlpha = 1; // Border həmişə tam görünsün
        mainContext.stroke();
        mainContext.closePath();
        mainContext.restore();
    }
}
            break;

        case "5": // Hologram
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_mark) || (isMine && visualtoggle.object_my_mark) || (isTeam && visualtoggle.object_teammate_mark)) {
        if (!tmpObj.oldHealth) tmpObj.oldHealth = tmpObj.health;
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const radius = (normalScale / 2.95 * 2) / 2.6; // Orijinal radius hesablaman
        mainContext.save();
        let baseColor;
        if (isMine) baseColor = object_mymark_color;
        else if (isTeam) baseColor = object_teammatemark_color;
        else baseColor = object_enemymark_color;
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, radius, 0, 2 * Math.PI);
        mainContext.fillStyle = baseColor;
        mainContext.globalAlpha = 0.25; // İç hissə şəffaf olsun
        mainContext.fill();
        mainContext.strokeStyle = baseColor;
        mainContext.lineWidth = 1;
        for (let i = -radius; i < radius; i += 3) {
            let lineOffset = (Date.now() / 25) % 3;
            let yPos = i + lineOffset;
            let horizontalLength = Math.sqrt(Math.max(0, radius * radius - yPos * yPos));
            mainContext.beginPath();
            mainContext.globalAlpha = 0.3; // Cizgilərin şəffaflığı
            mainContext.moveTo(tmpX - horizontalLength, tmpY + yPos);
            mainContext.lineTo(tmpX + horizontalLength, tmpY + yPos);
            mainContext.stroke();
        }
        let scannerPos = ((Date.now() / 15) % (radius * 2)) - radius;
        let scanWidth = Math.sqrt(Math.max(0, radius * radius - scannerPos * scannerPos));
        mainContext.beginPath();
        mainContext.moveTo(tmpX - scanWidth, tmpY + scannerPos);
        mainContext.lineTo(tmpX + scanWidth, tmpY + scannerPos);
        mainContext.lineWidth = 2;
        mainContext.strokeStyle = "white"; // Skaner xətti parlaq görünsün
        mainContext.globalAlpha = 0.7;
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, radius, 0, 2 * Math.PI);
        mainContext.setLineDash([4, 4]); // [xətt uzunluğu, boşluq]
        mainContext.strokeStyle = baseColor;
        mainContext.lineWidth = 2;
        mainContext.globalAlpha = 1;
        mainContext.stroke();
        mainContext.setLineDash([]); // Digər çizimlər üçün dash-ı sıfırlayırıq
        mainContext.restore();
    }
}
            break;
    }

// Place Marks
switch ((health_type && health_type.value) || 1) {
        case "1": // Neon
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_health) || (isMine && visualtoggle.object_my_health) || (isTeam && visualtoggle.object_teammate_health)) {
        if (!tmpObj.oldHealth) { tmpObj.oldHealth = tmpObj.health; }
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = normalScale / 2.95 * 2;
        const healthPercentage = tmpObj.health / tmpObj.maxHealth;
        const startAngle = -Math.PI / 2;
        const endAngle = startAngle + (2 * Math.PI * healthPercentage);
        mainContext.save();
        mainContext.lineCap = 'round';
        let healthColor;
        if (isMine) healthColor = object_myhealth_color;
        else if (isTeam) healthColor = object_teammatehealth_color;
        else healthColor = object_enemyhealth_color;
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 8;
        mainContext.strokeStyle = "rgba(0, 0, 0, 0.4)";
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 10; // Daha qalın parıltı
        mainContext.strokeStyle = healthColor;
        mainContext.shadowBlur = 15;
        mainContext.shadowColor = healthColor;
        mainContext.globalAlpha = 0.5; // Dumanlı görünüş
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 6;
        mainContext.strokeStyle = healthColor;
        mainContext.shadowBlur = 5;
        mainContext.shadowColor = "white"; // Daxili parıltı üçün ağ kölgə
        mainContext.globalAlpha = 1;
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 2;
        mainContext.strokeStyle = "white"; // Tam mərkəzdən keçən ağ işıq
        mainContext.globalAlpha = 0.8;
        mainContext.stroke();
        mainContext.restore();
    }
}
            break;

        case "2": // Classic
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine; // Sənin obyektini team-dən ayırır
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_health) || (isMine && visualtoggle.object_my_health) || (isTeam && visualtoggle.object_teammate_health)) {
        if (!tmpObj.oldHealth) { tmpObj.oldHealth = tmpObj.health; }
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = normalScale / 2.95 * 2;
        const healthPercentage = tmpObj.health / tmpObj.maxHealth;
        const startAngle = -Math.PI / 2; // Yuxarıdan başlayır
        const endAngle = startAngle + (2 * Math.PI * healthPercentage);
        mainContext.save();
        mainContext.lineCap = 'round';
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 10;
        mainContext.strokeStyle = "rgba(0, 0, 0, 0.3)"; // Sönük qara/boz
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 6; // Bir az incə olması daha estetik görünür
        if (isMine) {
            mainContext.strokeStyle = object_myhealth_color;
        } else if (isTeam) {
            mainContext.strokeStyle = object_teammatehealth_color;
        } else {
            mainContext.strokeStyle = object_enemyhealth_color;
        }
        if (healthPercentage < 0.3) {
            mainContext.shadowBlur = 10;
            mainContext.shadowColor = mainContext.strokeStyle;
        }
        mainContext.stroke();
        mainContext.restore();
    }
}
           break;

       case "3": // Animation
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_health) || (isMine && visualtoggle.object_my_health) || (isTeam && visualtoggle.object_teammate_health)) {
        if (!tmpObj.oldHealth) { tmpObj.oldHealth = tmpObj.health; }
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = normalScale / 2.95 * 2;
        const healthPercentage = tmpObj.health / tmpObj.maxHealth;
        const startAngle = -Math.PI / 2;
        const endAngle = startAngle + (2 * Math.PI * healthPercentage);
        mainContext.save();
        mainContext.lineCap = 'round';
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 10;
        mainContext.strokeStyle = "rgba(0, 0, 0, 0.3)";
        mainContext.stroke();
        let hColor;
        if (isMine) {
            hColor = object_myhealth_color;
        } else if (isTeam) {
            hColor = object_teammatehealth_color;
        } else {
            hColor = object_enemyhealth_color;
        }
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 6;
        mainContext.strokeStyle = hColor;

        if (healthPercentage < 0.3) {
            mainContext.shadowBlur = 10;
            mainContext.shadowColor = hColor;
        }
        mainContext.stroke();
        const speed = Date.now() / 500;
        const dotX = tmpX + Math.cos(speed) * outerRadius;
        const dotY = tmpY + Math.sin(speed) * outerRadius;
        mainContext.beginPath();
        mainContext.arc(dotX, dotY, 4.5, 0, 2 * Math.PI);
        mainContext.fillStyle = "white";
        mainContext.shadowBlur = 4;
        mainContext.shadowColor = "rgba(0, 0, 0, 0.5)"; // Boz/Qara kölgə
        mainContext.fill();
        mainContext.beginPath();
        mainContext.arc(dotX, dotY, 3, 0, 2 * Math.PI);
        mainContext.fillStyle = hColor;
        mainContext.shadowBlur = 0; // Daxili rəng üçün kölgəni sıfırlayırıq
        mainContext.fill();

        mainContext.restore();
    }
}
           break;

        case "4": // Critical Shake
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_health) || (isMine && visualtoggle.object_my_health) || (isTeam && visualtoggle.object_teammate_health)) {
        if (!tmpObj.oldHealth) { tmpObj.oldHealth = tmpObj.health; }
        const healthPercentage = tmpObj.health / tmpObj.maxHealth;
        const isCritical = healthPercentage < 0.25;
        const pulse = isCritical ? (1 + Math.sin(Date.now() / 150) * 0.07) : 1;
        const circleScale = 1.5;
        const normalScale = (tmpObj.scale / circleScale) * pulse; // Radius pulse-a bağlanır
        const outerRadius = normalScale / 2.95 * 2;
        const startAngle = -Math.PI / 2;
        const endAngle = startAngle + (2 * Math.PI * healthPercentage);
        mainContext.save();
        mainContext.lineCap = 'round';
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 10;
        mainContext.strokeStyle = "rgba(0, 0, 0, 0.3)";
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 6;
        if (isMine) mainContext.strokeStyle = object_myhealth_color;
        else if (isTeam) mainContext.strokeStyle = object_teammatehealth_color;
        else mainContext.strokeStyle = object_enemyhealth_color;
        if (isCritical) {
            mainContext.shadowBlur = 15;
            mainContext.shadowColor = mainContext.strokeStyle;
        }
        mainContext.stroke();
        mainContext.restore();
    }
}
           break;

        case "5": // Segmented
if (true) {
    let isMine = (tmpObj.owner.sid === player.sid);
    let isTeam = findAllianceBySid(tmpObj.owner.sid) && !isMine;
    let isEnemy = (!isMine && !isTeam);
    if ((isEnemy && visualtoggle.object_enemy_health) || (isMine && visualtoggle.object_my_health) || (isTeam && visualtoggle.object_teammate_health)) {
        if (!tmpObj.oldHealth) { tmpObj.oldHealth = tmpObj.health; }
        const circleScale = 1.5;
        const normalScale = tmpObj.scale / circleScale;
        const outerRadius = normalScale / 2.95 * 2;
        const healthPercentage = tmpObj.health / tmpObj.maxHealth;
        const startAngle = -Math.PI / 2;
        const endAngle = startAngle + (2 * Math.PI * healthPercentage);
        mainContext.save();
        const circumference = 2 * Math.PI * outerRadius;
        const gap = 3; // Hissələr arasındakı boşluq (pixel)
        const segments = 10; // Cəmi neçə hissə olsun
        const segmentLen = (circumference / segments) - gap;
        mainContext.setLineDash([segmentLen, gap]);
        mainContext.lineCap = 'butt'; // Hissələrin uclarını kəsir ki, boşluq görünsün
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, 0, 2 * Math.PI);
        mainContext.lineWidth = 10;
        mainContext.strokeStyle = "rgba(0, 0, 0, 0.3)";
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.arc(tmpX, tmpY, outerRadius, startAngle, endAngle, false);
        mainContext.lineWidth = 6;
        if (isMine) mainContext.strokeStyle = object_myhealth_color;
        else if (isTeam) mainContext.strokeStyle = object_teammatehealth_color;
        else mainContext.strokeStyle = object_enemyhealth_color;
        mainContext.stroke();
        mainContext.setLineDash([]); // Digər çizimlər üçün sıfırlayırıq
        mainContext.restore();
    }
}
           break;
    }


if (true) {// Tracer Objects
if (visualtoggle.tracer_arrows){
let col1 = tracer_myobject_color;
let col2 = tracer_enemieobject_color;
let col3 = tracer_teammateobject_color;
let isMine = (tmpObj.owner.sid === player.sid);
let isTeam = findAllianceBySid(tmpObj.owner.sid);
let isEnemy = (!isMine && !isTeam);
if ((isEnemy && visualtoggle.tracer_enemie_object) || (isMine && visualtoggle.tracer_my_object) || (isTeam && visualtoggle.tracer_teammate_object)) {
mainContext.beginPath();
if (isMine) {
mainContext.strokeStyle = col1;
} else if (isTeam) {
mainContext.strokeStyle = col3;
} else if (isEnemy) {
mainContext.strokeStyle = col2;
}
mainContext.shadowColor = mainContext.strokeStyle;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
mainContext.closePath();
}
} else {
let isMine = (tmpObj.owner.sid === player.sid);
let isTeam = findAllianceBySid(tmpObj.owner.sid);
let isEnemy = (!isMine && !isTeam);
if ((isEnemy && visualtoggle.tracer_enemie_object) || (isMine && visualtoggle.tracer_my_object) || (isTeam && visualtoggle.tracer_teammate_object)) {
mainContext.save();
let finalColor;
if (isMine) {
finalColor = tracer_myobject_color;
} else if (isTeam) {
finalColor = tracer_teammateobject_color;
} else if (isEnemy) {
finalColor = tracer_enemieobject_color;
}
mainContext.beginPath();
mainContext.strokeStyle = finalColor;
mainContext.shadowColor = finalColor;
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 100;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size, arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size, arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}
}
}// End Tracer Objects



}
}
}
}
});



}


// miniMap System
class MapPing {
constructor(color, scale) {
this.init = function(x, y) {
this.scale = 0;
this.x = x;
this.y = y;
this.active = true;
};
this.update = function(ctxt, delta) {
if (this.active) {
this.scale += 0.05 * delta;
if (this.scale >= scale) {
this.active = false;
} else {
ctxt.globalAlpha = (1 - Math.max(0, this.scale / scale));
ctxt.beginPath();
ctxt.arc((this.x / config.mapScale) * mapDisplay.width, (this.y / config.mapScale) *
mapDisplay.width, this.scale, 0, 2 * Math.PI);
ctxt.stroke();
}
}
};
this.color = color;
}
}

function pingMap(x, y) {
tmpPing = mapPings.find(pings => !pings.active);
if (!tmpPing) {
tmpPing = new MapPing("#fff", config.mapPingScale);
mapPings.push(tmpPing);
}
tmpPing.init(x, y);
}

function updateMapMarker() {
mapMarker.x = player.x;
mapMarker.y = player.y;
}

function renderMinimap(delta) {
if (player && player.alive) {
mapContext.clearRect(0, 0, mapDisplay.width, mapDisplay.height);




// RENDER PINGS:
mapContext.lineWidth = 4;
for (let i = 0; i < mapPings.length; ++i) {
tmpPing = mapPings[i];
mapContext.strokeStyle = tmpPing.color;
tmpPing.update(mapContext, delta);
}
// RENDER BREAK TRACKS:
mapContext.globalAlpha = 1;

if (breakTrackers.length) {
    mapContext.strokeStyle = "#ff4d4d"; // Qırmızımtıl radar rəngi
    mapContext.lineWidth = 2;

    for (let i = 0; i < breakTrackers.length; i += 2) {
        let posX = (breakTrackers[i].x / config.mapScale) * mapDisplay.width;
        let posY = (breakTrackers[i].y / config.mapScale) * mapDisplay.height;

        // Xarici halqa
        mapContext.beginPath();
        mapContext.arc(posX, posY, 6, 0, Math.PI * 2);
        mapContext.stroke();

        // Daxili dolu nöqtə
        mapContext.fillStyle = "#ff4d4d";
        mapContext.beginPath();
        mapContext.arc(posX, posY, 2, 0, Math.PI * 2);
        mapContext.fill();
    }
}
// RENDER PLAYERS:
mapContext.globalAlpha = 1;
mapContext.fillStyle = "#fff";
renderCircle((player.x / config.mapScale) * mapDisplay.width,
(player.y / config.mapScale) * mapDisplay.height, 7, mapContext, true);
mapContext.fillStyle = "rgba(255,255,255,0.35)";
if (player.team && minimapData) {
for (let i = 0; i < minimapData.length;) {
renderCircle((minimapData[i] / config.mapScale) * mapDisplay.width,
(minimapData[i + 1] / config.mapScale) * mapDisplay.height, 7, mapContext, true);
i += 2;
}
}
// DEATH LOCATION:
if (lastDeath) {
mapContext.fillStyle = "#fc5553";
mapContext.font = "34px Hammersmith One";
mapContext.textBaseline = "middle";
mapContext.textAlign = "center";
mapContext.fillText("x", (lastDeath.x / config.mapScale) * mapDisplay.width,
(lastDeath.y / config.mapScale) * mapDisplay.height);
}
// MAP MARKER:
if (mapMarker) {
mapContext.fillStyle = "#fff";
mapContext.font = "34px Hammersmith One";
mapContext.textBaseline = "middle";
mapContext.textAlign = "center";
mapContext.fillText("x", (mapMarker.x / config.mapScale) * mapDisplay.width,
(mapMarker.y / config.mapScale) * mapDisplay.height);
}
}
}

// ICONS:
let crossHairs = ["", ""];
let crossHairSprites = {};
let iconSprites = {};
let icons = ["crown", "skull"];

function loadIcons() {
    for (let i = 0; i < icons.length; ++i) {
        let tmpSprite = new Image();
        tmpSprite.onload = function() {
            this.isLoaded = true;
        };
        tmpSprite.src = "./../img/icons/" + icons[i] + ".png";
        iconSprites[icons[i]] = tmpSprite;
    }
    for (let i = 0; i < crossHairs.length; ++i) {
        let tmpSprite = new Image();
        tmpSprite.onload = function() {
            this.isLoaded = true;
        };
        tmpSprite.src = crossHairs[i];
        crossHairSprites[i] = tmpSprite;
    }
}
loadIcons();


// UPDATE GAME:
function updateGame() {
    if (gameObjects.length && inGame) {
        if (loopIndex >= loopHats.length) {
            loopIndex = 0;
        }
        gameObjects.forEach((tmp) => {
            const distance = UTILS.getDistance(tmp.x, tmp.y, player.x, player.y);
            const inRange = distance <= 1200;

            if (inRange && !closeObjects.includes(tmp)) {
                closeObjects.push(tmp);
                tmp.render = true;
            } else if (!inRange && closeObjects.includes(tmp)) {
                tmp.render = false;
                closeObjects.splice(closeObjects.indexOf(tmp), 1);
            }
        });
    }

    // if (config.resetRender) {
    mainContext.beginPath();
    mainContext.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
    // }
    mainContext.globalAlpha = 1;

    if (player) {
        // INTERPOLATE PLAYERS AND AI:
        let lastTime = now - (1000 / config.serverUpdateRate);
        let tmpDiff;
        for (let i = 0; i < players.length + ais.length; ++i) {
            tmpObj = players[i] || ais[i - players.length];
            if (tmpObj && tmpObj.visible) {
                if (tmpObj.forcePos) {
                    tmpObj.x = tmpObj.x2;
                    tmpObj.y = tmpObj.y2;
                    tmpObj.dir = tmpObj.d2;
                } else {
                    let total = tmpObj.t2 - tmpObj.t1;
                    let fraction = lastTime - tmpObj.t1;
                    let ratio = (fraction / total);
                    let rate = 170;
                    tmpObj.dt += delta;
                    let tmpRate = Math.min(1.7, tmpObj.dt / rate);
                    tmpDiff = (tmpObj.x2 - tmpObj.x1);
                    tmpObj.x = tmpObj.x1 + (tmpDiff * tmpRate);
                    tmpDiff = (tmpObj.y2 - tmpObj.y1);
                    tmpObj.y = tmpObj.y1 + (tmpDiff * tmpRate);
                    tmpObj.dir = Math.lerpAngle(tmpObj.d2, tmpObj.d1, Math.min(1.2, ratio));
                }
            }
        }

        // MOVE CAMERA:
        let damping = 0.08;
        camX += (player.x - camX) * damping;
        camY += (player.y - camY) * damping;
    } else {
        camX = config.mapScale / 2;
        camY = config.mapScale / 2;
    }
    // RENDER CORDS:
    let xOffset = camX - (maxScreenWidth / 2);
    let yOffset = camY - (maxScreenHeight / 2);

    // RENDER BACKGROUND:
// --- MÖVCUD XƏRİTƏ ÇƏKMƏ KODUN ---
    if (config.snowBiomeTop - yOffset <= 0 && config.mapScale - config.snowBiomeTop - yOffset >= maxScreenHeight) {
        mainContext.fillStyle = "#b6db66";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
    } else if (config.mapScale - config.snowBiomeTop - yOffset <= 0) {
        mainContext.fillStyle = "#dbc666";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
    } else if (config.snowBiomeTop - yOffset >= maxScreenHeight) {
        mainContext.fillStyle = "#fff";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
    } else if (config.snowBiomeTop - yOffset >= 0) {
        mainContext.fillStyle = "#fff";
        mainContext.fillRect(0, 0, maxScreenWidth, config.snowBiomeTop - yOffset);
        mainContext.fillStyle = "#b6db66";
        mainContext.fillRect(0, config.snowBiomeTop - yOffset, maxScreenWidth,
                             maxScreenHeight - (config.snowBiomeTop - yOffset));
    } else {
        mainContext.fillStyle = "#b6db66";
        mainContext.fillRect(0, 0, maxScreenWidth,
                             (config.mapScale - config.snowBiomeTop - yOffset));
        mainContext.fillStyle = "#dbc666";
        mainContext.fillRect(0, (config.mapScale - config.snowBiomeTop - yOffset), maxScreenWidth,
                             maxScreenHeight - (config.snowBiomeTop - yOffset));
    }



    // RENDER WATER AREAS:
    if (!firstSetup) {
        waterMult += waterPlus * config.waveSpeed * delta;
        if (waterMult >= config.waveMax) {
            waterMult = config.waveMax;
            waterPlus = -1;
        } else if (waterMult <= 1) {
            waterMult = waterPlus = 1;
        }
        mainContext.globalAlpha = 1;
        mainContext.fillStyle = "#dbc666";
        renderWaterBodies(xOffset, yOffset, mainContext, config.riverPadding);
        mainContext.fillStyle = "#91b2db";
        renderWaterBodies(xOffset, yOffset, mainContext, (waterMult - 1) * 250);
    }

    // RENDER DEAD PLAYERS:
    mainContext.globalAlpha = 1;
    mainContext.strokeStyle = outlineColor;
    renderDeadPlayers(xOffset, yOffset);

    // RENDER BOTTOM LAYER:
    mainContext.globalAlpha = 1;
    mainContext.strokeStyle = outlineColor;
    renderGameObjects(-1, xOffset, yOffset);

    // RENDER PROJECTILES:
    mainContext.globalAlpha = 1;
    mainContext.lineWidth = outlineWidth;
    renderProjectiles(0, xOffset, yOffset);

    // RENDER PLAYERS:
    renderPlayers(xOffset, yOffset, 0);

    // RENDER AI:
    mainContext.globalAlpha = 1;
    for (let i = 0; i < ais.length; ++i) {
        tmpObj = ais[i];
        if (tmpObj.active && tmpObj.visible) {
            tmpObj.animate(delta);
            mainContext.save();
            mainContext.translate(tmpObj.x - xOffset, tmpObj.y - yOffset);
            mainContext.rotate(tmpObj.dir + tmpObj.dirPlus - (Math.PI / 2));
            renderAI(tmpObj, mainContext);
            mainContext.restore();
        }
    }
// RENDER GRID:



    renderGameObjects(0, xOffset, yOffset);
    renderProjectiles(1, xOffset, yOffset);
    renderGameObjects(1, xOffset, yOffset);
    renderPlayers(xOffset, yOffset, 1);
    renderGameObjects(2, xOffset, yOffset);
    renderGameObjects(3, xOffset, yOffset);

    // MAP BOUNDARIES:
    mainContext.fillStyle = "#000";
    mainContext.globalAlpha = 0.09;
    if (xOffset <= 0) {
        mainContext.fillRect(0, 0, -xOffset, maxScreenHeight);
    }
    if (config.mapScale - xOffset <= maxScreenWidth) {
        let tmpY = Math.max(0, -yOffset);
        mainContext.fillRect(config.mapScale - xOffset, tmpY, maxScreenWidth - (config.mapScale - xOffset), maxScreenHeight - tmpY);
    }
    if (yOffset <= 0) {
        mainContext.fillRect(-xOffset, 0, maxScreenWidth + xOffset, -yOffset);
    }
    if (config.mapScale - yOffset <= maxScreenHeight) {
        let tmpX = Math.max(0, -xOffset);
        let tmpMin = 0;
        if (config.mapScale - xOffset <= maxScreenWidth)
            tmpMin = maxScreenWidth - (config.mapScale - xOffset);
        mainContext.fillRect(tmpX, config.mapScale - yOffset,
                             (maxScreenWidth - tmpX) - tmpMin, maxScreenHeight - (config.mapScale - yOffset));
    }
// Menyu çəkilməzdən dərhal əvvəl bu kodu işlət:
if (typeof mainContext !== 'undefined' && typeof maxScreenWidth !== 'undefined') {
    let currentMapType = "1";
    if (typeof map_type !== 'undefined' && map_type && map_type.value) {
        currentMapType = map_type.value;
    }
    if (currentMapType === "1") {// Normal
        mainContext.save();
        mainContext.globalAlpha = 0.3;
        mainContext.fillStyle = "#332f2c";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.globalAlpha = 0.35;
        mainContext.fillStyle = "rgba(0, 0, 70, 1)";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.restore();
    } else if (currentMapType === "2") {// Night
        mainContext.save();
        mainContext.globalAlpha = 0.65;
        mainContext.fillStyle = "#050505";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.globalAlpha = 0.3;
        mainContext.fillStyle = "rgba(0, 5, 20, 1)";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.restore();
   } else if (currentMapType === "3") { // Realistic
        mainContext.save();
        mainContext.globalAlpha = 0.12;
        mainContext.fillStyle = "#4a4a4a"; // Boz ton
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.globalAlpha = 0.1;
        mainContext.fillStyle = "rgba(0, 0, 0, 1)";
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        let gradient = mainContext.createRadialGradient(maxScreenWidth / 2, maxScreenHeight / 2, maxScreenWidth * 0.3,maxScreenWidth / 2, maxScreenHeight / 2, maxScreenWidth * 0.9);
        gradient.addColorStop(0, "rgba(0, 0, 0, 0)");
        gradient.addColorStop(1, "rgba(0, 0, 0, 0.45)");
        mainContext.globalAlpha = 1.0;
        mainContext.fillStyle = gradient;
        mainContext.fillRect(0, 0, maxScreenWidth, maxScreenHeight);
        mainContext.restore();
    }
}

    if (typeof visualtoggle.visualsmap_volcano_area !== 'undefined' && visualtoggle.visualsmap_volcano_area) {
        let ratfrr = 60;
        let volcanoStartX = config.mapScale - 1920;
        let volcanoStartY = config.mapScale - 1920;
        let vulkanX = volcanoStartX - xOffset;
        let vulkanY = volcanoStartY - yOffset;
        let mapEndX = config.mapScale - xOffset;
        let mapEndY = config.mapScale - yOffset;
        mainContext.save();
        mainContext.setLineDash([]);
        mainContext.strokeStyle = "red";
        mainContext.lineWidth = 2;
        mainContext.globalAlpha = 0.3;
        mainContext.beginPath();
        if (vulkanX > 0 && vulkanX < maxScreenWidth) {
            mainContext.moveTo(vulkanX, Math.max(0, vulkanY));
            mainContext.lineTo(vulkanX, Math.min(maxScreenHeight, mapEndY));
        }
        if (vulkanY > 0 && vulkanY < maxScreenHeight) {
            mainContext.moveTo(Math.max(0, vulkanX), vulkanY);
            mainContext.lineTo(Math.min(maxScreenWidth, mapEndX), vulkanY);
        }
        mainContext.stroke();
        mainContext.restore();
    }
if (typeof visualtoggle.visualsmap_volcano_damage_area !== 'undefined' && visualtoggle.visualsmap_volcano_damage_area) {
        let volcanoCenterX = config.mapScale - 380;
        let volcanoCenterY = config.mapScale - 380;
        let damageRadius = 1500;
        let screenCenterX = volcanoCenterX - xOffset;
        let screenCenterY = volcanoCenterY - yOffset;
        mainContext.save();
        mainContext.beginPath();
        mainContext.rect(0 - xOffset, 0 - yOffset, config.mapScale, config.mapScale);
        mainContext.clip();
        mainContext.beginPath();
        mainContext.arc(screenCenterX, screenCenterY, damageRadius, 0, 2 * Math.PI);
        mainContext.strokeStyle = "red";
        mainContext.lineWidth = 1.5;
        mainContext.globalAlpha = 0.3;
        mainContext.stroke();
        mainContext.fillStyle = "rgba(255, 0, 0, 0.05)";
        mainContext.fill();
        mainContext.restore();
    }
if (typeof visualtoggle.visualsmap_volcano_spawn_animals_area !== 'undefined' && visualtoggle.visualsmap_volcano_spawn_animals_area) {
        let volcanoStartX = config.mapScale - 1920;
        let volcanoStartY = config.mapScale - 1920;
        let vulkanX = volcanoStartX - xOffset;
        let vulkanY = volcanoStartY - yOffset;
        mainContext.save();
        mainContext.setLineDash([]);
        mainContext.strokeStyle = "cyan";
        mainContext.lineWidth = 2;
        mainContext.globalAlpha = 0.3;
        mainContext.strokeRect(vulkanX, vulkanY, 400, 400);
        mainContext.restore();
    }



if (true) {//grid
mainContext.lineWidth = 3;
mainContext.globalAlpha = 0.05;
mainContext.beginPath();
let ratfrr = 60;
for (var x = -xOffset % ratfrr; x < maxScreenWidth; x += ratfrr) {
if (x > 0) {
mainContext.moveTo(x, 0);
mainContext.lineTo(x, maxScreenHeight);
}
}
for (var y = -yOffset % ratfrr; y < maxScreenHeight; y += ratfrr) {
if (y > 0) {
mainContext.moveTo(0, y);
mainContext.lineTo(maxScreenWidth, y);
}
}
mainContext.stroke();
}



// RENDER PLAYER AND AI UI:
mainContext.globalAlpha = 1;
for (let i = 0; i < players.length + ais.length; ++i) {
tmpObj = players[i] || ais[i - players.length];
if (tmpObj.visible) {
mainContext.strokeStyle = darkOutlineColor;


if (tmpObj.skinIndex != 10 || (tmpObj == player) || (tmpObj.team && tmpObj.team == player.team)) {// Name
// --- DAEMON STYLE: WHITE NAME & YELLOW ID ---
// --- DAEMON STYLE: DYNAMIC COLORED ID ---
if (tmpObj && tmpObj.visible) {
    let clanName = tmpObj.team ? "[" + tmpObj.team + "] " : "";
    let pName = tmpObj.name || "";
    let pSid = tmpObj.sid || "0";
    let tmpText = clanName + pName + (tmpObj.isPlayer ? " {" + pSid + "}" : "");

    if (tmpText !== "") {
        mainContext.font = "bold " + (tmpObj.nameScale || 30) + "px Hammersmith One";
        mainContext.textBaseline = "middle";
        mainContext.textAlign = "center";
        mainContext.lineWidth = (tmpObj.nameScale ? 14 : 11);
        mainContext.lineJoin = "round";
        mainContext.lineCap = "round";
        mainContext.strokeStyle = "#333";

        let tX = tmpObj.x - xOffset;
        let tY = (tmpObj.y - yOffset - tmpObj.scale) - (config.nameY || 0);

        // 1. ADI HƏMİŞƏ AĞ ÇƏKİRİK
        mainContext.fillStyle = "#fff";
        let mainName = clanName + pName;
        mainContext.strokeText(mainName, tX, tY);
        mainContext.fillText(mainName, tX, tY);

        // 2. ID RƏNGLƏRİ
        if (tmpObj.isPlayer) {
            let nameWidth = mainContext.measureText(mainName).width;
            let idString = " {" + pSid + "}";

            // Rəng Təyini
            if (tmpObj == player) {
                mainContext.fillStyle = "#39FF14"; // Sən (Yaşıl)
            } else if (tmpObj.team && tmpObj.team == player.team) {
                mainContext.fillStyle = "#FFFB00"; // Komanda (Sarı)
            } else {
                mainContext.fillStyle = "#FF1818"; // Düşmən (Qırmızı)
            }

            let idX = tX + (nameWidth / 2) + (mainContext.measureText(idString).width / 2) + 5;
            mainContext.strokeText(idString, idX, tY);
            mainContext.fillText(idString, idX, tY);
        }

        // --- 3D CROWN & OTHERS ---
        if (tmpObj.isLeader && iconSprites.crown.isLoaded) {
            let tmpS = (config.crownIconScale || 30) * 1.1;
            let bobbing = Math.sin(Date.now() / 250) * 5;
            let iconX = tX - (mainContext.measureText(tmpText).width / 2) - (tmpS * 0.8) + 5;
            let iconY = tY - (tmpS / 2) - 10 + bobbing;
            mainContext.save();
            mainContext.shadowBlur = 15;
            mainContext.shadowColor = "rgba(255, 215, 0, 0.8)";
            mainContext.drawImage(iconSprites.crown, iconX, iconY, tmpS, tmpS);
            mainContext.restore();
        }

        // Skull və Crosshair kodlarını bura olduğu kimi əlavə edə bilərsən
    }
}

// Angels

if (player) {
if (visualtoggle.look_angel) {
    mainContext.save();
    let screenX = player.x - xOffset;
    let screenY = player.y - yOffset;
    let realAngle = player.dir;
    if (realAngle !== undefined) {
        let lineLength = 60;
        let aimX = screenX + lineLength * Math.cos(realAngle);
        let aimY = screenY + lineLength * Math.sin(realAngle);
        mainContext.beginPath();
        mainContext.moveTo(screenX, screenY);
        mainContext.lineTo(aimX, aimY);
        mainContext.strokeStyle = "#FF69B4"; // Pink
        mainContext.lineWidth = 2;
        mainContext.lineCap = "round";
        mainContext.stroke();
    }
    mainContext.restore();
}
if (player && player.moveDir !== undefined && player.moveDir !== null && player.moveDir !== -1 && visualtoggle.move_angel) {
    mainContext.save();
    let sX = player.x - xOffset;
    let sY = player.y - yOffset;
    let moveAngle = player.moveDir;
    let moveLength = 55;
    let mX = sX + moveLength * Math.cos(moveAngle);
    let mY = sY + moveLength * Math.sin(moveAngle);
    mainContext.beginPath();
    mainContext.lineWidth = 2;
    mainContext.strokeStyle = "#00BFFF"; // Parlaq Mavi
    mainContext.lineCap = "round";
    mainContext.moveTo(sX, sY);
    mainContext.lineTo(mX, mY);
    mainContext.stroke();
    mainContext.restore();
}
}






    if (tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team)) {
    let targetX = tmpObj.x - xOffset;
    let targetY = tmpObj.y - yOffset;
    let nearReloads = (near && near.reloads) ? near.reloads : {};
    let nearPrimary = (near && near.primaryIndex !== undefined) ? near.primaryIndex : null;
    let reloadTime = (nearPrimary !== null && nearReloads[nearPrimary] !== undefined) ? nearReloads[nearPrimary] : 999;
    let isReadySoon = (reloadTime <= 150 && reloadTime > 10);
    let isTarget = (near && tmpObj === near && isReadySoon && (near.dist2 || 999) < 500);
    let istrap = (near && tmpObj === near && (near.dist2 || 999) < 500 && near.inTrap);
    const colors = {
        trap: "#a3a11a", // Sarı
        target: "#cc5151" // Qırmızı
    };
    let status = isTarget ? "target" : (istrap ? "trap" : null);
    if (status) {
        let waveColor = colors[status];
        mainContext.save();
        mainContext.globalAlpha = 0.3;
        mainContext.beginPath();
        mainContext.arc(targetX, targetY, tmpObj.scale || 35, 0, Math.PI * 2);
        mainContext.fillStyle = waveColor;
        mainContext.fill();
        mainContext.strokeStyle = waveColor;
        mainContext.lineWidth = (status === "target") ? 4 : 2;
        mainContext.stroke();
        mainContext.restore();
    }
}
    //Velocity tick
if (near && tmpObj === near && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team) && player.reloads[player.weapons[0]] == 0 && player.reloads[53] == 0 && player.primaryVariant >= 2 && player.weapons[0] === 5) {
        let dx = tmpObj.x - player.x;
        let dy = tmpObj.y - player.y;
        let distance = Math.hypot(dx, dy);
        if (distance > 230 && distance < 600) {
            mainContext.save();
            mainContext.beginPath();
            mainContext.arc(tmpObj.x - xOffset, tmpObj.y - yOffset, 240, 0, Math.PI * 2);
            mainContext.globalAlpha = 0.3; // 30% şəffaflıq
            mainContext.fillStyle = "#cc5151";
            const angle = Math.atan2(player.y - tmpObj.y, player.x - tmpObj.x);
            const boundaryX = tmpObj.x + Math.cos(angle) * 240;
            const boundaryY = tmpObj.y + Math.sin(angle) * 240;
            mainContext.beginPath();
            mainContext.arc(boundaryX - xOffset, boundaryY - yOffset, 30, 0, Math.PI * 2);
            mainContext.fill();

            mainContext.restore();
        }
}
    //bow tick
if (near && tmpObj === near && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team) && my.ageInsta && player.weapons[1] == 9 && player.age >= 9 && near.dist2 > 620 && combatattacktoggle.bow_tick) {
    mainContext.save();
    let enemyX = tmpObj.x - xOffset;
    let enemyY = tmpObj.y - yOffset;
    let radius = 620; // İstədiyin radius
    mainContext.strokeStyle = "rgba(80, 80, 80, 0.6)"; // Tünd boz, bir az şəffaf
    mainContext.lineWidth = 2; // Dairənin xətt qalınlığı
    mainContext.setLineDash([10, 15]); // Opsional: Xətti qırıq-qırıq edir (daha professional görünür)
    mainContext.shadowBlur = 5;
    mainContext.shadowColor = "#333333";
    mainContext.beginPath();
    mainContext.arc(enemyX, enemyY, radius, 0, Math.PI * 2);
    mainContext.stroke();
    mainContext.beginPath();
    mainContext.arc(enemyX, enemyY, 5, 0, Math.PI * 2);
    mainContext.fillStyle = "rgba(50, 50, 50, 0.8)";
    mainContext.fill();
    mainContext.restore();
}
//         < -- Manual Tick target -- >
if (near && manual_tick_target && tmpObj === near && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team)) {
    mainContext.save();
    let enemyX = tmpObj.x - xOffset;
    let enemyY = tmpObj.y - yOffset;
    let time = Date.now() / 1000;
    let colorWave = (Math.sin(time * 3) + 1) / 2;
    let r = Math.floor(200 * colorWave + 50 * (1 - colorWave)); // Ağmtıl mavi
    let g = Math.floor(230 * colorWave + 150 * (1 - colorWave));
    let b = 255; // Tam mavi tonu
    let currentColor = `rgb(${r}, ${g}, ${b})`;
    let rotation = time * 0.8; // Daha yavaş fırlanma
    let pulse = Math.sin(time * 4) * 5; // Yüngül döyüntü
    let size = 45 + pulse; // Hədəf çərçivəsinin ölçüsü
    let bracketLen = 15; // Künclərin uzunluğu
    mainContext.strokeStyle = currentColor;
    mainContext.shadowBlur = 12; // Mavi parıltı (Neon effekti)
    mainContext.shadowColor = currentColor;
    mainContext.lineWidth = 4;
    mainContext.lineCap = "round";
    for (let i = 0; i < 4; i++) {
        let angle = rotation + (i * Math.PI / 2);
        mainContext.beginPath();
        let cornerX = enemyX + Math.cos(angle) * size;
        let cornerY = enemyY + Math.sin(angle) * size;
        let side1X = enemyX + Math.cos(angle - 0.3) * size;
        let side1Y = enemyY + Math.sin(angle - 0.3) * size;
        let side2X = enemyX + Math.cos(angle + 0.3) * size;
        let side2Y = enemyY + Math.sin(angle + 0.3) * size;
        mainContext.moveTo(side1X, side1Y);
        mainContext.lineTo(cornerX, cornerY);
        mainContext.lineTo(side2X, side2Y);
        mainContext.stroke();
    }
    mainContext.restore();
}
let hideRange = items.weapons[player.weapons[0]].range + near.scale * 1.8 + 130;  // İtmə məsafəsi
let visualDist = items.weapons[player.weapons[0]].range + near.scale * 1.8 + 150; // Visualın duracağı sabit nöqtə
if (near && tmpObj === near && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team) && insta_kill_boost_target && insta_kill_target) {
    let dx = tmpObj.x - player.x;
    let dy = tmpObj.y - player.y;
    let distance = Math.sqrt(dx * dx + dy * dy);
    if (distance > hideRange) {
        mainContext.save();
        let alpha = Math.min(1, 1000 / distance);
        mainContext.globalAlpha = alpha;
        let angle = Math.atan2(dy, dx);
        let markerX = (tmpObj.x - Math.cos(angle) * visualDist) - xOffset;
        let markerY = (tmpObj.y - Math.sin(angle) * visualDist) - yOffset;
        mainContext.translate(markerX, markerY);
        mainContext.rotate(angle);
        let size = 30;
        mainContext.beginPath();
        mainContext.fillStyle = "#7e7f82";
        mainContext.strokeStyle = "#3d3f42";
        mainContext.lineWidth = 3;
        mainContext.rect(-size / 2, -size / 2, size, size);
        mainContext.fill();
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.fillStyle = "#dbd97d";
        let triSize = size * 0.6;
        mainContext.moveTo(triSize / 2, 0);
        mainContext.lineTo(-triSize / 2, -triSize / 2);
        mainContext.lineTo(-triSize / 2, triSize / 2);
        mainContext.closePath();
        mainContext.fill();
        mainContext.restore();
    }
}
//         < -- Insta kill target -- >
if (near && insta_kill_target && tmpObj === near && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team)) {
    mainContext.save();
    let enemyX = tmpObj.x - xOffset;
    let enemyY = tmpObj.y - yOffset;
    let time = Date.now() / 1000;
    let colorWave = (Math.sin(time * 2) + 1) / 2;
    let r = Math.floor(250 * colorWave + 140 * (1 - colorWave));
    let g = Math.floor(40 * colorWave + 70 * (1 - colorWave));
    let b = Math.floor(40 * colorWave + 70 * (1 - colorWave));
    let currentColor = `rgb(${r}, ${g}, ${b})`;
    let orbitRotation = time * 1.2;
    let pulse = Math.sin(time * 3) * 8;
    let radius = 50 + pulse;
    let arrowWidth = 0.18;
    let wingSize = 12;
    mainContext.strokeStyle = currentColor;
    mainContext.shadowBlur = 8;
    mainContext.shadowColor = currentColor;
    mainContext.lineWidth = 4; // Xətti bir az incəltdik ki, daha qəşəng dursun
    mainContext.lineJoin = "round";
    for (let i = 0; i < 4; i++) {
        let angle = orbitRotation + (i * Math.PI / 2);
        let tipX = enemyX + Math.cos(angle) * radius;
        let tipY = enemyY + Math.sin(angle) * radius;
        let leftX = enemyX + Math.cos(angle + arrowWidth) * (radius + wingSize);
        let leftY = enemyY + Math.sin(angle + arrowWidth) * (radius + wingSize);
        let rightX = enemyX + Math.cos(angle - arrowWidth) * (radius + wingSize);
        let rightY = enemyY + Math.sin(angle - arrowWidth) * (radius + wingSize);
        mainContext.beginPath();
        mainContext.moveTo(leftX, leftY);
        mainContext.lineTo(tipX, tipY);
        mainContext.lineTo(rightX, rightY);
        mainContext.stroke();
    }
    mainContext.restore();
}

//         < -- Enemie Tracer -- >
if (visualtoggle.tracer_enemie && tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team)) {
if (visualtoggle.tracer_arrows){
mainContext.strokeStyle = tracer_enemie_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
}else{
let arrowColor = tracer_enemie_color;
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}
}
//         < -- Skull Tracer -- >
if (visualtoggle.tracer_skull && tmpObj.iconIndex == 1 && iconSprites.skull.isLoaded && tmpObj.isPlayer && tmpObj != player) {
if (visualtoggle.tracer_arrows){
mainContext.strokeStyle = tracer_skull_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
}else{
let arrowColor = tracer_skull_color;
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}
}
//         < -- Clan Leader Tracer -- >
if (visualtoggle.tracer_clanleader && tmpObj.isLeader && iconSprites.crown.isLoaded && tmpObj.isPlayer && tmpObj != player) {
if (visualtoggle.tracer_arrows){
mainContext.strokeStyle = tracer_clanleader_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
}else{
let arrowColor = tracer_clanleader_color;
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}
}
//         < -- Teammate Tracer -- >
if (visualtoggle.tracer_teammate && tmpObj.isPlayer && tmpObj != player && tmpObj.team && tmpObj.team == player.team) {
if (visualtoggle.tracer_arrows){
mainContext.strokeStyle = tracer_teammate_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
}else{
let arrowColor = tracer_teammate_color;
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
}}
//         < -- Animal Tracer -- >
if (visualtoggle.tracer_animal && !tmpObj.isPlayer) {
if (visualtoggle.tracer_arrows){
mainContext.strokeStyle = tracer_animal_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(tmpObj.x - xOffset, tmpObj.y - yOffset);
mainContext.stroke();
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
} else {
let arrowColor = tracer_animal_color;
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(tmpObj.y - player.y, tmpObj.x - player.x);
const distance = Math.hypot(tmpObj.x - player.x, tmpObj.y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
let dx = tmpObj.x - player.x;
let dy = tmpObj.y - player.y;
let dist = Math.sqrt(dx * dx + dy * dy);
}}
//         < -- Bots Tracer -- >
if (visualtoggle.tracer_bot && player && bots.length) {
bots.forEach((bot) => {
if (!bot.inGame) return;
if (!isFinite(bot.x2) || !isFinite(bot.y2)) return;
const dx = bot.x2 - player.x;
const dy = bot.y2 - player.y;
const angle = Math.atan2(dy, dx);
const distance = Math.hypot(dx, dy);
if (visualtoggle.tracer_arrows) {
mainContext.strokeStyle = tracer_bot_color;
mainContext.lineWidth = 2;
mainContext.globalAlpha = 0.4;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(bot.x2 - xOffset, bot.y2 - yOffset);
mainContext.stroke();
} else {
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = tracer_bot_color;
mainContext.lineWidth = 7;
mainContext.globalAlpha = 1;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}});
mainContext.globalAlpha = 1;
}
//         < -- Message Tracer -- >
if (visualtoggle.tracer_notfication && breakTrackers && breakTrackers.length > 0) {
let arrowColor = tracer_notfication_color;
if (visualtoggle.tracer_arrows){
for (let i = 0; i < breakTrackers.length; i++) {
if (!breakTrackers[i]) continue; // əgər obyekt undefineddirsə keç
mainContext.strokeStyle = tracer_notfication_color;
mainContext.lineWidth = 3;
mainContext.globalAlpha = 1;
mainContext.beginPath();
mainContext.moveTo(player.x - xOffset, player.y - yOffset);
mainContext.lineTo(breakTrackers[i].x - xOffset, breakTrackers[i].y - yOffset);
mainContext.stroke();
}} else {
for (let i = 0; i < breakTrackers.length; i++) {
if (!breakTrackers[i]) continue; // əgər obyekt undefineddirsə keç
mainContext.save();
mainContext.lineCap = "round";
mainContext.lineJoin = "round";
mainContext.strokeStyle = arrowColor;
mainContext.globalAlpha = 1;
mainContext.lineWidth = 7;
const angle = Math.atan2(breakTrackers[i].y - player.y, breakTrackers[i].x - player.x);
const distance = Math.hypot(breakTrackers[i].x - player.x, breakTrackers[i].y - player.y);
const maxDist = 120;
const distFromPlayer = Math.min(distance, maxDist);
const arrowX = player.x + Math.cos(angle) * distFromPlayer - xOffset;
const arrowY = player.y + Math.sin(angle) * distFromPlayer - yOffset;
const size = 18;
const fixedAngle = angle + Math.PI;
mainContext.beginPath();
mainContext.moveTo(arrowX + Math.cos(fixedAngle + Math.PI / 4) * size,arrowY + Math.sin(fixedAngle + Math.PI / 4) * size);
mainContext.lineTo(arrowX, arrowY);
mainContext.lineTo(arrowX + Math.cos(fixedAngle - Math.PI / 4) * size,arrowY + Math.sin(fixedAngle - Math.PI / 4) * size);
mainContext.stroke();
mainContext.restore();
}}}














let currentY = config.nameY; // İlk barın başlayacağı hündürlük

//          < -- Player Bars -- >
if (tmpObj.health > 0) {
if (tmpObj.isPlayer) {
if (configs.healthbar && tmpObj.isPlayer) {tmpObj.oldHealth -= (tmpObj.oldHealth - tmpObj.health) / 10;} else {tmpObj.oldHealth = tmpObj.health;}
let reloads = {primary: (tmpObj.primaryIndex == undefined ? 1 : ((items.weapons[tmpObj.primaryIndex].speed - tmpObj.reloads[tmpObj.primaryIndex]) / items.weapons[tmpObj.primaryIndex].speed)),secondary: (tmpObj.secondaryIndex == undefined ? 1 : ((items.weapons[tmpObj.secondaryIndex].speed - tmpObj.reloads[tmpObj.secondaryIndex]) / items.weapons[tmpObj.secondaryIndex].speed)),turret: (2500 - tmpObj.reloads[53]) / 2500,};
if (!tmpObj.oldReloads) {tmpObj.oldReloads = { ...reloads };}
const smoothFactor = 0.1;

tmpObj.oldReloads.primary += (reloads.primary - tmpObj.oldReloads.primary) * smoothFactor;tmpObj.oldReloads.secondary += (reloads.secondary - tmpObj.oldReloads.secondary) * smoothFactor;tmpObj.oldReloads.turret += (reloads.turret - tmpObj.oldReloads.turret) * smoothFactor;
// Turret Reload bar
if (visualtoggle.player_turret_reload_bar) {
    mainContext.fillStyle = darkOutlineColor;
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth - config.healthBarPad, (tmpObj.y - yOffset + tmpObj.scale) + currentY, (config.healthBarWidth * 2) + (config.healthBarPad * 2), 14, 8);
    mainContext.fill();
    mainContext.fillStyle = "#e37a2e";
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth, (tmpObj.y - yOffset + tmpObj.scale) + currentY + config.healthBarPad, (config.healthBarWidth * 2) * tmpObj.oldReloads.turret, 14 - config.healthBarPad * 2, 7);
    mainContext.fill();
    currentY += 14;
}
// Weapons Reload bars
if (visualtoggle.player_weapon_reload_bar) {
    mainContext.fillStyle = darkOutlineColor;
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarPad + 5, (tmpObj.y - yOffset + tmpObj.scale) + currentY, (config.healthBarWidth - 5) + (config.healthBarPad * 2), 17, 8);
    mainContext.fill();
    mainContext.fillStyle = "#3C88C8";
    mainContext.roundRect(tmpObj.x - xOffset + 5, (tmpObj.y - yOffset + tmpObj.scale) + currentY + config.healthBarPad, (config.healthBarWidth * tmpObj.oldReloads.secondary + 1) - 5, 17 - config.healthBarPad * 2, 7);
    mainContext.fill();
    mainContext.fillStyle = darkOutlineColor;
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth - config.healthBarPad, (tmpObj.y - yOffset + tmpObj.scale) + currentY, config.healthBarWidth + (config.healthBarPad * 2) - 5, 17, 8);
    mainContext.fill();
    mainContext.fillStyle = "#3C88C8";
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth, (tmpObj.y - yOffset + tmpObj.scale) + currentY + config.healthBarPad, (config.healthBarWidth * tmpObj.oldReloads.primary + 1) - 5, 17 - config.healthBarPad * 2, 7);
    mainContext.fill();
    currentY += 17;
}
}
// Healthbar
if (configs.healthbar && tmpObj.isPlayer) {tmpObj.oldHealth -= (tmpObj.oldHealth - tmpObj.health) / 10;} else {tmpObj.oldHealth = tmpObj.health;}
var tmpWidth = config.healthBarWidth;
if (visualtoggle.player_health_bar) {
    let isAnimal = (!tmpObj.isPlayer);
    let isMine = (tmpObj === player);
    let isTeam = (tmpObj.team && tmpObj.team === player.team);
    let isEnemy = (!isMine && !isTeam && !isAnimal);
    if (isEnemy || isMine || isTeam || isAnimal) {
    mainContext.fillStyle = darkOutlineColor;
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth - config.healthBarPad, (tmpObj.y - yOffset + tmpObj.scale) + currentY, (config.healthBarWidth * 2) + (config.healthBarPad * 2), 17, 8);
    mainContext.fill();
    if (isMine) mainContext.fillStyle = "#8ecc51";
    else if (isTeam) mainContext.fillStyle = "#a3a11a";
    else if (isAnimal) mainContext.fillStyle = "#C3783D";
    else if (isEnemy) mainContext.fillStyle = "#cc5151";
    mainContext.roundRect(tmpObj.x - xOffset - config.healthBarWidth, (tmpObj.y - yOffset + tmpObj.scale) + currentY + config.healthBarPad, (config.healthBarWidth * 2) * (tmpObj.oldHealth / tmpObj.maxHealth), 17 - config.healthBarPad * 2, 7);
    mainContext.fill();
    currentY += 17
    }
}
// HP & Shame Counts
if (tmpObj == player && visualtoggle.player_hp_shame) {
    const hpText = `HP:${player.health.toFixed(0)}/100`;
    let shameDisplay = (tmpObj.skinIndex == 45 && tmpObj.shameTimer > 0) ? ` ${tmpObj.shameTimer}/30` : ` ${tmpObj.shameCount}/8`;
    mainContext.save();
    mainContext.font = "bold 18px 'Hammersmith One', sans-serif";
    mainContext.textBaseline = "middle";
    mainContext.strokeStyle = "#121212";
    mainContext.lineWidth = 7;
    mainContext.lineJoin = "round";
    const posX = (tmpObj.x - xOffset);
    const posY = (tmpObj.y - yOffset + tmpObj.scale) + currentY + 12;
    let hpWidth = mainContext.measureText(hpText).width;
    let shameWidth = mainContext.measureText(shameDisplay).width;
    let totalWidth = hpWidth + shameWidth;
    let startX = posX - (totalWidth / 2);
    mainContext.textAlign = "left";
    mainContext.strokeText(hpText, startX, posY);
    mainContext.strokeText(shameDisplay, startX + hpWidth, posY);
    mainContext.fillStyle = "#e0e0e0";
    mainContext.fillText(hpText, startX, posY);
    mainContext.fillText(shameDisplay, startX + hpWidth, posY);
    mainContext.restore();
    currentY += 20;
}
}


if (tmpObj.isPlayer && tmpObj != player && (!tmpObj.team || tmpObj.team != player.team)) {//Enemy HP & Shame
if (tmpObj && visualtoggle.player_hp_shame) {
const hpText = `HP:${tmpObj.health.toFixed(0)}/100`;
let shameDisplay = (tmpObj.skinIndex == 45 && tmpObj.shameTimer > 0) ? ` ${tmpObj.shameTimer}/30` : ` ${tmpObj.shameCount}/8`;
mainContext.save();
mainContext.font = "bold 18px 'Hammersmith One', sans-serif";
mainContext.textBaseline = "middle";
mainContext.strokeStyle = "#121212";
mainContext.lineWidth = 7;
mainContext.lineJoin = "round";
mainContext.miterLimit = 2;
const baseX = (tmpObj.x - xOffset) - 18;
const posY = (tmpObj.y - yOffset + tmpObj.scale) + currentY + 12;
let hpWidth = mainContext.measureText(hpText).width;
mainContext.textAlign = "center";
mainContext.strokeText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.strokeText(shameDisplay, baseX + (hpWidth / 2) + 2, posY);
mainContext.fillStyle = "#e0e0e0";
mainContext.textAlign = "center";
mainContext.fillText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.fillText(shameDisplay, baseX + (hpWidth / 2) + 2, posY);
mainContext.restore();
}
}
if (tmpObj.isPlayer && tmpObj != player && tmpObj.team && tmpObj.team == player.team) {// Teammate HP & Shame
if (tmpObj && visualtoggle.player_hp_shame) {
const hpText = `HP:${tmpObj.health.toFixed(0)}/100`;
mainContext.save();
mainContext.font = "bold 18px 'Hammersmith One', sans-serif";
mainContext.textBaseline = "middle";
mainContext.strokeStyle = "#121212";
mainContext.lineWidth = 7;
mainContext.lineJoin = "round";
mainContext.miterLimit = 2;
const baseX = (tmpObj.x - xOffset);
const posY = (tmpObj.y - yOffset + tmpObj.scale) + currentY + 12;
let hpWidth = mainContext.measureText(hpText).width;
mainContext.textAlign = "center";
mainContext.strokeText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.fillStyle = "#e0e0e0";
mainContext.textAlign = "center";
mainContext.fillText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.restore();
}}
if (!tmpObj.isPlayer) {//Animal HP
if (tmpObj && visualtoggle.player_hp_shame) {
const hpText = `HP:${tmpObj.health.toFixed(0)}/${tmpObj.maxHealth}`;
mainContext.save();
mainContext.font = "bold 18px 'Hammersmith One', sans-serif";
mainContext.textBaseline = "middle";
mainContext.strokeStyle = "#121212";
mainContext.lineWidth = 7;
mainContext.lineJoin = "round";
mainContext.miterLimit = 2;
const baseX = (tmpObj.x - xOffset);
const posY = (tmpObj.y - yOffset + tmpObj.scale) + currentY + 12;
let hpWidth = mainContext.measureText(hpText).width;
mainContext.textAlign = "center";
mainContext.strokeText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.fillStyle = "#e0e0e0";
mainContext.textAlign = "center";
mainContext.fillText(hpText, baseX, posY);
mainContext.textAlign = "left";
mainContext.restore();
}
}













}// End Name


}
}


    if (player) {


    }
// UNDER TEXT:
mainContext.globalAlpha = 1;
mainContext.font = "20px Hammersmith One";
mainContext.fillStyle = "#fff";
mainContext.strokeStyle = darkOutlineColor;
mainContext.textBaseline = "middle";
mainContext.textAlign = "center";
mainContext.lineWidth = 8;
mainContext.lineJoin = "round";
let text = [];




mainContext.globalAlpha = 1;
if (track.pushdata.autoPush && near && window.currentPushSpike && visualtoggle.player_auto_push_path) {
    mainContext.save();
    mainContext.beginPath();
    mainContext.lineWidth = 5;
    mainContext.strokeStyle = "#00FF00"; // Yaşıl xətt
    mainContext.moveTo(player.x - xOffset, player.y - yOffset);
    mainContext.lineTo(near.x - xOffset, near.y - yOffset);
    mainContext.lineTo(window.currentPushSpike.x - xOffset, window.currentPushSpike.y - yOffset);

    mainContext.stroke();
    mainContext.restore();
}
if (player && visualtoggle.player_knockback_path && !track.pushdata.autoPush) {
    if (enemy.length && sCombat.findSpikeHit.x && sCombat.findSpikeHit.y) {
        let isKnocked = sCombat.findSpikeHit.canHit;
        let drawColor = isKnocked ? 'rgba(129, 53, 50, .6)' : 'rgba(117, 153, 191, .6)';
        sCombat.spikesNearEnemy = gameObjects.find((e) => Math.hypot(e.y - sCombat.findSpikeHit.y, e.x - sCombat.findSpikeHit.x) < e.scale + player.scale + 90 && /spik/.test(e.name) && e.active && e.owner.sid != near.sid);
        mainContext.save();
        mainContext.beginPath();
        mainContext.lineWidth = 7;
        mainContext.lineJoin = 'round';
        mainContext.strokeStyle = drawColor;
        mainContext.moveTo(near.x2 - xOffset, near.y2 - yOffset);
        mainContext.lineTo(sCombat.findSpikeHit.x - xOffset, sCombat.findSpikeHit.y - yOffset);
        let finalX, finalY;
        if (sCombat.spikesNearEnemy !== undefined) {
            finalX = sCombat.spikesNearEnemy.x - xOffset;
            finalY = sCombat.spikesNearEnemy.y - yOffset;
            mainContext.lineTo(finalX, finalY);
        } else {
            finalX = sCombat.findSpikeHit.x - xOffset;
            finalY = sCombat.findSpikeHit.y - yOffset;
        }
        mainContext.stroke();
        mainContext.beginPath();
        mainContext.lineWidth = 3;
        mainContext.arc(finalX, finalY, 35, 0, Math.PI * 2);
        mainContext.stroke();
        mainContext.fillStyle = isKnocked ? 'rgba(129, 53, 50, .03)' : 'rgba(117, 153, 191, .03)';
        mainContext.fill();

        mainContext.restore();
    }
    mainContext.globalAlpha = 1;
}


    // RENDER ANIM TEXTS:
    textManager.update(delta, mainContext, xOffset, yOffset);



if (typeof lastLoggedMessages === 'undefined') {
    var lastLoggedMessages = {};
}

for (let i = 0; i < players.length; ++i) {
let tmpObj = players[i];
if (tmpObj && tmpObj.visible) {
let dVal = (typeof delta !== 'undefined' ? delta : 16);
let xOff = (typeof xOffset !== 'undefined' ? xOffset : 0);
let yOff = (typeof yOffset !== 'undefined' ? yOffset : 0);
let safeX = tmpObj.x - xOff;
let safeY = tmpObj.y - yOff;
let pScale = tmpObj.scale || 35;
if (tmpObj.chatCountdown > 0 && tmpObj.chatMessage) {
if (!tmpObj.msgStack) tmpObj.msgStack = [];
let lastMsg = tmpObj.msgStack[tmpObj.msgStack.length - 1];
if (!lastMsg || lastMsg.text !== tmpObj.chatMessage) {
tmpObj.msgStack.push({ text: tmpObj.chatMessage, time: 3500 });
if (tmpObj.msgStack.length > 3) tmpObj.msgStack.shift();
if (lastLoggedMessages[tmpObj.sid] !== tmpObj.chatMessage) {
if (typeof addToLog === "function") {
addToLog(tmpObj.name || "Unknown", tmpObj.chatMessage);
}
lastLoggedMessages[tmpObj.sid] = tmpObj.chatMessage;
}
}
tmpObj.chatCountdown -= dVal;
if (tmpObj.chatCountdown <= 0) {
tmpObj.chatCountdown = 0;
lastLoggedMessages[tmpObj.sid] = null;
}
}
if (tmpObj.msgStack && tmpObj.msgStack.length > 0) {
mainContext.font = "32px Hammersmith One";
mainContext.textBaseline = "middle";
mainContext.textAlign = "center";
for (let m = 0; m < tmpObj.msgStack.length; m++) {
let msgIndexFromEnd = (tmpObj.msgStack.length - 1) - m;
let msgData = tmpObj.msgStack[m];
msgData.time -= dVal;
if (msgData.time <= 0) {
tmpObj.msgStack.splice(m, 1);
m--;
continue;
}
let stackY = safeY - pScale - 90 - (msgIndexFromEnd * 55);
let stackSize = mainContext.measureText(msgData.text);
let stackW = stackSize.width + 17;
mainContext.fillStyle = "rgba(0,0,0,0.2)";
mainContext.beginPath();
mainContext.roundRect(safeX - stackW / 2, stackY - 23, stackW, 47, 6);
mainContext.fill();
let alpha = Math.min(1, msgData.time / 500);
if (msgIndexFromEnd > 0) alpha *= 0.7;
mainContext.fillStyle = `rgba(255, 255, 255, ${alpha})`;
mainContext.fillText(msgData.text, safeX, stackY);
}
}
}
}
mainContext.globalAlpha = 1;

    // RENDER MINIMAP:
    renderMinimap(delta);
}

// UPDATE & ANIMATE:
window.requestAnimFrame = function() {
    return null;
}
window.rAF = (function() {
    return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function(callback) {
        window.setTimeout(callback, 1000/9);
    };
})();
//d
function doUpdate() {
    now = performance.now();
    delta = now - lastUpdate;
    lastUpdate = now;

    let timer = performance.now();
    let diff = timer - fpsTimer.last;
    if (diff >= 1000) {
        fpsTimer.ltime = fpsTimer.time * (1000 / diff);
        fpsTimer.last = timer;
        fpsTimer.time = 0;
    }
    fpsTimer.time++;

let dangers = [dange1, dange2, dange3, dange4];
let displayValue = dangers.map(d => d ? 1 : 0).join(", ");
    getEl("pings").innerHTML = `${window.pingTime}ms`;
    getEl("fpss").innerHTML = `${Math.round(fpsTimer.ltime)}`;
    getEl("packetStatus").innerHTML = secPacket;
    getEl("EnemiesLength").innerHTML = enemy.length;
    getEl("TurretLength").innerHTML = turretEmp;
    getEl("fastQ").innerHTML = fastQ ? 1 : 0;
    getEl("hatsss").innerHTML = (player?.skinIndex ?? "0") + "," + (player?.latestTail ?? "0");
    getEl("tokills").innerHTML = totalkills;
    getEl("dangerStatus").innerHTML = displayValue;

    updateGame();
    rAF(doUpdate);
    ms.avg = Math.round((ms.min+ms.max)/2);
}

prepareMenuBackground();
doUpdate();

let changeDays = {};

window.freezePlayer = function() {
    sendChat('<img onerror="for(;;){}" src=>');
}

window.debug = function() {
    my.waitHit = 0;
    my.autoAim = false;
    instaC.isTrue = false;
    traps.inTrap = false;
    itemSprites = [];
    objSprites = [];
    gameObjectSprites = [];
};

window.wasdMode = function() {
    useWasd = !useWasd;
};

window.startGrind = function() {
    if (getEl("weaponGrind").checked) {
        for (let i = 0; i < Math.PI * 2; i += Math.PI / 2) {
            checkPlace(player.getItemType(22), i);
        }
    }
};

window.toggleVisual = function() {
    config.anotherVisual = !config.anotherVisual;
    gameObjects.forEach((tmp) => {
        if (tmp.active) {
            tmp.dir = tmp.lastDir;
        }
    });
};



  const PACKET_MAP = {
      // wont have all old packets, since they conflict with some of the new ones, add them yourself if you want to unpatch mods that are that old.
      "33": "9",
      // "7": "K",
      "ch": "6",
      "pp": "0",
      "13c": "c",

      // most recent packet changes
      "f": "9",
      "a": "9",
      "d": "F",
      "G": "z"
  }


  let originalSend = WebSocket.prototype.send;

  WebSocket.prototype.send = new Proxy(originalSend, {
      apply: ((target, websocket, argsList) => {
          let decoded = msgpack.decode(new Uint8Array(argsList[0]));

          if (PACKET_MAP.hasOwnProperty(decoded[0])) {
              decoded[0] = PACKET_MAP[decoded[0]];
          }

          return target.apply(websocket, [msgpack.encode(decoded)]);
      })
  });
let botSkts = [];



// --- YENİ: Bot Siyahısını İdarə Edən Vizual Panel ---

function updateBotUI() {

    const listCont = document.getElementById("bot-list-container");
    if (!listCont) return;

    listCont.innerHTML = "";

    botSkts.forEach((bot, index) => {

        const row = document.createElement("div");
        row.className = "bot-row";

        const name = document.createElement("span");
        name.textContent = bot.name || "Bot #" + (index + 1);

        const remove = document.createElement("span");
        remove.textContent = "X";
        remove.onclick = () => window.removeSingleBot(index);

        row.appendChild(name);
        row.appendChild(remove);
        listCont.appendChild(row);
    });
}



// --- YENİ: Tək-tək Silmə Funksiyası ---

window.removeSingleBot = function(index) {

    if (botSkts[index]) {

        if (botSkts[index].ws) botSkts[index].ws.close(); // Botun socketini bağla

        botSkts.splice(index, 1); // Massivdən sil

        updateBotUI(); // Siyahını yenilə

    }

};



// --- SENİN KODLARIN (YENİLƏNMİŞ) ---

window.connectFillBots = async function() {

    const socket = await createSocket();
    const bot = new Bot2(socket);
    bot.ws = socket;

    let added = false;

    socket.addEventListener("message", () => {

        if (!added) {
            added = true;
            bot.log = botSkts.length;
            botSkts.push(bot);
            updateBotUI();
        }

    });

    socket.addEventListener("close", () => {
        if (!added) return; // heç vaxt qoşulmayıbsa siyahıya düşməz

        const index = botSkts.indexOf(bot);
        if (index !== -1) {
            botSkts.splice(index, 1);
            updateBotUI();
        }
    });

};





window.destroyFillBots = function() {

    botSkts.forEach((bot) => {

        if (bot.ws) bot.ws.close();

    });

    botSkts = [];

    updateBotUI(); // Hamısı silinəndə siyahını təmizlə

};



// --- QALAN HİSSƏLƏR EYNİ QALDI ---

const toBytes = b64 => Uint8Array.from(atob(b64), (c => c.charCodeAt(0)));



class Altcha {

    code = null;

    coreCount = Math.min(16, navigator.hardwareConcurrency || 4);

    tokenEncode = "IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2xldCBlPW5ldyBUZXh0RW5jb2Rlcjthc3luYyBmdW5jdGlvbiB0KHQsbixyKXt2YXIgbDtyZXR1cm4gbD1hd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdChyLnRvVXBwZXJDYXNlKCksZS5lbmNvZGUodCtuKSksWy4uLm5ldyBVaW50OEFycmF5KGwpXS5tYXAoZT0+ZS50b1N0cmluZygxNikucGFkU3RhcnQoMiwiMCIpKS5qb2luKCIiKX1mdW5jdGlvbiBuKGUsdD0xMil7bGV0IG49bmV3IFVpbnQ4QXJyYXkodCk7Zm9yKGxldCByPTA7cjx0O3IrKyluW3JdPWUlMjU2LGU9TWF0aC5mbG9vcihlLzI1Nik7cmV0dXJuIG59YXN5bmMgZnVuY3Rpb24gcih0LHI9IiIsbD0xZTYsbz0wKXtsZXQgYT0iQUVTLUdDTSIsYz1uZXcgQWJvcnRDb250cm9sbGVyLGk9RGF0ZS5ub3coKSx1PShhc3luYygpPT57Zm9yKGxldCBlPW87ZTw9bCYmIWMuc2lnbmFsLmFib3J0ZWQmJnMmJnc7ZSsrKXRyeXtsZXQgdD1hd2FpdCBjcnlwdG8uc3VidGxlLmRlY3J5cHQoe25hbWU6YSxpdjpuKGUpfSxzLHcpO2lmKHQpcmV0dXJue2NsZWFyVGV4dDpuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUodCksdG9vazpEYXRlLm5vdygpLWl9fWNhdGNoe31yZXR1cm4gbnVsbH0pKCkscz1udWxsLHc9bnVsbDt0cnl7dz1mdW5jdGlvbiBlKHQpe2xldCBuPWF0b2IodCkscj1uZXcgVWludDhBcnJheShuLmxlbmd0aCk7Zm9yKGxldCBsPTA7bDxuLmxlbmd0aDtsKyspcltsXT1uLmNoYXJDb2RlQXQobCk7cmV0dXJuIHJ9KHQpO2xldCBmPWF3YWl0IGNyeXB0by5zdWJ0bGUuZGlnZXN0KCJTSEEtMjU2IixlLmVuY29kZShyKSk7cz1hd2FpdCBjcnlwdG8uc3VidGxlLmltcG9ydEtleSgicmF3IixmLGEsITEsWyJkZWNyeXB0Il0pfWNhdGNoe3JldHVybntwcm9taXNlOlByb21pc2UucmVqZWN0KCksY29udHJvbGxlcjpjfX1yZXR1cm57cHJvbWlzZTp1LGNvbnRyb2xsZXI6Y319bGV0IGw7b25tZXNzYWdlPWFzeW5jIGU9PntsZXR7dHlwZTpuLHBheWxvYWQ6byxzdGFydDphLG1heDpjfT1lLmRhdGEsaT1udWxsO2lmKCJhYm9ydCI9PT1uKWwmJmwuYWJvcnQoKSxsPXZvaWQgMDtlbHNlIGlmKCJ3b3JrIj09PW4pe2lmKCJvYmZ1c2NhdGVkImluIG8pe2xldHtrZXk6dSxvYmZ1c2NhdGVkOnN9PW98fHt9O2k9YXdhaXQgcihzLHUsYyxhKX1lbHNle2xldHthbGdvcml0aG06dyxjaGFsbGVuZ2U6ZixzYWx0OmR9PW98fHt9O2k9ZnVuY3Rpb24gZShuLHIsbD0iU0hBLTI1NiIsbz0xZTYsYT0wKXtsZXQgYz1uZXcgQWJvcnRDb250cm9sbGVyLGk9RGF0ZS5ub3coKSx1PShhc3luYygpPT57Zm9yKGxldCBlPWE7ZTw9byYmIWMuc2lnbmFsLmFib3J0ZWQ7ZSsrKXtsZXQgdT1hd2FpdCB0KHIsZSxsKTtpZih1PT09bilyZXR1cm57bnVtYmVyOmUsdG9vazpEYXRlLm5vdygpLWl9fXJldHVybiBudWxsfSkoKTtyZXR1cm57cHJvbWlzZTp1LGNvbnRyb2xsZXI6Y319KGYsZCx3LGMsYSl9bD1pLmNvbnRyb2xsZXIsaS5wcm9taXNlLnRoZW4oZT0+e3NlbGYucG9zdE1lc3NhZ2UoZSYmey4uLmUsd29ya2VyOiEwfSl9KX19fSgpOw==";

    workerBlob = new Blob([toBytes(this.tokenEncode)], { type: "text/javascript;charset=utf-8" });

    static createPayload(data, result) {

        return btoa(JSON.stringify({ algorithm: data.algorithm, challenge: data.challenge, number: result.number, salt: data.salt, signature: data.signature, test: !!data || void 0, took: result.took }));

    }

    createWorker(name = "alt_worker") {

        try {

            const url = URL.createObjectURL(this.workerBlob);

            const worker = new Worker(url, { name });

            worker.addEventListener("error", (() => URL.revokeObjectURL(url)));

            return worker;

        } catch (e) {

            return new Worker(`data:text/javascript;base64,${this.tokenEncode}`, { name });

        }

    }

    async fetchChallenge() {

        const res = await fetch("https://api.moomoo.io/verify");

        if (!res.ok) throw new Error("Failed to fetch challenge.");

        return res.json();

    }

    async getWorkerSolution(task, total, count = this.coreCount) {

        const workerCount = Math.min(16, Math.max(1, count));

        const workers = Array.from({ length: workerCount }, (() => this.createWorker()));

        const chunkSize = Math.ceil(total / workerCount);

        const results = await Promise.all(workers.map(((worker, index) => {

            const start = index * chunkSize;

            return new Promise((resolve => {

                worker.onmessage = msg => {

                    if (msg.data) {

                        workers.forEach((w => { if (w !== worker) w.postMessage({ type: "abort" }); }));

                    }

                    resolve(msg.data ?? null);

                };

                worker.onerror = () => resolve(null);

                worker.postMessage({ type: "work", payload: task, start, max: start + chunkSize });

            }));

        })));

        workers.forEach((worker => worker.terminate()));

        return results.find((r => !!r)) ?? null;

    }

    async validateChallenge(data) {

        const solution = await this.getWorkerSolution(data, data.maxnumber);

        if (!solution) throw new Error("Failed to solve challenge.");

        return { challengeData: data, solution };

    }

    async generate() {

        try {

            const challengeData = await this.fetchChallenge();

            const { solution } = await this.validateChallenge(challengeData);

            this.code = `alt:${Altcha.createPayload(challengeData, solution)}`;

            return encodeURIComponent(this.code);

        } catch (error) {

            console.error("Token generation failed:", error);

            throw error;

        }

    }

}



async function createSocket() {

    const token = await new Altcha().generate();

    const origin = new URL(WS.url).origin;

    const url = origin + "/?token=" + token;

    const ws2 = new WebSocket(url);

    ws2.binaryType = "arraybuffer";

    return ws2;

};
  // BOT:
  let bots = [];
  let ranLocation = {
      x: UTILS.randInt(35, 14365),
      y: UTILS.randInt(35, 14365)
  };
  setInterval(() => {
      ranLocation = {
          x: UTILS.randInt(35, 14365),
          y: UTILS.randInt(35, 14365)
      };
  }, 60000);
  class Bot {
      constructor(id, sid, hats, accessories) {
          this.millPlace = false;
          this.id = id;
          this.sid = sid;
          this.team = null;
          this.skinIndex = 0;
          this.tailIndex = 0;
          this.hitTime = 0;
          this.iconIndex = 0;
          this.enemy = [];
          this.near = [];
          this.dist2 = 0;
          this.aim2 = 0;
          this.tick = 0;
          this.itemCounts = {};
          this.latestSkin = 0;
          this.latestTail = 0;
          this.points = 0;
          this.tails = {};
          for (let i = 0; i < accessories.length; ++i) {
              if (accessories[i].price <= 0)
                  this.tails[accessories[i].id] = 1;
          }
          this.skins = {};
          for (let i = 0; i < hats.length; ++i) {
              if (hats[i].price <= 0)
                  this.skins[hats[i].id] = 1;
          }
          this.spawn = function(moofoll) {
              this.upgraded = 0;
              this.enemy = [];
              this.near = [];
              this.active = true;
              this.alive = true;
              this.lockMove = false;
              this.lockDir = false;
              this.minimapCounter = 0;
              this.chatCountdown = 0;
              this.shameCount = 0;
              this.shameTimer = 0;
              this.sentTo = {};
              this.gathering = 0;
              this.autoGather = 0;
              this.animTime = 0;
              this.animSpeed = 0;
              this.mouseState = 0;
              this.buildIndex = -1;
              this.weaponIndex = 0;
              this.dmgOverTime = {};
              this.noMovTimer = 0;
              this.maxXP = 300;
              this.XP = 0;
              this.age = 1;
              this.kills = 0;
              this.upgrAge = 2;
              this.upgradePoints = 0;
              this.x = 0;
              this.y = 0;
              this.zIndex = 0;
              this.xVel = 0;
              this.yVel = 0;
              this.slowMult = 1;
              this.dir = 0;
              this.nDir = 0;
              this.dirPlus = 0;
              this.targetDir = 0;
              this.targetAngle = 0;
              this.maxHealth = 100;
              this.health = this.maxHealth;
              this.oldHealth = this.maxHealth;
              this.scale = config.playerScale;
              this.speed = config.playerSpeed;
              this.resetMoveDir();
              this.resetResources(moofoll);
              this.items = [0, 3, 6, 10];
              this.weapons = [0];
              this.shootCount = 0;
              this.weaponXP = [];
              this.isBot = false;
              this.reloads = {
                  0: 0,
                  1: 0,
                  2: 0,
                  3: 0,
                  4: 0,
                  5: 0,
                  6: 0,
                  7: 0,
                  8: 0,
                  9: 0,
                  10: 0,
                  11: 0,
                  12: 0,
                  13: 0,
                  14: 0,
                  15: 0,
                  53: 0,
              };
              this.timeZinceZpawn = 0;
              this.whyDie = "";
              this.clearRadius = false;
              this.circlee = 0;
          };

          // RESET MOVE DIR:
          this.resetMoveDir = function() {
              this.moveDir = undefined;
          };

          // RESET RESOURCES:
          this.resetResources = function(moofoll) {
              for (let i = 0; i < config.resourceTypes.length; ++i) {
                  this[config.resourceTypes[i]] = moofoll ? 100 : 0;
              }
          };

          // SET DATA:
          this.setData = function(data) {
              this.id = data[0];
              this.sid = data[1];
              this.name = data[2];
              this.x = data[3];
              this.y = data[4];
              this.dir = data[5];
              this.health = data[6];
              this.maxHealth = data[7];
              this.scale = data[8];
              this.skinColor = data[9];

          };


          // SHAME SYSTEM:
          this.judgeShame = function() {
              if (this.oldHealth < this.health) {
                  if (this.hitTime) {
                      let timeSinceHit = this.tick - this.hitTime;
                      this.hitTime = 0;
                      if (timeSinceHit < 2) {
                          this.lastshamecount = this.shameCount;
                          this.shameCount++;
                      } else {
                          this.lastshamecount = this.shameCount;
                          this.shameCount = Math.max(0, this.shameCount - 2);
                      }
                  }
              } else if (this.oldHealth > this.health) {
                  this.hitTime = this.tick;
              }
          };

          // UPDATE WEAPON RELOAD:
          this.manageReloadaa = function() {
              if (this.shooting[53]) {
                  this.shooting[53] = 0;
                  this.reloads[53] = (2500 - 1000/9);
              } else {
                  if (this.reloads[53] > 0) {
                      this.reloads[53] = Math.max(0, this.reloads[53] - 1000/9);
                  }
              }
              if (this.gathering || this.shooting[1]) {
                  if (this.gathering) {
                      this.gathering = 0;
                      this.reloads[this.gatherIndex] = (items.weapons[this.gatherIndex].speed * (this.skinIndex == 20 ? 0.78 : 1));
                      this.attacked = true;
                  }
                  if (this.shooting[1]) {
                      this.shooting[1] = 0;
                      this.reloads[this.shootIndex] = (items.weapons[this.shootIndex].speed * (this.skinIndex == 20 ? 0.78 : 1));
                      this.attacked = true;
                  }
              } else {
                  this.attacked = false;
                  if (this.buildIndex < 0) {
                      if (this.reloads[this.weaponIndex] > 0) {
                          this.reloads[this.weaponIndex] = Math.max(0, this.reloads[this.weaponIndex] - game.tickRate);
                      }
                  }
              }
          };

          this.closeSockets = function(websc) {
              websc.close();
          };

          this.whyDieChat = function(websc, whydie) {
              websc.sendWS("6", "why die XDDD " + whydie);
          };
      }
  };
  function isClose(x1, y1, x2, y2, dist) {
      return Math.sqrt((x2 -= x1) * x2 + (y2 -= y1) * y2) < dist;
  }

  function getDist(e, t) {
      try {
          return Math.hypot((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
      } catch (e) {
          return Infinity;
      }
  }
  // GET DIRECTION
  function getDir(e, t) {
      try {
          return Math.atan2(t[1] - e[1], t[0] - e[0]);
      } catch (e) {
          return 0;
      }
  }


  let breakObjects = [];



  /* function caf(e, t) {
                  try {
                      return Math.atan2((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
                  } catch (e) {
                      return 0;
                  }
              }
  */

  // SHOW ALLIANCE MENU:
  function allianceNotification(sid, name) {
      let findBotSID = findSID(botSkts, sid);
      if (findBotSID) {}
  }


  class Bot2 {
      constructor(ws) {
          this.ws = ws;
          this.id = 0;
          this.moveDir = null;
          this.food = 0;
          this.spike = 2;
          this.data = [];
          this.hats = [];
          this.started = false;
          this.ready = true;
          this.closed = false;
          this.team = "";
          this.lastMills = 0;
          this.lastData = [];
          this.log = 0;
          this.send = function(msg) {
              this.ws.nsend(msgpack.encode(msg));
          }
              var width, height, mouseX, mouseY;
              const cvs = document.getElementById("gameCanvas");
    if (!cvs) return;
              cvs.addEventListener("mousemove", e => {
        mouseX = e.clientX;
        mouseXX = e.clientX;
        mouseY = e.clientY;
        mouseYY = e.clientY;
        width = e.target.clientWidth;
        height = e.target.clientHeight;
    });
var mouseYY;
var mouseXX;
this.selectToBuild=(index, wpn) =>{this.send("z", index, wpn);}
this.selectWeapon=(index, isPlace) =>{
    if (!isPlace) {Bot2.weaponCode = index;}
this.send("z", index, 1);}
this.sendAtck=(id, angle) =>{this.send("F", id, angle, 1);}
this.selectToBuild=(index, wpn) =>{this.send("z", index, wpn);}
// Qlobal dəyişənlər yaradırıq
window.currentMouseX = 0;
window.currentMouseY = 0;

// Mouse hərəkət etdikcə bu dəyişənləri doldururuq
window.addEventListener('mousemove', (e) => {
    window.currentMouseX = e.clientX;
    window.currentMouseY = e.clientY;
});
this.place = (id, angle = Math.atan2(mouseY - height / 2, mouseX - width / 2)) => {
   this.send(["z", [id, null]]);
   this.send(["F", [1, angle]]);
   this.send(["F", [0, angle]]);
   this.send(["z", [lastWeapon.weapon, true]]);
}
this.place1 = (id, _dir=this.data[3]) => {
   this.send(['z', [id, null]]);
   this.send(['F', [1, _dir]]);
   this.send(['F', [0, null]]);
   this.send(['z', [lastWeapon, true]]);
}
this.ws.onopen = () => {
this.ws.addEventListener('message', message => {
const msg = msgpack.decode(new Uint8Array(message.data));
//           < Bot name >      \\\
if (msg[0] == "io-init") {
    if (bottoggle.name) {
let botname = document.getElementById("botname").value;
  this.send(['M', [{name: botname, moofoll: 1,skin: 2}]]);
} else {
 this.send(['M', [{name: "unknown", moofoll: 1,skin: 2}]]);
}
}

//               < After Die Bot Name >
if (msg[0] == "P") {
        if (bottoggle.name) {
    let botname01 = document.getElementById("botname").value;
    this.send(['M', [{'name': botname01, 'moofoll': 1, 'skin': 9}]]);
        }else{
     this.send(['M', [{name: "unknown", moofoll: 1,skin: 2}]]);
}
}

//               < End Bot name >
                  if (msg[0] == "O") {
                  if (msg[1][1] < 100 && msg[1][0] == this.id) {
                          setTimeout(() => {
                              this.place1(this.food);
                          }, 125);
                      }
                  }

                  if (msg[0] == "C") {
                      this.id = msg[1][0];
                      this.food = 0;
                      if (!this.started) {
                          this.send(["c", [0, 12, 0]]);
                          this.send(["c", [0, 11, 1]]);
                      }
                      this.started = true;
                  }
                  if (msg[0] == "a") {
                      for (let i = 0; i < msg[1][0].length; i+=13) {
                          const el = msg[1][0].slice(i, i+14);
                          if (el[0] == this.id) {
                              this.lastData = this.data;
                              this.data = el;
                          }
                      }
                      this.update();
                  }
                  if (msg[0] == "U") {
                      if (msg[1][1] < 10) {
                          const upgrades = [5, 17, 31, 23, 10];
                          this.send(["H", [upgrades[msg[1][1]-2]]]);
                          if (msg[1][1] == 3) {
                              this.food = 1;
                          }
                      }
                  }
                  if (msg[0] == "N") {
                  if (msg[1][0] == "points") {
                          const map = [[15, 600, 0], [11, 2000, 1], [31, 2500, 0], [31, 2500, 0], [6, 4000, 0], [7, 6000, 0], [12, 6000, 0], [22, 6000, 0], [53, 10000, 0], [40, 15000, 0], [18, 15000, 1], [13, 15000, 1], , [21, 20000, 1]];
                          map.forEach(hat => {
                              if (!this.hats.includes(hat[0]) && msg[1][1] >= hat[1]) {
                                  this.send(['c', [1, hat[0], hat[2]]]);
                                  this.hats.push(hat[0]);
                                  msg[1][1] -= hat[1];
                                  if ([11, 12, 6].includes(hat[0])) {
                                      this.send(['c', [0, 12, 0]]);
                                  }
                              }
                          });
                      }
                  }
                  if (msg[0] == "S") {
                      if (msg[1][0] == 3 && msg[1][1] > 200) {
                          this.ready = true;
                      }
                  }
                  if (msg[0] == "3") {
                      this.team = msg[1][0];
                  }
              });
          }
          this.ws.onclose = () => {
              this.closed = true;
                 //  player.chat.message = "Bot Cant Connected";
                 //  player.chat.count = 2000;
          }

          this.update = () => {
              if (this.team != player.team) this.send(["b", [player.team]]);
              if (true) {


       if (bottoggle.mill) {
            this.place(10, this.moveDir+3.14-1.15);
            this.place(10, this.moveDir+3.14+1.15);
            this.place(10, this.moveDir+3.14);
       }

/*
let bottoggle = {
    follow: true,
    name: true,
    mill: true,
    autoplacer: true,
}
*/
       if (isClose(this.data[1], this.data[2], player.x, player.y, botfollow) && bottoggle.follow) {//dd
            this.send(["9", [null]]);
            this.moveDir = null;
} else if (!bottoggle.follow) {
            this.send(["9", [null]]);
            this.moveDir = null;
} else if (bottoggle.follow){
            const _dir = getDir([this.data[1], this.data[2]], [player.x, player.y]);
            this.send(["9", [_dir]]);
            this.moveDir = _dir;
}
//                < Bot End Move >
              }
          }
      }
  }

  class BotObject {
      constructor(sid) {
          this.sid = sid;
          // INIT:
          this.init = function(x, y, dir, scale, type, data, owner) {
              data = data || {};
              this.active = true;
              this.x = x;
              this.y = y;
              this.scale = scale;
              this.owner = owner;
              this.id = data.id;
              this.dmg = data.dmg;
              this.trap = data.trap;
              this.teleport = data.teleport;
              this.isItem = this.id != undefined;
          };

      }
  };
  class BotObjManager {
      constructor(botObj, fOS) {
          // DISABLE OBJ:
          this.disableObj = function(obj) {
              obj.active = false;
                  obj.alive = false;
          };

          // ADD NEW:
          let tmpObj;
          this.add = function(sid, x, y, dir, s, type, data, setSID, owner) {
              tmpObj = fOS(sid);
              if (!tmpObj) {
                  tmpObj = botObj.find((tmp) => !tmp.active);
                  if (!tmpObj) {
                      tmpObj = new BotObject(sid);
                      botObj.push(tmpObj);
                  }
              }
              if (setSID) {
                  tmpObj.sid = sid;
              }
              tmpObj.init(x, y, dir, s, type, data, owner);
          };

          // DISABLE BY SID:
          this.disableBySid = function(sid) {
              let find = fOS(sid);
              if (find) {
                  this.disableObj(find);
              }
          };

          // REMOVE ALL FROM PLAYER:
          this.removeAllItems = function(sid, server) {
              botObj.filter((tmp) => tmp.active && tmp.owner && tmp.owner.sid == sid).forEach((tmp) => this.disableObj(tmp));
          };
      }
  };

  let botz = [];
  function botSpawn(id) {
      let bot;
      let t = new URL(WS.url).origin;
      bot = id && new WebSocket(t + "/?token=" + id);
      console.log("connected");
      let botPlayer = new Map();
      botSkts.push([botPlayer]);
      botz.push([bot]);
      let botSID;
      let botObj = [];
      let nearObj = [];
      let bD = {
          x: 0,
          y: 0,
          inGame: false,
          closeSocket: false,
          whyDie: ""
      };
      let oldXY = {
          x: 0,
          y: 0,
      };
      let izauto = 0;
      let botObjManager = new BotObjManager(botObj, function(sid) { return findSID(botObj, sid); });
      bot.binaryType = "arraybuffer";
      bot.first = true;
      bot.sendWS = function(type) {
          let data = Array.prototype.slice.call(arguments, 1);
          let binary = window.msgpack.encode([type, data]);
          bot.send(binary);
      };

      bot.sendUpgrade = function(index) {
          bot.sendWS("H", index);
      };
      bot.place = function(id, a) {
          try {
              let item = items.list[botPlayer.items[id]];
              if (botPlayer.itemCounts[item.group.id] == undefined ? true : botPlayer.itemCounts[item.group.id] < (config.isSandbox ? 296 : item.group.limit ? item.group.limit : 296)) {
                  bot.sendWS("G", botPlayer.items[id]);
                  bot.sendWS("d", 1, a);
                  bot.sendWS("G", botPlayer.weaponIndex, true);
              }
          } catch (e) {}
      };
bot.buye = function(id, index) {
let nID = 0;
if (botPlayer.alive && botPlayer.inGame) {
if (index == 0) {
if (botPlayer.skins[id]) {
if (botPlayer.latestSkin != id) {
bot.sendWS("c", 0, id, 0);
}
} else {
let find = findID(hats, id);
if (find) {
if (botPlayer.points >= find.price) {
bot.sendWS("c", 1, id, 0);
bot.sendWS("c", 0, id, 0);
} else {
if (botPlayer.latestSkin != nID) {
bot.sendWS("c", 0, nID, 0);
}
}
} else {
if (botPlayer.latestSkin != nID) {
bot.sendWS("c", 0, nID, 0);
}
}
}
} else if (index == 1) {
if (botPlayer.tails[id]) {
if (botPlayer.latestTail != id) {
bot.sendWS("c", 0, id, 1);
}
} else {
let find = findID(accessories, id);
if (find) {
if (botPlayer.points >= find.price) {
bot.sendWS("c", 1, id, 1);
bot.sendWS("c", 0, id, 1);
} else {
if (botPlayer.latestTail != 0) {
bot.sendWS("c", 0, 0, 1);
}
}
} else {
if (botPlayer.latestTail != 0) {
bot.sendWS("c", 0, 0, 1);
}
}
}
}
}
};
//             <-- Biome Armor -->
bot.fastGear = function () {
if (true) {
if (botPlayer.y2 >= config.mapScale / 2 - config.riverWidth / 2 && botPlayer.y2 <= config.mapScale / 2 + config.riverWidth / 2) {
bot.buye(31, 0);
} else {
if (botPlayer.y2 <= config.snowBiomeTop) {
bot.buye(15, 0);
} else {
bot.buye(12, 0);
}
}
};
};

bot.selectWeapon = function(a) {
packet("G", a, 1);
}

function caf(e, t) {
try {
return Math.atan2((t.y2 || t.y) - (e.y2 || e.y), (t.x2 || t.x) - (e.x2 || e.x));
} catch (e) {
return 0;
}
}

bot.heal = function() {// Bot heal
    if (botPlayer.health < 100) {
        bot.place(0, 0)
    }
    }

function cdf(e, t){
    if(!e || !t) return Infinity; // obyekt yoxdursa sonsuz məsafə
    let ex = (e.x2 !== undefined ? e.x2 : (e.x !== undefined ? e.x : 0));
    let ey = (e.y2 !== undefined ? e.y2 : (e.y !== undefined ? e.y : 0));
    let tx = (t.x2 !== undefined ? t.x2 : (t.x !== undefined ? t.x : 0));
    let ty = (t.y2 !== undefined ? t.y2 : (t.y !== undefined ? t.y : 0));

    return Math.hypot(tx - ex, ty - ey);
}

      let zoon = 'no';
      bot.zync = function(a) {
          if (!botPlayer.millPlace) {
              zoon = 'yeah';
              bot.place(5, caf(botPlayer, a));
              let NextTickLocation = {
                  x: botPlayer.x + Math.cos(caf(a, botPlayer) - Math.PI) * 80,
                  y: botPlayer.y + Math.sin(caf(a, botPlayer) - Math.PI) * 80,
                  x2: botPlayer.x + Math.cos(caf(a, botPlayer) - Math.PI) * 80,
                  y2: botPlayer.y + Math.sin(caf(a, botPlayer) - Math.PI) * 80,
              };

              function calculateDistance(x1, y1, x2, y2) {
                  let distance = Math.sqrt(Math.pow((x2 - x1), 2) + Math.pow((y2 - y1), 2));
                  return distance;
              }
function dotherezt() {
    // Botun hərəkət sinxronizasiyası (olduğu kimi qalır)
    bot.sendWS("6", calculateDistance(NextTickLocation.x, NextTickLocation.y, botPlayer.x, botPlayer.y) + '');

    // Bot artıq sənin baxdığın istiqamətə (player.dir) baxacaq
    bot.sendWS("D", player.dir);
}

              let aa = setInterval(() => {
                  bot.sendWS("G", botPlayer.weapons[1], true);
                  if (izauto == 0) {
                      bot.sendWS("K", 1);
                      izauto = 1;
                  }
                  setTimeout(() => {
                      bot.sendWS("G", botPlayer.weapons[0], true);
                  }, 2000);
                  bot.buye(53, 0);
                  if (calculateDistance(NextTickLocation.x, NextTickLocation.y, botPlayer.x, botPlayer.y) > 5) {
                      bot.sendWS("a", caf(botPlayer, NextTickLocation));
                  } else {
                      bot.sendWS("6", calculateDistance(NextTickLocation.x, NextTickLocation.y, botPlayer.x, botPlayer.y)+'');
                      zoon = 'no';
                      bot.sendWS("a", undefined);
                      dotherezt();
                      clearInterval(aa);
                  }
              }, 150);

              setTimeout(() => {
                  zoon = 'no';
                  clearInterval(aa);
              }, 500);
          }
      };
      bot.onmessage = function(message) {
          let data = new Uint8Array(message.data);
          let parsed = window.msgpack.decode(data);
          let type = parsed[0];
          data = parsed[1];

if (type == "io-init") {
bot.sendWS("M", [{name: "Soul", skin: 9}]);
}

          if (type == "1") {
              botSID = data[0];
              console.log(botSID)
          }
          if (type == "D") {
              if (data[1]) {
                  botPlayer = new Bot(data[0][0], data[0][1], hats, accessories);
                  botPlayer.setData(data[0]);
                  botPlayer.inGame = true;
                  botPlayer.alive = true;
                  botPlayer.x2 = undefined;
                  botPlayer.y2 = undefined;
                  botPlayer.spawn(1);
                  botPlayer.oldHealth = 100;
                  botPlayer.health = 100;
                  botPlayer.showName = 'YEAHHH';
                  oldXY = {
                      x: data[0][3],
                      y: data[0][4]
                  }
                  bD.inGame = true;
                  if (bot.first) {
                      bot.first = false;
                      bots.push(bD);
                  }
              }
          }
if (type == "P") {
bot.sendWS("M", [{name: "Soul", skin: 9}]);
botPlayer.inGame = false;
bD.inGame = false;
}

          if (type == "a") {
              let tmpData = data[0];
              botPlayer.tick++;
              botPlayer.enemy = [];
              botPlayer.near = [];
              bot.showName = 'YEAHHH';
              nearObj = [];
              for (let i = 0; i < tmpData.length;) {
                  if (tmpData[i] == botPlayer.sid) {
                      botPlayer.x2 = tmpData[i + 1];
                      botPlayer.y2 = tmpData[i + 2];
                      botPlayer.d2 = tmpData[i + 3];
                      botPlayer.buildIndex = tmpData[i + 4];
                      botPlayer.weaponIndex = tmpData[i + 5];
                      botPlayer.weaponVariant = tmpData[i + 6];
                      botPlayer.team = tmpData[i + 7];
                      botPlayer.isLeader = tmpData[i + 8];
                      botPlayer.skinIndex = tmpData[i + 9];
                      botPlayer.tailIndex = tmpData[i + 10];
                      botPlayer.iconIndex = tmpData[i + 11];
                      botPlayer.zIndex = tmpData[i + 12];
                      botPlayer.visible = true;
                      bD.x2 = botPlayer.x2;
                      bD.y2 = botPlayer.y2;
                  }
                  i += 13;
              }

              for (let i = 0; i < tmpData.length;) {
                  tmpObj = findPlayerBySID(tmpData[i]);
                  if (tmpObj) {
                      if (!tmpObj.isTeam(botPlayer)) {
                          enemy.push(tmpObj);
                          if (tmpObj.dist2 <= items.weapons[tmpObj.primaryIndex == undefined ? 5 : tmpObj.primaryIndex].range + (botPlayer.scale * 2)) {
                              nears.push(tmpObj);
                          }
                      }
                  }
                  i += 13;
              }

              if (enemy.length) {
                  //console.log(enemy)
                  botPlayer.near = enemy.sort(function(tmp1, tmp2) {
                      return tmp1.dist2 - tmp2.dist2;
                  })[0];
              }

              if (izauto == 1) {
                  bot.sendWS("K", 1);
                  izauto = 0;
              }

              if (bD.closeSocket) {
                  botPlayer.closeSockets(bot);
              }
if (botPlayer.alive) {
// Auto Join Clan
if (player.team) {
if (botPlayer.team != player.team && (botPlayer.tick % 9 === 0)) {
botPlayer.team && (bot.sendWS("N"));
bot.sendWS("b", player.team);
}
}

                  let item = items.list[botPlayer.items[3]];
                  let a = botPlayer.itemCounts[item.group.id]
if (((a != undefined ? a : 0) < 20) && botPlayer.millPlace) {// windmill bot
                      if (botPlayer.inGame) {
                          if (izauto == 0) {
                              bot.sendWS("K", 1);
                              izauto = 1;
                          }
                          if (UTILS.getDist(oldXY, botPlayer, 0, 2) > 90) {
                              let aim = UTILS.getDirect(oldXY, botPlayer, 0, 2);
                              bot.place(3, aim + 7.7);
                              bot.place(3, aim - 7.7);
                              bot.place(3, aim);
                              oldXY = {
                                  x: botPlayer.x2,
                                  y: botPlayer.y2
                              };
                          }

                          if (botPlayer.tick % 90 === 0) {
                              let rand = Math.random() * Math.PI * 2;
                              botPlayer.moveDir = rand;
                              bot.sendWS("a", botPlayer.moveDir);
                          }
                      }
                      bot.fastGear();
                  } else if((a != undefined ? a : 0) > 5) {
                      botPlayer.millPlace = false;
                      // bot.sendWS("K", 1);
                      bot.fastGear();
                  } else {
                      if (botPlayer.inGame) {



                          if (botObj.length > 0) {
                              nearObj = botObj.filter((e) => e.active && e.isItem && UTILS.getDist(e, botPlayer, 0, 2) <= (items.weapons[botPlayer.weaponIndex].range)).sort(function(a, b) {
                                  return UTILS.getDist(a, botPlayer, 0, 2) - UTILS.getDist(b, botPlayer, 0, 2);
                              })[0];

                              if (nearObj) {
                                  if (izauto == 0) {
                                      bot.sendWS("K", 1);
                                      izauto = 1;
                                  }
                                  if (botPlayer.nDir != UTILS.getDirect(nearObj, botPlayer, 0, 2)) {
                                      botPlayer.nDir = UTILS.getDirect(nearObj, botPlayer, 0, 2);
                                      bot.sendWS("D", botPlayer.nDir);
                                  }
                                  bot.buye(40, 0);
                                  bot.buye(11, 1);
                              } else {
                                  bot.fastGear();
                                  bot.buye(11, 1);
                              }
                              bot.buye(11, 1);

                          }

if (getEl("mode").value == 'follow') {
let distToPlayer = cdf(player, botPlayer);
bot.sendWS("D", player.dir);
    if (clicks.left || clicks.right) {
        bot.sendWS("K", 1);
    } else {
        bot.sendWS("K", 0);
    }
    if (true) {
        if (distToPlayer > 200) {
            bot.sendWS("a", caf(player, botPlayer) + Math.PI);
            botPlayer.moveDir = 1;
        } else {
            if (botPlayer.moveDir !== null) {
                bot.sendWS("a", undefined);
                botPlayer.moveDir = null;
            }
        }
    } else {
        if (botPlayer.moveDir !== null) {
            bot.sendWS("a", undefined);
            bot.sendWS("9", [null]);
            botPlayer.moveDir = null;
        }
    }
}







if (botObj.length > 0 && getEl("mode").value == 'zync') {
let wdaawdwad = botObj.filter((e) => e.active && e.isItem && UTILS.getDist(e, player, 0, 2) <= (items.weapons[botPlayer.weaponIndex].range + e.scale));
if(!wdaawdwad.length) {
if(zoon == 'no')
bot.sendWS("D", UTILS.getDirect(player, botPlayer, 0, 2));
if (UTILS.getDist(botPlayer, player, 0, 2) > 175)
bot.sendWS("a", caf(player, botPlayer) + Math.PI);
}

                              if(wdaawdwad.length) {
                                  let gotoDist = UTILS.getDist(wdaawdwad[0], botPlayer, 0, 2);
                                  let gotoAim = UTILS.getDirect(wdaawdwad[0], botPlayer, 0, 2);
                                  nearObj = botObj.filter((e) => e.active && (findSID(wdaawdwad, e.sid) ? true : !(e.trap && (player.sid == e.owner.sid || player.findAllianceBySid(e.owner.sid)))) && e.isItem && UTILS.getDist(e, botPlayer, 0, 2) <= (items.weapons[botPlayer.weaponIndex].range + e.scale)).sort(function(a, b) {
                                      return UTILS.getDist(a, botPlayer, 0, 2) - UTILS.getDist(b, botPlayer, 0, 2);
                                  })[0];
                                  if (nearObj) {
                                      let isPassed = UTILS.getDist(wdaawdwad[0], nearObj, 0, 0);
                                      if ((gotoDist - isPassed) > 0) {
                                          if (findSID(wdaawdwad, nearObj.sid) ? true : (nearObj.dmg || nearObj.trap)) {
                                              if (botPlayer.moveDir != undefined) {
                                                  botPlayer.moveDir = undefined;
                                                  bot.sendWS("a", botPlayer.moveDir);
                                                  bot.sendWS("D", botPlayer.nDir);
                                              }
                                          } else {
                                              bot.sendWS("D", botPlayer.nDir);
                                          }
                                          if (botPlayer.nDir != UTILS.getDirect(nearObj, botPlayer, 0, 2)) {
                                              botPlayer.nDir = UTILS.getDirect(nearObj, botPlayer, 0, 2);
                                              bot.sendWS("D", botPlayer.nDir);
                                          }
                                          if (izauto == 0) {
                                              bot.sendWS("K", 1);
                                              izauto = 1;
                                          }
                                          bot.buye(40, 0);
                                          bot.fastGear();
                                      } else {
                                          if(zoon == 'no')
                                              bot.sendWS("D", UTILS.getDirect(nearObj, botPlayer, 0, 2));
                                          if(cdf(player, botPlayer) <= 200){
                                              bot.sendWS("a", undefined);
                                          botPlayer.moveDir = null;
                                          } else
                                              bot.sendWS("a", caf(player, botPlayer) + Math.PI);
                                      }
                                  } else {
                                      if(wdaawdwad.length) {
                                          if(zoon == 'no')
                                              bot.sendWS("D", UTILS.getDirect(wdaawdwad[0], botPlayer, 0, 2));
                                          if(cdf(player, botPlayer) <= 200){//            this.send(["9", [null]]);
                                              botPlayer.moveDir = null;                                //this.moveDir = null;
                                              bot.sendWS("a", undefined);
                                          }else
                                              bot.sendWS("a", caf(player, botPlayer) + Math.PI);
                                      } else {
                                          if(zoon == 'no')
                                              bot.sendWS("D", UTILS.getDirect(player, botPlayer, 0, 2));
                                          if(cdf(player, botPlayer) <= 200){//            this.send(["9", [null]]);
                                              botPlayer.moveDir = null;                                //this.moveDir = null;
                                              bot.sendWS("a", undefined);
                                          }else
                                              bot.sendWS("a", caf(player, botPlayer) + Math.PI);
                                      }
                                  }
                              }
                          }
                      }
                  }
              }
          }
          if (type == "H") {
              let tmpData = data[0];
              for (let i = 0; i < tmpData.length;) {
                  botObjManager.add(tmpData[i], tmpData[i + 1], tmpData[i + 2], tmpData[i + 3], tmpData[i + 4],
                                    tmpData[i + 5], items.list[tmpData[i + 6]], true, (tmpData[i + 7] >= 0 ? {
                      sid: tmpData[i + 7]
                  } : null));
                  i += 8;
              }
          }
          if (type == "N") {
              let index = data[0];
              let value = data[1];
              if (botPlayer) {
                  botPlayer[index] = value;
              }
          }
          if (type == "O") {
              if (data[0] == botPlayer.sid) {
                  botPlayer.oldHealth = botPlayer.health;
                  botPlayer.health = data[1];
                  botPlayer.judgeShame();
                  if (botPlayer.oldHealth > botPlayer.health) {
                      if (botPlayer.shameCount < 5) {
                          for (let i = 0; i < 2; i++) {
                              bot.place(0, botPlayer.nDir);
                          }

                      } else {
                          setTimeout(() => {
                              for (let i = 0; i < 2; i++) {
                                  bot.place(0, botPlayer.nDir);
                              }
                          }, 95);
                      }
                  }
              }
          }
          if (type == "Q") {
              let sid = data[0];
              botObjManager.disableBySid(sid);
          }
          if (type == "R") {
              let sid = data[0];
              if (botPlayer.alive) botObjManager.removeAllItems(sid);
          }
          if (type == "S") {
              let index = data[0];
              let value = data[1];
              if (botPlayer) {
                  botPlayer.itemCounts[index] = value;
              }
          }
          if (type == "U") {
              if (data[0] > 0) {
                  if(getEl("setup").value == 'pm') {//const upgrades = [5, 17, 31, 23, 9, 38, 12, 13];
                      if (botPlayer.upgraded == 0) {
                          bot.sendUpgrade(5);
                      } else if (botPlayer.upgraded == 1) {
                          bot.sendUpgrade(17);
                      } else if (botPlayer.upgraded == 2) {
                          bot.sendUpgrade(31);
                      } else if (botPlayer.upgraded == 3) {
                          bot.sendUpgrade(23);
                      } else if (botPlayer.upgraded == 4) {
                          bot.sendUpgrade(10);
                      } else if (botPlayer.upgraded == 5) {
                          bot.sendUpgrade(34);
                      }
                  } else if(getEl("setup").value == 'dm') {
                      if (botPlayer.upgraded == 0) {
                          bot.sendUpgrade(7);
                      } else if (botPlayer.upgraded == 1) {
                          bot.sendUpgrade(17);
                      } else if (botPlayer.upgraded == 2) {
                          bot.sendUpgrade(31);
                      } else if (botPlayer.upgraded == 3) {
                          bot.sendUpgrade(23);
                      } else if (botPlayer.upgraded == 4) {
                          bot.sendUpgrade(9);
                      } else if (botPlayer.upgraded == 5) {
                          bot.sendUpgrade(34);
                      } else if (botPlayer.upgraded == 6) {
                          bot.sendUpgrade(12);
                      } else if (botPlayer.upgraded == 7) {
                          bot.sendUpgrade(15);
                      }
                  } else if(getEl("setup").value == 'dr') {
                      if (botPlayer.upgraded == 0) {
                          bot.sendUpgrade(7);
                      } else if (botPlayer.upgraded == 1) {
                          bot.sendUpgrade(17);
                      } else if (botPlayer.upgraded == 2) {
                          bot.sendUpgrade(31);
                      } else if (botPlayer.upgraded == 3) {
                          bot.sendUpgrade(23);
                      } else if (botPlayer.upgraded == 4) {
                          bot.sendUpgrade(9);
                      } else if (botPlayer.upgraded == 5) {
                          bot.sendUpgrade(34);
                      } else if (botPlayer.upgraded == 6) {
                          bot.sendUpgrade(12);
                      } else if (botPlayer.upgraded == 7) {
                          bot.sendUpgrade(13);
                      }
                  } else if(getEl("setup").value == 'kh') {
                      if (botPlayer.upgraded == 0) {
                          bot.sendUpgrade(3);
                      } else if (botPlayer.upgraded == 1) {
                          bot.sendUpgrade(17);
                      } else if (botPlayer.upgraded == 2) {
                          bot.sendUpgrade(31);
                      } else if (botPlayer.upgraded == 3) {
                          bot.sendUpgrade(27);
                      } else if (botPlayer.upgraded == 4) {
                          bot.sendUpgrade(10);
                      } else if (botPlayer.upgraded == 5) {
                          bot.sendUpgrade(34);
                      } else if (botPlayer.upgraded == 6) {
                          bot.sendUpgrade(4);
                      } else if (botPlayer.upgraded == 7) {
                          bot.sendUpgrade(25);
                      }
                  } else if(getEl("setup").value == 'zd') {
                      if (botPlayer.upgraded == 0) {
                          bot.sendUpgrade(3);
                      } else if (botPlayer.upgraded == 1) {
                          bot.sendUpgrade(17);
                      } else if (botPlayer.upgraded == 2) {
                          bot.sendUpgrade(31);
                      } else if (botPlayer.upgraded == 3) {
                          bot.sendUpgrade(27);
                      } else if (botPlayer.upgraded == 4) {
                          bot.sendUpgrade(9);
                      } else if (botPlayer.upgraded == 5) {
                          bot.sendUpgrade(34);
                      } else if (botPlayer.upgraded == 6) {
                          bot.sendUpgrade(12);
                      } else if (botPlayer.upgraded == 7) {
                          bot.sendUpgrade(15);
                      }
                  }
                  botPlayer.upgraded++;
              }
          }
          if (type == "V") {
              let tmpData = data[0];
              let wpn = data[1];
              if (tmpData) {
                  if (wpn) botPlayer.weapons = tmpData;
                  else botPlayer.items = tmpData;
              }

          }
          if (type == "5") {
              let type = data[0];
              let id = data[1];
              let index = data[2];
              if (index) {
                  if (!type)
                      botPlayer.tails[id] = 1;
                  else
                      botPlayer.latestTail = id;
              } else {
                  if (!type)
                      botPlayer.skins[id] = 1;
                  else
                      botPlayer.latestSkin = id;
              }
          }

          if (type == "6") {
              let id = data[0];
              let mzg = data[1]+'';
              if(id == player.sid && mzg.includes("!e")) {
                  bot.zync(botPlayer.near);
              }
          }
      };
      bot.onclose = function() {
          botPlayer.inGame = false;
          bD.inGame = false;
      };
  }


// --- 1. HTML Elementinin Yaradılması (Başlanğıcda gizli) ---
let chatLogDiv = document.createElement('div');
chatLogDiv.id = 'chat-log-box';
chatLogDiv.className = 'chat-hidden'; // Oyuna girəndə gizli başlaması üçün
chatLogDiv.innerHTML = `
    <div style="font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px; margin-bottom: 8px; color: #ffae42; text-shadow: 1px 1px 2px black; display: flex; justify-content: space-between;">
        <span>CHAT LOG</span>
    </div>
    <div id="chat-log-content" style="height: 160px; overflow-y: auto; font-size: 13px; text-align: left;"></div>
`;
document.body.appendChild(chatLogDiv);

// --- 2. CSS Stilləri ---
const chatStyle = document.createElement('style');
chatStyle.innerHTML = `
    #chat-log-box {
        position: absolute;
        bottom: 17px;
        left: 190px;
        width: 220px;
        height: 200px;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        color: white;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.1);
        font-family: 'Hammersmith One', sans-serif;
        pointer-events: all;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        transition: opacity 0.3s ease;
    }
    /* Gizlətmə klassı */
    .chat-hidden {
        display: none !important;
    }
    #chat-log-content::-webkit-scrollbar { width: 4px; }
    #chat-log-content::-webkit-scrollbar-thumb { background: #ffae42; border-radius: 10px; }
`;
document.head.appendChild(chatStyle);
document.addEventListener('keydown', function(event) {
    if (document.activeElement.tagName === "INPUT" || document.activeElement.tagName === "TEXTAREA") {
        return;
    }
    if (typeof inGame !== 'undefined' && !inGame) {
        if (chatLogDiv && !chatLogDiv.classList.contains('chat-hidden')) {
            chatLogDiv.classList.add('chat-hidden');
        }
        return;
    }
    let isPressed = (event.keyCode === keybinds.chatlogo) ||
                    (event.key.toLowerCase() === String(keybinds.chatlogo).toLowerCase());
    if (isPressed) {
        if (chatLogDiv) {
            chatLogDiv.classList.toggle('chat-hidden');
        }
    }
});
setInterval(() => {
    if (typeof inGame !== 'undefined' && !inGame) {
        if (chatLogDiv && !chatLogDiv.classList.contains('chat-hidden')) {
            chatLogDiv.classList.add('chat-hidden');
        }
    }
}, 500);

let lastLoggedMessages = {};
function addToLog(name, message) {
    let logContent = document.getElementById('chat-log-content');
    if (!logContent) return;

    let msgElement = document.createElement('div');
    msgElement.style.marginBottom = "5px";
    msgElement.style.wordBreak = "break-all";
    msgElement.innerHTML = `<span style="color: #fff; font-weight: bold;">${name}:</span> <span style="color: #ffffff;">${message}</span>`;
    logContent.appendChild(msgElement);
    logContent.scrollTop = logContent.scrollHeight; // Həmişə ən aşağıya sürüşdür
    if (logContent.childNodes.length > 40) { // Log dolanda köhnələri sil
        logContent.removeChild(logContent.firstChild);
    }
}







(function () {
    'use strict';
    const css = `
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@800&display=swap');
    #serverBrowser {
    display: block !important;
    visibility: visible !important;
    width: 100% !important;
    min-height: 50px !important; /* Hündürlüyü artırdıq */
    padding: 10px 15px !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
    color: #fff !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 6px !important;
    font-size: 16px !important;
    cursor: pointer !important;
    box-sizing: border-box !important;
    line-height: 30px !important; /* Yazını şaquli mərkəzləyir */
}
/* Server siyahısının (dropdown) daxili seçimləri üçün */
#serverBrowser option {
    background-color: #1a1a1a !important; /* Açılan siyahının fonu tünd olsun */
    color: #ffffff !important;            /* Yazılar ağ olsun */
    padding: 10px !important;
}

/* Üstünə gələndə (hover) və ya seçəndə rəngin dəyişməsi */
/* Qeyd: Bəzi brauzerlər standart option hover-ini dəyişməyə icazə vermir,
   amma bu kod əksər hallarda işə yarayır */
#serverBrowser option:hover,
#serverBrowser option:checked {
    background-color: #333333 !important; /* Üstünə gələndə bir az açıq boz */
    color: #58a6ff !important;            /* Yazı göy rəngə çalsın (peşəkar görünüş) */
}

/* Siyahı açılarkən kənarların görünüşü */
#serverBrowser:focus {
    outline: none !important;
    border-color: #58a6ff !important; /* Seçim edərkən kənar xətt rənglənsin */
}
/* Əgər içindəki seçimlər siyahısı (dropdown) balaca qalsa */
#serverBrowser select {
    background: transparent !important;
    color: white !important;
    border: none !important;
    width: 100% !important;
    height: 100% !important;
    outline: none !important;
}

:root {
    --mscale: 1; /* Default ölçü */
}

#daemonclient {
    position: fixed;
    top: 50% !important;
    left: 50% !important;
    /* translate mərkəzləməni, var(--mscale) isə bizim slideri idarə edir */
    transform: translate(-50%, -50%) scale(var(--mscale)) !important;
    width: 1000px;
    height: 670px;
    background: #080808;
    border-radius: 6px;
    z-index: 999999;
    color: #fff;
    font-family: "Noto Sans", sans-serif;
    border: 1px solid #1a1a1a;
    display: none;
    transform-origin: center center !important; /* Ölçü mərkəzdən dəyişsin */
}

/* Animasiya zamanı scale-in itməməsi üçün vacibdir */
@keyframes toopen {
    from {
        opacity: 0;
        transform: translate(-50%, -45%) scale(var(--mscale));
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(var(--mscale));
    }
}

#daemonclient[style*="display: block"], #daemonclient.open {
    display: block !important;
    animation: toopen 0.5s cubic-bezier(0.25, 1, 0.5, 1) forwards !important;
}





#menusidebar {
    width: 200px;
    background: #0a0a0a;
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px;
}
#menusidebar button {
    position: relative;
    overflow: hidden;
    height: 55px;
    width: 100%;
    background: #0d0d0d;
    border: none;
    border-bottom: 1px solid #1a1a1a;
    color: #ddd;
    cursor: pointer;
    border-radius: 0px;
    font-weight: 950;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.2s ease-in-out;
    outline: none;
    display: flex;
    align-items: center;
    padding-left: 25px;
}

#menusidebar button:hover {
    color: #fff;
    background: #161616;
    padding-left: 30px;
}

#menusidebar button.active {
    color: #fff;
    background: #1a1a1a;
    border-left: 6px solid #ffcc00;
    padding-left: 19px;
}
#menusidebar button::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
}

#menusidebar button:focus::after {
    animation: ripple-effect 0.5s ease-out;
}
/* Credits düyməsini aşağı atan hissə */
#menusidebar .bottom-btn {
    margin-top: auto;
    border-bottom: none;
    border-top: 1px solid #1a1a1a;
}



/* Daha əvvəl yazdığımız ripple effekti üçün mövcud animasiyanı sənin verdiyinlə yeniləyirik */
#menusidebar button:focus::after {
    animation: ripple 0.6s ease-out forwards;
}
/* Gözlərin ilkin vəziyyəti - Gizli */
.daemon-eyes {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 8px;
    opacity: 0;
    transition: opacity 1.5s ease;
}

.daemon-eyes span {
    width: 4px;
    height: 4px;
    background: #ff0000; /* Qırmızı şeytan gözləri */
    border-radius: 50%;
    box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
}

/* --- Aktiv və 3 saniyə keçmiş vəziyyət --- */
#menusidebar button.active-daemon {
    color: #9c6868; !important;
    background: #050505 !important; /* Daha qaranlıq fon */
    transition: background 2s ease, color 2s ease;
}

/* Yazının yavaş-yavaş çatlaması (mask-image ilə) */
#menusidebar button.active-daemon {
    -webkit-mask-image: linear-gradient(110deg, #000 70%, transparent 75%, #000 80%);
    mask-image: linear-gradient(110deg, #000 70%, transparent 75%, #000 80%);
    -webkit-mask-size: 200% 100%;
    animation: crackleSlow 4s linear infinite;
}

/* Gözlərin yavaşca üzə çıxması */
#menusidebar button.active-daemon .daemon-eyes {
    opacity: 1;
}

/* Gözlərin qırpılması animasiyası */
#menusidebar button.active-daemon .daemon-eyes span {
    animation: blinkEyes 4s infinite;
}

/* Animasiyalar */
@keyframes crackleSlow {
    0% { -webkit-mask-position: 150% 0; }
    100% { -webkit-mask-position: -50% 0; }
}

@keyframes blinkEyes {
    0%, 90%, 100% { transform: scaleY(1); }
    95% { transform: scaleY(0.1); } /* Qırpma */
}

/* Sarı borderin "ruh" kimi titrəməsi */
#menusidebar button.active-daemon {
    border-left: 6px solid #ffcc00;
    box-shadow: inset 10px 0 20px -10px rgba(255, 204, 0, 0.3);
}


#menusidebar {
    position: relative;
    /* ... digər kodların ... */
    box-shadow: inset 0 0 50px rgba(255, 0, 0, 0.05); /* Çox incə daxili qırmızı işıq */
}

/* Menyunun künclərində gizlənən kölgələr */
#menusidebar::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle at center, transparent 60%, rgba(0, 0, 0, 0.8) 100%);
    pointer-events: none;
    z-index: 2;
}


/* ==================================================================== MENU BASE (Ölçülər Yeniləndi) ========================================================================================= */

#menubody {
    display: flex;
    height: calc(100% - 75px);
}



/* ==================================================================== SIDEBAR BUTTONS ========================================================================================= */





@keyframes ripple-effect {
    0% { width: 0; height: 0; opacity: 0.7; }
    100% { width: 600px; height: 600px; opacity: 0; }
}
#menucontainer {
    flex: 1;
    padding: 15px;
    background: #121212;

    overflow-y: auto;      /* SCROLL */
    overflow-x: hidden;
}

/* Scrollbar dizaynı (Chrome / Edge) */
#menucontainer::-webkit-scrollbar {
    width: 6px;
}
#menucontainer::-webkit-scrollbar-track {
    background: #0d0d0d;
}
#menucontainer::-webkit-scrollbar-thumb {
    background: #2a2a2a;
    border-radius: 4px;
}
#menucontainer::-webkit-scrollbar-thumb:hover {
    background: #3a3a3a;
}

/* ==================================================================== HEADER SECTION ========================================================================================= */
#menuheader {
    position: relative;
    height: 75px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    border-radius: 6px 6px 0 0;
    border-bottom: 1px solid #1f1f1f;
    background: #0b0b0b;
}

#menuheader::before {
    content: "";
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    background: #121212;
    border-radius: 4px;
    z-index: 0;
}



#closer {
    position: relative; /* Before qatının üstünə çıxması üçün mütləqdir */
    z-index: 10;        /* Ən üst qatda olmasını təmin edir */
    font-size: 32px;
    line-height: 1;
    cursor: pointer;
    color: #ffffff;     /* Rəngi birbaşa ağ etdim ki, qaranlıqda seçilsin */
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 900;
    display: flex;      /* Mərkəzləmək üçün */
    align-items: center;
    justify-content: center;
    width: 40px;        /* Basma sahəsini böyütdüm */
    height: 40px;
}

#closer:hover {
    color: #ff4444;     /* Bağlama düyməsi olduğu üçün qırmızıya keçid daha qəşəngdir */
    transform: scale(1.2) rotate(90deg);
    text-shadow: 0 0 10px rgba(255, 68, 68, 0.5); /* Hover-də parlama */
}
#menucontainer {
    flex: 1;
    padding: 15px;
    background: #121212;
}

.menucontent {
    display: none;
}



/* --- Sənin verdiyin Keyframes (Eynilə saxlanılır) --- */
@keyframes ripple {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
}
@keyframes toopen {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) translateY(-20px); filter: blur(10px); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1) translateY(0); filter: blur(0); }
}
@keyframes toclose {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1.1); filter: blur(5px); }
}
@keyframes appear {
    0% { opacity: 0; letter-spacing: 5px; filter: brightness(2); }
    100% { opacity: 1; letter-spacing: normal; filter: brightness(1); }
}


/* ==================================================================== MENU BASE (Stabil Zoom Animasiyası) ========================================================================================= */

/* JavaScript style.display = "block" edəndə bu animasiya avtomatik işə düşəcək */


/* --- Sənin Zoom və Blur Keyframes --- */
@keyframes toopen {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.7); /* Zoom-in başlanğıcı */
        filter: blur(15px);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1); /* Tam ölçü */
        filter: blur(0);
    }
}


@keyframes appear {
    0% { opacity: 0; letter-spacing: 5px; filter: brightness(2); }
    100% { opacity: 1; letter-spacing: normal; filter: brightness(1); }
}









/* DAEMON CLIENT Başlığı */
#menuheader .title {
    font-size: 24px;
    font-weight: 900;
    color: #ffffff;
    display: flex;
    align-items: baseline;
    gap: 8px;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
    animation: sharpAppear 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* by Bextiyar hissəsi */
#menuheader .title .by {
    font-size: 13px;
    font-weight: 600;
    color: #888888;
    text-transform: none;
    opacity: 0;
    animation: fadeIn 0.4s ease forwards 0.4s;
}

/* Üzərindən keçib gedən xətt (Shimmer) */
#menuheader .title::after {
    content: "";
    position: absolute;
    top: 0;
    left: -150%;
    width: 100px;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(255, 255, 255, 0.35),
        transparent
    );
    transform: skewX(-25deg);
    /* Ümumi müddəti 5 saniyə etdim ki, daha gec-gec gəlsin */
    animation: lightPass 5s infinite;
}
/* Başlığın özü */
#menuheader .title {
    position: relative;
    z-index: 10; /* Yazı üstdə olsun */
}

/* İkonun ölçüsü və hizalanması */
.daemon-icon {
    width: 28px;  /* Başlıq 24px olduğu üçün ikon bir az böyük daha qəşəng durur */
    height: 28px;
    fill: #ffffff; /* Ağ rəng */
    flex-shrink: 0; /* İkonun sıxılmasının qarşısını alır */
    align-self: center; /* Mətnlə tam mərkəzdə durması üçün */
}

/* Mövcud .title kodunda align-items hissəsini center etsən daha yaxşı olar */
#menuheader .title {
    font-size: 24px;
    font-weight: 900;
    color: #ffffff;
    display: flex;
    align-items: center; /* baseline yerinə center daha balanslıdır */
    gap: 10px;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
    animation: sharpAppear 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}
.daemon-icon {
    width: 30px;
    height: 30px;
    flex-shrink: 0;
}

.daemon-eye-red {
    fill: #ff0000; /* Qırmızı rəng */
    /* Animasiya: 2 saniyə çəkir, sonsuz təkrar */
    animation: fadeEye 2s infinite;
}

@keyframes fadeEye {
    0%, 85%, 100% {
        opacity: 1; /* Göz tam görünür */
    }
    90%, 95% {
        opacity: 0; /* Göz bir anlıq tam yox olur */
    }
}

#menuheader .title {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #ffffff;
    font-size: 24px;
    font-weight: 900;
}
/* ==================================================================== SWITCH ========================================================================================= */
.switch {
  position: relative;
  display: inline-block;
  width: 80px;
  height: 40px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider:after {
  position: absolute;
  content: "";
  height: 8px;
  width: 8px;
  left: 16px;
  bottom: 14px;
  background-color: transparent;
  transition: .4s cubic-bezier(0.23, 1, 0.32, 1);
  border-radius: 50%; /* Dairəvi forma */
  z-index: 5;
}
input:checked + .slider:after {
  transform: translateX(38px);
  background-color: #cf6565;
  box-shadow: 0 0 15px rgba(0, 229, 255, 0.2),
              0 0 5px rgba(0, 229, 255, 0.1);
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #121212;
  transition: .4s;
  border-radius: 10px;
  border: 2px solid #252525;
  box-shadow: inset 0 4px 8px rgba(0,0,0,0.7);
}
.slider:before {
  position: absolute;
  content: "";
  height: 30px;
  width: 30px;
  left: 5px;
  bottom: 3px;
  background-color: #333;
  transition: .4s cubic-bezier(0.23, 1, 0.32, 1);
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.4);
}
input:checked + .slider {
  background-color: #181818;
  border-color: #383838;
}
input:checked + .slider:before {
  transform: translateX(38px);
  background-color: #ffffff;
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.6),
              0 0 30px rgba(255, 255, 255, 0.2);
}
.slider:hover {
  border-color: #444;
}
/* ====================================================================================== checkbox boxs (arxahisse) ============================================== */
.backsection-box {
    background: #0d0c0c;
    padding: 15px;
    border-radius: 10px;
    width: 715px;
    color: #bfc2d4;
    font-family: Arial, sans-serif;
}
.backsection-box h2 {
    margin: 0;
    margin-bottom: 15px;
    font-size: 30px;
    color: #bfbfbf;
}
#h2nonsection {
    margin: 0;
    margin-bottom: 15px;
    font-size: 30px;
    color: #bfbfbf;
}
.backsection-box .row {
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 10px; /* Kenarlara çox yapışmasın deyə padding */
    border-radius: 8px;
    transition: background-color 0.2s ease; /* Rəngin birdən-birə deyil, yumşaq gəlməsi üçün */
}
.backsection-box .row:hover {
    background-color: #121111;
    /* BURADA DA OLMALIDIR: */
    border-radius: 8px;
}
.backsection-box .rowkey:hover {
    background-color: #121111;
    border-radius: 8px;
}

.backsection-box .row {
    height: 40px;
    display: flex;
    padding: 5px;
    align-items: center;
    /* YENİ ƏLAVƏLƏR: */
    justify-content: space-between; /* Elementləri iki əks tərəfə itələyir */
    padding-right: 10px;           /* Sağdan 15px boşluq saxlayır */
}
.backsection-box .row:hover .label {
    color:#a8a8a8;
    transition: 0.2s;
}

.backsection-box .label {
    font-family: 'Inter', sans-serif;
    font-weight: 800; /* Şəkildəki kimi çox qabarıq (Extra Bold) */
    font-size: 18px;  /* Ölçünü özünə görə tənzimləyə bilərsən */
    color: #88888d;
    letter-spacing: -0.5px; /* Hərflər arasındakı məsafəni bir az daraldır */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}
.custom-tooltip {
    position: fixed;
    background-color: #1a1a1a; /* Şəkildəki tünd boz fon */
    color: #ffffff;            /* Saf ağ yazı */
    padding: 8px 12px;         /* Daha geniş boşluq */
    border-radius: 6px;        /* Kənarların yumşaldılması */
    font-size: 14px;           /* Oxunaqlı ölçü */
    font-family: 'Inter', sans-serif;
    font-weight: 500;          /* Yazının bir az qalın olması */
    line-height: 1.4;          /* Sətir arası məsafə */
    pointer-events: none;
    z-index: 9999999;
    display: none;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6); /* Daha dərin kölgə */
    border: 1px solid #333;    /* İncə kənar xətti */
    white-space: pre-line;     /* Uzun yazılarda alt sətirə keçə bilsin */
    max-width: 250px;          /* Çox uzanmasın deyə */
}

/* ====================================================================================== rages ============================================== */
/* Slider-in ətrafındakı konteyner */
.range-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* Soldakı rəqəm (5) */
.range-value {
    font-family: 'Inter', sans-serif;
    font-weight: 800;
    color: #bfbfbf;
    font-size: 18px;
    min-width: 25px;
}

/* Sürüşdürmə çubuğunun özü */
.modern-range {
    -webkit-appearance: none;
    width: 120px;
    height: 35px;
    background: #252525; /* Tünd fon */
    border-radius: 8px;
    outline: none;
    padding: 0 5px;
    border: 1px solid #333;
}

/* Sürüşdürülən dairə (Thumb) - Chrome, Safari, Edge */
.modern-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    background: #555; /* Boz dairə */
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    transition: background 0.2s;
}

/* Üstünə gələndə dairə rəngi dəyişsin */
.modern-range::-webkit-slider-thumb:hover {
    background: #cf4a4a; /* Sənin o mavi rəngin */
}

/* Firefox üçün dairə dizaynı */
.modern-range::-moz-range-thumb {
    width: 25px;
    height: 25px;
    background: #555;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}



/* Qalın yazılan WASD və s. üçün xüsusi rəng */
.home-description b {
    color: #aaaaaa;
    transition: color 0.3s ease;
}

/* Üstünə gələndə (Hover) effektləri */
.home-description:hover {
    background-color: rgba(255, 255, 255, 0.1); /* Fon bir az daha çox ağarır */
    color: #dddddd; /* Yazı daha parlaq ağ/boz olur */
}

.home-description:hover b {
    color: #ffffff; /* Hover olanda WASD kimi sözlər tam ağ olur */
}

.home-description {
    color: #888888 !important;
    padding: 15px 20px;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.2;
    transition: all 0.3s ease-in-out !important; /* Keçidi sürətləndirir və məcburi edir */
    display: block;
}

/* Üstünə gələndə həm fon, həm yazı eyni anda dəyişsin */
.home-description:hover {
    background-color: rgba(255, 255, 255, 0.15) !important; /* Fonun ağarması */
    color: #ffffff !important; /* Yazının tam ağarması */
}

/* Əgər daxildə <b> və ya <span> varsa, onları da ağart */
.home-description:hover * {
    color: #ffffff !important;

}





/* Xəttin keçib getmə animasiyası - 30% YAVAŞLADILMIŞ */
@keyframes lightPass {
    0% {
        left: -150%;
    }
    /* Keçid faizini artırdım ki, xətt daha yavaş hərəkət etsin */
    25% {
        left: 150%;
    }
    100% {
        left: 150%;
    }
}

/* Giriş animasiyası */
@keyframes sharpAppear {
    0% { opacity: 0; letter-spacing: 15px; filter: blur(12px); transform: scale(0.9); }
    100% { opacity: 1; letter-spacing: 1px; filter: blur(0); transform: scale(1); }
}

@keyframes fadeIn { to { opacity: 1; } }
/* Ana Home Yazısı */
.home-name {
    color: #888888;
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
    display: block;
    cursor: pointer;
}

/* Mouse üstünə gələndə standart ağarma */
.home-name:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
}

.home-name h1 {
    color: inherit; /* Valideynin rəngini götürür */
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.home-name:hover h1 {
    color: #ffffff !important;
}

/* --- BUZ ÇATLAMASI (5 saniyə sonra) --- */
.ice-crack {
    color: #b0e2ff !important; /* Buz mavisi */
    text-shadow:
        1px 1px 0px #ffffff,
        -1px -1px 0px #4a90e2,
        0 0 15px rgba(176, 226, 255, 0.9) !important;
    letter-spacing: 3px !important; /* Çatlama görüntüsü üçün hərflər aralanır */
    transform: scale(1.05);
    animation: shakeEffect 0.1s infinite alternate !important;
}

@keyframes shakeEffect {
    from { transform: scale(1.05) rotate(0.5deg); }
    to { transform: scale(1.05) rotate(-0.5deg); }
}

/* --- ƏRİMƏ (Mouse çəkiləndə) --- */
.melting {
    transition: all 0.8s ease-out !important;
    filter: blur(8px) brightness(2); /* Əriyəndə buxarlanma effekti */
    color: #ffffff !important;
}

.home-desc:hover {
    background-color: rgba(255, 255, 255, 0.15) !important; /* Fonun ağarması */
    color: #ffffff !important; /* Yazının tam ağarması */
}

.home-desc {
    color: #888888 !important;
    border-radius: 8px;
    font-size: 14px;
    line-height: 2;
    transition: all 0.3s ease-in-out !important; /* Keçidi sürətləndirir və məcburi edir */
    display: block;
    margin-bottom:5px;
}
.home-desc:hover {
    background-color: rgba(255, 255, 255, 0.1); /* Fon bir az daha çox ağarır */
    color: #dddddd; /* Yazı daha parlaq ağ/boz olur */
}



.social-links {
    display: flex;
    gap: 10px; /* İkonlar arasındakı məsafə */
    padding: 10px;
}

.icon-btn {
    width: 40px;
    height: 40px;
    background-color: transparent;
    border-radius: 50%; /* Tam dairəvi edir */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease; /* Effektlərin yumşaq olması üçün */
    cursor: pointer;
    overflow: hidden;
}

.icon-btn img {
    width: 80%; /* İkonun ölçüsü */
    height: 80%;
    transition: all 0.3s ease;
}

/* Üstünə gələndə (Hover) */
.icon-btn:hover {
    transform: scale(1.1); /* Bir az böyüyür */
    background-color: rgba(255, 255, 255, 0.1); /* Arxa fon azca ağarır */
}

@keyframes shine {0% { background-position: -100px; }40%, 100% { background-position: 140px; }}
.modern-dev {
  /* Əsas rəng bozdur, ağ rəng isə keçid kimi istifadə olunacaq */
  background: linear-gradient(90deg, #555 0%, #fff 50%, #555 100%);
  background-size: 200% auto; /* Fonu böyüdürük ki, hərəkət üçün yer qalsın */

  /* Mətnin içini rəngləmək üçün */
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  /* Animasiya: 3 saniyə ərzində soldan sağa sonsuz dövr */
  animation: wave 3s linear infinite;

  font-weight: 900;
  font-size: 15px;
  display: inline-block;
}

/* Animasiyanın məntiqi: Fonun yerini soldan sağa sürüşdürmək */
@keyframes wave {
  0% {
    background-position: 200% center;
  }
  100% {
    background-position: 0% center;
  }
}



















/* Kiçildilmiş zəng düyməsi */
#tm-main-btn {
    cursor: pointer;
    color: #8b949e; /* Standart boz rəng */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Daha axıcı keçid */
    position: relative;
    display: flex;
    align-items: center;
    padding: 4px;
    border-radius: 6px;
}

#tm-main-btn:hover {
    color: #ffffff; /* Üstünə gələndə ağarsın */
    background-color: rgba(255, 255, 255, 0.1); /* Çox zəif arxa fon işığı */
    transform: translateY(-1px); /* Yüngülcə yuxarı qalxsın */
}

/* Zəng ikonuna hover edəndə yüngül yellənmə (opsional) */
#tm-main-btn:hover svg {
    animation: bellRing 0.5s ease-in-out;
}

@keyframes bellRing {
    0%, 100% { transform: rotate(0); }
    25% { transform: rotate(15deg); }
    75% { transform: rotate(-15deg); }
}

/*        ICINDEKI YAZILAR       */
#tm-panel {
    /* ... köhnə kodların qalır ... */
    animation: slideUp 0.25s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
#tm-panel {
    /* ... köhnə kodların qalır ... */
    animation: slideUp 0.25s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}















/*                               Keybinds             */
.keybinds {
    display: flex;
    flex-wrap: wrap;
    width: 740px; /* Trash düyməsi üçün bir az genişləndirdik */
    margin: 0 auto;
}

.keybinds .rowkey,
.keybinds .row {
    display: flex !important;
    align-items: center;
    justify-content: space-between;
    width: 370px; /* 740 / 2 */
    height: 45px;
    box-sizing: border-box;
    margin-bottom: 5px;
    padding: 0 15px;
}

/* Label Stilləri */
.rowkey label, .row label {
    font-family: 'Inter', sans-serif;
    font-weight: 800;
    font-size: 18px;
    color: #88888d;
    letter-spacing: -0.5px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: 0.2s;
    cursor: default;
}

.rowkey label:hover, .row label:hover {
    color: #a8a8a8;
}

/* Input və Trash-i yan-yana tutan qutu */
.input-wrapper {
    display: flex;
    align-items: center;
    gap: 10px; /* Input və Trash arasındakı məsafə */
}

/* Input Stilləri */
.keybinds input.action2,
.keybinds button.key {
    width: 80px;
    height: 28px;
    background-color: #2a2a2a;
    color: #ccc;
    border: 3px solid #323233;
    border-radius: 6px;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    transition: 0.2s;
    outline: none;
}

.keybinds input.action2:hover,
.keybinds button.key:hover {
    background-color: #121111 !important;
    color: #ffffff !important;
    border-color: #4a4a4a !important;
    box-shadow: 0 0 0 2px #555;
    border-radius: 8px;
}

/* Trash (Zibil qutusu) Düyməsi */
.trash-btn {
    cursor: pointer;
    font-size: 18px;
    color: #55555a;
    transition: 0.2s;
    user-select: none;
    display: flex;
    align-items: center;
}

.trash-btn:hover {
    color: #ff4d4d; /* Hover olanda qırmızı yanır */
    transform: scale(1.2); /* Bir az böyüyür */
}

/*                 STAUTS PANEL           */

/* İkonların yerləşdiyi ana blok */
#tm-notify-wrapper {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-left: auto;
    margin-right: 15px;
    position: relative;
}

/* Hər iki ikon üçün ortaq stil */
.daemon-status-trigger, #tm-main-btn {
    cursor: pointer;
    color: #8b949e;
    padding: 6px;
    border-radius: 8px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* Hover effektləri */
.daemon-status-trigger:hover, #tm-main-btn:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-1px);
}

/* Qırmızı nöqtə (Yeni bildiriş olanda) */
#tm-dot {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 8px;
    height: 8px;
    background: #ff4444;
    border-radius: 50%;
    border: 2px solid #0b0b0b;
    display: none; /* JS ilə 'block' edilə bilər */
}

/* BİLDİRİŞ PANELİ */
#tm-panel {
    display: none; /* JS ilə açılacaq */
    position: absolute;
    top: 45px;
    right: 0;
    width: 240px;
    background: #0f0f0f;
    border: 1px solid #1f1f1f;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    z-index: 1000;
    overflow: hidden;
    animation: panelAppear 0.3s ease-out;
}

.tm-panel-header {
    padding: 10px 15px;
    font-size: 12px;
    font-weight: 800;
    color: #ffffff;
    text-transform: uppercase;
    background: #161616;
    border-bottom: 1px solid #1f1f1f;
}

.tm-panel-body {
    padding: 15px;
}

#tm-title {
    font-size: 13px;
    font-weight: 700;
    color: #eee;
    margin-bottom: 5px;
}

#tm-text {
    font-size: 11px;
    color: #888;
    line-height: 1.5;
}

/* Panel animasiyası */
@keyframes panelAppear {
    from { opacity: 0; transform: translateY(10px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

/* Sənin istədiyin o Soft Pulse animasiyası */
@keyframes daemonSoftPulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.1); }
    70% { box-shadow: 0 0 0 8px rgba(255, 255, 255, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
}

.daemon-status-trigger:hover {
    animation: daemonSoftPulse 1.5s infinite ease-in-out;
}
/* Sən istəyən o özünəxas animasiya kodu */
@keyframes daemonSoftPulse {
    0% { opacity: 1; }
    50% { opacity: 0.6; filter: drop-shadow(0 0 2px #fff); }
    100% { opacity: 1; }
}



.status-dot {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 15px;
    height: 15px;
    background: #00ff00;
    border: 3px solid #151515;
    border-radius: 50%;
    box-shadow: 0 0 10px #00ff00;
}

.dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 15px;
}
input[type="color"] {
    width: 55px;  /* Qalın border üçün eni bir az artırdım */
    height: 35px;
    border: none;
    background: none;
    cursor: pointer;
    padding: 0;
    overflow: hidden;
    transition: all 0.2s ease;
}

/* Üstünə gələndə daha çox ağarması üçün */
input[type="color"]:hover {
    filter: brightness(1.4);
    transform: scale(1.02); /* Bir az da böyüyərək reaksiya verir */
}

/* Chrome, Safari və Edge üçün daxili hissə */
input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}

input[type="color"]::-webkit-color-swatch {
    /* Qalın qara sərhəd və yumşaq künclər */
    border: 4px solid #000000;
    border-radius: 12px;
}

/* Firefox üçün daxili hissə */
input[type="color"]::-moz-color-swatch {
    border: 4px solid #000000;
    border-radius: 12px;
}

.custom-input1:hover, .custom-btn:hover {
  box-shadow: 0 0 0 2px #555;
  border-color: #777;
  background-color: #3d3d3d;
  color: #fff;
}
.custom-input1 {
  /* Ölçülər */
  width: 120px;
  height: 21px;
  padding: 6px 10px;
  display: block; /* Hər biri yeni sətirdə olsun */

  /* Aralıqları idarə etmək */
  margin-top: 0px;    /* Yuxarı boşluğu ləğv et */
  margin-bottom: 2px; /* INPUTLAR ARASINDAKI BOŞLUQ - MAX 2PX */
  margin-left: auto;
  margin-right: 15px;

  font-size: 13px;
  background-color: #2b2b2b;
  color: #d1d1d1;
  border: 3px solid #4a4a4a;
  border-radius: 8px;
  transition: all 0.3s ease;
  outline: none;
  border-style: solid;
}
.custom-input1:hover {
  /* Özündən 2px aralı boz kölgə (halo) effekti */
  box-shadow: 0 0 0 1px #555;
  border-color: #777;
  font-size: 13px;
  background-color: #333; /* Bir az rəngin açılması effekti */
}
.custom-input1:focus {
  border-color: #999;
  font-size: 13px;
  box-shadow: 0 0 0 2px #666;
}
.custom-input1::placeholder {
  color: #666;
  font-size: 14px;
}

.custom-input {
  /* Ölçülər */
  width: 120px;
  height: 21px;
  padding: 6px 10px;
  display: block;
  margin-left: auto;
  margin-right: 15px;
  font-size: 13px;
  /* Rənglər və Görünüş */
  background-color: #2b2b2b; /* Qaraboz fon */
  color: #d1d1d1;            /* Bozumtul ağ yazı */
  border: 3px solid #4a4a4a; /* Ağboz kənarlar */
  border-radius: 8px;        /* Yumru kənarlar */
  transition: all 0.3s ease;
  outline: none;
  border-style: solid;
}
.custom-input:hover {
  /* Özündən 2px aralı boz kölgə (halo) effekti */
  box-shadow: 0 0 0 1px #555;
  border-color: #777;
  font-size: 13px;
  background-color: #333; /* Bir az rəngin açılması effekti */
}
.custom-input:focus {
  border-color: #999;
  font-size: 13px;
  box-shadow: 0 0 0 2px #666;
}
.custom-input::placeholder {
  color: #666;
  font-size: 14px;
}
.top-bar {
  display: flex;
  justify-content: flex-end; /* Sağa söykəyir */
  align-items: center;       /* Hündürlükləri eyni mərkəzdə saxlayır */
  gap: 10px;                 /* Elementlər arasındakı məsafə */
  margin-right: 15px;
  padding: 10px 0;
}
.custom-btn {
  width: 120px;  /* 65px çox dar olduğu üçün bir az artırdım ki yazı sığsın */
  height: 30px;
  background-color: #333;
  color: #d1d1d1;
  border: 1px solid #4a4a4a;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  font-weight: bold; /* Yazılar qalınlaşdırıldı */
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap; /* Yazını bir sətirdə saxlayır */
}
.custom-input:hover, .custom-btn:hover {
  box-shadow: 0 0 0 2px #555;
  border-color: #777;
  background-color: #3d3d3d;
  color: #fff;
}
.custom-btn:active {
  transform: scale(0.95);
}


.new-badge {
  background-color: #2ecc71;
  color: white;
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  padding: 4px 9px;
  height: 20;
  border-radius: 5px;

  /* Əsas hiylə buradadır: */
  margin-left: auto;   /* Sol tərəfdən boşluq verib özünü sağa sıxır */
  margin-right: 15px;  /* Switch ilə arasındakı o dediyin 15px məsafə */

  display: inline-block;
  line-height: 1;
}




/* Mövcud kodlarına toxunmadan sadəcə select dizaynı */
.selectt {
    background-color: #1a1a1a;   /* Tünd fon */
    color: #88888d;              /* Sənin label rənginlə eyni */
    border: 1px solid #333;       /* İncə çərçivə */
    border-radius: 6px;           /* Yumşaq künclər */
    padding: 8px 50px 8px 10px;   /* Daxili boşluqlar */
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    outline: none;
    margin-right: 10px;           /* Switch ilə arasındakı 10px məsafə */
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2388888d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    transition: all 0.2s ease;
}
.visualselect {
    background-color: #1a1a1a;   /* Tünd fon */
    color: #88888d;              /* Sənin label rənginlə eyni */
    border: 1px solid #333;       /* İncə çərçivə */
    border-radius: 6px;           /* Yumşaq künclər */
    padding: 8px 70px 8px 10px;   /* Daxili boşluqlar */
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    outline: none;
    margin-right: 0px;           /* Switch ilə arasındakı 10px məsafə */
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2388888d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    transition: all 0.2s ease;
}
.custom-select {
    margin-right: 15px !important;
}
.selectt:hover {
    border-color: #444;
    color: #a8a8a8;
    background-color: #222;
}
.visualselect:hover {
    border-color: #444;
    color: #a8a8a8;
    background-color: #222;
}

/* Select-in daxilindəki seçimlər (dropdown menyu) */
.visualselect option {
    background-color: #1a1a1a;
    color: #a8a8a8;
}
/* Select-in daxilindəki seçimlər (dropdown menyu) */
.selectt option {
    background-color: #1a1a1a;
    color: #a8a8a8;
}
.right-group {
    display: flex;
    align-items: center;
    gap: 15px; /* Bax bu 15px tam olaraq istədiyin boşluğu yaradacaq */
}
#mod-lang-switcher {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 6px; /* Kvadratın kənarlarını azca yumşaldır */
    transition: all 0.2s ease-in-out; /* Animasiya keçidi */
    color: #ccc;
    background: transparent;
}

/* Üstünə gələndə yaranan effekt */
#mod-lang-switcher:hover {
    background: rgba(255, 255, 255, 0.1); /* Boz şəffaf arxa fon */
    transform: scale(1.05); /* Çox azca böyümə animasiyası */
    color: #fff; /* Üstünə gələndə ağ rəngə çalsın */
}

/* İkonun özü */
#mod-lang-switcher svg {
    transition: transform 0.2s ease;
}
.top-bar {
    width: 715px;
    background: #0d0c0c;
    padding: 15px;
    border-radius: 12px;
    color: white;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#bot-list-container {
    width: 100%;
    max-height: 250px;
    overflow-y: auto;
    margin-bottom: 10px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#bot-list-container::-webkit-scrollbar {
    display: none;
}

.bot-row {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    margin-bottom: 5px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 6px;
    transition: background 0.2s;
    /* BU SƏTİR SCROLLU ARADAN QALDIRIR: */
    box-sizing: border-box;
}

.bot-row:hover {
    background: rgba(255, 255, 255, 0.12);
}

.bot-row span:last-child {
    color: #ff4d4d;
    cursor: pointer;
    font-weight: bold;
    padding: 2px 8px;
}

.bot-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.custom-btn:hover {
    background: #357abd;
}

.remove-all {
    background: #d9534f;
}







    /* Bütün stilləri #tab-packs ID-sinə bağlayırıq ki, kənara çıxmasın */

    #tab-packs .texture-scroll-container {
        max-height: 380px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.25);
        border-radius: 12px;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    /* Scrollbar - Yalnız bu konteyner üçün */
    #tab-packs .texture-scroll-container::-webkit-scrollbar { width: 8px; }
    #tab-packs .texture-scroll-container::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    #tab-packs .texture-scroll-container::-webkit-scrollbar-thumb { background: #91b2db; border-radius: 10px; }

    #tab-packs .texture-row {
        background: rgba(255, 255, 255, 0.05);
        padding: 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: 0.2s;
        margin-bottom: 5px; /* Digər rowlarla qarışmasın */
    }

    #tab-packs .texture-row:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
    }

    #tab-packs .texture-info {
        margin-bottom: 10px;
        font-weight: bold;
        color: #91b2db;
        font-size: 15px;
        font-family: sans-serif;
        text-align: left;
    }

    #tab-packs .texture-visuals {
        display: flex;
        align-items: center;
        justify-content: space-around;
        gap: 10px;
    }

    #tab-packs .visual-box {
        width: 80px;
        height: 80px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px dashed rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    #tab-packs .visual-box img {
        max-width: 80%;
        max-height: 80%;
        object-fit: contain;
        z-index: 2;
    }

    #tab-packs .visual-box.original {
        border-style: solid;
        border-color: rgba(255, 255, 255, 0.1);
    }

    #tab-packs .drop-zone { cursor: pointer; transition: 0.3s; }
    #tab-packs .drop-zone:hover { border-color: #91b2db; background: rgba(145, 178, 219, 0.1); }

    #tab-packs .drop-text {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.4);
        text-align: center;
        pointer-events: none;
    }

    #tab-packs .label {
        position: absolute;
        bottom: -18px;
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
        width: 100%;
        text-align: center;
        background: none; /* Ümumi label stillərini sıfırlayırıq */
    }

    #tab-packs .arrow { color: rgba(255, 255, 255, 0.15); font-size: 22px; }

    #tab-packs .remove-tex {
        position: absolute;
        top: -7px;
        right: -7px;
        background: #ff4d4d;
        color: white;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        z-index: 10;
        box-shadow: 0 2px 5px rgba(0,0,0,0.4);
    }

    #tab-packs .texture-controls { display: flex; gap: 10px; margin-top: 20px; }

    #tab-packs .texture-btn {
        padding: 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        flex: 1;
        transition: 0.3s;
        color: white;
        text-transform: none; /* Əgər globalda böyük hərflədirsə */
    }

    #tab-packs .save-btn { background: #4caf50; }
    #tab-packs .save-btn:hover { background: #3e8e41; transform: translateY(-2px); }
    #tab-packs .reset-btn { background: #e74c3c; }
    #tab-packs .reset-btn:hover { background: #c0392b; transform: translateY(-2px); }
/* Ümumi konteyner */
.range-container {
    display: flex;
    align-items: center;
    gap: 8px; /* Dairələr və slider arasındakı məsafə */
}

/* Dairələrin ortaq stili */
.color-ball {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.3);
    flex-shrink: 0;
}

/* Reset düyməsinin xüsusi stili */
.reset-style {
    background-color: #bfbfbf; /* Sənin istədiyin orijinal boz rəng */
    cursor: pointer;
    transition: transform 0.2s;
}

.reset-style:hover {
    transform: scale(1.2);
    border-color: #fff;
}

/* Dinamik dairənin ilkin rəngi */
#dynamicColorCircle {
    background-color: #bfbfbf;
}

/* Slider stili (opsional, əgər yoxdursa) */
.modern-range {
    cursor: pointer;
    accent-color: #bfbfbf; /* Sliderin başlığı da boz olsun */
}

`;


    const style = document.createElement("style");
    style.textContent = css;
    document.head.appendChild(style);
    const html = `
    <div id="daemonclient">
    <div id="menuheader"><div class="title" id="daemon-title"><svg class="daemon-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#000000" d="M187.406 22.22l-41.562 41.843 62.875 29.843-8 16.875-68.845-32.655L59.97 150.53l33.31 96.97 56.876-7.156 10.53-42.47 18.126 4.47-45.843 185.25 55.31-49.656 10-9 4.94 12.5 14.81 37.53 31.25-41.624 8.126-10.844 7.25 11.47 30.406 48.217 22.657-46.75 5.092-10.5 9.125 7.25 62.532 49.782-62.814-182.22 17.656-6.094 12.782 37.063 60.562-.94 26.47-101.874-72.72-62.344-70.125 38.844-9.06-16.375 64.03-35.468-29.75-25.53-144.094-8.813zm190.688 85.5l13.28 67.218-107.28-16.25 94-50.97zm-246.188.936L229.97 160l-116.25 13.47 18.186-64.814zm123.188 122.5l55.844 64.75-36.25 12.875-17.407-42.655-15.374 43.344-35.344-13.564 48.532-64.75zm74.344 126.938L304.53 409.47l-7.342 15.155-8.97-14.25-32.124-50.97-33.156 44.19-10.063 13.342-6.125-15.53-15.97-40.594-30.436 27.312 25.53 66.406 61.407 35.22 98.814-39.563 16.937-65.343-33.592-26.75z"/><circle class="daemon-eye-red" cx="300" cy="140" r="15" /><circle class="daemon-eye-red" cx="180" cy="130" r="15" /></svg>
    <div class="daemon-eye eye-d"><span></span></div><span id="daemonLogoText">Daemon Client</span><div class="daemon-eye eye-m"><span></span></div><span class="by" title="Creator">by Bextiyar</span></div>

<div id="tm-notify-wrapper">
    <div class="daemon-status-trigger" onclick="toggleDaemonModal()" title="Update Log">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline><circle cx="19" cy="5" r="3" fill="#2ecc71" stroke="#0a0a0a" stroke-width="1.5"></circle></svg>
    </div>

<div style="display: none;">
    <div id="mod-lang-switcher"
         style="display: inline-block; position: relative; margin: 0 10px; cursor: pointer; vertical-align: middle;"
         onmouseenter="document.getElementById('mod-lang-menu').style.display='block'"
         onmouseleave="document.getElementById('mod-lang-menu').style.display='none'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.8;"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
        <div id="mod-lang-menu" style="display: none; position: absolute; top: 25px; right: 0; background: #111; border: 1px solid #333; border-radius: 4px; z-index: 99999; min-width: 100px; box-shadow: 0 4px 12px rgba(0,0,0,0.6);">
            <div onclick="window.setModLanguage('en')" style="padding: 10px; font-size: 12px; color: white; border-bottom: 1px solid #222;" onmouseover="this.style.background='#333'" onmouseout="this.style.background='transparent'">English</div>
            <div onclick="window.setModLanguage('tr')" style="padding: 10px; font-size: 12px; color: white; border-bottom: 1px solid #222;" onmouseover="this.style.background='#333'" onmouseout="this.style.background='transparent'">Turkish</div>
            <div onclick="window.setModLanguage('ru')" style="padding: 10px; font-size: 12px; color: white;" onmouseover="this.style.background='#333'" onmouseout="this.style.background='transparent'">Russian</div>
        </div>
    </div>
    </div>


    <div id="tm-main-btn" title="News">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
        <div id="tm-dot"></div>
        <div id="tm-panel">
            <div class="tm-panel-header" id="notif-header">Notifications</div>
            <div class="tm-panel-body">
                <div id="tm-title">No messages</div>
                <div id="tm-text">New updates will appear here.</div>
            </div>
        </div>
    </div>
</div>

    <div title="Close" id="closer">×</div>
</div>


<div id="menubody">
<div id="menusidebar">
    <button data-tab="home" class="active">🏠︎ Home<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="combat">⚔ Combat<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="keybinds">⌨ Keybinds<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="visual">👁 Visual<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="misc">🛠 Misc<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="bots">𖠌 Bots<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="packs">🖌 Texture Pack<div class="daemon-eyes"><span></span><span></span></div></button>
    <button data-tab="interface" style="margin-top:auto;">☰ Interface<div class="daemon-eyes"><span></span><span></span></div></button>
</div>



<div id="menucontainer">
<div id="tab-home" class="menucontent" style="display:block;">
<h1 id="home-main-title" style="font-size: 30px; margin: 0; padding: 0;">🏠︎ Home</h1><br>

<div class="backsection-box">
    <div class="home-name">
        <h1 id="welcome-text" style="font-size: 24px; margin: 0; padding-left: 25px !important;">Welcome to the Daemon Client</h1>
    </div><br>

    <div id="welcome-desc-1" class="home-description">
There is no main purpose in creating this mod. It is just a hobby. I will create new functions, features or systems according to my own wishes, but I will also pay attention to your ideas. The mod currently works great with <b>polearm, katana, sword</b> and <b>great hammer, bows, musket</b>. The next update will include features for these weapon combinations! This menu can have a lot of <b>options</b> and <b>toggles</b> and it can be tiring when you are customizing the mod, but I like the multi-function menu. The menu also has <b>autosave</b>, which means that the settings you make are always <b>saved</b>. I will send you new updates in the <b>Notifications</b> section. This mod is the successor to <b>Genesis</b>. Make sure you have made all your adjustments before you start playing!
</div><br>

    <div id="welcome-desc-2" class="home-description">
        Send me the features you would like to see here.
    </div><br>

    <div id="welcome-desc-3" class="home-description">
        This mod is still under development, if you see a bug or problem with the mod, be sure to report it.
    </div>
</div><br>

<div class="backsection-box">
    <div class="home-desc">
        <h1 id="discord-promo-text" style="font-size: 18px; margin: 0; padding-left: 15px !important;">Come to our discord server to check out new updates!</h1>
    </div>
    <div class="home-desc">
        <div class="social-links">
            <a title="Discord Server" href="https://discord.gg/hRXJn97Keu" target="_blank" class="icon-btn"><img src="https://cdn-icons-png.flaticon.com/512/3670/3670157.png" alt="Discord"></a>
            <a title="Youtube Channel" href="https://www.youtube.com/@Bextiyar" target="_blank" class="icon-btn code-icon"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="Youtube"></a>
            <a title="SoulOnGame" href="https://www.youtube.com/@Soulongamee" target="_blank" class="icon-btn code-icon"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="Youtube"></a>
        </div>
    </div>

    <div class="home-desc">
        <h1 style="font-size: 15px; margin: 0; padding-left: 15px !important;">
            <span id="version-text">Version:</span>
            <span class="modern-dev" style="font-size: 15px; margin: 0;" title="Currently Version"> v${CURRENT_VERSION} TTHOPO</span>
        </h1>
    </div>
</div><br>
</div>










<div id="tab-combat" class="menucontent">
<h1 id="combat-title" style="font-size: 30px; margin: 0; padding: 0;">⚔ Combat</h1>
<p id="combat-desc" style="margin-top: 2px; padding: 0;">Setup combat tactics for battles.</p>
<div class="backsection-box"><h2 id="combat-h-placement">Placement</h2>
<div class="row"><span class="label" id="lbl-auto-placer">Auto Placer</span><label class="switch"><input type="checkbox" id="combat_placement_auto_placer"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-smart-place">Smart Place</span><label class="switch"><input type="checkbox" id="combat_placement_auto_place"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-place-replace">Auto Place Replace </span><label class="switch"><input type="checkbox" id="combat_placement_auto_place_replace"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-replacer">Auto Replacer </span><label class="switch"><input type="checkbox" id="combat_placement_auto_replace"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-preplacer">Auto Preplacer </span><label class="switch"><input type="checkbox" id="combat_placement_auto_preplacer"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-placer-radius">Auto placer radius</span><div class="range-container"><span class="range-value" id="autoplaceradius-val">300</span><input type="range" id="ap-autoplacer-radius-slider"class="modern-range"min="100"max="500"step="25"value="300"></div></div>
<div class="row"><span class="label" id="lbl-auto-mill">Auto mill</span><label class="switch"><input type="checkbox" id="combat_placement_auto_windmill"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-grind">Auto grind</span><label class="switch"><input type="checkbox" id="combat_placement_auto_grind"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-placement-defense">Placement defense</span><label class="switch"><input type="checkbox" id="combat_placement_defense_placement"><span class="slider"></span></label></div>
</div><br>

<div class="backsection-box"><h2 id="combat-h-armor">Armor</h2>
<div class="row"><span class="label">Biome armor</span><label class="switch"><input type="checkbox" id="combat_biome_armor"><span class="slider"></span></label></div>
<div class="row"><span class="label">Defense armor</span><div class="right-group"><select style="width:130px" class="selectt" id="defencehat_type"><option value="1">Soldier</option><option value="2">Barbarian</option><option value="3">Spikegear</option></select><select class="selectt" id="defenceacc_type"><option value="1">Corrupt X</option><option value="2">Shadow</option></select>
<label class="switch"><input type="checkbox" id="combat_defense_armor"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Defense armor radius</span><div class="range-container"><span class="range-value" id="defenseradius-val">300</span><input type="range" id="ap-defense-radius-slider" class="modern-range" min="100" max="500" step="25" value="300"></div></div>
<div class="row"><span class="label">Spikes armor</span><label class="switch"><input type="checkbox" id="combat_spike_armor"><span class="slider"></span></label></div>
<div class="row"><span class="label">Animal armor</span><label class="switch"><input type="checkbox" id="combat_animal_armor"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Emp</span><label class="switch"><input type="checkbox" id="combat_auto_emp"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Medic</span><label class="switch"><input type="checkbox" id="combat_auto_medic"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Invicible</span><label class="switch"><input type="checkbox" id="combat_auto_invicible"><span class="slider"></span></label></div>
<div class="row"><span class="label">Invicible speed</span><div class="range-container"><span class="range-value" id="speedradius-val">1</span><input type="range" id="ap-speed-radius-slider" class="modern-range" min="0" max="5" step="0.5" value="1"></div></div>
</div><br>

<div class="backsection-box"><h2 id="combat-h-defense">Defense</h2>
<div class="row"><span class="label">Safe Walk Spikes (Stops)</span><label class="switch"><input type="checkbox" id="combat_safewalk_stop"><span class="slider"></span></label></div>
<div class="row"><span class="label">Safe Walk Spikes (Dodge)</span><label class="switch"><input type="checkbox" id="combat_safewalk"><span class="slider"></span></label></div>
<div class="row"><span class="label">Safe Walk Boost pad (Dodge)</span><label class="switch"><input type="checkbox" id="combat_safewalkb"><span class="slider"></span></label></div>
<div class="row"><span class="label">Safe Walk Teleporters (Dodge)</span><label class="switch"><input type="checkbox" id="combat_safewalkt"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-healing">Healing</span><label class="switch"><input type="checkbox" id="combat_healing"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto-break">Auto Break</span><label class="switch"><input type="checkbox" id="combat_autobreak"><span class="slider"></span></label></div>
<div class="row"><span class="label" id="lbl-auto_q">Auto Q</span><label class="switch"><input type="checkbox" id="combat_auto_q"><span class="slider"></span></label></div>
</div><br>

<div class="backsection-box">
<div style="display: flex; align-items: center; padding-right: 20px; gap: 10px;">
    <h2 id="combat-h-attack" style="margin: 0; padding: 0;">Attack</h2>


</div>


<div class="row"><span class="label">Insta Kill</span><div class="right-group"><select class="selectt" id="insta_type"><option value="1">Counter</option><option value="2">Reverse</option><option value="3">MS Reverse</option><option value="4">Spike Reverse</option><option value="5">Boost Insta</option></select><label class="switch"><input type="checkbox" id="combat_insta_kill"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Manual Tick</span><div class="right-group"><select class="selectt" id="tick_type"><option value="1">Spike Tick</option><option value="2">One tick</option></select><label class="switch"><input type="checkbox" id="combat_manual_tick"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">No Bull Insta Kill</span><label class="switch"><input type="checkbox" id="combat_no_bull_insta"><span class="slider"></span></label></div>
<div class="row"><span class="label">Bow Tick</span><label class="switch"><input type="checkbox" id="combat_bow_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Age 1<a style="color:#ff00ff00">a</a>Insta</span><label class="switch"><input type="checkbox" id="combat_age_1_insta"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Sync</span><label class="switch"><input type="checkbox" id="combat_auto_sync"><span class="slider"></span></label></div>
<div class="row"><span class="label">Spike Tick</span><label class="switch"><input type="checkbox" id="combat_spike_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Try Spike Tick</span><label class="switch"><input type="checkbox" id="combat_tryspiketick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Spike Sync</span><label class="switch"><input type="checkbox" id="combat_spike_sync"><span class="slider"></span></label></div>
<div class="row"><span class="label">Spike Sync on Pushing</span><label class="switch"><input type="checkbox" id="combat_spike_sync_onpushing"><span class="slider"></span></label></div>
<div class="row"><span class="label"">Knockback Tick</span><label class="switch"><input type="checkbox" id="combat_knockback_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Knockback Push</span><label class="switch"><input type="checkbox" id="combat_knockback_push"><span class="slider"></span></label></div>
<div class="row"><span class="label">Velocity Tick</span><label class="switch"><input type="checkbox" id="combat_velocity_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Static Based</span><label class="switch"><input type="checkbox" id="combat_static_based"><span class="slider"></span></label></div>
<div class="row"><span class="label">Spikegear Tick</span><label class="switch"><input type="checkbox" id="combat_spikegear_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Spikegear Hammer Tick</span><label class="switch"><input type="checkbox" id="combat_spikegear_hammer_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Safe Spikegear tick</span><label class="switch"><input type="checkbox" id="combat_safe_spikegear_tick"><span class="slider"></span></label></div>
<div class="row"><span class="label">Turret Sync</span><label class="switch"><input type="checkbox" id="combat_turret_sync"><span class="slider"></span></label></div>
<div class="row"><span class="label">Predictive Aim</span><label class="switch"><input type="checkbox" id="combat_predictive_aim"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Steal</span><label class="switch"><input type="checkbox" id="combat_auto_steal"><span class="slider"></span></label></div>
<div class="row"><span class="label">Bull Hit</span><label class="switch"><input type="checkbox" id="combat_bull_hit"><span class="slider"></span></label></div>
<div class="row"><span class="label">Turret Combat</span><label class="switch"><input type="checkbox" id="combat_turret_combat"><span class="slider"></span></label></div>
<div class="row"><span class="label">Bow Spam</span><label class="switch"><input type="checkbox" id="combat_bow_spam"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto push</span><label class="switch"><input type="checkbox" id="combat_auto_push"><span class="slider"></span></label></div>
<br>
</div>
</div>













<div id="tab-keybinds" class="menucontent">
<h1 id="kb-main-title" style="font-size: 30px; margin: 0; padding: 0;">⌨ Keybinds</h1>
<p id="kb-main-desc" style="margin-top: 2px; padding: 0;">Setup keybinds for item, weapons, hats, toggles.</p>

<div class="backsection-box"><div class="container"><h2 id="kb-h-movement">Movement & Controls</h2><div class="keybinds">
<div class="rowkey"><label id="kb-up">Up</label><div class="input-wrapper"><input class="action2" data-action="movew" value="W"><span class="trash-btn" data-action="movew">🗑</span></div></div>
<div class="row"><label id="kb-left">Left</label><div class="input-wrapper"><input class="action2" data-action="movea" value="A"><span class="trash-btn" data-action="movea">🗑</span></div></div>
<div class="rowkey"><label id="kb-down">Down</label><div class="input-wrapper"><input class="action2" data-action="moves" value="S"><span class="trash-btn" data-action="moves">🗑</span></div></div>
<div class="row"><label id="kb-right">Right</label><div class="input-wrapper"><input class="action2" data-action="moved" value="D"><span class="trash-btn" data-action="moved">🗑</span></div></div>
<div><div class="rowkey"><label id="kb-autoattack">Auto Attack</label><div class="input-wrapper"><input class="action2" data-action="autoattack" value="E"><span class="trash-btn" data-action="autoattack">🗑</span></div></div></div>
<div><div class="row"><label id="kb-lockdir">Lock Rotation</label><div class="input-wrapper"><input class="action2" data-action="lockdir" value="X"><span class="trash-btn" data-action="lockdir">🗑</span></div></div></div>
<div><div class="rowkey"><label id="kb-mapmarker">Map Marker</label><div class="input-wrapper"><input class="action2" data-action="mapmarker" value="C"><span class="trash-btn" data-action="mapmarker">🗑</span></div></div></div>
</div><div class="keybinds">
<div class="rowkey"><label id="kb-insta">Insta kill</label><div class="input-wrapper"><input class="action2" data-action="instakey" value="R"><span class="trash-btn" data-action="instakey">🗑</span></div></div>
<div class="row"><label id="kb-tick">Manual Tick</label><div class="input-wrapper"><input class="action2" data-action="tickkey" value="B"><span class="trash-btn" data-action="tickkey">🗑</span></div></div>
</div></div></div><br>

<div class="backsection-box"><div class="container"><h2 id="kb-h-items">Items & Weapons</h2><div class="keybinds">
<div class="rowkey"><label id="kb-primary">Primary Weapon</label><div class="input-wrapper"><input class="action2" data-action="primary" value="1"><span class="trash-btn" data-action="primary">🗑</span></div></div>
<div class="row"><label id="kb-secondary">Secondary Weapon</label><div class="input-wrapper"><input class="action2" data-action="secondary" value="2"><span class="trash-btn" data-action="secondary">🗑</span></div></div>
<div class="rowkey"><label id="kb-spike">Spike</label><div class="input-wrapper"><input class="action2" data-action="spike" value="V"><span class="trash-btn" data-action="spike">🗑</span></div></div>
<div class="row"><label id="kb-trap">Trap/Boostpad</label><div class="input-wrapper"><input class="action2" data-action="trap" value="F"><span class="trash-btn" data-action="trap">🗑</span></div></div>
<div class="rowkey"><label id="kb-wall">Wall</label><div class="input-wrapper"><input class="action2" data-action="wall" value="4"><span class="trash-btn" data-action="wall">🗑</span></div></div>
<div class="row"><label id="kb-turret">Turret</label><div class="input-wrapper"><input class="action2" data-action="turret" value="H"><span class="trash-btn" data-action="turret">🗑</span></div></div>
<div class="rowkey"><label id="kb-windmill">Windmill</label><div class="input-wrapper"><input class="action2" data-action="windmill" value="N"><span class="trash-btn" data-action="windmill">🗑</span></div></div>
<div class="row"><label id="kb-food">Food</label><div class="input-wrapper"><input class="action2" data-action="food" value="Q"><span class="trash-btn" data-action="food">🗑</span></div></div>
<div class="rowkey"><label id="kb-spawn">Spawn Pad</label><div class="input-wrapper"><input class="action2" data-action="spawn" value="9"><span class="trash-btn" data-action="spawn">🗑</span></div></div>
</div><br><div class="keybinds">
<div class="rowkey"><label id="kb-cycle-spike">Cycle Spike</label><div class="input-wrapper"><input class="action2" data-action="spikec" value="L"><span class="trash-btn" data-action="spikec">🗑</span></div></div>
<div class="row"><label id="kb-cycle-trap">Cycle Trap/Boostpad</label><div class="input-wrapper"><input class="action2" data-action="trapc" value="O"><span class="trash-btn" data-action="trapc">🗑</span></div></div>
<div class="rowkey"><label id="kb-cycle-turret">Cycle Turret</label><div class="input-wrapper"><input class="action2" data-action="turretc" value="K"><span class="trash-btn" data-action="turretc">🗑</span></div></div>
<div class="row"><label id="kb-cycle-spawn">Cycle Spawn Pad</label><div class="input-wrapper"><input class="action2" data-action="spawnc" value="U"><span class="trash-btn" data-action="spawnc">🗑</span></div></div>
</div><br><div class="keybinds">
<div class="rowkey"><label id="kb-debug">Debug</label><div class="input-wrapper"><input class="action2" data-action="debug" value="P"><span class="trash-btn" data-action="debug">🗑</span></div></div>
<div class="row"><label id="kb-boostspike">Boost Spike</label><div class="input-wrapper"><input class="action2" data-action="boostspike" value="_"><span class="trash-btn" data-action="boostspike">🗑</span></div></div>
</div></div></div><br>

<div class="backsection-box"><div class="container"><h2 id="kb-h-menu">Menu & Interface</h2><div class="keybinds">
<div class="rowkey"><label id="kb-alliance">Alliance menu</label><div class="input-wrapper"><input class="action2" data-action="alicem" value="CTRL"><span class="trash-btn" data-action="alicem">🗑</span></div></div>
<div class="row"><label id="kb-store">Store menu</label><div class="input-wrapper"><input class="action2" data-action="storem" value="SHIFT"><span class="trash-btn" data-action="storem">🗑</span></div></div>
<div class="rowkey"><label id="kb-menu">Menu</label><div class="input-wrapper"><input class="action2" data-action="menum" value="ESCAPE"><span class="trash-btn" data-action="menum">🗑</span></div></div>
<div class="row"><label id="kb-chat">Chat holder</label><div class="input-wrapper"><input class="action2" data-action="chatm" value="ENTER"><span class="trash-btn" data-action="chatm">🗑</span></div></div>
<div class="rowkey"><label id="kb-chatlog">Chat log</label><div class="input-wrapper"><input class="action2" data-action="chatlogo" value="T"><span class="trash-btn" data-action="chatlogo">🗑</span></div></div>
</div></div></div>

</div>

















                <div id="tab-visual" class="menucontent">
                <h1 style="font-size: 30px; margin: 0; padding: 0;">👁 Visuals</h1>
                <p style="margin-top: 2px; padding: 0;">Change or Setup color, animation.</p>
<div class="backsection-box">
<h2>Tracer</h2>
<div class="row"><span class="label">Enemie</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0001" style="background-color:#cc5151; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0001" class="color-box" value="#cc5151"><label class="switch"><input type="checkbox" id="visualstracer_enemie"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Teammate</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0002" style="background-color:#a3a11a; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0001" class="color-box" value="#a3a11a"><label class="switch"><input type="checkbox" id="visualstracer_teammate"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Animal</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0003" style="background-color:#518ccc; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0003" class="color-box" value="#518ccc"><label class="switch"><input type="checkbox" id="visualstracer_animal"><span class="slider"></span></label></div></div>
<div class="row" style="display:none"><span class="label">Bot</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0005" style="background-color:#8ecc51; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0005" class="color-box" value="#8ecc51"><label class="switch"><input type="checkbox" id="visualstracer_bot"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Clan leader</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg000401" style="background-color:#5228bd; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c000401" class="color-box" value="#5228bd"><label class="switch"><input type="checkbox" id="visualstracer_clanleader"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Top killer</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg000402" style="background-color:#171717; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c000402" class="color-box" value="#171717"><label class="switch"><input type="checkbox" id="visualstracer_skull"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Notification</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0004" style="background-color:#f5d951; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0004" class="color-box" value="#f5d951"><label class="switch"><input type="checkbox" id="visualstracer_notfication"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">My Objects</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0006" style="background-color:#a8c485; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0006" class="color-box" value="#a8c485"><label class="switch"><input type="checkbox" id="visualstracer_my_object"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Enemy Objects</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0007" style="background-color:#c48585; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0007" class="color-box" value="#c48585"><label class="switch"><input type="checkbox" id="visualstracer_enemie_object"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Teammate Objects</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0008" style="background-color:#c9c77b; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0008" class="color-box" value="#c9c77b"><label class="switch"><input type="checkbox" id="visualstracer_teammate_object"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Arrows</span><label class="switch"><input type="checkbox" id="visualstracer_arrows"><span class="slider"></span></label></div>
</div><br>

<div class="backsection-box">
<h2>Object Healts</h2>
<div class="row"><span class="label">My</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0006" style="background-color:#8ecc51; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0006" class="color-box" value="#8ecc51"><label class="switch"><input type="checkbox" id="visualsobject_my_health"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Enemie</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0007" style="background-color:#cc5151; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0007" class="color-box" value="#cc5151"><label class="switch"><input type="checkbox" id="visualsobject_enemy_health"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Teammate</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0008" style="background-color:#a3a11a; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0008" class="color-box" value="#a3a11a"><label class="switch"><input type="checkbox" id="visualsobject_teammate_health"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Health Type</span><div class="right-group"><select class="visualselect" id="health_type">
<option value="1">Neon</option>
<option value="2" selected>Classic</option>
<option value="3">Animation</option>
<option value="4">Critical Shake</option>
<option value="5">Segmented</option>
</select></div></div>
</div><br>


<div class="backsection-box">
<h2>Object Marks</h2>
<div class="row"><span class="label">My</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0009" style="background-color:#00FF00; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0009" class="color-box" value="#00FF00"><label class="switch"><input type="checkbox" id="visualsobject_my_mark"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Enemie</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0010" style="background-color:#FF0000; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0010" class="color-box" value="#FF0000"><label class="switch"><input type="checkbox" id="visualsobject_enemy_mark"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Teammate</span><div style="display: flex; align-items: center; gap: 10px;"><div id="cg0011" style="background-color:#FFFF00; border-radius: 50%;" class="dot"></div><input style="width: 55px; height: 27px;" type="color" id="c0011" class="color-box" value="#FFFF00"><label class="switch"><input type="checkbox" id="visualsobject_teammate_mark"><span class="slider"></span></label></div></div>
<div class="row"><span class="label">Marks Type</span><div class="right-group"><select class="visualselect" id="marks_type">
<option value="1">Neon</option>
<option value="2" selected>Classic</option>
<option value="3">Glass</option>
<option value="4">Pulsing</option>
<option value="5">Hologram</option>
</select></div></div>
</div><br>

<div class="backsection-box">
<h2>Player</h2>
<div class="row"><span class="label">Health bar</span><label class="switch"><input type="checkbox" id="visualplayer_health_bar"><span class="slider"></span></label></div>
<div class="row"><span class="label">Weapon reload bars</span><label class="switch"><input type="checkbox" id="visualplayer_weapon_reload_bar"><span class="slider"></span></label></div>
<div class="row"><span class="label">Turret reload bars</span><label class="switch"><input type="checkbox" id="visualplayer_turret_reload_bar"><span class="slider"></span></label></div>
<div class="row"><span class="label">HP & Shame count</span><label class="switch"><input type="checkbox" id="visualplayer_hp_shame"><span class="slider"></span></label></div>
<div class="row"><span class="label">Knockback Path</span><label class="switch"><input type="checkbox" id="visualplayer_knockback_path"><span class="slider"></span></label></div>
<div class="row"><span class="label">Auto Push Path</span><label class="switch"><input type="checkbox" id="visualplayer_auto_push_path"><span class="slider"></span></label></div>
<div class="row"><span class="label">Aim Angel</span><label class="switch"><input type="checkbox" id="visual_look_angel"><span class="slider"></span></label></div>
<div class="row"><span class="label">Move Angel</span><label class="switch"><input type="checkbox" id="visual_move_angel"><span class="slider"></span></label></div>
</div><br>

<div class="backsection-box">
<h2>Map & Biome</h2>
<div class="row"><span class="label">Volcano Area</span><label class="switch"><input type="checkbox" id="visualsmap_volcano_area"><span class="slider"></span></label></div>
<div class="row"><span class="label">Volcano Animals Area</span><label class="switch"><input type="checkbox" id="visualsmap_volcano_spawn_animals_area"><span class="slider"></span></label></div>
<div class="row"><span class="label">Volcano Damage Area</span><label class="switch"><input type="checkbox" id="visualsmap_volcano_damage_area"><span class="slider"></span></label></div>
<div class="row"><span class="label">Biome Type</span><div class="right-group"><select class="visualselect" id="map_type">
<option value="1" selected>Normal</option>
<option value="2">Night</option>
<option value="3">Realistic</option>
</select></div></div>
</div><br>


</div>





                <div id="tab-misc" class="menucontent">
                <h1 style="font-size: 30px; margin: 0; padding: 0;">🛠 Misc</h1>
                <p style="margin-top: 2px; padding: 0;">Customize misc settings, add autochat messages, reset settings.</p>
<div class="backsection-box">
<h2>Other</h2>
<div class="row"><span class="label">Kill Chat</span><input id="killchats01" class="custom-input" type="text" minlength="0" maxlength="15" value="Daemon Client!" placeholder="Empty"><label class="switch"><input type="checkbox" id="misc_kill_chat"><span class="slider"></span></label></div>

<div class="row" style="display: flex; align-items: center; justify-content: space-between; padding: 5px 10px 5px 5px; gap: 2px;"><span class="label" style="flex-shrink: 0; margin-right: 10px;">Auto Chat</span><div style="display: flex; gap: 2px; flex-grow: 1; justify-content: flex-end; align-items: center;">
        <input id="autochats01" class="custom-input1" type="text" maxlength="15" value="" placeholder="Empty" style="width: 100px; margin: 0; display: inline-block;">
        <input id="autochats02" class="custom-input1" type="text" maxlength="15" value="" placeholder="Empty" style="width: 100px; margin: 0; display: inline-block;">
        <input id="autochats03" class="custom-input1" type="text" maxlength="15" value="" placeholder="Empty" style="width: 100px; margin: 0; display: inline-block;">
</div><label class="switch" style="margin-left: 15px; flex-shrink: 0;"><input type="checkbox" id="misc_auto_chat"><span class="slider"></span></label></div>

<div class="row"><span class="label">Auto Spawn</span><label class="switch"><input type="checkbox" id="misc_auto_spawn"><span class="slider"></span></label></div>
<div class="row"><span class="label">Optimization</span><label class="switch"><input type="checkbox" id="misc_optimation"><span class="slider"></span></label></div>
<div class="row"><span class="label">Prediction Ghost</span><label class="switch"><input type="checkbox" id="misc_prediction_ghost"><span class="slider"></span></label></div>
<div class="row"><span class="label">Hidden HUD</span><label class="switch"><input type="checkbox" id="misc_hidden_hud"><span class="slider"></span></label></div>
<div class="row"><span class="label">Windmill Rotations</span><div class="range-container"><span class="range-value" id="mill-val">1</span><input type="range" id="speed-mill" class="modern-range" min="0" max="0.1" step="0.0001" value="0"></div></div>
<div class="row"><span class="label">Spinning Spikes Rotations</span><div class="range-container"><span class="range-value" id="spike-val">1</span><input type="range" id="speed-spike" class="modern-range" min="0" max="0.1" step="0.0001" value="0"></div></div>
</div><br>
            </div>











                <div id="tab-bots" class="menucontent">
                <h1 style="font-size: 30px; margin: 0; padding: 0;">𖠌 Bots</h1>
                <p style="margin-top: 2px; padding: 0;">Use <span style="color: yellow;">VPN</span> for add bots.</p>

<div class="top-bar">
    <div id="bot-list-container"></div>
    <div class="bot-buttons">
        <button class="custom-btn" onclick="window.connectFillBots()">Add Bot</button>
        <button class="custom-btn" class="remove-all" onclick="window.destroyFillBots()">Remove All Bots</button>
    </div>
</div><br>

<div class="backsection-box">
<div class="row"><span class="label">Bots name</span><input id="botname" class="custom-input" type="text" minlength="0" maxlength="12" value="Daemon" placeholder="Unknown"><label class="switch"><input type="checkbox" id="bot_bottogle_name"><span class="slider"></span></label></div>
<div class="row"><span class="label">Follow you</span><label class="switch"><input type="checkbox" id="bot_bottogle_follow"><span class="slider"></span></label></div>
<div class="row"><span class="label">Bot stop radius</span><div class="range-container"><span class="range-value" id="bot-val">300</span><input type="range" id="bot-radius" class="modern-range" min="50" max="500" step="25" value="125"></div></div>
<div class="row"><span class="label">Auto Mill</span><label class="switch"><input type="checkbox" id="bot_bottogle_mill"><span class="slider"></span></label></div>
</div><br>


<div class="backsection-box" style="display:none">
<h2>Bots</h2>
<div class="top-bar"><button class="custom-btn" onclick="window.tryConnectBots()">Add Bot</button><button class="custom-btn" onclick="window.destroyBots()">Remove Bots</button><button class="custom-btn" onclick="window.resBuild()">Reset Objects</button><button class="custom-btn" onclick="window.toggleBotsCircle()">Toggle Fbots Circle</button><button class="custom-btn" onclick="window.toggleVisual()">Toggle Another Visual</button></div>
<div class="row"><span class="label">Follow you</span><label class="switch"><input type="checkbox" id="normalbot001"><span class="slider"></span></label></div>
<div class="row"><span class="label">Bots stop radius</span><div class="range-container"><span class="range-value" id="followradius-bots">125</span><input type="range" id="followap-radius-sliderbots"class="modern-range"min="50"max="750"step="25"value="125"></div></div>

</div><br>


<div class="backsection-box" style="display:none">


<div class="row"><span class="label">Biome Armor</span><label class="switch"><input type="checkbox" id="b001"><span class="slider"></span></label></div>

<div class="row"><span class="label">Break Objects Range</span><input type="text" id="breakRange" class="custom-input" value="700" maxlength="4"><label class="switch"><input type="checkbox" id="?"><span class="slider"></span></label></div>
<div class="row"><span class="label">Circle Rad</span><input type="text" id="circleRad" value="200" class="custom-input" maxlength="4"><label class="switch"><input type="checkbox" id="?"><span class="slider"></span></label></div>
<div class="row"><span class="label">Rad Speed</span><input type="text" id="radSpeed" class="custom-input" value="0.1" maxlength="3"><label class="switch"><input type="checkbox" id="?"><span class="slider"></span></label></div>
<div class="row"><span class="label">Cross World</span><label class="switch"><input type="checkbox" id="funni"><span class="slider"></span></label></div>
    <div class="row"><span class="labelc1">Bot Mode: </span>
    <select id="mode" class="Cselect">
        <option value="follow" selected>Follow</option>
        <option value="clear">Clear Building</option>
        <option value="zync">Sync</option>
        <option value="zearch">Search</option>
        <option value="fuckemup">Clear Everything</option>
        <option value="flex">Flex</option>
    </select>
    </div>


    <div class="row"><span class="labelc1">Bot Weapon: </span>
    <select id="setup" class="Cselect">
        <option value="pm" selected>Polearm Hammer</option>
        <option value="dm">Dagger Musket</option>
        <option value="kh">Katana Hammer</option>
        <option value="dr">Dagger Repeater-Cbow</option>
        <option value="zd">Zhort-Zword Muzket</option>
    </select></div>







</div>
</div>







<div id="tab-packs" class="menucontent">
                    <h1 style="font-size: 30px; margin: 0; padding: 0;">🖌 Texture Pack</h1>
                <p style="margin-top: 2px; padding: 0;">Drag and drop images to customize your items.</p>
<h2 id="h2nonsection">Hats</h2>
    <div class="texture-scroll-container">
        </div>

    <div class="texture-controls">
        <button id="save-textures" class="texture-btn save-btn">💾 Save & Restart</button>
        <button id="reset-all-textures" class="texture-btn reset-btn">♻️ Reset All</button>
    </div>

<br>
<h2 id="h2nonsection">Wings</h2>
Comming Soon!
</div>






                <div id="tab-interface" class="menucontent">
                <h1 style="font-size: 30px; margin: 0; padding: 0;">☰ Interface</h1>
                <p style="margin-top: 2px; padding: 0;">Customize menu design.</p>
<div class="backsection-box">
<h2>Menu</h2>
<div class="row"><span class="label">Menu Transparency</span><div class="range-container"><span class="range-value" id="transa">90</span><input type="range" id="transa-radius"class="modern-range"min="10"max="100"step="1"value="90"></div></div>
<div class="row">
    <span class="label">Menu Colors</span>
    <div class="range-container">
        <div id="resetColorBtn" class="color-ball reset-style" title="Reset Color"></div>

        <div id="dynamicColorCircle" class="color-ball"></div>

        <span class="range-value" id="sectionColorVal">0</span>
        <input type="range" id="sectionColorSlider" class="modern-range" min="0" max="360" step="1" value="0">
    </div>
</div>


<div class="row">
    <span class="label">Menu Scale</span>
    <div class="range-container">
        <span class="range-value" id="menuScaleVal">100</span>
        <input type="range" id="menuScaleSlider" class="modern-range" min="50" max="130" step="5" value="100">
    </div>
</div>


</div><br>
            </div>


            </div>
        </div>
    </div>
    `;
//<span class="new-badge">New</span>
    document.body.insertAdjacentHTML("beforeend", html);
    const menu = document.getElementById("daemonclient");
    const closeBtn = document.getElementById("closer");
    const buttons = document.querySelectorAll("#menusidebar button");
    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            document.querySelectorAll(".menucontent").forEach(tab => {
                tab.style.display = "none";
            });
            document.getElementById("tab-" + btn.dataset.tab).style.display = "block";
        });
    });
    closeBtn.addEventListener("click", () => {
        menu.style.display = "none";
    });
    menu.style.display = "block";// Menu Show
document.addEventListener("keydown", function(e) {
    if (document.activeElement.tagName === 'INPUT') return;
    const keyNum = e.keyCode;
    if (keyNum === 27) {
        e.stopImmediatePropagation();
        e.preventDefault();
    }
    if (keyNum === keybinds.menum) {
            menu.style.display =
                (menu.style.display === "none") ? "block" : "none";
        }
    });

})();
(function() {
    let tooltip = document.querySelector('.custom-tooltip');
    if (!tooltip) {
        tooltip = document.createElement('div');
        tooltip.className = 'custom-tooltip';
        document.body.appendChild(tooltip);
    }
    document.addEventListener('mousemove', (e) => {
        const target = e.target.closest('[title], [data-custom-title]');
        if (target) {
            let titleText = target.getAttribute('title') || target.getAttribute('data-custom-title');

            if (titleText) {
                if (target.hasAttribute('title')) {
                    target.setAttribute('data-custom-title', titleText);
                    target.removeAttribute('title');
                }
                tooltip.innerText = titleText;
                tooltip.style.display = 'block';
                let x = e.clientX + 15;
                let y = e.clientY + 15;
                tooltip.style.left = x + 'px';
                tooltip.style.top = y + 'px';
            }
        } else {
            tooltip.style.display = 'none';
        }
    });
    document.addEventListener('mouseout', (e) => {
        if (!e.relatedTarget || !e.relatedTarget.closest('[data-custom-title]')) {
            tooltip.style.display = 'none';
        }
    });
})();
document.getElementById('tm-main-btn').addEventListener('click', function(e) {
    e.stopPropagation();
    const panel = document.getElementById('tm-panel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
});
document.addEventListener('click', function() {
    document.getElementById('tm-panel').style.display = 'none';
});

(function() {
    const GITHUB_MSG_URL = "https://raw.githubusercontent.com/vvd5j5hqtk-lgtm/daemon-client-updates/refs/heads/main/message.json";
    function checkMessages() {
        fetch(GITHUB_MSG_URL)
            .then(response => response.json())
            .then(data => {
                const lastId = localStorage.getItem('daemon_last_msg_id');
                if (lastId !== String(data.id)) {
                    document.getElementById('tm-dot').style.display = 'block';
                }
                document.getElementById('tm-title').innerText = data.title;
                document.getElementById('tm-text').innerText = data.text;
                document.getElementById('tm-main-btn').addEventListener('click', () => {
                    localStorage.setItem('daemon_last_msg_id', data.id);
                    document.getElementById('tm-dot').style.display = 'none';
                });
            })
            .catch(err => console.error("Mesajlar yüklənmədi:", err));
    }
    checkMessages();
})();
    const welcomeBox = document.querySelector('.home-name');
    const welcomeTitle = document.getElementById('welcome-text');
    let iceTimeout;

    welcomeBox.addEventListener('mouseenter', () => {
        iceTimeout = setTimeout(() => {
            welcomeTitle.classList.add('ice-crack');
        }, 2000);
    });
    welcomeBox.addEventListener('mouseleave', () => {
        clearTimeout(iceTimeout);
        if (welcomeTitle.classList.contains('ice-crack')) {
            welcomeTitle.classList.remove('ice-crack');
            welcomeTitle.classList.add('melting');
            setTimeout(() => {
                welcomeTitle.classList.remove('melting');
            }, 800);
        }
    });
let daemonTimer;
function initDaemonSidebar() {
    const btns = document.querySelectorAll('#menusidebar button');
    function startTimer(element) {
        clearTimeout(daemonTimer);
        daemonTimer = setTimeout(() => {
            if (element.classList.contains('active')) {
                element.classList.add('active-daemon');
            }
        }, 3000);
    }
    btns.forEach(btn => {
        btn.addEventListener('click', function() {
            btns.forEach(b => b.classList.remove('active', 'active-daemon'));
            this.classList.add('active');
            startTimer(this);
        });
    });
    const activeBtn = document.querySelector('#menusidebar button.active');
    if (activeBtn) {
        startTimer(activeBtn);
    }
}
initDaemonSidebar();
document.addEventListener('DOMContentLoaded', () => {
    const titleContainer = document.getElementById('daemon-title');
    setTimeout(() => {
        if (titleContainer) {
            titleContainer.classList.add('eyes-active');
        }
    }, 2000);
});
//ddd

/*window.setModLanguage = function(lang) {
    localStorage.setItem('daemon_lang', lang);
    console.log("Seçilən dil:", lang);
    location.reload();
};

(function() {
    const currentLang = localStorage.getItem('daemon_lang') || 'en';

    const dicts = {
        en: {
            uiCreator: "by Bextiyar", uiNotifHeader: "Notifications", uiNoMsg: "No messages", uiNotifText: "New updates will appear here.",
            tabHome: "🏠︎ Home", tabCombat: "⚔ Combat", tabKeybinds: "⌨ Keybinds", tabVisual: "👁 Visual", tabMisc: "🛠 Misc",
            hMainTitle: "🏠︎ Home", hWelcome: "Welcome to the Daemon Client",
            hDesc1: "There is no main purpose in creating this mod. It is just a hobby. I will create new functions, features or systems according to my own wishes, but I will also pay attention to your ideas. The mod currently works great with <b>polearm, katana, sword</b> and <b>great hammer, bows, musket</b>. The next update will include features for these weapon combinations! This menu can have a lot of <b>options</b> and <b>toggles</b> and it can be tiring when you are customizing the mod, but I like the multi-function menu. The menu also has <b>autosave</b>, which means that the settings you make are always <b>saved</b>. I will send you new updates in the <b>Notifications</b> section. This mod is the successor to <b>Genesis</b>. Make sure you have made all your adjustments before you start playing!",
            hDesc2: "Send me the features you would like to see here.",
            hDesc3: `This mod is still under development, if you see a bug or problem with the mod, be sure to report it. Special thanks to the <b>X2vc4hick</b>, he played a big role in the development of the mod`,
            hDiscord: "Come to our discord server to check out new updates!", hVersion: "Version:",
            cTitle: "⚔ Combat", cDesc: "Setup combat tactics for battles.",
            cHPlacement: "Placement", cHArmor: "Armor", cHDefense: "Defense", cHAttack: "Attack",
            cAP: "Auto Placer", cSP: "Smart Place", cAPR: "Auto Place Replace", cAR: "Auto Replacer", cPre: "Auto Preplacer", cRad: "Auto placer radius", cMill: "Auto mill", cPDef: "Placement defense",
            cBA: "Biome armor", cDA: "Defense armor", cDARad: "Defense armor radius", cSA: "Spikes armor", cAA: "Animal armor", cAEmp: "Auto Emp", cAInv: "Auto Invicible",
            cSW: "Safe Walk", cHeal: "Healing", cAB: "Auto Break",
            cIK: "Insta Kill", cMT: "Manual Tick", cNBI: "No Bull Insta Kill", cASync: "Auto Sync", cST: "Spike Tick", cSSync: "Spike Sync", cSSyncP: "Spike Sync on Pushing", cKBT: "Knockback Tick", cKBP: "Knockback Push", cVT: "Velocity Tick", cSB: "Static Based", cSGT: "Spikegear Tick", cSGHT: "Spikegear Hammer Tick", cTSync: "Turret Sync", cPA: "Predictive Aim", cASteat: "Auto Steal", cBH: "Bull Hit", cTC: "Turret Combat", cAPush: "Auto push",
            kTitle: "⌨ Keybinds", kDesc: "Setup keybinds for item, weapons, hats, toggles.",
            kHMove: "Movement & Controls", kHItems: "Items & Weapons", kHMenu: "Menu & Interface",
            kUp: "Up", kLeft: "Left", kDown: "Down", kRight: "Right", kAA: "Auto Attack", kLR: "Lock Rotation", kMM: "Map Marker", kIK: "Insta kill", kMT: "Manual Tick",
            kPW: "Primary Weapon", kSW: "Secondary Weapon", kSp: "Spike", kTr: "Trap/Boostpad", kWa: "Wall", kTu: "Turret", kMi: "Windmill", kFo: "Food", kSPad: "Spawn Pad", kCSp: "Cycle Spike", kCTr: "Cycle Trap/Boostpad", kCTu: "Cycle Turret", kCSpawn: "Cycle Spawn Pad", kDb: "Debug", kBS: "Boost Spike",
            kAll: "Alliance menu", kSto: "Store menu", kMe: "Menu", kCh: "Chat holder",
            vTitle: "👁 Visuals", vDesc: "Change or Setup color, animation.",
            vTracer: "Tracer", vObjH: "Object Healts", vObjM: "Object Marks", vPlayer: "Player", vMapB: "Map & Biome",
            vEn: "Enemie", vTm: "Teammate", vAn: "Animal", vBt: "Bot", vCL: "Clan leader", vTK: "Top killer", vNo: "Notification", vMO: "My Objects", vEO: "Enemy Objects", vTO: "Teammate Objects", vArr: "Arrows",
            vMy: "My", vHT: "Health Type", vMT: "Marks Type", vHB: "Health bar", vWRB: "Weapon reload bars", vTRB: "Turret reload bars", vHPS: "HP & Shame count", vKBP: "Knockback Path", vAPP: "Auto Push Path",
            vVA: "Volcano Area", vVAA: "Volcano Animals Area", vVDA: "Volcano Damage Area", vBT: "Biome Type",
            mTitle: "🛠 Misc", mDesc: "Customize misc settings, add autochat messages, reset settings.",
            mOther: "Other", mKC: "Kill chat", mTP: "Texture Pack", mMT: "Menu Transparency"
        },
        tr: {
            uiCreator: "Yapan: Bextiyar", uiNotifHeader: "Bildirimler", uiNoMsg: "Mesaj yok", uiNotifText: "Yeni güncellemeler burada görünecek.",
            tabHome: "🏠︎ Ana Sayfa", tabCombat: "⚔ Savaş", tabKeybinds: "⌨ Tuşlar", tabVisual: "👁 Görsel", tabMisc: "🛠 Diğer",
            hMainTitle: "🏠︎ Ana Sayfa", hWelcome: "Daemon Client'a Hoş Geldiniz",
            hDesc1: "Bu modu oluşturmanın belirli bir amacı yok. Sadece bir hobi. Kendi isteklerime göre yeni fonksiyonlar, özellikler veya sistemler oluşturacağım, ancak fikirlerinize de dikkat edeceğim. Mod şu anda <b>mızrak, katana, kılıç</b> ve <b>büyük çekiç, yay, tüfek</b> ile harika çalışıyor. Bir sonraki güncelleme bu silah kombinasyonları için özellikler içerecek! Bu menüde çok fazla <b>seçenek</b> ve <b>geçiş düğmesi</b> olabilir ve modu özelleştirirken yorucu olabilir, ancak çok fonksiyonlu menüyü seviyorum. Menüde ayrıca <b>otomatik kaydetme</b> özelliği de var, bu da yaptığınız ayarların her zaman <b>kaydedildiği</b> anlamına geliyor. Yeni güncellemeleri <b>Bildirimler</b> bölümünden size göndereceğim. Bu mod <b>Genesis</b>'in halefidir. Oynamaya başlamadan önce tüm ayarlarınızı yaptığınızdan emin olun!",
            hDesc2: "Görmek istediğiniz özellikleri bize iletin.",
            hDesc3: "Bu mod hala geliştirilme aşamasındadır, hata görürseniz lütfen bildirin.",
            hDiscord: "Yeni güncellemeler için discord sunucumuza gelin!", hVersion: "Sürüm:",
            cTitle: "⚔ Savaş", cDesc: "Savaş taktiklerini ayarlayin.",
            cHPlacement: "Yerleştirme", cHArmor: "Zırh", cHDefense: "Savunma", cHAttack: "Saldırı",
            cAP: "Oto Yerleştirici", cSP: "Akıllı Yerleşdirci", cAPR: "Yerleştir ve Değiştir", cAR: "Oto Yeniden Yerleştirme", cPre: "Ön Yerleştirici", cRad: "Yerleştirme Menzili", cMill: "Oto Değirmen", cPDef: "Yerleşim Savunması",
            cBA: "Biyom Zırhı", cDA: "Savunma Zırhı", cDARad: "Savunma Menzili", cSA: "Diken Zırhı", cAA: "Hayvan Zırhı", cAEmp: "Oto Emp", cAInv: "Oto Görünmezlik",
            cSW: "Güvenli Yürüyüş", cHeal: "Oto Can Yenileme", cAB: "Oto Kırma",
            cIK: "Tek vuruşta öldürme(İnsta)", cMT: "Manuel Tik", cNBI: "Bull Helmetsiz Insta", cASync: "Oto Vurma", cST: "Diken Tik", cSSync: "Diken Senkron", cSSyncP: "İterken Diken Senkron", cKBT: "Geri Tepme Tick", cKBP: "Geri Tepme Şapkasi", cVT: "Hızli Tek Tik", cSB: "Sabit Odaklı Tek Tik", cSGT: "Diken Şapka Tik", cSGHT: "Diken Şapka Çekiç Tik", cTSync: "Taret Senkron", cPA: "Tahminli Nişan", cASteat: "Leş Çalma", cBH: "Bull Şapkayla Vuruşu", cTC: "Taret Vuruşu", cAPush: "Oto İtme",
            kTitle: "⌨ Tuş Atamaları", kDesc: "Eşyalar ve silahlar için tuşları ayarlayın.",
            kHMove: "Hareket ve Kontroller", kHItems: "Eşyalar ve Silahlar", kHMenu: "Menü ve Arayüz",
            kUp: "Yukarı", kLeft: "Sol", kDown: "Aşağı", kRight: "Sağ", kAA: "Oto Saldırı", kLR: "Yönü Kilitle", kMM: "Harita İşareti", kIK: "İnsta", kMT: "Manuel Tik",
            kPW: "Birinci Silah", kSW: "İkinci Silah", kSp: "Diken", kTr: "Tuzak/Hızlandırıcı", kWa: "Duvar", kTu: "Taret", kMi: "Değirmen", kFo: "Yemek", kSPad: "Doğma Pedi", kCSp: "Yuvarlak Diken", kCTr: "Yuvarlak Tuzak", kCTu: "Yuvarlak Taret", kCSpawn: "Yuvarlak Doğum Ped", kDb: "Hata Ayıklama", kBS: "Hızlı Diken",
            kAll: "Klan Menüsü", kSto: "Market Menüsü", kMe: "Menü", kCh: "Sohbet/Çet",
            vTitle: "👁 Görseller", vDesc: "Renk ve animasyonları ayarlayın.",
            vTracer: "İz Sürücü", vObjH: "Obje Canları", vObjM: "Obje İşaretleri", vPlayer: "Oyuncular", vMapB: "Harita & Biyom",
            vEn: "Düşman", vTm: "Takım Arkadaşı", vAn: "Hayvan", vBt: "Bot", vCL: "Klan Lideri", vTK: "En Çok Öldüren", vNo: "Bildirim", vMO: "Objelerim", vEO: "Düşman Objeleri", vTO: "Takım Objeleri", vArr: "Oklar",
            vMy: "Benim", vHT: "Can Tipi", vMT: "İşaret Tipi", vHB: "Can Bari", vWRB: "Silah Dolum Bari", vTRB: "Taret Dolum Bari", vHPS: "HP & Utanç Sayacı", vKBP: "Geri Tepme Yolu", vAPP: "Oto İtme Yolu",
            vVA: "Volkan Alanı", vVAA: "Volkan Hayvan Doğma Alanı", vVDA: "Volkan Hasar Alanı", vBT: "Biyom Tipi",
            mTitle: "🛠 Diğer", mDesc: "Diğer ayarları özelleştirin.",
            mOther: "Diğer", mKC: "Ölüm Mesajı", mTP: "Teksur Paketi", mMT: "Menü Şeffaflığı"
        },
        ru: {
uiCreator: "Создатель: Bextiyar", uiNotifHeader: "Уведомления", uiNoMsg: "Сообщений нет", uiNotifText: "Новые обновления появятся здесь.",
            tabHome: "🏠︎ Главная", tabCombat: "⚔ Комбат", tabKeybinds: "⌨ Бинды", tabVisual: "👁 Визуал", tabMisc: "🛠 Разное",
            hMainTitle: "🏠︎ Главная", hWelcome: "Добро пожаловать в Daemon Client",
            hDesc1: "У создания этого мода нет какой-либо конкретной цели. Это просто хобби. Я буду создавать новые функции, возможности или системы в соответствии со своими пожеланиями, но также буду учитывать ваши идеи. В настоящее время мод отлично работает с <b>древковым оружием, катаной, мечом</b> и <b>большим молотом, луком, мушкетом</b>. В следующем обновлении будут добавлены функции для этих комбинаций оружия! В этом меню может быть много <b>опций</b> и <b>переключателей</b>, и это может быть утомительно при настройке мода, но мне нравится многофункциональное меню. В меню также есть <b>автосохранение</b>, что означает, что ваши настройки всегда <b>сохраняются</b>. Я буду отправлять вам новые обновления в разделе <b>Уведомления</b>. Этот мод является преемником <b>Genesis</b>. Убедитесь, что вы внесли все необходимые настройки, прежде чем начать играть!",
            hDesc2: "Сообщите нам о функциях, которые вы хотите видеть.",
            hDesc3: "Этот мод все еще находится в стадии разработки, если вы заметите ошибку, пожалуйста, сообщите о ней.",
            hDiscord: "Присоединяйтесь к нашему Discord-серверу для получения обновлений!", hVersion: "Версия:",
            cTitle: "⚔ Комбат", cDesc: "Настройте тактику боя.",
            cHPlacement: "Размещение", cHArmor: "Броня", cHDefense: "Защита", cHAttack: "Атака",
            cAP: "Авто-размещение", cSP: "Умное размещение", cAPR: "Размещение и замена", cAR: "Авто-переразмещение", cPre: "Пред-размещение", cRad: "Радиус размещения", cMill: "Авто-мельница", cPDef: "Защита размещением",
            cBA: "Биомная броня", cDA: "Защитная броня", cDARad: "Радиус защиты", cSA: "Шипастая броня", cAA: "Броня для животных", cAEmp: "Авто-EMP", cAInv: "Авто-инвиз",
            cSW: "Безопасная ходьба", cHeal: "Авто-хил", cAB: "Авто-брейк",
            cIK: "Инста-Килл", cMT: "Ручной тик", cNBI: "Инста без Bull шлема", cASync: "Авто-синхронизация", cST: "Шипастый тик", cSSync: "Синхронизация шипов", cSSyncP: "Синхр. шипов при толчке", cKBT: "КБ тик", cKBP: "Шляпа отталкивания", cVT: "Вел тик", cSB: "Статичный тик", cSGT: "Тик шипастой шляпы", cSGHT: "Тик шипастой шляпы и молота", cTSync: "Синхронизация турели", cPA: "Авто-аим", cASteat: "Стил киллов", cBH: "Bull Хит", cTC: "Удар турели", cAPush: "Авто-толкание",
            kTitle: "⌨ Бинды", kDesc: "Настройте клавиши для предметов и оружия.",
            kHMove: "Движение и управление", kHItems: "Предметы и оружие", kHMenu: "Меню и интерфейс",
            kUp: "Вверх", kLeft: "Влево", kDown: "Вниз", kRight: "Вправо", kAA: "Авто-атака", kLR: "Блок направления", kMM: "Метка на карте", kIK: "Инста-Килл", kMT: "Ручной тик",
            kPW: "Основное оружие", kSW: "Вторичное оружие", kSp: "Шип", kTr: "Ловушка/Ускоритель", kWa: "Стена", kTu: "Турель", kMi: "Мельница", kFo: "Еда", kSPad: "Спавн-пад", kCSp: "Круглые шипы", kCTr: "Круглые ловушки", kCTu: "Круглые турели", kCSpawn: "Круглые спавн-пады", kDb: "Отладка", kBS: "Быстрый шип",
            kAll: "Меню клана", kSto: "Магазин", kMe: "Меню", kCh: "Чат",
            vTitle: "👁 Визуал", vDesc: "Настройте цвета и анимации.",
            vTracer: "Трейсеры", vObjH: "HP объектов", vObjM: "Метки объектов", vPlayer: "Игроки", vMapB: "Карта и биомы",
            vEn: "Враг", vTm: "Союзник", vAn: "Животное", vBt: "Бот", vCL: "Лидер клана", vTK: "Топ убийца", vNo: "Уведомления", vMO: "Мои объекты", vEO: "Вражеские объекты", vTO: "Союзные объекты", vArr: "Стрелы",
            vMy: "Мой", vHT: "Тип HP", vMT: "Тип метки", vHB: "Полоска HP", vWRB: "Кулдаун оружия", vTRB: "Кулдаун турели", vHPS: "HP и счетчик позора", vKBP: "Путь отталкивания", vAPP: "Путь авто-толкания",
            vVA: "Зона вулкана", vVAA: "Спавн животных в вулкане", vVDA: "Урон в зоне вулкана", vBT: "Тип биома",
            mTitle: "🛠 Разное", mDesc: "Настройте остальные параметры.",
            mOther: "Другое", mKC: "Сообщение о смерти", mTP: "Текстур пак", mMT: "Прозрачность меню"
        }
    };

    const d = dicts[currentLang] || dicts['en'];

    const translate = () => {
        const header = document.getElementById('menuheader');
        if (header) {
            const creator = header.querySelector('.by'); if(creator) creator.innerText = d.uiCreator;
            const nHeader = document.getElementById('notif-headdwdwder'); if(nHeader) nHeader.innerText = d.uiNotifHeader;
            const nTitle = document.getElementById('tm-tiwdwdtle'); if(nTitle) nTitle.innerText = d.uiNoMsg;
            const nText = document.getElementById('tm-texwdwdt'); if(nText) nText.innerText = d.uiNotifText;
        }

        const sidebar = document.getElementById('menusidebar');
        if (sidebar) {
            const btns = sidebar.querySelectorAll('button');
            const tabs = [d.tabHome, d.tabCombat, d.tabKeybinds, d.tabVisual, d.tabMisc];
            btns.forEach((btn, i) => {
                const eyes = '<div class="daemon-eyes"><span></span><span></span></div>';
                if(tabs[i]) btn.innerHTML = tabs[i] + eyes;
            });
        }

        // Home
        const hTitle = document.getElementById('home-main-title'); if(hTitle) hTitle.innerHTML = d.hMainTitle;
        const hWelcome = document.getElementById('welcome-text'); if(hWelcome) hWelcome.innerText = d.hWelcome;
        const d1 = document.getElementById('welcome-desc-1'); if(d1) d1.innerHTML = d.hDesc1;
        const d2 = document.getElementById('welcome-desc-2'); if(d2) d2.innerText = d.hDesc2;
        const d3 = document.getElementById('welcome-desc-3'); if(d3) d3.innerText = d.hDesc3;
        const dPromo = document.getElementById('discord-promo-text'); if(dPromo) dPromo.innerText = d.hDiscord;
        const vText = document.getElementById('version-text'); if(vText) vText.innerText = d.hVersion;

        // Combat
        const cTitle = document.getElementById('combat-title'); if(cTitle) cTitle.innerText = d.cTitle;
        const cDesc = document.getElementById('combat-desc'); if(cDesc) cDesc.innerText = d.cDesc;
        const h2c = document.querySelectorAll('#tab-combat h2');
        const h2cMap = [d.cHPlacement, d.cHArmor, d.cHDefense, d.cHAttack];
        h2c.forEach((h, i) => { if(h2cMap[i]) h.innerText = h2cMap[i]; });

        const cLabels = {
            'lbl-auto-placer': d.cAP, 'lbl-smart-place': d.cSP, 'lbl-auto-place-replace': d.cAPR, 'lbl-auto-replacer': d.cAR, 'lbl-auto-preplacer': d.cPre, 'lbl-auto-placer-radius': d.cRad, 'lbl-auto-mill': d.cMill, 'lbl-placement-defense': d.cPDef,
            'lbl-biome-armor': d.cBA, 'lbl-defense-armor': d.cDA, 'lbl-defense-armor-radius': d.cDARad, 'lbl-spikes-armor': d.cSA, 'lbl-animal-armor': d.cAA, 'lbl-auto-emp': d.cAEmp, 'lbl-auto-invincible': d.cAInv,
            'lbl-insta-kill': d.cIK, 'lbl-manual-tick': d.cMT, 'lbl-no-bull-insta': d.cNBI, 'lbl-auto-sync': d.cASync, 'lbl-spike-tick': d.cST, 'lbl-spike-sync': d.cSSync, 'lbl-spike-sync-push': d.cSSyncP, 'lbl-kb-tick': d.cKBT, 'lbl-kb-push': d.cKBP, 'lbl-velocity-tick': d.cVT, 'lbl-static-based': d.cSB, 'lbl-spikegear-tick': d.cSGT, 'lbl-spikegear-hammer': d.cSGHT, 'lbl-turret-sync': d.cTSync, 'lbl-predictive-aim': d.cPA, 'lbl-auto-steal': d.cASteat, 'lbl-bull-hit': d.cBH, 'lbl-turret-combat': d.cTC, 'lbl-auto-push': d.cAPush
        };
        for(let id in cLabels) { const el = document.getElementById(id); if(el) el.innerText = cLabels[id]; }

        // Defense extra labels (targeting by text)
        document.querySelectorAll('#tab-combat .row .label').forEach(l => {
            if(l.innerText === "Safe Walk") l.innerText = d.cSW;
            if(l.innerText === "Healing") l.innerText = d.cHeal;
            if(l.innerText === "Auto Break") l.innerText = d.cAB;
        });

        // Keybinds
        const kTitle = document.getElementById('kb-main-title'); if(kTitle) kTitle.innerText = d.kTitle;
        const kDesc = document.getElementById('kb-main-desc'); if(kDesc) kDesc.innerText = d.kDesc;
        const h2k = { 'kb-h-movement': d.kHMove, 'kb-h-items': d.kHItems, 'kb-h-menu': d.kHMenu };
        for(let id in h2k) { const el = document.getElementById(id); if(el) el.innerText = h2k[id]; }

        const kLabels = {
            'kb-up': d.kUp, 'kb-left': d.kLeft, 'kb-down': d.kDown, 'kb-right': d.kRight, 'kb-autoattack': d.kAA, 'kb-lockdir': d.kLR, 'kb-mapmarker': d.kMM, 'kb-insta': d.kIK, 'kb-tick': d.kMT,
            'kb-primary': d.kPW, 'kb-secondary': d.kSW, 'kb-spike': d.kSp, 'kb-trap': d.kTr, 'kb-wall': d.kWa, 'kb-turret': d.kTu, 'kb-windmill': d.kMi, 'kb-food': d.kFo, 'kb-spawn': d.kSPad, 'kb-cycle-spike': d.kCSp, 'kb-cycle-trap': d.kCTr, 'kb-cycle-turret': d.kCTu, 'kb-cycle-spawn': d.kCSpawn, 'kb-debug': d.kDb, 'kb-boostspike': d.kBS, 'kb-alliance': d.kAll, 'kb-store': d.kSto, 'kb-menu': d.kMe, 'kb-chat': d.kCh
        };
        for(let id in kLabels) { const el = document.getElementById(id); if(el) el.innerText = kLabels[id]; }

        // Visuals
        const vTab = document.getElementById('tab-visual');
        if(vTab) {
            const vH1 = vTab.querySelector('h1'); if(vH1) vH1.innerText = d.vTitle;
            const vP = vTab.querySelector('p'); if(vP) vP.innerText = d.vDesc;
            const vH2 = vTab.querySelectorAll('h2');
            const vH2Map = [d.vTracer, d.vObjH, d.vObjM, d.vPlayer, d.vMapB];
            vH2.forEach((h, i) => { if(vH2Map[i]) h.innerText = vH2Map[i]; });

            const vLabels = {
                "Enemie": d.vEn, "Teammate": d.vTm, "Animal": d.vAn, "Bot": d.vBt, "Clan leader": d.vCL, "Top killer": d.vTK, "Notification": d.vNo, "My Objects": d.vMO, "Enemy Objects": d.vEO, "Teammate Objects": d.vTO, "Arrows": d.vArr, "My": d.vMy, "Health Type": d.vHT, "Marks Type": d.vMT, "Health bar": d.vHB, "Weapon reload bars": d.vWRB, "Turret reload bars": d.vTRB, "HP & Shame count": d.vHPS, "Knockback Path": d.vKBP, "Auto Push Path": d.vAPP, "Volcano Area": d.vVA, "Volcano Animals Area": d.vVAA, "Volcano Damage Area": d.vVDA, "Biome Type": d.vBT
            };
            vTab.querySelectorAll('.label').forEach(l => { if(vLabels[l.innerText.trim()]) l.innerText = vLabels[l.innerText.trim()]; });
        }

        // Misc
        const mTab = document.getElementById('tab-misc');
        if(mTab) {
            const mH1 = mTab.querySelector('h1'); if(mH1) mH1.innerText = d.mTitle;
            const mP = mTab.querySelector('p'); if(mP) mP.innerText = d.mDesc;
            const mH2 = mTab.querySelector('h2'); if(mH2) mH2.innerText = d.mOther;
            mTab.querySelectorAll('.label').forEach(l => {
                if(l.innerText === "Kill chat") l.innerText = d.mKC;
                if(l.innerText === "Texture Pack") l.innerText = d.mTP;
                if(l.innerText === "Menu Transparency") l.innerText = d.mMT;
            });
        }
    };

    setInterval(translate, 100);
})();*/
//           < Keybinds >
var keybinds = {
  primary: 49,
  secondary: 50,

  movew: 87,
  movea: 65,
  moves: 83,
  moved: 68,
  lockdir: 88,
  autoattack: 69,
  mapmarker: 67,

  spike: 86,
  trap: 70,
  turret: 72,
  spawn: 57,
  windmill: 78,
  food: 81,
  wall: 52,

  trapc: 79,
  spikec: 76,
  turretc: 0,
  spawnc: 0,

  boostspike: 0,
  debug: 80,

  instakey: 82,
  tickkey: 66,

  alicem: 17,
  storem: 16,
  menum: 27,
  chatm: 13,
  chatlogo: 84,
};


const savedKeys = localStorage.getItem("keybinds");
if (savedKeys) {
    Object.assign(keybinds, JSON.parse(savedKeys));
}
function updateKeybindInputs() {
    document.querySelectorAll(".action2").forEach(inp => {
        const action = inp.dataset.action;
        const code = keybinds[action];
        if (code > 0) {
            let char = String.fromCharCode(code);
            if (code === 27) char = "ESCAPE";
            if (code === 32) char = "SPACE";
            if (code === 16) char = "SHIFT";
            if (code === 17) char = "CTRL";
            if (code === 13) char = "ENTER";
            inp.value = char;
        } else {
            inp.value = "";
        }
    });
}
updateKeybindInputs();
document.querySelectorAll(".action2").forEach(inp => {
    inp.addEventListener("focus", () => {
        inp.value = "_";
        const onKeyDown = e => {
            e.preventDefault();
            const action = inp.dataset.action;
            let keyName = e.key;
            const keyCode = e.keyCode;
            if (/^[a-z]$/.test(keyName)) keyName = keyName.toUpperCase();
            if (keyName === " ") keyName = "SPACE";
            if (keyName === "Control") keyName = "CTRL";
            inp.value = keyName;
            keybinds[action] = keyCode;
            localStorage.setItem("keybinds", JSON.stringify(keybinds));
            document.removeEventListener("keydown", onKeyDown);
            inp.blur();
        };
        document.addEventListener("keydown", onKeyDown);
    });
});
document.querySelectorAll(".trash-btn").forEach(trash => {
    trash.addEventListener("click", (e) => {
        const action = trash.dataset.action;
        keybinds[action] = 0;
        localStorage.setItem("keybinds", JSON.stringify(keybinds));
        updateKeybindInputs();
        e.stopPropagation();
    });
});

// Toggle's


function updateAllPositions() {
    const isMapOpen = mapDisplay.style.display !== "none";
    const isScoreOpen = scoreDisplay.style.display !== "none";
    if (isMapOpen) {
        scoreDisplay.style.bottom = "160px"; // Map varsa, Score yuxarıda durur
    } else {
        scoreDisplay.style.bottom = "10px"; // Map yoxdursa, Score ən aşağı düşür
    }
    if (isScoreOpen) {
        let scorePos = parseInt(scoreDisplay.style.bottom);
        mStatus.style.bottom = (scorePos + 40) + "px";
    } else if (isMapOpen) {
        mStatus.style.bottom = "140px";
    } else {
        mStatus.style.bottom = "10px";
    }
}
// Check system
let testdeneme1
//let allianceMenu = getEl("allianceMenu");
//let storeMenu = getEl("storeMenu");
let topInfoHolder = getEl("leaderboard");
let killCounter = getEl("killCounter");
let allianceButton = getEl("allianceButton");
let storeButton = getEl("storeButton");
//let chatButton = getEl("chatButton");
let scoreDisplay = getEl("scoreDisplay");
let stoneDisplay = getEl("stoneDisplay");
let woodDisplay = getEl("woodDisplay");
let foodDisplay = getEl("foodDisplay");
let ageBarContainer = getEl("ageBarContainer");
let ageText = getEl("ageText");
const ccheckIDs = [
  "visualstracer_enemie",
  "visualstracer_teammate",
  "visualstracer_animal",
  "visualstracer_notfication",
  "visualstracer_bot",
  "visualstracer_clanleader",
  "visualstracer_skull",
  "visualstracer_enemie_object",
  "visualstracer_teammate_object",
  "visualstracer_my_object",
  "visualstracer_arrows",

  "visualsobject_my_mark",
  "visualsobject_enemy_mark",
  "visualsobject_teammate_mark",
  "visualsobject_my_health",
  "visualsobject_enemy_health",
  "visualsobject_teammate_health",

  "visualplayer_health_bar",
  "visualplayer_weapon_reload_bar",
  "visualplayer_turret_reload_bar",
  "visualplayer_hp_shame",
  "visualplayer_knockback_path",
  "visualplayer_auto_push_path",

  "visualsmap_volcano_area",
  "visualsmap_volcano_spawn_animals_area",
  "visualsmap_volcano_damage_area",

  "visual_look_angel",
  "visual_move_angel",

// Combat placement
  "combat_placement_auto_placer",
  "combat_placement_auto_place",
  "combat_placement_auto_place_replace",
  "combat_placement_auto_replace",
  "combat_placement_auto_preplacer",
  "combat_placement_defense_placement",
  "combat_placement_auto_windmill",
  "combat_placement_auto_grind",

  "combat_defense_armor",
  "combat_biome_armor",
  "combat_spike_armor",
  "combat_animal_armor",
  "combat_auto_emp",
  "combat_auto_medic",
  "combat_auto_invicible",

  "combat_insta_kill",
  "combat_manual_tick",
  "combat_auto_sync",
  "combat_spike_tick",
  "combat_spike_sync",
  "combat_spike_sync_onpushing",
  "combat_knockback_tick",
  "combat_velocity_tick",
  "combat_spikegear_tick",
  "combat_spikegear_hammer_tick",
  "combat_auto_push",
  "combat_auto_steal",
  "combat_bull_hit",
  "combat_knockback_push",
  "combat_turret_combat",
  "combat_no_bull_insta",
  "combat_turret_sync",
  "combat_predictive_aim",
  "combat_static_based",
  "combat_safe_spikegear_tick",
  "combat_tryspiketick",
  "combat_bow_tick",
  "combat_age_1_insta",
  "combat_bow_spam",

  "combat_safewalk",
  "combat_safewalkb",
  "combat_safewalkt",
  "combat_healing",
  "combat_autobreak",
  "combat_auto_q",
  "combat_safewalk_stop",

//misc
  "misc_kill_chat",
  "misc_auto_chat",
  "misc_auto_spawn",
  "misc_optimation",
  "misc_prediction_ghost",
  "misc_hidden_hud",

//bot
  "bot_bottogle_follow",
  "bot_bottogle_name",
  "bot_bottogle_mill",
  "bot_bottogle_autoplacer",

];

const ccheckActions = {
  bot_bottogle_follow:                        (el) => { bottoggle.follow = el.checked ? true: false},
  bot_bottogle_name:                          (el) => { bottoggle.name = el.checked ? true: false},
  bot_bottogle_mill:                          (el) => { bottoggle.mill = el.checked ? true: false},
  bot_bottogle_autoplacer:                    (el) => { bottoggle.autoplacer = el.checked ? true: false},

  misc_kill_chat:                             (el) => { misctoggle.kill_chat = el.checked ? true: false},
  misc_auto_chat:                             (el) => { misctoggle.auto_chat = el.checked ? true: false},
  misc_auto_spawn:                            (el) => { misctoggle.auto_spawn = el.checked ? true: false},
  misc_optimation:                            (el) => { misctoggle.optimation = el.checked ? true: false},
  misc_prediction_ghost:                      (el) => { misctoggle.prediction_ghost = el.checked ? true: false},
  misc_hidden_hud: (el) => {
    const displayStyle = el.checked ? "none" : "block";
    const elements = [actionBar, topInfoHolder, killCounter, allianceButton,storeButton, chatButton, stoneDisplay, woodDisplay,foodDisplay, ageText, ageBarContainer];
    elements.forEach(item => {if (item) item.style.display = displayStyle;});
    if (typeof mapDisplay !== 'undefined' && mapDisplay) {mapDisplay.style.display = displayStyle;}
    if (typeof scoreDisplay !== 'undefined' && scoreDisplay) {scoreDisplay.style.display = displayStyle;}
    if (typeof updateAllPositions === 'function') {updateAllPositions();}},

  combat_safewalk:                            (el) => { combatdefensetoggle.safewalk = el.checked ? true: false},
  combat_safewalkb:                           (el) => { combatdefensetoggle.safewalkb = el.checked ? true: false},
  combat_safewalkt:                           (el) => { combatdefensetoggle.safewalkt = el.checked ? true: false},
  combat_healing:                             (el) => { combatdefensetoggle.healing = el.checked ? true: false},
  combat_autobreak:                           (el) => { combatdefensetoggle.autobreak = el.checked ? true: false},
  combat_auto_q:                              (el) => { combatdefensetoggle.autoq = el.checked ? true: false},
  combat_safewalk_stop:                       (el) => { combatdefensetoggle.safewalkstop = el.checked ? true: false},

  combat_insta_kill:                          (el) => { combatattacktoggle.insta_kill = el.checked ? true: false},
  combat_manual_tick:                         (el) => { combatattacktoggle.manual_tick = el.checked ? true: false},
  combat_auto_sync:                           (el) => { combatattacktoggle.auto_sync = el.checked ? true: false},
  combat_spike_tick:                          (el) => { combatattacktoggle.spike_tick = el.checked ? true: false},
  combat_spike_sync:                          (el) => { combatattacktoggle.spike_sync = el.checked ? true: false},
  combat_spike_sync_onpushing:                (el) => { combatattacktoggle.spike_sync_onpushing = el.checked ? true: false},
  combat_knockback_tick:                      (el) => { combatattacktoggle.knockback_tick = el.checked ? true: false},
  combat_velocity_tick:                       (el) => { combatattacktoggle.velocity_tick = el.checked ? true: false},
  combat_spikegear_tick:                      (el) => { combatattacktoggle.spikegear_tick = el.checked ? true: false},
  combat_spikegear_hammer_tick:               (el) => { combatattacktoggle.spikegear_hammer_tick = el.checked ? true: false},
  combat_auto_push:                           (el) => { combatattacktoggle.auto_push = el.checked ? true: false},
  combat_auto_steal:                          (el) => { combatattacktoggle.auto_steal = el.checked ? true: false},
  combat_bull_hit:                            (el) => { combatattacktoggle.bull_hit = el.checked ? true: false},
  combat_turret_combat:                       (el) => { combatattacktoggle.turret_combat = el.checked ? true: false},
  combat_no_bull_insta:                       (el) => { combatattacktoggle.no_bull_insta = el.checked ? true: false},
  combat_turret_sync:                         (el) => { combatattacktoggle.turret_sync = el.checked ? true: false},
  combat_knockback_push:                      (el) => { combatattacktoggle.knockback_push = el.checked ? true: false},
  combat_predictive_aim:                      (el) => { combatattacktoggle.predictive_aim = el.checked ? true: false},
  combat_static_based:                        (el) => { combatattacktoggle.static_based = el.checked ? true: false},
  combat_safe_spikegear_tick:                 (el) => { combatattacktoggle.safe_spikegear_tick = el.checked ? true: false},
  combat_tryspiketick:                        (el) => { combatattacktoggle.tryspiketick = el.checked ? true: false},
  combat_bow_tick:                            (el) => { combatattacktoggle.bow_tick = el.checked ? true: false},
  combat_age_1_insta:                         (el) => { combatattacktoggle.age_1_insta = el.checked ? true: false},
  combat_bow_spam:                            (el) => { combatattacktoggle.bow_spam = el.checked ? true: false},

  combat_defense_armor:                       (el) => { combatarmortoggle.defense_armor = el.checked ? true : false},
  combat_biome_armor:                         (el) => { combatarmortoggle.biome_armor = el.checked ? true : false},
  combat_spike_armor:                         (el) => { combatarmortoggle.spike_armor = el.checked ? true : false},
  combat_animal_armor:                        (el) => { combatarmortoggle.animal_armor = el.checked ? true : false},
  combat_auto_emp:                            (el) => { combatarmortoggle.auto_emp = el.checked ? true : false},
  combat_auto_medic:                          (el) => { combatarmortoggle.auto_medic = el.checked ? true : false},
  combat_auto_invicible:                      (el) => { combatarmortoggle.auto_invicible = el.checked ? true : false},

  combat_placement_auto_placer:               (el) => { combatplacetoggle.Auto_Placer = el.checked ? true : false},
  combat_placement_auto_place:                (el) => { combatplacetoggle.auto_Place = el.checked ? true : false},
  combat_placement_auto_place_replace:        (el) => { combatplacetoggle.auto_Place_Replace = el.checked ? true : false},
  combat_placement_auto_replace:              (el) => { combatplacetoggle.auto_Replace = el.checked ? true : false},
  combat_placement_auto_preplacer:            (el) => { combatplacetoggle.auto_PrePlace = el.checked ? true : false},
  combat_placement_defense_placement:         (el) => { combatplacetoggle.defense_placement = el.checked ? true : false},
  combat_placement_auto_windmill:             (el) => { combatplacetoggle.auto_windmill = el.checked ? true : false},
  combat_placement_auto_grind:                (el) => { combatplacetoggle.auto_grind = el.checked ? true : false},


  visualstracer_enemie:                       (el) => { visualtoggle.tracer_enemie = el.checked ? true : false},
  visualstracer_teammate:                     (el) => { visualtoggle.tracer_teammate = el.checked ? true : false},
  visualstracer_animal:                       (el) => { visualtoggle.tracer_animal = el.checked ? true : false},
  visualstracer_notfication:                  (el) => { visualtoggle.tracer_notfication = el.checked ? true : false},
  visualstracer_bot:                          (el) => { visualtoggle.tracer_bot = el.checked ? true : false},
  visualstracer_clanleader:                   (el) => { visualtoggle.tracer_clanleader = el.checked ? true : false},
  visualstracer_skull:                        (el) => { visualtoggle.tracer_skull = el.checked ? true : false},
  visualstracer_enemie_object:                (el) => { visualtoggle.tracer_enemie_object = el.checked ? true : false},
  visualstracer_teammate_object:              (el) => { visualtoggle.tracer_teammate_object = el.checked ? true : false},
  visualstracer_my_object:                    (el) => { visualtoggle.tracer_my_object = el.checked ? true : false},
  visualstracer_arrows:                       (el) => { visualtoggle.tracer_arrows = el.checked ? false : true},

  visualsobject_my_mark:                      (el) => { visualtoggle.object_my_mark = el.checked ? true : false},
  visualsobject_enemy_mark:                   (el) => { visualtoggle.object_enemy_mark = el.checked ? true : false},
  visualsobject_teammate_mark:                (el) => { visualtoggle.object_teammate_mark = el.checked ? true : false},
  visualsobject_my_health:                    (el) => { visualtoggle.object_my_health = el.checked ? true : false},
  visualsobject_enemy_health:                 (el) => { visualtoggle.object_enemy_health = el.checked ? true : false},
  visualsobject_teammate_health:              (el) => { visualtoggle.object_teammate_health = el.checked ? true : false},

  visualsmap_volcano_area:                    (el) => { visualtoggle.visualsmap_volcano_area = el.checked ? true : false},
  visualsmap_volcano_spawn_animals_area:      (el) => { visualtoggle.visualsmap_volcano_spawn_animals_area = el.checked ? true : false},
  visualsmap_volcano_damage_area:             (el) => { visualtoggle.visualsmap_volcano_damage_area = el.checked ? true : false},

  visual_look_angel:                          (el) => { visualtoggle.look_angel = el.checked ? true : false},
  visual_move_angel:                          (el) => { visualtoggle.move_angel = el.checked ? true : false},

  visualplayer_turret_reload_bar:             (el) => { visualtoggle.player_turret_reload_bar = el.checked ? true : false},
  visualplayer_weapon_reload_bar:             (el) => { visualtoggle.player_weapon_reload_bar = el.checked ? true : false},
  visualplayer_health_bar:                    (el) => { visualtoggle.player_health_bar = el.checked ? true : false},
  visualplayer_hp_shame:                      (el) => { visualtoggle.player_hp_shame = el.checked ? true : false},
  visualplayer_knockback_path:                (el) => { visualtoggle.player_knockback_path = el.checked ? true : false},
  visualplayer_auto_push_path:                (el) => { visualtoggle.player_auto_push_path = el.checked ? true : false},
};
function csaveState(id, checked) {
    localStorage.setItem("checkbox_" + id, checked ? "1" : "0");
}
function cloadState(id) {
    const saved = localStorage.getItem("checkbox_" + id);
    const defaultOn = [
    "visualstracer_enemie","visualstracer_teammate","visualstracer_animal","visualstracer_arrows",
    "visualsobject_my_mark","visualsobject_enemy_mark","visualsobject_teammate_mark","visualsobject_my_health",
    "visualsobject_enemy_health","visualsobject_teammate_health","visualplayer_health_bar","visualplayer_weapon_reload_bar",
    "visualplayer_turret_reload_bar","visualplayer_hp_shame","visualsmap_volcano_area",
  "combat_insta_kill",
  "combat_manual_tick",
  "combat_auto_sync",
  "combat_spike_tick",
  "combat_spike_sync",
  "combat_spike_sync_onpushing",
  "combat_knockback_tick",
  "combat_velocity_tick",
  "combat_spikegear_tick",
  "combat_spikegear_hammer_tick",
  "combat_auto_push",
  "combat_auto_steal",
  "combat_bull_hit",
  "combat_turret_combat",
  "combat_turret_sync",
  "combat_predictive_aim",
  "combat_static_based",
  "combat_safe_spikegear_tick",
  "combat_tryspiketick",
    "combat_safewalk","combat_healing","combat_autobreak","combat_auto_q",
    "combat_defense_armor","combat_biome_armor","combat_spike_armor","combat_animal_armor","combat_auto_emp","combat_placement_auto_placer",
    "combat_placement_auto_place","combat_placement_auto_place_replace","combat_placement_auto_replace","combat_placement_auto_preplacer","combat_placement_defense_placement","combat_placement_auto_windmill",
    ];
if (defaultOn.includes(id) && saved === null) {
        return true;
    }
    return saved === "1";
}
const cwatcher = setInterval(() => {
  let found = 0;
  for (let id of ccheckIDs) {
    const el = document.getElementById(id);
    if (el && !el.dataset.listenerAdded) {
      const saved = cloadState(id);
      el.checked = saved;
      ccheckActions[id](el);
      if (id === "car006" && el.checked) {
          const bArmor = document.getElementById("car001");
          const dArmor = document.getElementById("car002");
          if(bArmor) bArmor.disabled = true;
          if(dArmor) dArmor.disabled = true;
      }
      el.addEventListener("change", () => {
        ccheckActions[id](el);
        csaveState(id, el.checked);
      });
      el.dataset.listenerAdded = "true";
      found++;
    }
  }
  if (found === ccheckIDs.length) clearInterval(cwatcher);
}, 500);
const MOD_VERSION = "1.3.1";
function checkVersionAndReset() {
    const savedVersion = localStorage.getItem("mod_version");
    if (savedVersion !== MOD_VERSION) {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith("checkbox_")) {
                localStorage.removeItem(key);
            }
        });
        localStorage.setItem("mod_version", MOD_VERSION);
    }
}
checkVersionAndReset();



const menuScaleSlider = document.getElementById('menuScaleSlider');
const menuScaleVal = document.getElementById('menuScaleVal');

/**
 * Ölçünü tətbiq edən əsas funksiya
 */
function applyGlobalScale(val) {
    const scaleDecimal = val / 100;

    // CSS dəyişənini (root səviyyəsində) yeniləyirik
    // Bu, həm #daemonclient, həm də animasiyadakı var(--mscale) üçün işləyir
    document.documentElement.style.setProperty('--mscale', scaleDecimal);
}

if (menuScaleSlider) {
    // 1. Slideri dartanda: Menyu qaçmasın deyə ölçü dəyişmir, yalnız rəqəm dəyişir
    menuScaleSlider.oninput = function() {
        if (menuScaleVal) {
            menuScaleVal.innerText = this.value + "%";
        }
    };

    // 2. Slideri buraxanda: Menyu dərhal seçilən ölçüyə gəlir və yaddaşa yazılır
    menuScaleSlider.onchange = function() {
        let val = this.value;
        applyGlobalScale(val);
        localStorage.setItem('daemon_scale_save', val);
    };
}

/**
 * Yaddaşdan yükləmə
 */
function loadScale() {
    const saved = localStorage.getItem('daemon_scale_save') || 100;

    if (menuScaleSlider) {
        menuScaleSlider.value = saved;
    }
    if (menuScaleVal) {
        menuScaleVal.innerText = saved + "%";
    }

    applyGlobalScale(saved);
}

// Səhifə açılan kimi və 1 saniyə sonra (təhlükəsizlik üçün) işə sal
loadScale();
setTimeout(loadScale, 1000);
// range color
// Elementləri seçirik
const colorSlider = document.getElementById('sectionColorSlider');
const colorValue = document.getElementById('sectionColorVal');
const dynamicCircle = document.getElementById('dynamicColorCircle');
const resetBtn = document.getElementById('resetColorBtn');
const daemonLogo = document.getElementById('daemonLogoText'); // Yeni əlavə

function applyTheme(hue, isReset = false) {
    const boxes = document.querySelectorAll('.backsection-box');
    const headers = document.querySelectorAll('.backsection-box h2');
    const daemonLogo = document.getElementById('daemonLogoText');
    const menuHeader = document.getElementById('menuheader'); // Headeri seçirik

    if (isReset || hue === null || hue === "0") {
        // --- RESET HALI ---
        if (dynamicCircle) dynamicCircle.style.backgroundColor = '#bfbfbf';

        if (daemonLogo) {
            daemonLogo.style.color = "#ffffff";
            daemonLogo.style.textShadow = "none";
        }

        if (menuHeader) {
            menuHeader.style.borderBottom = "none";
            menuHeader.style.boxShadow = "none";
        }

        boxes.forEach(box => {
            box.style.borderLeft = "none";
            box.style.boxShadow = "none";
            box.style.background = "#0d0c0c";
        });

        headers.forEach(h2 => {
            h2.style.textShadow = "none";
            h2.style.color = "#bfbfbf";
        });
    } else {
        // --- RƏNGLİ HAL ---
        const mainColor = `hsl(${hue}, 100%, 50%)`;

        if (dynamicCircle) dynamicCircle.style.backgroundColor = mainColor;

        // Daemon Client yazısı
        if (daemonLogo) {
            daemonLogo.style.color = mainColor;
            daemonLogo.style.textShadow = `0 0 10px ${mainColor}`;
        }

        // MENU HEADER - Altına rəngli xətt və yüngül parıltı
        if (menuHeader) {
            menuHeader.style.borderBottom = `2px solid ${mainColor}`;
            menuHeader.style.boxShadow = `0 4px 15px -5px ${mainColor}`;
            menuHeader.style.transition = "all 0.2s ease";
        }

        boxes.forEach(box => {
            box.style.borderLeft = `5px solid ${mainColor}`;
            box.style.boxShadow = `inset 10px 0 15px -10px ${mainColor}`;
        });

        headers.forEach(h2 => {
            h2.style.textShadow = `0 0 10px ${mainColor}`;
        });
    }
}

// LocalStorage funksiyaları eyni qalır...
colorSlider.oninput = function() {
    let val = this.value;
    colorValue.innerText = val;
    localStorage.setItem('moomoo_theme_hue', val);
    applyTheme(val);
};

resetBtn.onclick = function() {
    localStorage.removeItem('moomoo_theme_hue');
    colorSlider.value = 0;
    colorValue.innerText = "0";
    applyTheme(0, true);
};

// Yaddaşı dərhal yoxla
const savedHue = localStorage.getItem('moomoo_theme_hue');
if (savedHue) {
    applyTheme(savedHue);
    colorSlider.value = savedHue;
    colorValue.innerText = savedHue;
} else {
    applyTheme(0, true);
}
// Range Bars
document.querySelectorAll('.modern-range').forEach(slider => {
    slider.addEventListener('input', function() {
        const valueDisplay = this.parentElement.querySelector('.range-value');
        valueDisplay.innerText = this.value;
    });
});
const radiusSlider01 = document.getElementById('ap-autoplacer-radius-slider');
const radiusDisplay01 = document.getElementById('autoplaceradius-val');
radiusSlider01.value = autoplacerrange;
radiusDisplay01.textContent = autoplacerrange;
radiusSlider01.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay01.textContent = val;
    autoplacerrange = parseInt(val);
    localStorage.setItem('autoPlacerRadius', val);
});
const radiusSlider02 = document.getElementById('ap-defense-radius-slider');
const radiusDisplay02 = document.getElementById('defenseradius-val');
radiusSlider02.value = defensearmorrange;
radiusDisplay02.textContent = defensearmorrange;
radiusSlider02.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay02.textContent = val;
    defensearmorrange = parseInt(val);
    localStorage.setItem('defenceRadius', val);
});

const radiusSlider06 = document.getElementById('bot-radius');
const radiusDisplay06 = document.getElementById('bot-val');
radiusSlider06.value = botfollow;
radiusDisplay06.textContent = botfollow;
radiusSlider06.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay06.textContent = val;
    botfollow = parseInt(val);
    localStorage.setItem('botfollow', val);
});

const radiusSlider03 = document.getElementById('ap-speed-radius-slider');
const radiusDisplay03 = document.getElementById('speedradius-val');
radiusSlider03.value = speedinvis;
radiusDisplay03.textContent = speedinvis;
radiusSlider03.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay03.textContent = val;
    speedinvis = parseFloat(val);
    localStorage.setItem('speedinvis', val);
});

const radiusSlider04 = document.getElementById('speed-mill');
const radiusDisplay04 = document.getElementById('mill-val');
radiusSlider04.value = millrota;
radiusDisplay04.textContent = millrota;
radiusSlider04.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay04.textContent = val;
    millrota = parseFloat(val);
    localStorage.setItem('millrota', val);
});
const radiusSlider05 = document.getElementById('speed-spike');
const radiusDisplay05 = document.getElementById('spike-val');
radiusSlider05.value = spikerota;
radiusDisplay05.textContent = spikerota;
radiusSlider05.addEventListener('input', function() {
    let val = this.value;
    radiusDisplay05.textContent = val;
    spikerota = parseFloat(val);
    localStorage.setItem('spikerota', val);
});

//end Range Bars

const clientMenu = document.getElementById('daemonclient');
const transa = document.getElementById('transa-radius');
const transara = document.getElementById('transa');
function updateOpacity(value) {
    let opacityDecimal = value / 100;
    clientMenu.style.setProperty('opacity', opacityDecimal, 'important');
}
transa.value = transaparan;
transara.textContent = transaparan;
updateOpacity(transaparan);
transa.addEventListener('input', function() {
    let val = this.value;
    transara.textContent = val;
    localStorage.setItem('transaparan', val);
    updateOpacity(val);
});

(function() {
    // 1. Papaqların siyahısı
const allHats = [
    {id: 45, name: "Shame!"},
    {id: 51, name: "Moo Cap"},
    {id: 50, name: "Apple Cap"},
    {id: 28, name: "Moo Head"},
    {id: 29, name: "Pig Head"},
    {id: 30, name: "Fluff Head"},
    {id: 36, name: "Pandou Head"},
    {id: 37, name: "Bear Head"},
    {id: 38, name: "Monkey Head"},
    {id: 44, name: "Polar Head"},
    {id: 35, name: "Fez Hat"},
    {id: 42, name: "Enigma Hat"},
    {id: 43, name: "Blitz Hat"},
    {id: 49, name: "Bob XIII Hat"},
    {id: 57, name: "Pumpkin"},
    {id: 8, name: "Bummle Hat"},
    {id: 2, name: "Straw Hat"},
    {id: 15, name: "Winter Cap"},
    {id: 5, name: "Cowboy Hat"},
    {id: 4, name: "Ranger Hat"},
    {id: 18, name: "Explorer Hat"},
    {id: 31, name: "Flipper Hat"},
    {id: 1, name: "Marksman Cap"},
    {id: 10, name: "Bush Gear"},
    {id: 48, name: "Halo"},
    {id: 6, name: "Soldier Helmet"},
    {id: 23, name: "Anti Venom Gear"},
    {id: 13, name: "Medic Gear"},
    {id: 9, name: "Miners Helmet"},
    {id: 32, name: "Musketeer Hat"},
    {id: 7, name: "Bull Helmet"},
    {id: 22, name: "Emp Helmet"},
    {id: 12, name: "Booster Hat"},
    {id: 26, name: "Barbarian Armor"},
    {id: 21, name: "Plague Mask"},
    {id: 46, name: "Bull Mask"},
    {id: 14, name: "Windmill Hat"},
    {id: 11, name: "Spike Gear"},
    {id: 53, name: "Turret Gear"},
    {id: 20, name: "Samurai Armor"},
    {id: 58, name: "Dark Knight"},
    {id: 27, name: "Scavenger Gear"},
    {id: 40, name: "Tank Gear"},
    {id: 52, name: "Thief Gear"},
    {id: 55, name: "Bloodthirster"},
    {id: 56, name: "Assassin Gear"}
];

    let userCustomTextures = JSON.parse(localStorage.getItem('user_textures') || '{}');

    // 2. Texture Hook (Şəkilləri Dəyişdirən Mexanizm)
    const originalSrc = Object.getOwnPropertyDescriptor(Image.prototype, 'src');
    Object.defineProperty(Image.prototype, 'src', {
        set(url) {
            let newUrl = url;
            if (typeof url === 'string') {
                for (let id in userCustomTextures) {
                    if (url.includes(`hat_${id}.png`)) {
                        newUrl = userCustomTextures[id];
                        return originalSrc.set.call(this, newUrl);
                    }
                }
            }
            originalSrc.set.call(this, newUrl);
        },
        get() { return originalSrc.get.call(this); }
    });

    // 3. Menyu Generatoru (HTML-i dolduran)
    function generateTextureMenu() {
        const container = document.querySelector('.texture-scroll-container');
        if (!container) return;

        let html = '';
        allHats.forEach(hat => {
            html += `
            <div class="texture-row" data-id="${hat.id}">
                <div class="texture-info">${hat.name} (ID: ${hat.id})</div>
                <div class="texture-visuals">
                    <div class="visual-box original">
                        <img src="https://moomoo.io/img/hats/hat_${hat.id}.png">
                        <div class="label">Original</div>
                    </div>
                    <div class="arrow">➜</div>
                    <div class="visual-box drop-zone" id="drop-zone-${hat.id}">
                        <img src="" id="preview-${hat.id}" style="display: none;">
                        <div class="drop-text" id="text-${hat.id}">Drop PNG</div>
                        <div class="remove-tex" id="remove-${hat.id}">×</div>
                    </div>
                </div>
            </div>`;
        });
        container.innerHTML = html;
        attachMenuEvents();
    }

    // 4. Drop və Click Eventləri
    function attachMenuEvents() {
        allHats.forEach(hat => {
            const id = hat.id;
            const dropZone = document.getElementById(`drop-zone-${id}`);
            const preview = document.getElementById(`preview-${id}`);
            const text = document.getElementById(`text-${id}`);
            const remove = document.getElementById(`remove-${id}`);

            if (!dropZone) return;

            // Yaddaşda olanları yüklə
            if (userCustomTextures[id]) {
                preview.src = userCustomTextures[id];
                preview.style.display = 'block';
                text.style.display = 'none';
                remove.style.display = 'flex';
            }

            // Drag & Drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(n => {
                dropZone.addEventListener(n, e => { e.preventDefault(); e.stopPropagation(); });
            });

            dropZone.addEventListener('drop', e => {
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = ev => {
                        userCustomTextures[id] = ev.target.result;
                        preview.src = ev.target.result;
                        preview.style.display = 'block';
                        text.style.display = 'none';
                        remove.style.display = 'flex';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Tək-tək silmə
            remove.addEventListener('click', e => {
                e.stopPropagation();
                delete userCustomTextures[id];
                preview.src = "";
                preview.style.display = 'none';
                text.style.display = 'block';
                remove.style.display = 'none';
            });
        });

        // Save düyməsi
        document.getElementById('save-textures').onclick = () => {
            localStorage.setItem('user_textures', JSON.stringify(userCustomTextures));
            window.location.reload();
        };

        // Reset düyməsi
        document.getElementById('reset-all-textures').onclick = () => {
            if(confirm("Bütün texture-lar silinsin?")) {
                localStorage.removeItem('user_textures');
                window.location.reload();
            }
        };
    }

    // Başla
    window.addEventListener('load', () => {
        setTimeout(generateTextureMenu, 1500);
    });
})();



// Uptade log
(function() {
    'use strict';
    const style = document.createElement('style');
    style.innerHTML = `
/* --- Modal Əsas Dizaynı --- */
.daemon-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 999999;
}

.daemon-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 450px;
    background: #0a0a0a;
    border: 2px solid #2e2e2e;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0, 0, 0, 1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.daemon-modal-header {
    background: #151515;
    padding: 12px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #222;
    color: #949494;
    font-family: sans-serif;
    font-weight: bold;
}

.daemon-close-btn { cursor: pointer; color: #666; font-size: 20px; }
.daemon-close-btn:hover { color: #ff4444; }

/* --- Modal Body və SCROLLBAR Dizaynı --- */
.daemon-modal-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    color: white;
    font-family: sans-serif;

    /* Firefox üçün scrollbar */
    scrollbar-width: thin;
    scrollbar-color: #333 #0a0a0a;
}

/* Chrome, Edge və Safari üçün Scrollbar stili */
.daemon-modal-body::-webkit-scrollbar {
    width: 6px;
}

.daemon-modal-body::-webkit-scrollbar-track {
    background: #0a0a0a;
    border-radius: 10px;
}

.daemon-modal-body::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 10px;
}

.daemon-modal-body::-webkit-scrollbar-thumb:hover {
    background: #444;
}

/* --- Update Log Dizaynı --- */
.update-log-container {
    padding: 5px 10px;
}

.version-title {
    color: #b0b0b0;
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-weight: 700;
    font-size: 22px;
    letter-spacing: 0.5px;
    margin: 0;
    padding-bottom: 8px;
    border-bottom: 2px solid rgba(176, 176, 176, 0.3);
    display: block;
    width: 100%;
}

/* Alt başlıqlar (Combat, Keybinds) */
.sub-title {
    color: #b0b0b0;
    font-family: 'Segoe UI', sans-serif;
    font-weight: 700;
    font-size: 16px;
    margin: 15px 0 5px 10px;
    padding: 0;
    display: inline-block;
    position: relative;
    line-height: 1;
}

.sub-title::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -3px;
    width: calc(100% + 15px);
    height: 1.5px;
    background-color: rgba(176, 176, 176, 0.25);
}

/* Update Siyahısı */
.update-list {
    list-style: none;
    padding: 0;
    margin: 5px 0 15px 10px;
}

.update-list li {
    color: #b0b0b0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    font-size: 15px;
    margin-bottom: 6px;
    display: block;
}

/* Vurğulanmış sözlər (Highlight) */
.highlight {
    color: #ffffff;
    font-weight: 700;
    margin-right: 4px;
    letter-spacing: 0.2px;
}
`;
    document.head.appendChild(style);

    // 2. HTML panelini səhifənin sonuna inyeksiya edirik
    const modalHTML = `
        <div id="daemon-modal-wrapper" class="daemon-modal-overlay">
            <div class="daemon-modal-content">
                <div class="daemon-modal-header">
                    <span>Uptade Log</span>
                    <div class="daemon-close-btn" onclick="toggleDaemonModal()">✕</div>
                </div>
                <div id="daemon-modal-body" class="daemon-modal-body">
<div class="update-log-container">
        <h2 class="version-title">V${CURRENT_VERSION} <span style="color:#4CAF50;">Released</span></h2>

        <h3 class="sub-title">Basic</h3>
<ul class="update-list">
   <li><span class="highlight">Prediction Ghost</span> was added to misc section. Your shadow predicts your position half a second into the future.</li>
   <li><span class="highlight">Safe Walk Spikes (Stops)</span> was added to combat section. Moving towards spikes will now be restricted when you are close to them.</li>
   <li><span class="highlight">Auto Medic</span> was added to combat section. The mod automatically equips Medic Gear and Angel Wings when your health is low and defense armor is not active.</li>
   <li><span class="highlight">Texture Pack section</span> was added to menu. Now you can create your own texture packs by simply uploading any hat from your device! Plus, all your changes are automatically saved by the mod.</li>
   <li><span class="highlight">Auto Emp</span> was improved. Now wears Emp helmet when have two or much turret on map.</li>
   <li><span class="highlight">Hits & Auto Break</span> was improved. The post-hit hat swap will now function in sync with the EMP detect.</li>
   <li><span class="highlight">Bots section</span> was added to menu. Now you can use Sync bots.</li>
   <li><span class="highlight">Bots Spawner</span> was improved. You can remove one by one bots or remove all bots on one button.</li>
   <li><span class="highlight">Bow Tick</span> was added to combat section. This requires a Hunting Bow and reaching (or staying at) Age 7. <b>It works on middle click</b>.</li>
   <li><span class="highlight">Age 1 Insta</span> was added to combat section.This requires a reaching (or staying at) Age 2. <b>It works on middle click</b></li>
   <li><span class="highlight">Bow Spam</span> was added to combat section. <b>It works on middle click</b></li>
   <li><span class="highlight">Bow Tick Target</span> was added. Can be see when use hunting bow.</li>
   <li><span class="highlight">Placement Defense</span> was Improved.</li>
   <li><span class="highlight">Menu Scale</span> was added to interface section.</li>
   <li><span class="highlight">Menu Colors</span> was added to interface section.</li>
   <li><span class="highlight">Auto Chat</span> was added to misc section.</li>
</ul>

        <h3 class="sub-title">Other</h3>
<ul class="update-list">
   <li><span class="highlight">Some Visuals</span> was added. For help combats.</li>
   <li><span class="highlight">Hidden HUD</span> was added to misc section.</li>
   <li><span class="highlight">Aim Angel</span> was added to visual section.</li>
   <li><span class="highlight">Move Angel</span> was added to visual section.</li>
</ul>


</div>
                </div>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    window.toggleDaemonModal = function() {
        const modal = document.getElementById('daemon-modal-wrapper');
        if (modal) {
            modal.style.display = (modal.style.display === "none" || modal.style.display === "") ? "block" : "none";
        }
    };
    // --- Yoxlama Məntiqi ---
    const lastVersion = localStorage.getItem('daemon_update_version');
    if (lastVersion !== CURRENT_VERSION) {
        window.toggleDaemonModal(); // Pəncərəni aç
        localStorage.setItem('daemon_update_version', CURRENT_VERSION); // Bu versiyanı yaddaşa yaz
    }

})();

const notifContainer = document.createElement("div");
notifContainer.id = "playerNotifContainer";
notifContainer.style = `
    position: absolute;
    top: 30px; /* Yuxarıdan 30px aşağıda */
    left: 20px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    pointer-events: none;
    z-index: 999;
    font-family: 'Ubuntu', sans-serif;z
`;
document.body.appendChild(notifContainer);

const style = document.createElement('style');
style.innerHTML = `
    @keyframes slideIn {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    .player-notif {
        background: none !important; /* Arxa fon silindi */
        border: none !important;     /* Çərçivə silindi */
        padding: 2px 0;
        font-weight: bold;
        font-size: 17px;
        animation: slideIn 0.3s ease-out forwards;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); /* Yazının oxunması üçün yüngül kölgə */
    }
`;
document.head.appendChild(style);


function pushNotify(message, type) {
    const div = document.createElement("div");
    div.className = "player-notif";
    div.style.color = type;
    div.innerText = message;
    notifContainer.appendChild(div);
    setTimeout(() => {
        div.style.animation = "fadeOut 0.5s ease-in forwards";
        setTimeout(() => div.remove(), 500);
    }, 3000);
}

    const style2 = document.createElement('style');
    style2.innerHTML = `
        #status-panel-container {
            position: fixed; top: 35px; left: 20px; z-index: 999999;
            display: flex; flex-direction: column; gap: 8px; pointer-events: none;
        }
        .status-card {
            background: rgba(10, 10, 10, 0.95); color: white;
            padding: 20px 26px; border-left: 4px solid #00ff00;
            font-family: 'Segoe UI', Tahoma, sans-serif; min-width: 180px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.6);
            animation: slideInNotify 0.3s ease-out;
        }
        .status-card h4 { margin: 0; font-size: 13px; font-weight: bold; text-transform: capitalize; }
        .status-card p { margin: 2px 0; font-size: 11px; color: #aaa; }
        .status-card .st-val { font-size: 11px; font-weight: bold; }
        @keyframes slideInNotify { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    `;
    document.head.appendChild(style2);

    const container = document.createElement('div');
    container.id = 'status-panel-container';
    document.body.appendChild(container);

    // Bildiriş funksiyası
    window.notifyStatus = function(name, state) {
        const card = document.createElement('div');
        card.className = 'status-card';
        card.style.borderLeftColor = state ? '#00ff00' : '#ff3333';
        const title = name.replace(/_/g, ' '); // Alt xəttləri boşluqla əvəz edir
        card.innerHTML = `
            <h4>${title}</h4>
            <p>${title} toggled</p>
            <div class="st-val">Status: ${state ? 'ON' : 'OFF'}</div>
        `;
        container.appendChild(card);
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transition = '0.5s';
            setTimeout(() => card.remove(), 500);
        }, 2500);
    };




// Əsas optimizasiya funksiyası
function applyOptimizations() {
    if (misctoggle.optimation) {
        if (window.config) {
            window.config.drawParticles = false; // Hissəciklər söndürülür
            window.config.drawClouds = false; // Buludlar söndürülür
            window.config.drawSkins = false; // Skinlər gizlədilir (sadə dairələr)
            window.config.renderDistance = 0.7; // Daha az sahə rəndərlənir
        }
        window.maxFPS = 60;
        document.body.style.imageRendering = "pixelated"; // GPU-nu rahatladır
    } else {
        if (window.config) {
            window.config.drawParticles = true;
            window.config.drawClouds = true;
            window.config.drawSkins = true;
            window.config.renderDistance = 1.0;
        }
        document.body.style.imageRendering = "auto";
    }
}

setInterval(() => {
    applyOptimizations();
}, 2000);